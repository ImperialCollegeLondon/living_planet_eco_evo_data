{"version":2,"kind":"Notebook","sha256":"f3acc764ff6cc27ba2fb2c52267afdf898f35ee6af2cf1f073d2244516e23781","slug":"gis-practical","location":"/gis_practical/gis_practical.md","dependencies":[],"frontmatter":{"title":"Spatial methods in Ecological and Evolutionary Data Science","kernelspec":{"name":"ir","display_name":"R","language":"R"},"jupytext":{"formats":"md:myst","text_representation":{"extension":".md","format_name":"myst","format_version":"0.13","jupytext_version":"1.18.1"}},"content_includes_title":false,"authors":[{"nameParsed":{"literal":"David Orme","given":"David","family":"Orme"},"name":"David Orme","id":"contributors-myst-generated-uid-0"}],"exports":[{"format":"md","filename":"gis_practical.md","url":"https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/gis_practical-f421375163f7eb2006a1a48fa8ae813f.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":17,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"This webpage provides one long self-paced practical that provides an introduction to key\nspatial data handling and analysis techniques for use with the Ecological and\nEvolutionary Data Science. This practical uses ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"Ms9x2MuivN"},{"type":"link","url":"https://cran.r-project,org","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"the R programming\nlanguage","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"Xp2GB47RAR"}],"urlSource":"https://cran.r-project,org","key":"nFP9NgaVpo"},{"type":"text","value":" to load, manipulate and analyse spatial data.","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"S1RT7eQyl7"}],"key":"aijhuvkLdN"},{"type":"paragraph","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"There are a number of reasons for using R:","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"yI5GgVuhtL"}],"key":"HX5vAaJwMG"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":24,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"It is an open-source, cross-platform and free program.","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"q6vAvNHLD0"}],"key":"XpppTdXyjB"}],"key":"jdMm4tY4RP"},{"type":"listItem","spread":true,"position":{"start":{"line":25,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"It provides a powerful set of GIS data tools and packages extend this GIS\nfunctionality into a well estabished ecosystem of R packages for ecological and\nevolutionary analysis, including species distribution modelling, population genetics\nand many other areas.","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"NpP70MWn0Q"}],"key":"VSn8d4Io1f"}],"key":"NYOoOrXmsV"},{"type":"listItem","spread":true,"position":{"start":{"line":29,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Writing spatial analyses as R scripts provides a clear reproducible research record.","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"IUwNr998Ss"}],"key":"faNn1aecd4"}],"key":"VQN5nWK9bn"}],"key":"Favay4f4yW"},{"type":"paragraph","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"children":[{"type":"text","value":"There are disadvantages to using R as a GIS platform:","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"EOpr0HcZSS"}],"key":"NaxJ9BKvFc"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":33,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":33,"column":1},"end":{"line":35,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Principally, although it can create very high quality spatial graphics, it is not a\nGIS data visualiser and explorer program. It is not as easy to zoom and pan around\nspatial datasets in R or to alter the way in which a set of layers overlay each other.","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"MyCkkaNsUf"}],"key":"qpHb6TAYFV"}],"key":"GZhYWnpTBz"},{"type":"listItem","spread":true,"position":{"start":{"line":36,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"It can also be difficult to find the exact set of commands you need to get the result\nyou are after (although this can also be true of other systems)!","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"yeMXKjpy8P"}],"key":"WeYg536yYi"}],"key":"Hrl0WfUgaT"}],"key":"BQkiAJrn2Z"},{"type":"paragraph","position":{"start":{"line":39,"column":1},"end":{"line":40,"column":1}},"children":[{"type":"text","value":"If you end up using GIS more widely in your research project, you may find it useful to\nlook at other GIS programs for exploring and visualising data:","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"IWU3RY5YAp"}],"key":"hCatPkKNrj"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":42,"column":1},"end":{"line":48,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":42,"column":1},"end":{"line":45,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The most well known is probably the ESRI ArcGIS package: Imperial College London does\nhave a ","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"bmsc66dDfN"},{"type":"link","url":"https://www.imperial.ac.uk/admin-services/ict/self-service/computers-printing/devices-and-software/get-software/get-software-for-students/arcgis/","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"children":[{"type":"text","value":"licensing agreement for\nArcGIS","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"wIw3m03sJP"}],"urlSource":"https://www.imperial.ac.uk/admin-services/ict/self-service/computers-printing/devices-and-software/get-software/get-software-for-students/arcgis/","key":"p85Qatv7LG"},{"type":"text","value":"\nbut it is Windows only software and is expensive to use.","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"GJC89yjBiZ"}],"key":"HV05skXm6i"}],"key":"ajpJcquOnZ"},{"type":"listItem","spread":true,"position":{"start":{"line":46,"column":1},"end":{"line":48,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The ","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"GFosAcrvIO"},{"type":"link","url":"https://qgis.org/","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"children":[{"type":"text","value":"QGIS program","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"V07fzx0Gix"}],"urlSource":"https://qgis.org/","key":"SUcDoViDtu"},{"type":"text","value":" is an open source and cross platform\nalternative to ArcGIS and is very worth exploring.","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"LpvaTtPe8w"}],"key":"NGw4Fs5T4m"}],"key":"Qy3xQatIWw"}],"key":"FHNJz1IMHO"},{"type":"paragraph","position":{"start":{"line":49,"column":1},"end":{"line":50,"column":1}},"children":[{"type":"text","value":"You might also want to look at geocomputation in other programming languages. The\n","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"key":"cINmTZrvNy"},{"type":"link","url":"https://geocompx.org/","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"children":[{"type":"text","value":"geocompx","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"key":"OtprDiDNB8"}],"urlSource":"https://geocompx.org/","key":"O2oAbjpJXt"},{"type":"text","value":" website provides an amazing resource for:","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"key":"hLVbj9UmxP"}],"key":"UMPcEzoseo"},{"type":"blockquote","position":{"start":{"line":52,"column":1},"end":{"line":53,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":52,"column":1},"end":{"line":53,"column":1}},"children":[{"type":"text","value":"reproducible geographic data analysis, modeling, and visualization with open source\nsoftware","position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"key":"kzwtUgi1mA"}],"key":"IPrXglnFKg"}],"key":"ABBH9u2yDE"},{"type":"paragraph","position":{"start":{"line":55,"column":1},"end":{"line":57,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},"key":"lid1IP8ikO"},{"type":"inlineCode","value":"geocompx","position":{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},"key":"sEMmshBpKt"},{"type":"text","value":" website provides guidance on using R, Python and Julia to do spatial\nanalysis and is a fantastic resource for learning more about using spatial data and\nprovides the ","position":{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},"key":"UZlBVheKZx"},{"type":"link","url":"https://r.geocompx.org/","position":{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},"children":[{"type":"text","value":"core R textbook","position":{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},"key":"RHwPUdpIbj"}],"urlSource":"https://r.geocompx.org/","key":"Qp6sI4AO87"},{"type":"text","value":" for this practical.","position":{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},"key":"pIFTyuw57N"}],"key":"lDUnxJP7wc"},{"type":"paragraph","position":{"start":{"line":59,"column":1},"end":{"line":60,"column":1}},"children":[{"type":"text","value":"Another great resource is the ","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"key":"vaWUKqZ9Rq"},{"type":"link","url":"https://rspatial.org/index.html","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"children":[{"type":"inlineCode","value":"rspatial","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"key":"fEqiq3rd3t"},{"type":"text","value":" website","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"key":"lLYWVRSD37"}],"urlSource":"https://rspatial.org/index.html","key":"TwLwoW7E97"},{"type":"text","value":",\nwhich provides a lot of information on using ","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"key":"kECN1RukTy"},{"type":"inlineCode","value":"terra","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"key":"Sv1HaEYJgP"},{"type":"text","value":" and other spatial tools in R.","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"key":"WvrJcTLJGB"}],"key":"OUci58RZ4j"},{"type":"heading","depth":2,"position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"children":[{"type":"text","value":"Required packages","position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"key":"yj6QtmbPbQ"}],"identifier":"required-packages","label":"Required packages","html_id":"required-packages","implicit":true,"key":"Su8BF8SEcV"},{"type":"paragraph","position":{"start":{"line":64,"column":1},"end":{"line":66,"column":1}},"children":[{"type":"text","value":"We will need to load the following packages. Remember to read ","position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"key":"qd8pxGKMCU"},{"type":"link","url":"/required-packages","position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"children":[{"type":"text","value":"this guide on setting up\npackages on your computer","position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"key":"cE2SgLX60Z"}],"urlSource":"../required_packages.md","dataUrl":"/required-packages.json","internal":true,"protocol":"file","key":"qLg9dqOyHG"},{"type":"text","value":" before running these practicals\non your own machine.","position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"key":"bQKzvcqllu"}],"key":"bTmkaoCfmE"}],"key":"xFuR5zbcGO"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"library(terra)       # core raster GIS package\nlibrary(sf)          # core vector GIS package\nlibrary(units)       # used for precise unit conversion\nlibrary(rcartocolor) # plotting\nlibrary(rpart)\n\n# library(geodata)   # Download and load functions for core datasets\n# library(openxlsx)  # Reading data from Excel files","visibility":"show","key":"JKILWY2Vzf"},{"type":"output","id":"lKshItLSgdbDjnqeo17Ty","data":[],"visibility":"show","key":"AzZpSUsM3D"}],"data":{"tags":["remove-stderr"]},"visibility":"show","key":"NEGZUxNGfM"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":81,"column":1},"end":{"line":83,"column":1}},"children":[{"type":"text","value":"You will see a whole load of package loading messages about GDAL, GEOS, PROJ which are\nnot shown here. Donâ€™t worry about this - they are not errors, just R linking to some key\nopen source GIS toolkits.","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"key":"US6aMsolHE"}],"key":"gkfs8akvzl"},{"type":"heading","depth":2,"position":{"start":{"line":85,"column":1},"end":{"line":85,"column":1}},"children":[{"type":"text","value":"Loading spatial datasets","position":{"start":{"line":85,"column":1},"end":{"line":85,"column":1}},"key":"phDIoME3Np"}],"identifier":"loading-spatial-datasets","label":"Loading spatial datasets","html_id":"loading-spatial-datasets","implicit":true,"key":"aA2YUeOFFu"},{"type":"heading","depth":3,"position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"children":[{"type":"text","value":"Field Data","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"biZnL857BU"}],"identifier":"field-data","label":"Field Data","html_id":"field-data","implicit":true,"key":"ix4PCtVELi"},{"type":"paragraph","position":{"start":{"line":89,"column":1},"end":{"line":93,"column":1}},"children":[{"type":"text","value":"We have location data for three field datasets and then a range of datasets providing\nadditional spatial data for the field sites  that you can use to set up and test\nhypotheses in your coursework. This practical will use these datasets to demonstrate a\nrange of different GIS methods in R: this section goes through loading the datasets into\nR.","position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"key":"jwkOOAXmeS"}],"key":"pz7a9eEOtW"},{"type":"heading","depth":4,"position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"children":[{"type":"text","value":"Sensor locations","position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"key":"WlzkcFPm91"}],"identifier":"sensor-locations","label":"Sensor locations","html_id":"sensor-locations","implicit":true,"key":"H1ap7NQQmp"},{"type":"paragraph","position":{"start":{"line":97,"column":1},"end":{"line":99,"column":1}},"children":[{"type":"text","value":"The sensor stations at Silwood and the NHM: a CSV file providing station data\nincluding the latitude and longitude of each site. This file is directly downloaded from\nthe Epicollect5 project.","position":{"start":{"line":97,"column":1},"end":{"line":97,"column":1}},"key":"fu2XJwoacG"}],"key":"sq5we5XjQr"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":101,"column":1},"end":{"line":118,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":101,"column":1},"end":{"line":103,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":101,"column":1},"end":{"line":102,"column":1}},"children":[{"type":"text","value":"This is vector point data: precise locations from GPS associated with additional site\ndata.","position":{"start":{"line":101,"column":1},"end":{"line":101,"column":1}},"key":"Rjqq3IcZUW"}],"key":"lfUHzjgwFe"}],"key":"KmHeMZZ3nF"},{"type":"listItem","spread":true,"position":{"start":{"line":104,"column":1},"end":{"line":105,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":104,"column":1},"end":{"line":104,"column":1}},"children":[{"type":"text","value":"The data is first loaded as a simple CSV file.","position":{"start":{"line":104,"column":1},"end":{"line":104,"column":1}},"key":"NE4mC9NFdw"}],"key":"pScofG6dPy"}],"key":"tXDOAOnr77"},{"type":"listItem","spread":true,"position":{"start":{"line":106,"column":1},"end":{"line":112,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":106,"column":1},"end":{"line":108,"column":1}},"children":[{"type":"text","value":"We then need to convert the data to an ","position":{"start":{"line":106,"column":1},"end":{"line":106,"column":1}},"key":"inCe0ZeuRU"},{"type":"inlineCode","value":"sf","position":{"start":{"line":106,"column":1},"end":{"line":106,"column":1}},"key":"vDU68hC968"},{"type":"text","value":" (simple features) object. This is very\nlike a normal R data frame, but contains an additional ","position":{"start":{"line":106,"column":1},"end":{"line":106,"column":1}},"key":"Rohn6n2AG7"},{"type":"inlineCode","value":"geometry","position":{"start":{"line":106,"column":1},"end":{"line":106,"column":1}},"key":"rK3FDDk6nr"},{"type":"text","value":" field that contains\nthe vector data geometries and the coordinate system.","position":{"start":{"line":106,"column":1},"end":{"line":106,"column":1}},"key":"ElpB7vkvHH"}],"key":"jPklq3psbl"},{"type":"paragraph","position":{"start":{"line":110,"column":1},"end":{"line":111,"column":1}},"children":[{"type":"text","value":"This is done using the ","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"ujScvblAnm"},{"type":"inlineCode","value":"sf::st_sf","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"osTGjBGFxX"},{"type":"text","value":" function to set the CSV fields that contain the\npoint coordinates.","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"gt629br3Up"}],"key":"BchYmKB5kD"}],"key":"qkV2svOGFT"},{"type":"listItem","spread":true,"position":{"start":{"line":113,"column":1},"end":{"line":118,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":113,"column":1},"end":{"line":117,"column":1}},"children":[{"type":"text","value":"We also need to set the projection of the data: this is GPS data, so consists of\ngeographic coordinates in degreees using the WGS84 geographic coordinate system.\nCoordinate system details are complex, but fortunately the EPSG database provides\nsimple numeric codes that make it easier to specify coordinate systems: WGS84 uses the\ncode ","position":{"start":{"line":113,"column":1},"end":{"line":113,"column":1}},"key":"FQ6aRy07XT"},{"type":"link","url":"https://epsg.io/4326","position":{"start":{"line":113,"column":1},"end":{"line":113,"column":1}},"children":[{"type":"inlineCode","value":"EPSG:4326","position":{"start":{"line":113,"column":1},"end":{"line":113,"column":1}},"key":"UAqwy0tH3w"}],"urlSource":"https://epsg.io/4326","key":"NgDNTnVsQl"},{"type":"text","value":".","position":{"start":{"line":113,"column":1},"end":{"line":113,"column":1}},"key":"QgB07MOMnr"}],"key":"TWO84S3DSt"}],"key":"uHVgyAS37N"}],"key":"Vrd9jMXDv5"}],"key":"yqu0G8HrlC"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Load the data from the CSV file\nsensor_locations <- read.csv(\"data/SensorSites/form-1__setup.csv\")\n\n# Convert to an sf object by setting the fields containing X and Y data and set \n# the projection of the dataset\nsensor_locations <- st_as_sf(\n  sensor_locations, \n  coords=c(\"long_Sensor_location\",\"lat_Sensor_location\"),\n  crs=\"EPSG:4326\"\n)","key":"lDN2CRhAni"},{"type":"output","id":"y3NXO6ugsvhnQkfHqXrvq","data":[],"key":"Dnp9FQGg8s"}],"key":"u5yo11aYsB"},{"type":"block","children":[{"type":"heading","depth":4,"position":{"start":{"line":132,"column":1},"end":{"line":132,"column":1}},"children":[{"type":"text","value":"Nest boxes","position":{"start":{"line":132,"column":1},"end":{"line":132,"column":1}},"key":"KhmgewT8xj"}],"identifier":"nest-boxes","label":"Nest boxes","html_id":"nest-boxes","implicit":true,"key":"rXmai1SWp2"},{"type":"paragraph","position":{"start":{"line":134,"column":1},"end":{"line":137,"column":1}},"children":[{"type":"text","value":"The locations of the Silwood blue tit nest boxes were also recorded using GPS. This is a\nlong-term dataset and these data have already been processed into specific GIS format:\nthe widely used ","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"key":"kP0emh34aO"},{"type":"link","url":"https://en.wikipedia.org/wiki/Shapefile","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"children":[{"type":"text","value":"shapefile format","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"key":"QAda82bezw"}],"urlSource":"https://en.wikipedia.org/wiki/Shapefile","data":{"page":"Shapefile","wiki":"https://en.wikipedia.org/","lang":"en"},"internal":false,"protocol":"wiki","key":"lggVGIQFTX"},{"type":"text","value":". The\n","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"key":"US8NNO0bn5"},{"type":"inlineCode","value":"sf::st_read","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"key":"Wcj0Bc3kAC"},{"type":"text","value":" function is used to read existing GIS format files directly into an","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"key":"jLBS8cKAL1"}],"key":"ZBoFIx7Agx"}],"key":"iVSJMaWURL"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"nest_boxes <- st_read(\"data/NestBoxes/NestBoxes.shp\")","key":"uxL5suwzPT"},{"type":"output","id":"8BiVbLBGr0KBG0GMQJgck","data":[],"key":"QFwkCwmNdn"}],"key":"apGLBOCKV4"},{"type":"block","children":[{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Warning","key":"JCbozffwUE"}],"key":"C6WHE0LUnX"},{"type":"paragraph","position":{"start":{"line":144,"column":1},"end":{"line":148,"column":1}},"children":[{"type":"text","value":"Confusingly, a ","position":{"start":{"line":144,"column":1},"end":{"line":144,"column":1}},"key":"O97V8Q5Wnc"},{"type":"strong","position":{"start":{"line":144,"column":1},"end":{"line":144,"column":1}},"children":[{"type":"text","value":"shapefile dataset is not a single file","position":{"start":{"line":144,"column":1},"end":{"line":144,"column":1}},"key":"nquiBFgvmw"}],"key":"gB9LIqT6q4"},{"type":"text","value":" - a shapefile dataset consists\nof a set of related files with the same shared file name and a range of file type\nsuffixes (","position":{"start":{"line":144,"column":1},"end":{"line":144,"column":1}},"key":"nNHtX8cKjz"},{"type":"inlineCode","value":".shp","position":{"start":{"line":144,"column":1},"end":{"line":144,"column":1}},"key":"ma5f64EyZg"},{"type":"text","value":", ","position":{"start":{"line":144,"column":1},"end":{"line":144,"column":1}},"key":"pVleJnir2F"},{"type":"inlineCode","value":".dbf","position":{"start":{"line":144,"column":1},"end":{"line":144,"column":1}},"key":"wmEaYAwNw8"},{"type":"text","value":", ","position":{"start":{"line":144,"column":1},"end":{"line":144,"column":1}},"key":"cR8i1QUWAu"},{"type":"inlineCode","value":".shx","position":{"start":{"line":144,"column":1},"end":{"line":144,"column":1}},"key":"yWwnkGk7fh"},{"type":"text","value":" and ","position":{"start":{"line":144,"column":1},"end":{"line":144,"column":1}},"key":"sKUUK9JQCK"},{"type":"inlineCode","value":".prj","position":{"start":{"line":144,"column":1},"end":{"line":144,"column":1}},"key":"wJb51zauts"},{"type":"text","value":" are the core subfiles but other suffixes are\ncommon). You ","position":{"start":{"line":144,"column":1},"end":{"line":144,"column":1}},"key":"LG0dhO3oif"},{"type":"strong","position":{"start":{"line":144,"column":1},"end":{"line":144,"column":1}},"children":[{"type":"text","value":"must keep all of these files together","position":{"start":{"line":144,"column":1},"end":{"line":144,"column":1}},"key":"sQvESBN3Vj"}],"key":"ed8zodK8bi"},{"type":"text","value":", or the dataset will not load\ncorrectly.","position":{"start":{"line":144,"column":1},"end":{"line":144,"column":1}},"key":"sPDQvXL6Km"}],"key":"FPgLDj0IeS"}],"key":"cNpaaFtokn"},{"type":"heading","depth":4,"position":{"start":{"line":151,"column":1},"end":{"line":151,"column":1}},"children":[{"type":"text","value":"Woodland survey","position":{"start":{"line":151,"column":1},"end":{"line":151,"column":1}},"key":"veC42vBWWq"}],"identifier":"woodland-survey","label":"Woodland survey","html_id":"woodland-survey","implicit":true,"key":"jVYoAqlmf6"},{"type":"paragraph","position":{"start":{"line":153,"column":1},"end":{"line":154,"column":1}},"children":[{"type":"text","value":"The Silwood woodland survey transect points: another CSV file providing latitude and\nlongitude of transect locations.","position":{"start":{"line":153,"column":1},"end":{"line":153,"column":1}},"key":"v9O1sWTZBP"}],"key":"wvAUj4J8iH"},{"type":"paragraph","position":{"start":{"line":156,"column":1},"end":{"line":156,"column":1}},"children":[{"type":"text","value":"TODO","position":{"start":{"line":156,"column":1},"end":{"line":156,"column":1}},"key":"XlimTqkeGu"}],"key":"iId1JTjPma"},{"type":"heading","depth":3,"position":{"start":{"line":158,"column":1},"end":{"line":158,"column":1}},"children":[{"type":"text","value":"Additional data","position":{"start":{"line":158,"column":1},"end":{"line":158,"column":1}},"key":"QNOs296GpX"}],"identifier":"additional-data","label":"Additional data","html_id":"additional-data","implicit":true,"key":"vnqeLoxIXN"},{"type":"paragraph","position":{"start":{"line":160,"column":1},"end":{"line":161,"column":1}},"children":[{"type":"text","value":"The practical then also uses a set of additional data files in a wide range of\nformats.","position":{"start":{"line":160,"column":1},"end":{"line":160,"column":1}},"key":"qOdBOL4QF3"}],"key":"TolsYLJUM4"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":163,"column":1},"end":{"line":178,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":163,"column":1},"end":{"line":172,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":163,"column":1},"end":{"line":168,"column":1}},"children":[{"type":"text","value":"Most of these datasets are downloaded from the ","position":{"start":{"line":163,"column":1},"end":{"line":163,"column":1}},"key":"EvzSoYAFtQ"},{"type":"link","url":"https://digimap.edina.ac.uk/","position":{"start":{"line":163,"column":1},"end":{"line":163,"column":1}},"children":[{"type":"text","value":"Edina\nDigimap","position":{"start":{"line":163,"column":1},"end":{"line":163,"column":1}},"key":"HwDrCOTTc6"}],"urlSource":"https://digimap.edina.ac.uk/","key":"oWQWURoVeK"},{"type":"text","value":" UK national GIS resource for higher education.\nImperial College London subscribes to this resource so you should be able to use this\nfor any UK based GIS whilst you are at the college. All of these datasets use the\nthe OSGB36 / British National Grid projected coordinate system, with units in metres\nand the ","position":{"start":{"line":163,"column":1},"end":{"line":163,"column":1}},"key":"JjG2evXiMn"},{"type":"link","url":"https://epsg.io/27700","position":{"start":{"line":163,"column":1},"end":{"line":163,"column":1}},"children":[{"type":"text","value":"EPSG code ","position":{"start":{"line":163,"column":1},"end":{"line":163,"column":1}},"key":"cZ5AuvssgB"},{"type":"inlineCode","value":"EPSG:27700","position":{"start":{"line":163,"column":1},"end":{"line":163,"column":1}},"key":"BQet6q9H8Y"}],"urlSource":"https://epsg.io/27700","key":"qpHM37DISV"},{"type":"text","value":".","position":{"start":{"line":163,"column":1},"end":{"line":163,"column":1}},"key":"u0rcUQcBml"}],"key":"qU85x6XA1n"},{"type":"paragraph","position":{"start":{"line":170,"column":1},"end":{"line":171,"column":1}},"children":[{"type":"text","value":"All of the Digimap data sources have national coverage and the additional data files\nare subsets of the available data for Silwood and the NHM.","position":{"start":{"line":170,"column":1},"end":{"line":170,"column":1}},"key":"RW2JoqVtR0"}],"key":"BjuNnzwQea"}],"key":"Ksy3mTJG1O"},{"type":"listItem","spread":true,"position":{"start":{"line":173,"column":1},"end":{"line":178,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":173,"column":1},"end":{"line":177,"column":1}},"children":[{"type":"text","value":"The last dataset is remotely-sensed data acquired by the Sentinel 2 satellite. This\nuses a different projected coordinate system: the ","position":{"start":{"line":173,"column":1},"end":{"line":173,"column":1}},"key":"bGgWQv04aB"},{"type":"link","url":"https://en.wikipedia.org/wiki/Universal_Transverse_Mercator_coordinate_system","position":{"start":{"line":173,"column":1},"end":{"line":173,"column":1}},"children":[{"type":"text","value":"Universal Transverse Mercator\nsystem","position":{"start":{"line":173,"column":1},"end":{"line":173,"column":1}},"key":"VHsvs4DMCv"}],"urlSource":"https://en.wikipedia.org/wiki/Universal_Transverse_Mercator_coordinate_system","data":{"page":"Universal_Transverse_Mercator_coordinate_system","wiki":"https://en.wikipedia.org/","lang":"en"},"internal":false,"protocol":"wiki","key":"AjK2M5ylJK"},{"type":"text","value":".\nThis projection uses multiple zones for different parts of the planet and the UK data\nis in UTM zone 30N, with units of meters and the [EPSG code ","position":{"start":{"line":173,"column":1},"end":{"line":173,"column":1}},"key":"yMYuGUdlui"},{"type":"inlineCode","value":"EPSG:32630","position":{"start":{"line":173,"column":1},"end":{"line":173,"column":1}},"key":"kCOs4Crvur"},{"type":"text","value":"].","position":{"start":{"line":173,"column":1},"end":{"line":173,"column":1}},"key":"voBt1uSCXl"}],"key":"c8EXIecijH"}],"key":"qF7pGgGRGw"}],"key":"F1oPXx5nTB"},{"type":"heading","depth":4,"position":{"start":{"line":179,"column":1},"end":{"line":179,"column":1}},"children":[{"type":"text","value":"Aerial photography","position":{"start":{"line":179,"column":1},"end":{"line":179,"column":1}},"key":"t9ekVfK3rz"}],"identifier":"aerial-photography","label":"Aerial photography","html_id":"aerial-photography","implicit":true,"key":"ZxD2i9QrS8"},{"type":"paragraph","position":{"start":{"line":181,"column":1},"end":{"line":185,"column":1}},"children":[{"type":"text","value":"These raster datasets provide 3km by 3km panes of 25cm resolution ","position":{"start":{"line":181,"column":1},"end":{"line":181,"column":1}},"key":"voGFqt8LgV"},{"type":"link","url":"https://digimap.edina.ac.uk/aerial","position":{"start":{"line":181,"column":1},"end":{"line":181,"column":1}},"children":[{"type":"text","value":"aerial\nphotography imagery","position":{"start":{"line":181,"column":1},"end":{"line":181,"column":1}},"key":"R81Rex2BIa"}],"urlSource":"https://digimap.edina.ac.uk/aerial","key":"WZfEHX2aa3"},{"type":"text","value":" for the two sites. These\nfiles are provided as GeoTIFF data files - these are essentially just standard TIFF\nimage files but contain metadata that provides the spatial context of each pixel in\nthe image and projection information.","position":{"start":{"line":181,"column":1},"end":{"line":181,"column":1}},"key":"RZQLoRtX3u"}],"key":"YlOv3UNgtU"},{"type":"paragraph","position":{"start":{"line":187,"column":1},"end":{"line":187,"column":1}},"children":[{"type":"text","value":"Raster data can be loaded using the ","position":{"start":{"line":187,"column":1},"end":{"line":187,"column":1}},"key":"wdmn8YYISB"},{"type":"inlineCode","value":"terra::rast","position":{"start":{"line":187,"column":1},"end":{"line":187,"column":1}},"key":"HlFZViPiS3"},{"type":"text","value":" function.","position":{"start":{"line":187,"column":1},"end":{"line":187,"column":1}},"key":"GULOx4631M"}],"key":"SKPdMLAkKC"}],"key":"XtFdnx0cDo"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"nhm_aerial <- rast('data/aerial/nhm_aerial.tiff')\nsilwood_aerial <- rast('data/aerial/silwood_aerial.tiff')","key":"YmTGdHzq0d"},{"type":"output","id":"uSFXV5OilVPUwwYDPi9yD","data":[],"key":"Cd4d31joOF"}],"key":"NRJVD12yGU"},{"type":"block","children":[{"type":"heading","depth":4,"position":{"start":{"line":194,"column":1},"end":{"line":194,"column":1}},"children":[{"type":"text","value":"OS Terrain 5","position":{"start":{"line":194,"column":1},"end":{"line":194,"column":1}},"key":"LLYcZk7072"}],"identifier":"os-terrain-5","label":"OS Terrain 5","html_id":"os-terrain-5","implicit":true,"key":"qIjS0zJbBL"},{"type":"paragraph","position":{"start":{"line":196,"column":1},"end":{"line":199,"column":1}},"children":[{"type":"text","value":"These raster datasets provide continuous elevation data at 5m\nresolution from the ","position":{"start":{"line":196,"column":1},"end":{"line":196,"column":1}},"key":"dLZpjevSgY"},{"type":"link","url":"https://www.ordnancesurvey.co.uk/products/os-terrain-5","position":{"start":{"line":196,"column":1},"end":{"line":196,"column":1}},"children":[{"type":"text","value":"Ordnance Survey Terrain 5 Digital Terrain Map (DTM)\ndataset","position":{"start":{"line":196,"column":1},"end":{"line":196,"column":1}},"key":"LYizmAuEV8"}],"urlSource":"https://www.ordnancesurvey.co.uk/products/os-terrain-5","key":"VVLrbcaXYD"},{"type":"text","value":". Each site has\ntwo adjoining panes of data.","position":{"start":{"line":196,"column":1},"end":{"line":196,"column":1}},"key":"qBmc7cVVL9"}],"key":"MdsQXJSbQw"},{"type":"admonition","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Aside: coordinates in the British National Grid","position":{"start":{"line":201,"column":1},"end":{"line":201,"column":1}},"key":"ClO1hRQ2Jy"}],"key":"pnzG37XtbZ"},{"type":"paragraph","position":{"start":{"line":204,"column":1},"end":{"line":209,"column":1}},"children":[{"type":"text","value":"The odd file names come from the British National Grid mapping system. The code ","position":{"start":{"line":204,"column":1},"end":{"line":204,"column":1}},"key":"AVawrqtTVY"},{"type":"inlineCode","value":"SU96NE","position":{"start":{"line":204,"column":1},"end":{"line":204,"column":1}},"key":"bZmEDuaupG"},{"type":"text","value":"\nindicates the north east quadrant of a 10 x 10 km cell that is found 9 cells east and 6\ncells north within the 100 x 100 km ","position":{"start":{"line":204,"column":1},"end":{"line":204,"column":1}},"key":"afwL83DFZq"},{"type":"inlineCode","value":"SU","position":{"start":{"line":204,"column":1},"end":{"line":204,"column":1}},"key":"ccmX5xDnl1"},{"type":"text","value":" cell. The ","position":{"start":{"line":204,"column":1},"end":{"line":204,"column":1}},"key":"HnqEzykPUQ"},{"type":"inlineCode","value":"SU","position":{"start":{"line":204,"column":1},"end":{"line":204,"column":1}},"key":"JwfGbGvcky"},{"type":"text","value":" cell itself is one of 25 cells\nwithin the 500 x 500 km ","position":{"start":{"line":204,"column":1},"end":{"line":204,"column":1}},"key":"f3lhOJme2I"},{"type":"inlineCode","value":"S","position":{"start":{"line":204,"column":1},"end":{"line":204,"column":1}},"key":"RqPeWFSHFJ"},{"type":"text","value":" cell. You can add more digits to give more resolution. An 8\ndigit grid reference has a 10 metre precision: the Hamilton building is at ","position":{"start":{"line":204,"column":1},"end":{"line":204,"column":1}},"key":"Tle15DjXmL"},{"type":"inlineCode","value":"SU 9469 6871","position":{"start":{"line":204,"column":1},"end":{"line":204,"column":1}},"key":"U4mV8BerNN"},{"type":"text","value":" and the NHM Wildlife Garden is at ","position":{"start":{"line":204,"column":1},"end":{"line":204,"column":1}},"key":"x6SKmO4IH5"},{"type":"inlineCode","value":"TQ 2656 7899","position":{"start":{"line":204,"column":1},"end":{"line":204,"column":1}},"key":"luVEAPzHp1"},{"type":"text","value":".","position":{"start":{"line":204,"column":1},"end":{"line":204,"column":1}},"key":"Wjcmq2yO9d"}],"key":"VSL4trcUzC"},{"type":"paragraph","position":{"start":{"line":211,"column":1},"end":{"line":211,"column":1}},"children":[{"type":"text","value":"See ","position":{"start":{"line":211,"column":1},"end":{"line":211,"column":1}},"key":"AOugamYgxd"},{"type":"link","url":"https://digimap.edina.ac.uk/help/our-maps-and-data/bng/","position":{"start":{"line":211,"column":1},"end":{"line":211,"column":1}},"children":[{"type":"text","value":"here for more details","position":{"start":{"line":211,"column":1},"end":{"line":211,"column":1}},"key":"TQxZ09Vc2x"}],"urlSource":"https://digimap.edina.ac.uk/help/our-maps-and-data/bng/","key":"RqEK8Gm2fM"},{"type":"text","value":".","position":{"start":{"line":211,"column":1},"end":{"line":211,"column":1}},"key":"va5VN7FOhF"}],"key":"DziA6AWGHT"}],"class":"tip","key":"nd1uyMerUK"},{"type":"paragraph","position":{"start":{"line":214,"column":1},"end":{"line":215,"column":1}},"children":[{"type":"text","value":"These files are ","position":{"start":{"line":214,"column":1},"end":{"line":214,"column":1}},"key":"mm9O6hw1vE"},{"type":"inlineCode","value":"ASC","position":{"start":{"line":214,"column":1},"end":{"line":214,"column":1}},"key":"TKfrea6tbO"},{"type":"text","value":" format files - a very simple text based format that contains the\ncell coordinates but ","position":{"start":{"line":214,"column":1},"end":{"line":214,"column":1}},"key":"EnVInskJgk"},{"type":"emphasis","position":{"start":{"line":214,"column":1},"end":{"line":214,"column":1}},"children":[{"type":"text","value":"not","position":{"start":{"line":214,"column":1},"end":{"line":214,"column":1}},"key":"I7zrNhsx8x"}],"key":"lGQym8XOr5"},{"type":"text","value":" the projection metadata.","position":{"start":{"line":214,"column":1},"end":{"line":214,"column":1}},"key":"IIQk8U6Jz1"}],"key":"BegTHaYnOe"}],"key":"jP4t1vp5JT"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Load the DTM data from ASC format files\nsilwood_dtm_SU96NE <- rast(\"data/dtm_5m/SU96NE.asc\")\nsilwood_dtm_SU96NW <- rast(\"data/dtm_5m/SU96NW.asc\")\nnhm_dtm_TQ27NE <- rast(\"data/dtm_5m/TQ27NE.asc\")\nnhm_dtm_TQ28SE <- rast(\"data/dtm_5m/TQ28SE.asc\")","key":"Wn0WfHvcNR"},{"type":"output","id":"FNrV7OQqOBw6JqJnyVws0","data":[],"key":"fPOA3f5b2o"}],"key":"XH3Y4lG8tG"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":225,"column":1},"end":{"line":226,"column":1}},"children":[{"type":"text","value":"If we look at one of those datasets, you can see that the cell coordinates, resolution\nand overall dataset size have been set but that the ","position":{"start":{"line":225,"column":1},"end":{"line":225,"column":1}},"key":"MBXViJA792"},{"type":"inlineCode","value":"coord. ref","position":{"start":{"line":225,"column":1},"end":{"line":225,"column":1}},"key":"HDqKtLm388"},{"type":"text","value":" attribute is empty.","position":{"start":{"line":225,"column":1},"end":{"line":225,"column":1}},"key":"FtiDF3fIKa"}],"key":"RYeV6cmQ3X"}],"key":"IBlaLfllQx"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Look at the object data\nsilwood_dtm_SU96NE","key":"uH4UmhoQfe"},{"type":"output","id":"p-nhg0WL2Vlg3A7o1QyOu","data":[],"key":"JbMCggih3V"}],"key":"PwyZLJHfB1"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":233,"column":1},"end":{"line":234,"column":1}},"children":[{"type":"text","value":"We need to set the projection manually using the ","position":{"start":{"line":233,"column":1},"end":{"line":233,"column":1}},"key":"z2BCTIOrad"},{"type":"inlineCode","value":"terra::crs","position":{"start":{"line":233,"column":1},"end":{"line":233,"column":1}},"key":"JqUNJdfo7v"},{"type":"text","value":" function and then check\nthat the attribute has been set.","position":{"start":{"line":233,"column":1},"end":{"line":233,"column":1}},"key":"dhU4AZpzhn"}],"key":"Y6HUNlohAR"}],"key":"rDVFghseRH"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Set the projection information for the DTM datasets\ncrs(silwood_dtm_SU96NE) <- \"EPSG:27700\"\ncrs(silwood_dtm_SU96NW) <- \"EPSG:27700\"\ncrs(nhm_dtm_TQ27NE) <- \"EPSG:27700\"\ncrs(nhm_dtm_TQ28SE) <- \"EPSG:27700\"\n\n# Print the modified dataset\nsilwood_dtm_SU96NE","key":"dZ8Ecae1Ab"},{"type":"output","id":"j2WTDt44Lp-tssWyZp7Vh","data":[],"key":"ZzKxxKhPIR"}],"key":"Gc3EKWy1EH"},{"type":"block","children":[{"type":"heading","depth":4,"position":{"start":{"line":247,"column":1},"end":{"line":247,"column":1}},"children":[{"type":"text","value":"CEH Land Cover","position":{"start":{"line":247,"column":1},"end":{"line":247,"column":1}},"key":"yqTZBAOx1x"}],"identifier":"ceh-land-cover","label":"CEH Land Cover","html_id":"ceh-land-cover","implicit":true,"key":"ldUVGZOkHr"},{"type":"paragraph","position":{"start":{"line":249,"column":1},"end":{"line":251,"column":1}},"children":[{"type":"text","value":"The Centre for Ecology and Hydrology produces a UK wide land cover map at 10 metre\nresolution. The datasets here are taken from the most recent ","position":{"start":{"line":249,"column":1},"end":{"line":249,"column":1}},"key":"dJoHMbwQ31"},{"type":"link","url":"https://catalogue.ceh.ac.uk/documents/5af9e97d-9f33-495d-8323-e57734388533","position":{"start":{"line":249,"column":1},"end":{"line":249,"column":1}},"children":[{"type":"text","value":"Land Cover Map\n2024","position":{"start":{"line":249,"column":1},"end":{"line":249,"column":1}},"key":"SNwGBb91vk"}],"urlSource":"https://catalogue.ceh.ac.uk/documents/5af9e97d-9f33-495d-8323-e57734388533","key":"RZj5mutDqR"},{"type":"text","value":".","position":{"start":{"line":249,"column":1},"end":{"line":249,"column":1}},"key":"v0iWqt5laB"}],"key":"yWiQGGh5VW"},{"type":"paragraph","position":{"start":{"line":253,"column":1},"end":{"line":256,"column":1}},"children":[{"type":"text","value":"The land cover categories are assigned using a classification of multi-band spectral\ndata from satellites onto the spectral signatures of known training sites. Each cell is\nassigned to the category with training signatures that most closely match the spectral\nsignature of the cell.","position":{"start":{"line":253,"column":1},"end":{"line":253,"column":1}},"key":"Wq3AJxFwmj"}],"key":"Bm1vHVQTy9"}],"key":"hKi06PWPAn"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Load the land cover map datasets\nsilwood_LCM <- rast(\"data/lcm_2024/Silwood_LCM2024.tiff\")\nnhm_LCM <- rast(\"data/lcm_2024/NHM_LCM2024.tiff\")\n\n# Look at the raster details\nprint(silwood_LCM)","key":"yxrNDLWF2M"},{"type":"output","id":"bL3zJ_EXhR-Mg7SBfo08d","data":[],"key":"exSytgNvE5"}],"key":"MmlDo8H3kb"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":267,"column":1},"end":{"line":269,"column":1}},"children":[{"type":"text","value":"The LCM2024 files contain ","position":{"start":{"line":267,"column":1},"end":{"line":267,"column":1}},"key":"XWoStJfphg"},{"type":"strong","position":{"start":{"line":267,"column":1},"end":{"line":267,"column":1}},"children":[{"type":"text","value":"two raster bands","position":{"start":{"line":267,"column":1},"end":{"line":267,"column":1}},"key":"nb57PJ4YhZ"}],"key":"P72V6UwC8b"},{"type":"text","value":". The first band is a numeric code\ngiving the land cover category. The second band give the probability of the cell having\nthat land cover type, based on the underlying classification.","position":{"start":{"line":267,"column":1},"end":{"line":267,"column":1}},"key":"d5DKiOJYHL"}],"key":"N5ZIL3Bjer"}],"key":"zEzi8ZqMGI"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"plot(silwood_LCM)","key":"OnPALh90JW"},{"type":"output","id":"cYkuVX0SpiM-bktW8o0aU","data":[],"key":"LSlpFh6SXY"}],"key":"hdEiJhrF1x"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":275,"column":1},"end":{"line":277,"column":1}},"children":[{"type":"text","value":"The loaded data only uses numeric codes for the land cover categories: we can add\ncategory labels and better category colours to make the data easier to use. The labels\nand some colours are defined in a separate CSV file:","position":{"start":{"line":275,"column":1},"end":{"line":275,"column":1}},"key":"p1cMPXu0Qq"}],"key":"nSRH77GUuR"}],"key":"TEcKJOxQSw"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"lcm_info <- read.csv(\"data/lcm_2024/LCM2024_info.csv\")\n\n# Set the band names, the category code labels and the colour tables\nlevels(nhm_LCM) <- lcm_info[c(\"value\", \"label\")]\ncoltab(nhm_LCM) <- lcm_info[c(\"value\", \"color\")]\nnames(nhm_LCM) <- c(\"LandCover\", \"Certainty\")\n\ncoltab(silwood_LCM) <- lcm_info[c(\"value\", \"color\")]\nlevels(silwood_LCM) <- lcm_info[c(\"value\", \"label\")]\nnames(silwood_LCM) <- c(\"LandCover\", \"Certainty\")","key":"urEwMEYB5M"},{"type":"output","id":"TTUXUeJY9Wy07lS3rSDDm","data":[],"key":"YvcbY9wWQR"}],"key":"G6Re350QSn"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":292,"column":1},"end":{"line":292,"column":1}},"children":[{"type":"text","value":"We can now plot maps that have actual category labels:","position":{"start":{"line":292,"column":1},"end":{"line":292,"column":1}},"key":"JAxH4Q5Lex"}],"key":"zqyVvknVwf"}],"key":"NmJcZHA6cD"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"par(mfrow=c(1,2))\nplot(silwood_LCM[\"LandCover\"])\nplot(nhm_LCM[\"LandCover\"])","key":"F1lZ8rGbjL"},{"type":"output","id":"zgNEwUydSAKhfHG89k12o","data":[],"key":"qatyPOMrCj"}],"key":"qdYNhqL8oF"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":300,"column":1},"end":{"line":300,"column":1}},"children":[{"type":"text","value":"And look at the frequencies of the different categories:","position":{"start":{"line":300,"column":1},"end":{"line":300,"column":1}},"key":"ZaDNWNsnrZ"}],"key":"f4TWWam3Kh"}],"key":"llAPFR8oTO"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"freq(silwood_LCM[\"LandCover\"])\nfreq(nhm_LCM[\"LandCover\"])","key":"zgH5um79Fx"},{"type":"output","id":"kz4op10FNmO0v74PnmOY_","data":[],"key":"K9frwwJPkf"}],"key":"fy1RPUylyC"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":307,"column":1},"end":{"line":309,"column":1}},"children":[{"type":"text","value":"We can also use the data within raster layers with other non-spatial data exploration\ntechniques. For example, we can look at the distribution of cell certainties associated\nwith each category.","position":{"start":{"line":307,"column":1},"end":{"line":307,"column":1}},"key":"DEPmMK8epr"}],"key":"RgEC37l1wa"}],"key":"d7RPXPq57v"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"par(mar = c(12, 3, 1, 1))\n\n# Plot cell assignment certainties as a function of land cover category\nboxplot(\n  silwood_LCM[\"Certainty\"], silwood_LCM[\"LandCover\"], \n  las = 3, xlab = NA\n)\nboxplot(\n  nhm_LCM[\"Certainty\"], nhm_LCM[\"LandCover\"], \n  las = 3, xlab = NA\n)","key":"JkQbEL74uo"},{"type":"output","id":"WzSAOrLOuAJGgHU6Sp-e-","data":[],"key":"oUyPskcgjE"}],"key":"lgd5qtYpSl"},{"type":"block","children":[{"type":"heading","depth":4,"position":{"start":{"line":325,"column":1},"end":{"line":325,"column":1}},"children":[{"type":"text","value":"OS VectorMap Local","position":{"start":{"line":325,"column":1},"end":{"line":325,"column":1}},"key":"RNcNglvlz9"}],"identifier":"os-vectormap-local","label":"OS VectorMap Local","html_id":"os-vectormap-local","implicit":true,"key":"fIkEkKd7Gl"},{"type":"paragraph","position":{"start":{"line":327,"column":1},"end":{"line":332,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":327,"column":1},"end":{"line":327,"column":1}},"key":"Z2Y7Up22TS"},{"type":"link","url":"https://www.ordnancesurvey.co.uk/products/os-vectormap-local","position":{"start":{"line":327,"column":1},"end":{"line":327,"column":1}},"children":[{"type":"text","value":"Ordnance Survey VectorMap\nLocal","position":{"start":{"line":327,"column":1},"end":{"line":327,"column":1}},"key":"FK7yACX7KO"}],"urlSource":"https://www.ordnancesurvey.co.uk/products/os-vectormap-local","key":"StF0bgb5pm"},{"type":"text","value":" dataset provides\nvery high precision vector data on spatial features in the UK. These files are saved in\nthe ","position":{"start":{"line":327,"column":1},"end":{"line":327,"column":1}},"key":"BJnGBUuxf0"},{"type":"link","url":"https://en.wikipedia.org/wiki/GeoPackage","position":{"start":{"line":327,"column":1},"end":{"line":327,"column":1}},"children":[{"type":"text","value":"GeoPackage file format (","position":{"start":{"line":327,"column":1},"end":{"line":327,"column":1}},"key":"fMidnpIErP"},{"type":"inlineCode","value":".gpkg","position":{"start":{"line":327,"column":1},"end":{"line":327,"column":1}},"key":"AXOP1CtBx6"},{"type":"text","value":")","position":{"start":{"line":327,"column":1},"end":{"line":327,"column":1}},"key":"EYzkjXZR8P"}],"urlSource":"https://en.wikipedia.org/wiki/GeoPackage","data":{"page":"GeoPackage","wiki":"https://en.wikipedia.org/","lang":"en"},"internal":false,"protocol":"wiki","key":"I4GmLcAJ6Z"},{"type":"text","value":". As\nwith the Terrain 5 data, the data from Edina Digimap consists of two 5 x 5 km panes for\neach site.","position":{"start":{"line":327,"column":1},"end":{"line":327,"column":1}},"key":"Jj4uBYE8Kj"}],"key":"nTETYzN3Ro"},{"type":"paragraph","position":{"start":{"line":334,"column":1},"end":{"line":337,"column":1}},"children":[{"type":"text","value":"A GeoPackage file can contain multiple vector datasets in a single file: these are\nusually called â€œlayersâ€ and so you will typically load one layer at a time. The code\nbelow uses the ","position":{"start":{"line":334,"column":1},"end":{"line":334,"column":1}},"key":"n5j8Nygvny"},{"type":"inlineCode","value":"sf::st_layers","position":{"start":{"line":334,"column":1},"end":{"line":334,"column":1}},"key":"JBOSVRjPfk"},{"type":"text","value":" command to show the available layers within one of the\nVML datasets.","position":{"start":{"line":334,"column":1},"end":{"line":334,"column":1}},"key":"ym3riuKsQ3"}],"key":"tSzKNnWGPe"}],"key":"uhKL0zG9on"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"print(st_layers(\"data/VML/vml-su96ne.gpkg\"))","key":"lnN3nkAzWv"},{"type":"output","id":"VfUOJ_u_MruzhAxrJZ46w","data":[],"key":"EDtJsk9ci0"}],"key":"rxTJlslO4d"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":343,"column":1},"end":{"line":344,"column":1}},"children":[{"type":"text","value":"We can then use the ","position":{"start":{"line":343,"column":1},"end":{"line":343,"column":1}},"key":"qj0lo6d7WA"},{"type":"inlineCode","value":"sf::st_read","position":{"start":{"line":343,"column":1},"end":{"line":343,"column":1}},"key":"y3nKwIpkKR"},{"type":"text","value":" function to read specific different layers for each\nsite.","position":{"start":{"line":343,"column":1},"end":{"line":343,"column":1}},"key":"rex6Rk4Q6g"}],"key":"I9HO4Q3Hog"}],"key":"f2P72Dn8v1"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Load the two panes of VML road centrelines for each site.\nvml_tq28se_roads <- st_read(\n  dsn = \"data/VML/vml-tq28se.gpkg\", layer = \"Road_Centreline\"\n)\nvml_tq27ne_roads <- st_read(\n  dsn = \"data/VML/vml-tq27ne.gpkg\", layer = \"Road_Centreline\"\n)\nvml_su96ne_roads <- st_read(\n  dsn = \"data/VML/vml-su96ne.gpkg\", layer = \"Road_Centreline\"\n)\nvml_su96nw_roads <- st_read(\n  dsn = \"data/VML/vml-su96nw.gpkg\", layer = \"Road_Centreline\"\n)\n# Do the same for water bodies\nvml_tq28se_water <- st_read(\n  dsn = \"data/VML/vml-tq28se.gpkg\", layer = \"Water_Area\"\n)\nvml_tq27ne_water <- st_read(\n  dsn = \"data/VML/vml-tq27ne.gpkg\", layer = \"Water_Area\"\n)\nvml_su96ne_water <- st_read(\n  dsn = \"data/VML/vml-su96ne.gpkg\", layer = \"Water_Area\"\n)\nvml_su96nw_water <- st_read(\n  dsn = \"data/VML/vml-su96nw.gpkg\", layer = \"Water_Area\"\n)","key":"lsnQnfPWju"},{"type":"output","id":"j89_CBMh2Yy7WhMpKOzwC","data":[],"key":"RC1pnBUunP"}],"key":"WlTkwvJVSY"},{"type":"block","children":[{"type":"heading","depth":4,"position":{"start":{"line":375,"column":1},"end":{"line":375,"column":1}},"children":[{"type":"text","value":"Sentinel 2 data","position":{"start":{"line":375,"column":1},"end":{"line":375,"column":1}},"key":"glEaif9qr2"}],"identifier":"sentinel-2-data","label":"Sentinel 2 data","html_id":"sentinel-2-data","implicit":true,"key":"CVIjq7TQi6"},{"type":"paragraph","position":{"start":{"line":377,"column":1},"end":{"line":381,"column":1}},"children":[{"type":"text","value":"The Sentinel 2 satellite mission collects spectral data from ","position":{"start":{"line":377,"column":1},"end":{"line":377,"column":1}},"key":"wcEmTLDgBE"},{"type":"link","url":"https://en.wikipedia.org/wiki/Sentinel-2#Spectral_bands","position":{"start":{"line":377,"column":1},"end":{"line":377,"column":1}},"children":[{"type":"text","value":"13\nbands","position":{"start":{"line":377,"column":1},"end":{"line":377,"column":1}},"key":"JOkxwECgGp"}],"urlSource":"https://en.wikipedia.org/wiki/Sentinel-2#Spectral_bands","data":{"page":"Sentinel-2#Spectral_bands","wiki":"https://en.wikipedia.org/","lang":"en"},"internal":false,"protocol":"wiki","key":"qZLT9hs8Y3"},{"type":"text","value":" across the visible, near\ninfra-red and infra-red at resolutions from 10m to 60m. See the ","position":{"start":{"line":377,"column":1},"end":{"line":377,"column":1}},"key":"jQhkMr3Hjm"},{"type":"link","url":"https://sentiwiki.copernicus.eu/web/sentinel-2","position":{"start":{"line":377,"column":1},"end":{"line":377,"column":1}},"children":[{"type":"text","value":"Copernicus Sentinel 2\ndata wiki","position":{"start":{"line":377,"column":1},"end":{"line":377,"column":1}},"key":"yZVr64PdkS"}],"urlSource":"https://sentiwiki.copernicus.eu/web/sentinel-2","key":"B6z0lyjN0a"},{"type":"text","value":" for more information about\nthe mission and data processing.","position":{"start":{"line":377,"column":1},"end":{"line":377,"column":1}},"key":"c3P7VWiK2W"}],"key":"RhnsemGvox"},{"type":"paragraph","position":{"start":{"line":383,"column":1},"end":{"line":390,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":383,"column":1},"end":{"line":383,"column":1}},"key":"tli68YUkpY"},{"type":"inlineCode","value":"sentinel_2","position":{"start":{"line":383,"column":1},"end":{"line":383,"column":1}},"key":"jhpMMdngXb"},{"type":"text","value":" folder contains data from a single (relatively cloud free!) scene from\nthe ","position":{"start":{"line":383,"column":1},"end":{"line":383,"column":1}},"key":"vrNlxFpGlH"},{"type":"link","url":"https://sentiwiki.copernicus.eu/web/s2-products#S2Products-Level-2AProductsS2-Products-L2Atrue","position":{"start":{"line":383,"column":1},"end":{"line":383,"column":1}},"children":[{"type":"text","value":"Sentinel 2 Level 2A data\nproduct","position":{"start":{"line":383,"column":1},"end":{"line":383,"column":1}},"key":"udgCAGPymF"}],"urlSource":"https://sentiwiki.copernicus.eu/web/s2-products#S2Products-Level-2AProductsS2-Products-L2Atrue","key":"LmLURdJ3a8"},{"type":"text","value":"\nthat was downloaded using the ","position":{"start":{"line":383,"column":1},"end":{"line":383,"column":1}},"key":"Bo7i7z4SIW"},{"type":"link","url":"https://browser.dataspace.copernicus.eu/","position":{"start":{"line":383,"column":1},"end":{"line":383,"column":1}},"children":[{"type":"text","value":"Copernicus data\nbrowser","position":{"start":{"line":383,"column":1},"end":{"line":383,"column":1}},"key":"I0ILMQj3YK"}],"urlSource":"https://browser.dataspace.copernicus.eu/","key":"eFKGeaYYoZ"},{"type":"text","value":". The L2A data product has been\nprocessed to remove atmospheric effects to give modelled surface reflectance values for\neach band and also to add some extra calculated layers, such as true colour images (more\non this later!).","position":{"start":{"line":383,"column":1},"end":{"line":383,"column":1}},"key":"IY5DczSofk"}],"key":"KCWdohbApe"},{"type":"paragraph","position":{"start":{"line":392,"column":1},"end":{"line":397,"column":1}},"children":[{"type":"text","value":"A single scene of L2A data covers roughly 110 x 110 km and contains about 1 GB of data,\nso has been cropped down to the two study sites (see ","position":{"start":{"line":392,"column":1},"end":{"line":392,"column":1}},"key":"cqP3ennWQG"},{"type":"crossReference","position":{"start":{"line":392,"column":1},"end":{"line":392,"column":1}},"children":[{"type":"text","value":"below","position":{"start":{"line":392,"column":1},"end":{"line":392,"column":1}},"key":"wTsDA59Ua9"}],"identifier":"cropping-rasters","label":"cropping-rasters","kind":"heading","template":"{name}","resolved":true,"html_id":"cropping-rasters","key":"qVnUBBCroC"},{"type":"text","value":"). The\ncode below loads the four 10m resolution bands into a single raster for each site by\nproviding a vector of file names to the ","position":{"start":{"line":392,"column":1},"end":{"line":392,"column":1}},"key":"VWCTaZBzma"},{"type":"inlineCode","value":"terra::rast","position":{"start":{"line":392,"column":1},"end":{"line":392,"column":1}},"key":"JlPlUuDRR3"},{"type":"text","value":" function. It also rescales the\ndata: remote sensing data is often stored as integer data to save file space and needs\nconverting to actual values, in this case by dividing by 10000.","position":{"start":{"line":392,"column":1},"end":{"line":392,"column":1}},"key":"jcImvFLEBr"}],"key":"fkIIZFbFil"}],"key":"VDp8fxtims"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Load the four 10m resolution Sentinel 2 bands for Silwood\ns2_silwood_10m <- rast(\n    c(\n        \"data/sentinel_2/R10m/silwood/T30UXC_20250711T110651_B02_10m.tiff\",\n        \"data/sentinel_2/R10m/silwood/T30UXC_20250711T110651_B03_10m.tiff\",\n        \"data/sentinel_2/R10m/silwood/T30UXC_20250711T110651_B04_10m.tiff\",\n        \"data/sentinel_2/R10m/silwood/T30UXC_20250711T110651_B08_10m.tiff\"\n    ),\n)  / 10000\n\n# Name the bands \nnames(s2_silwood_10m) <- c(\"B\", \"G\", \"R\", \"NIR\")\n\n# Do the same for the NHM\ns2_nhm_10m <- rast(\n    c(\n        \"data/sentinel_2/R10m/nhm/T30UXC_20250711T110651_B02_10m.tiff\",\n        \"data/sentinel_2/R10m/nhm/T30UXC_20250711T110651_B03_10m.tiff\",\n        \"data/sentinel_2/R10m/nhm/T30UXC_20250711T110651_B04_10m.tiff\",\n        \"data/sentinel_2/R10m/nhm/T30UXC_20250711T110651_B08_10m.tiff\"\n    ),\n) / 10000\nnames(s2_nhm_10m) <- c(\"B\", \"G\", \"R\", \"NIR\")\n\n# Show the resulting object structure\nprint(s2_silwood_10m)","key":"VMbyQA3UXt"},{"type":"output","id":"ieXYCvT2D8HlLCOmKCvo0","data":[],"key":"tiv1VzgzBr"}],"key":"RyNRAXo2kX"},{"type":"block","children":[{"type":"admonition","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Exercise","position":{"start":{"line":428,"column":1},"end":{"line":428,"column":1}},"key":"gxtM5b5AaP"}],"key":"lmEHTQjPRl"},{"type":"paragraph","position":{"start":{"line":430,"column":1},"end":{"line":435,"column":1}},"children":[{"type":"text","value":"The Sentinel 2 dataset directory also includes the band data sampled at 20m and 60m\nresolution. The 60m bands are largely aimed at detecting water vapour and clouds, but\nthe 20 metre bands include red edge, narrow near infrared and short wave infrared data\nthat can be useful. Use the code above as a template to load Bands 5, 6, 7, 8A, 11 and\n12 from the 20 meter directories for each site. Note that the 20m directory also\ncontains downsampled data from the 10 metre bands.","position":{"start":{"line":430,"column":1},"end":{"line":430,"column":1}},"key":"tg5qDDHTSH"}],"key":"QEHn2PJWmW"},{"type":"paragraph","position":{"start":{"line":437,"column":1},"end":{"line":439,"column":1}},"children":[{"type":"text","value":"The resulting objects should be called ","position":{"start":{"line":437,"column":1},"end":{"line":437,"column":1}},"key":"LpKEIqGPdP"},{"type":"inlineCode","value":"s2_silwood_20m","position":{"start":{"line":437,"column":1},"end":{"line":437,"column":1}},"key":"z8QH9rN2iA"},{"type":"text","value":" and ","position":{"start":{"line":437,"column":1},"end":{"line":437,"column":1}},"key":"ZS0Hm6cBXo"},{"type":"inlineCode","value":"s2_nhm_20m","position":{"start":{"line":437,"column":1},"end":{"line":437,"column":1}},"key":"fmDTyGjg3K"},{"type":"text","value":" and the bands\nshould be named ","position":{"start":{"line":437,"column":1},"end":{"line":437,"column":1}},"key":"e8lmfBcsew"},{"type":"inlineCode","value":"RE5","position":{"start":{"line":437,"column":1},"end":{"line":437,"column":1}},"key":"aqzUrXzsJo"},{"type":"text","value":", ","position":{"start":{"line":437,"column":1},"end":{"line":437,"column":1}},"key":"LTGypt6TNE"},{"type":"inlineCode","value":"RE6","position":{"start":{"line":437,"column":1},"end":{"line":437,"column":1}},"key":"FPiVZZBuKE"},{"type":"text","value":", ","position":{"start":{"line":437,"column":1},"end":{"line":437,"column":1}},"key":"d4F9sUFAV2"},{"type":"inlineCode","value":"RE7","position":{"start":{"line":437,"column":1},"end":{"line":437,"column":1}},"key":"gkeK7ErzFq"},{"type":"text","value":", ","position":{"start":{"line":437,"column":1},"end":{"line":437,"column":1}},"key":"uyiXmPjsDq"},{"type":"inlineCode","value":"NNIR","position":{"start":{"line":437,"column":1},"end":{"line":437,"column":1}},"key":"DQylGFVdJd"},{"type":"text","value":", ","position":{"start":{"line":437,"column":1},"end":{"line":437,"column":1}},"key":"p7tyPCmGHC"},{"type":"inlineCode","value":"SWIR1","position":{"start":{"line":437,"column":1},"end":{"line":437,"column":1}},"key":"KzyK21rkqr"},{"type":"text","value":" and ","position":{"start":{"line":437,"column":1},"end":{"line":437,"column":1}},"key":"w83e8yhDuE"},{"type":"inlineCode","value":"SWIR2","position":{"start":{"line":437,"column":1},"end":{"line":437,"column":1}},"key":"u6INjBd4ED"},{"type":"text","value":". The code cell below\ncan be unhidden to show the solution.","position":{"start":{"line":437,"column":1},"end":{"line":437,"column":1}},"key":"hBjAvyWcJJ"}],"key":"oLPINqyUYf"}],"key":"K4jaIJemzd"}],"key":"gNRSO5EDJw"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Load the six 20m resolution Sentinel 2 bands for Silwood\ns2_silwood_20m <- rast(\n    c(\n        \"data/sentinel_2/R20m/silwood/T30UXC_20250711T110651_B05_20m.tiff\",\n        \"data/sentinel_2/R20m/silwood/T30UXC_20250711T110651_B06_20m.tiff\",\n        \"data/sentinel_2/R20m/silwood/T30UXC_20250711T110651_B07_20m.tiff\",\n        \"data/sentinel_2/R20m/silwood/T30UXC_20250711T110651_B8A_20m.tiff\",\n        \"data/sentinel_2/R20m/silwood/T30UXC_20250711T110651_B11_20m.tiff\",\n        \"data/sentinel_2/R20m/silwood/T30UXC_20250711T110651_B12_20m.tiff\"\n    ),\n) / 10000\n\n# Name the bands \nnames(s2_silwood_20m) <- c(\"RE5\", \"RE6\", \"RE7\", \"NNIR\", \"SWIR1\", \"SWIR2\")\n\n# Load the seven 20m resolution Sentinel 2 bands for the NHM\ns2_nhm_20m <- rast(\n    c(\n        \"data/sentinel_2/R20m/nhm/T30UXC_20250711T110651_B05_20m.tiff\",\n        \"data/sentinel_2/R20m/nhm/T30UXC_20250711T110651_B06_20m.tiff\",\n        \"data/sentinel_2/R20m/nhm/T30UXC_20250711T110651_B07_20m.tiff\",\n        \"data/sentinel_2/R20m/nhm/T30UXC_20250711T110651_B8A_20m.tiff\",\n        \"data/sentinel_2/R20m/nhm/T30UXC_20250711T110651_B11_20m.tiff\",\n        \"data/sentinel_2/R20m/nhm/T30UXC_20250711T110651_B12_20m.tiff\"\n    ),\n) / 10000\n\n# Name the bands \nnames(s2_nhm_20m) <- c(\"RE5\", \"RE6\", \"RE7\", \"NNIR\", \"SWIR1\", \"SWIR2\")","visibility":"show","key":"TjH5v0gtb4"},{"type":"output","id":"X4DUh7hQU9LNEBfVMWY-5","data":[],"visibility":"show","key":"cKIstNCpnD"}],"data":{"tags":[]},"visibility":"hide","key":"G0C9WiWQBP"},{"type":"block","children":[{"type":"heading","depth":4,"position":{"start":{"line":476,"column":1},"end":{"line":476,"column":1}},"children":[{"type":"text","value":"Silmas route","position":{"start":{"line":476,"column":1},"end":{"line":476,"column":1}},"key":"tsbIjiWilL"}],"identifier":"silmas-route","label":"Silmas route","html_id":"silmas-route","implicit":true,"key":"eIW6mOO4GQ"},{"type":"paragraph","position":{"start":{"line":478,"column":1},"end":{"line":481,"column":1}},"children":[{"type":"text","value":"The last dataset is a ","position":{"start":{"line":478,"column":1},"end":{"line":478,"column":1}},"key":"vHUVQh8wLK"},{"type":"link","url":"https://en.wikipedia.org/wiki/GPS_Exchange_Format","position":{"start":{"line":478,"column":1},"end":{"line":478,"column":1}},"children":[{"type":"text","value":"GPS Exchange Format (GPX)\nfile","position":{"start":{"line":478,"column":1},"end":{"line":478,"column":1}},"key":"QnxbwpWjox"}],"urlSource":"https://en.wikipedia.org/wiki/GPS_Exchange_Format","data":{"page":"GPS_Exchange_Format","wiki":"https://en.wikipedia.org/","lang":"en"},"internal":false,"protocol":"wiki","key":"Hi8HFy5nL4"},{"type":"text","value":" containing the course of the\nSilmas fun run and walking route. The GPX format is a commonly used format to record\nroutes and points from GPS devices. Again, the format holds multiple layers:","position":{"start":{"line":478,"column":1},"end":{"line":478,"column":1}},"key":"w7Wfjjaaxy"}],"key":"L288tHMfUw"}],"key":"AC82Fv3hLL"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"print(st_layers(\"data/Silmas_Fun_Run.gpx\"))","key":"i10w8QqCfB"},{"type":"output","id":"hOANoR84KwhZSkEWHijKB","data":[],"key":"umnPK7Ql0Z"}],"key":"vqliZAzZJU"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":487,"column":1},"end":{"line":489,"column":1}},"children":[{"type":"text","value":"With GPX files, there are a fixed number of layers, not all of which have any actual\nfeatures, so here we can either load the recorded ","position":{"start":{"line":487,"column":1},"end":{"line":487,"column":1}},"key":"JDp2dUL0gu"},{"type":"inlineCode","value":"tracks","position":{"start":{"line":487,"column":1},"end":{"line":487,"column":1}},"key":"jmCb75SovB"},{"type":"text","value":" or the individual points\nalong the tracks (","position":{"start":{"line":487,"column":1},"end":{"line":487,"column":1}},"key":"bwgb64fT8P"},{"type":"inlineCode","value":"track_points","position":{"start":{"line":487,"column":1},"end":{"line":487,"column":1}},"key":"NYPeiQuWCM"},{"type":"text","value":").","position":{"start":{"line":487,"column":1},"end":{"line":487,"column":1}},"key":"x7GIIOgoCW"}],"key":"PnymRBcumT"}],"key":"nt1pUzHbQd"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"silmas_route <- st_read(\n  dsn=\"data/Silmas_Fun_Run.gpx\", layer=\"tracks\"\n)","key":"CHAjsRk7iw"},{"type":"output","id":"v4mn4oNOTPR-cIGJ2hCsd","data":[],"key":"rji6Bg79w2"}],"key":"ZY6Y15HZ9U"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":497,"column":1},"end":{"line":497,"column":1}},"children":[{"type":"text","value":"Reprojecting spatial data","position":{"start":{"line":497,"column":1},"end":{"line":497,"column":1}},"key":"AbtjZilK6D"}],"identifier":"reprojecting-spatial-data","label":"Reprojecting spatial data","html_id":"reprojecting-spatial-data","implicit":true,"key":"rQBVlrAfNU"},{"type":"paragraph","position":{"start":{"line":499,"column":1},"end":{"line":503,"column":1}},"children":[{"type":"text","value":"We now have a large number of different datasets, but they are not all in the same GIS\nprojection. We cannot use the datasets together until they use the same coordinate\nsystem. We will use the â€œOSGB 1936 / British National Gridâ€ (or BNG) projection for all of the\nrest of the practical. It is a projected coordinate system, which means we can use\nmetres to measure distances, and it is also the standard mapping system for the UK.","position":{"start":{"line":499,"column":1},"end":{"line":499,"column":1}},"key":"j3Ndy6juXF"}],"key":"Xo2mhrswiS"},{"type":"heading","depth":3,"position":{"start":{"line":505,"column":1},"end":{"line":505,"column":1}},"children":[{"type":"text","value":"Reprojecting vector datasets","position":{"start":{"line":505,"column":1},"end":{"line":505,"column":1}},"key":"nop7KMSSPu"}],"identifier":"reprojecting-vector-datasets","label":"Reprojecting vector datasets","html_id":"reprojecting-vector-datasets","implicit":true,"key":"iBCSRlTkrP"},{"type":"paragraph","position":{"start":{"line":507,"column":1},"end":{"line":510,"column":1}},"children":[{"type":"text","value":"It is relatively easy to reproject vector datasets: all of the features in a vector\ndataset are built up from pairs of point. Reprojection is therefore just a matter of\nrecalculating the coordinates in the new projection - the underlying equation might be\ncomplex but we are just moving points between two systems.","position":{"start":{"line":507,"column":1},"end":{"line":507,"column":1}},"key":"Pw4542w1Am"}],"key":"ywrPVrwKet"},{"type":"paragraph","position":{"start":{"line":512,"column":1},"end":{"line":513,"column":1}},"children":[{"type":"text","value":"We can show the current range of coordinates for a dataset by looking at the ","position":{"start":{"line":512,"column":1},"end":{"line":512,"column":1}},"key":"iWpZLQkFik"},{"type":"strong","position":{"start":{"line":512,"column":1},"end":{"line":512,"column":1}},"children":[{"type":"text","value":"extent","position":{"start":{"line":512,"column":1},"end":{"line":512,"column":1}},"key":"rVSUpQz6s9"}],"key":"efA6tSGQMe"},{"type":"text","value":"\nof the data before.","position":{"start":{"line":512,"column":1},"end":{"line":512,"column":1}},"key":"LQ53VMIyWK"}],"key":"QD9CSJaixR"}],"key":"qXXa2SZ1d0"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Show the extent of the sensor locations in the current WGS84 projection\next(sensor_locations)","key":"ErWIhuHTDm"},{"type":"output","id":"BgOUX_BBGYa8HWiQjJxhz","data":[],"key":"AblNLm3g6Z"}],"key":"s1uGsFE7gz"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":520,"column":1},"end":{"line":521,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":520,"column":1},"end":{"line":520,"column":1}},"key":"cqvZWeYToy"},{"type":"inlineCode","value":"sf::st_transform","position":{"start":{"line":520,"column":1},"end":{"line":520,"column":1}},"key":"v3hK7LVqZN"},{"type":"text","value":" function can then be used to transform data from one projection\nto another.","position":{"start":{"line":520,"column":1},"end":{"line":520,"column":1}},"key":"BjwDBI2wQW"}],"key":"bUDLOUeQhv"}],"key":"YVKsFey2ve"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Convert the WGS84 vector datasets to BNG\nsensor_locations <- st_transform(sensor_locations, crs=\"EPSG:27700\")\nnest_boxes <- st_transform(nest_boxes, crs=\"EPSG:27700\")\nsilmas_route <- st_transform(silmas_route, crs=\"EPSG:27700\")\n\n# Show the new extent\next(sensor_locations)","key":"vjUVhkMKhT"},{"type":"output","id":"rIRjwLemh6bdoPT1ZHqqN","data":[],"key":"n2zarrJZV7"}],"key":"vPqPo1YI63"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":533,"column":1},"end":{"line":533,"column":1}},"children":[{"type":"text","value":"Reprojecting raster datasets","position":{"start":{"line":533,"column":1},"end":{"line":533,"column":1}},"key":"T9vsYrKuzU"}],"identifier":"reprojecting-raster-datasets","label":"Reprojecting raster datasets","html_id":"reprojecting-raster-datasets","implicit":true,"key":"eufsELEyn1"},{"type":"paragraph","position":{"start":{"line":535,"column":1},"end":{"line":538,"column":1}},"children":[{"type":"text","value":"This is more involved than reprojecting vector data. You have a series of raster cell\nvalues in one projection and then want to insert representative values into a set of\ncells on a different projection. The borders of those new cells could have all sorts of\nodd relationships to the current ones.","position":{"start":{"line":535,"column":1},"end":{"line":535,"column":1}},"key":"CcoTUB9SkW"}],"key":"vYI0LyS6gx"},{"type":"paragraph","position":{"start":{"line":540,"column":1},"end":{"line":540,"column":1}},"children":[{"type":"text","value":"We can show the issue by superimposing two grids:","position":{"start":{"line":540,"column":1},"end":{"line":540,"column":1}},"key":"KPJe6Rtoxd"}],"key":"yP5X3DcbSi"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":542,"column":1},"end":{"line":546,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":542,"column":1},"end":{"line":543,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"A 200 m resolution grid using the extent of the BNG projection datasets for Silwood\n(red cells).","position":{"start":{"line":542,"column":1},"end":{"line":542,"column":1}},"key":"a6pbPkEL4C"}],"key":"FTePY7QPeD"}],"key":"OTyovn0Y6U"},{"type":"listItem","spread":true,"position":{"start":{"line":544,"column":1},"end":{"line":546,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"A very similar 200m grid taken from the extent of the Sentinel 2 data in the UTM30N\nprojection for the same site and then reprojected into the BNG (grey cells)","position":{"start":{"line":544,"column":1},"end":{"line":544,"column":1}},"key":"SxLw94Bfsr"}],"key":"UPrpoNMo1W"}],"key":"MYRUX8yQNp"}],"key":"ooDSS5ypRo"}],"key":"RMBIKrchiG"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Create a BNG raster at 200m resolution for the study site\ngrid_BNG <- rast(ext(silwood_aerial), res = 200, crs = \"EPSG:27700\")\n# Convert to an sf polygon dataset of grid cells\ngrid_BNG <- st_as_sf(as.polygons(grid_BNG))\n\n# Create a UTM30N raster at 200 m resolution for the study site\ngrid_UTM30N <- rast(ext(s2_silwood_10m), res = 200, crs = \"EPSG:32630\")\n# Convert to an sf polygon dataset _and_ then transform to BNG\ngrid_UTM30N <- st_as_sf(as.polygons(grid_UTM30N))\ngrid_UTM30N_in_BNG <- st_transform(grid_UTM30N, \"EPSG:27700\")\n\n# Plot the two sets of grid cells over each other\nplot(st_geometry(grid_UTM30N_in_BNG), reset=FALSE, border=\"grey\")\nplot(st_geometry(grid_BNG), border='red', add=TRUE)\n\n# Add coordinates on the axes\naxis(1)\naxis(2)","visibility":"hide","key":"aT2sMJixLl"},{"type":"output","id":"zZ-ynzFtwGcOUUrL4Xml5","data":[],"visibility":"show","key":"O41pbkKODP"}],"data":{"tags":[]},"visibility":"show","key":"CZRGq1NBpR"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":570,"column":1},"end":{"line":572,"column":1}},"children":[{"type":"text","value":"As you can see, even when the resolutions are the same, there is no neat one-to-one\nrelationship between the two sets of cells: the axes of the two grids are not exactly\nparallel and the coordinates of the cell boundaries are not the same.","position":{"start":{"line":570,"column":1},"end":{"line":570,"column":1}},"key":"WWKom9Qi8s"}],"key":"xPGwUYWtHi"},{"type":"paragraph","position":{"start":{"line":574,"column":1},"end":{"line":577,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":574,"column":1},"end":{"line":574,"column":1}},"key":"uJAszt9yKa"},{"type":"inlineCode","value":"terra::project","position":{"start":{"line":574,"column":1},"end":{"line":574,"column":1}},"key":"sNkwD3cqG6"},{"type":"text","value":" function both ","position":{"start":{"line":574,"column":1},"end":{"line":574,"column":1}},"key":"jZltP7QBSc"},{"type":"strong","position":{"start":{"line":574,"column":1},"end":{"line":574,"column":1}},"children":[{"type":"text","value":"converts the coordinates","position":{"start":{"line":574,"column":1},"end":{"line":574,"column":1}},"key":"vkW3oxif9w"}],"key":"iTumoXflPE"},{"type":"text","value":" from one projection to\nanother and ","position":{"start":{"line":574,"column":1},"end":{"line":574,"column":1}},"key":"eKF5YjLMZr"},{"type":"strong","position":{"start":{"line":574,"column":1},"end":{"line":574,"column":1}},"children":[{"type":"text","value":"resamples the data","position":{"start":{"line":574,"column":1},"end":{"line":574,"column":1}},"key":"Up8sVYuFiV"}],"key":"bFQKcq5y7F"},{"type":"text","value":" from one grid to another. There are various methods\nto carry out resampling - see the ","position":{"start":{"line":574,"column":1},"end":{"line":574,"column":1}},"key":"yulJxZMDNT"},{"type":"inlineCode","value":"method","position":{"start":{"line":574,"column":1},"end":{"line":574,"column":1}},"key":"onjfgFYKbQ"},{"type":"text","value":" details in ","position":{"start":{"line":574,"column":1},"end":{"line":574,"column":1}},"key":"F89Q4yhmFZ"},{"type":"inlineCode","value":"?project","position":{"start":{"line":574,"column":1},"end":{"line":574,"column":1}},"key":"PdycBeYgT9"},{"type":"text","value":" but they basically fall\ninto two groups:","position":{"start":{"line":574,"column":1},"end":{"line":574,"column":1}},"key":"rJO1CGtvRr"}],"key":"wdNUrgZHJF"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":579,"column":1},"end":{"line":590,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":579,"column":1},"end":{"line":584,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":579,"column":1},"end":{"line":583,"column":1}},"children":[{"type":"text","value":"Most are interpolations methods for getting a representative ","position":{"start":{"line":579,"column":1},"end":{"line":579,"column":1}},"key":"yDq8jOiGjV"},{"type":"strong","position":{"start":{"line":579,"column":1},"end":{"line":579,"column":1}},"children":[{"type":"text","value":"continuous value","position":{"start":{"line":579,"column":1},"end":{"line":579,"column":1}},"key":"uYU5v1Rw8b"}],"key":"hdmAh2rZ29"},{"type":"text","value":" for\neach cell from the data in the original raster grid. They range from simple ","position":{"start":{"line":579,"column":1},"end":{"line":579,"column":1}},"key":"NyzvmeMwiH"},{"type":"inlineCode","value":"average","position":{"start":{"line":579,"column":1},"end":{"line":579,"column":1}},"key":"MDt7f9kucn"},{"type":"text","value":"\nvalues of intersecting cells, to more complex polynomials and splines (e.g ","position":{"start":{"line":579,"column":1},"end":{"line":579,"column":1}},"key":"YPCK2vfRC0"},{"type":"inlineCode","value":"cubic","position":{"start":{"line":579,"column":1},"end":{"line":579,"column":1}},"key":"MClPI48jUU"},{"type":"text","value":")\nthat use a moving window of a neighbourhood of cells to construct an estimate for the\nnew cell.","position":{"start":{"line":579,"column":1},"end":{"line":579,"column":1}},"key":"PdDbWV5zVJ"}],"key":"LNyeIBUZ55"}],"key":"U6hEsO4wch"},{"type":"listItem","spread":true,"position":{"start":{"line":585,"column":1},"end":{"line":590,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":585,"column":1},"end":{"line":589,"column":1}},"children":[{"type":"text","value":"Other approaches select a single value from the source grid: the ","position":{"start":{"line":585,"column":1},"end":{"line":585,"column":1}},"key":"A9KnSxcFKK"},{"type":"inlineCode","value":"near","position":{"start":{"line":585,"column":1},"end":{"line":585,"column":1}},"key":"sEqQyVFDyg"},{"type":"text","value":" method takes\nthe value from the source raster cell closest to the centre of the new cell, and the\n","position":{"start":{"line":585,"column":1},"end":{"line":585,"column":1}},"key":"erol95VNhw"},{"type":"inlineCode","value":"mode","position":{"start":{"line":585,"column":1},"end":{"line":585,"column":1}},"key":"lSN9kigGOL"},{"type":"text","value":" value takes the modal value of the set of overlapping cells. Both of these\napproaches are intended for use with categorical raster data, where it makes no sense\nto interpolate values between category codes.","position":{"start":{"line":585,"column":1},"end":{"line":585,"column":1}},"key":"h2PdKcoIX9"}],"key":"p5zcRaX8Yp"}],"key":"Olv55N8nhC"}],"key":"BPLNWMdj53"},{"type":"paragraph","position":{"start":{"line":591,"column":1},"end":{"line":594,"column":1}},"children":[{"type":"text","value":"To use the ","position":{"start":{"line":591,"column":1},"end":{"line":591,"column":1}},"key":"XuOHjECKYc"},{"type":"inlineCode","value":"terra::project","position":{"start":{"line":591,"column":1},"end":{"line":591,"column":1}},"key":"XcEEygxH49"},{"type":"text","value":" function, you need to provide a raster with the target\nresolution and projection to use as a template. To reproject the Sentinel 2 data, we can\nsimply use the Land Cover map datasets, which are also have a 10m resolution and have\nbeen cropped to the study area.","position":{"start":{"line":591,"column":1},"end":{"line":591,"column":1}},"key":"v216kY3eS9"}],"key":"SsF71s3dSL"}],"key":"PsR2XYeKPA"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"s2_silwood_10m <- project(s2_silwood_10m, silwood_LCM, method=\"cubic\")\ns2_nhm_10m <- project(s2_nhm_10m, nhm_LCM, method=\"cubic\")","key":"MkZhemsRQq"},{"type":"output","id":"ulDLajRqvbmmcMAUoxAGN","data":[],"key":"DdOCVB4L5Z"}],"key":"ZOGtJe4mb5"},{"type":"block","children":[{"type":"admonition","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Exercise","position":{"start":{"line":601,"column":1},"end":{"line":601,"column":1}},"key":"BaYtbuRd9T"}],"key":"FVscy6As0r"},{"type":"paragraph","position":{"start":{"line":603,"column":1},"end":{"line":604,"column":1}},"children":[{"type":"text","value":"Repeat this reprojection for the 20 metre resolution Sentinel 2 datasets that you\ncreated earlier (","position":{"start":{"line":603,"column":1},"end":{"line":603,"column":1}},"key":"XiBsjXqEuv"},{"type":"inlineCode","value":"s2_silwood_20m","position":{"start":{"line":603,"column":1},"end":{"line":603,"column":1}},"key":"fbOQIONdDI"},{"type":"text","value":" and ","position":{"start":{"line":603,"column":1},"end":{"line":603,"column":1}},"key":"o5LpjjwefL"},{"type":"inlineCode","value":"s2_nhm_20m","position":{"start":{"line":603,"column":1},"end":{"line":603,"column":1}},"key":"ATtMXnVN9C"},{"type":"text","value":").","position":{"start":{"line":603,"column":1},"end":{"line":603,"column":1}},"key":"Rd3VJxaaxt"}],"key":"wYV1JizzOp"},{"type":"paragraph","position":{"start":{"line":606,"column":1},"end":{"line":607,"column":1}},"children":[{"type":"text","value":"You should reproject the data to the same 20 metre resolution. We do not have an\nexisting BNG raster dataset at this resolution, so you will need to make one.","position":{"start":{"line":606,"column":1},"end":{"line":606,"column":1}},"key":"QKYohGt0od"}],"key":"eFIkvMP6dR"}],"key":"A9Serrq2k9"}],"key":"WrCQ1OxCvQ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Make 20 metre resolution templates for the study sites\nsilwood_template_20m <- rast(ext(silwood_aerial), res=20, crs=\"EPSG:27700\")\nnhm_template_20m <- rast(ext(nhm_aerial), res=20, crs=\"EPSG:27700\")\n\n# Reproject S2 20m bands into BNG\ns2_silwood_20m <- project(s2_silwood_20m, silwood_template_20m, method=\"cubic\")\ns2_nhm_20m <- project(s2_nhm_20m, nhm_template_20m, method=\"cubic\")","visibility":"show","key":"gQvtCZVVTv"},{"type":"output","id":"VAQ81XsNW-N5qL-ZVmlkR","data":[],"visibility":"show","key":"wcVY6YfkiX"}],"data":{"tags":[]},"visibility":"hide","key":"gFn50Svtkv"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":623,"column":1},"end":{"line":623,"column":1}},"children":[{"type":"text","value":"Manipulating raster data","position":{"start":{"line":623,"column":1},"end":{"line":623,"column":1}},"key":"z9qv6sGvXf"}],"identifier":"manipulating-raster-data","label":"Manipulating raster data","html_id":"manipulating-raster-data","implicit":true,"key":"nF4BKAyxFq"},{"type":"paragraph","position":{"start":{"line":625,"column":1},"end":{"line":627,"column":1}},"children":[{"type":"text","value":"Even once you have raster datasets in the same resolution, it is common to want to\nmanipulate them to get multiple datasets into the same extent and resolution. This\nsection covers:","position":{"start":{"line":625,"column":1},"end":{"line":625,"column":1}},"key":"yBBLdyCzsI"}],"key":"Rk6WMs1GuZ"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":629,"column":1},"end":{"line":633,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":629,"column":1},"end":{"line":629,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"upscaling and downscaling raster resolution,","position":{"start":{"line":629,"column":1},"end":{"line":629,"column":1}},"key":"ebdSdDqbQW"}],"key":"mOjM3pHPdm"}],"key":"z8QSsrkaJt"},{"type":"listItem","spread":true,"position":{"start":{"line":630,"column":1},"end":{"line":630,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"joining adjacent raster tiles into a single dataset,","position":{"start":{"line":630,"column":1},"end":{"line":630,"column":1}},"key":"N1OcCXWcnM"}],"key":"Aq0iuxFPQc"}],"key":"A16SHJav2b"},{"type":"listItem","spread":true,"position":{"start":{"line":631,"column":1},"end":{"line":631,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"combining raster bands for datasets with the same extent and resolution, and","position":{"start":{"line":631,"column":1},"end":{"line":631,"column":1}},"key":"Y2QOJAhaR4"}],"key":"AgNAOFaZPR"}],"key":"NOxzSKi9Wy"},{"type":"listItem","spread":true,"position":{"start":{"line":632,"column":1},"end":{"line":633,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"cropping datasets to a smaller extent.","position":{"start":{"line":632,"column":1},"end":{"line":632,"column":1}},"key":"h1SahhXOvG"}],"key":"SgQW3okg5L"}],"key":"yxZBhIu2gv"}],"key":"jAjOSpoxit"},{"type":"heading","depth":3,"position":{"start":{"line":634,"column":1},"end":{"line":634,"column":1}},"children":[{"type":"text","value":"Changing raster resolution","position":{"start":{"line":634,"column":1},"end":{"line":634,"column":1}},"key":"WATbBp1qam"}],"identifier":"changing-raster-resolution","label":"Changing raster resolution","html_id":"changing-raster-resolution","implicit":true,"key":"Vm9nW3gDZT"},{"type":"paragraph","position":{"start":{"line":636,"column":1},"end":{"line":637,"column":1}},"children":[{"type":"text","value":"If you want to change the resolution or grid of an existing raster grid ","position":{"start":{"line":636,"column":1},"end":{"line":636,"column":1}},"key":"Mm1ERHUhhx"},{"type":"strong","position":{"start":{"line":636,"column":1},"end":{"line":636,"column":1}},"children":[{"type":"text","value":"without\nchanging the projection","position":{"start":{"line":636,"column":1},"end":{"line":636,"column":1}},"key":"ieGGLJMH6P"}],"key":"LZlsatOKIO"},{"type":"text","value":" then you there are a few options:","position":{"start":{"line":636,"column":1},"end":{"line":636,"column":1}},"key":"eMS3x4HqdG"}],"key":"aXYvmY0ZZv"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":639,"column":1},"end":{"line":647,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":639,"column":1},"end":{"line":642,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":639,"column":1},"end":{"line":641,"column":1}},"children":[{"type":"text","value":"If you want to change the grid resolution by a simple factor while keeping the same\nbasic grid cell alignments and extent, then you can use the ","position":{"start":{"line":639,"column":1},"end":{"line":639,"column":1}},"key":"UM6STvlPiC"},{"type":"inlineCode","value":"terra::aggregate","position":{"start":{"line":639,"column":1},"end":{"line":639,"column":1}},"key":"BujDamvrx2"},{"type":"text","value":" and\n","position":{"start":{"line":639,"column":1},"end":{"line":639,"column":1}},"key":"GXrFzvUBSW"},{"type":"inlineCode","value":"terra::disagg","position":{"start":{"line":639,"column":1},"end":{"line":639,"column":1}},"key":"X7d6lGWMk0"},{"type":"text","value":" functions.","position":{"start":{"line":639,"column":1},"end":{"line":639,"column":1}},"key":"hPxwNwXuw3"}],"key":"TBHaPOyjHw"}],"key":"khOvAIux0g"},{"type":"listItem","spread":true,"position":{"start":{"line":643,"column":1},"end":{"line":647,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":643,"column":1},"end":{"line":646,"column":1}},"children":[{"type":"text","value":"If you need to change the grid to a raster resolution that is not a simple factor or\nneed to move the cell boundaries to match another dataset, then you will need the\n","position":{"start":{"line":643,"column":1},"end":{"line":643,"column":1}},"key":"rVXnFom2aH"},{"type":"inlineCode","value":"terra::resample","position":{"start":{"line":643,"column":1},"end":{"line":643,"column":1}},"key":"Fvftu51ZzX"},{"type":"text","value":" function. This functions much like ","position":{"start":{"line":643,"column":1},"end":{"line":643,"column":1}},"key":"eM3EV9p7TL"},{"type":"inlineCode","value":"terra::project","position":{"start":{"line":643,"column":1},"end":{"line":643,"column":1}},"key":"W0hBQbYWSR"},{"type":"text","value":" without the\ncoordinate transformation, and has the same methods for resampling onto the new grid.","position":{"start":{"line":643,"column":1},"end":{"line":643,"column":1}},"key":"UXQm1Agh55"}],"key":"bWPBu4tpEi"}],"key":"O0m8GrNGml"}],"key":"BajBDMHLVI"},{"type":"paragraph","position":{"start":{"line":648,"column":1},"end":{"line":651,"column":1}},"children":[{"type":"text","value":"Here, we will use disaggregation to resample the 20 metre resolution Sentinel 2 bands to\n10 metre resolution. We will use ","position":{"start":{"line":648,"column":1},"end":{"line":648,"column":1}},"key":"JQBZCLFpJ5"},{"type":"inlineCode","value":"method=bilinear","position":{"start":{"line":648,"column":1},"end":{"line":648,"column":1}},"key":"j7c8TVjqMK"},{"type":"text","value":" which uses a simple linear model to\nassign new cell values; the alternative ","position":{"start":{"line":648,"column":1},"end":{"line":648,"column":1}},"key":"r0tzxbzxRW"},{"type":"inlineCode","value":"method=near","position":{"start":{"line":648,"column":1},"end":{"line":648,"column":1}},"key":"aozLdTIz8V"},{"type":"text","value":" would simply duplicate the value\nfrom the nearest coarser resolution cell into each of the smaller cells.","position":{"start":{"line":648,"column":1},"end":{"line":648,"column":1}},"key":"qeF0cnxtXp"}],"key":"Qb9X9vYdv1"}],"key":"xQ2na8EYmM"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"s2_silwood_20m_at_10m <- disagg(s2_silwood_20m, fact=2, method=\"bilinear\")\ns2_nhm_20m_at_10m <- disagg(s2_nhm_20m, fact=2, method=\"bilinear\")","key":"svfI5oz5Vs"},{"type":"output","id":"zlDUsudbh1xdSflyIEbzO","data":[],"key":"HTLU4D71mg"}],"key":"O4506upCx0"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":658,"column":1},"end":{"line":658,"column":1}},"children":[{"type":"text","value":"We can use the ","position":{"start":{"line":658,"column":1},"end":{"line":658,"column":1}},"key":"KXLyjng7NE"},{"type":"inlineCode","value":"terra::res","position":{"start":{"line":658,"column":1},"end":{"line":658,"column":1}},"key":"LAjeDwwOkx"},{"type":"text","value":" function to show the resolutions of the two versions.","position":{"start":{"line":658,"column":1},"end":{"line":658,"column":1}},"key":"tW4AIiy8e1"}],"key":"GReokR4oSw"}],"key":"x3zrRM9wZZ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"print(res(s2_silwood_20m))\nprint(res(s2_silwood_20m_at_10m))","key":"PUWK7Kcl7I"},{"type":"output","id":"26gD3e9hOahyYvD8aLKD4","data":[],"key":"Yg6VMIBgXj"}],"key":"f6Q9BPRFTi"},{"type":"block","children":[{"type":"admonition","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Stretch goal: projecting Sentinel 2 to 10m resolution","position":{"start":{"line":665,"column":1},"end":{"line":665,"column":1}},"key":"Fm9opYGndg"}],"key":"oTt5YRLAQ4"},{"type":"paragraph","position":{"start":{"line":668,"column":1},"end":{"line":670,"column":1}},"children":[{"type":"text","value":"We could also have got the 20 metre resolution Sentinel 2 bands resampled to 10 metres\nusing  only the ","position":{"start":{"line":668,"column":1},"end":{"line":668,"column":1}},"key":"P9M4UKYy5H"},{"type":"inlineCode","value":"terra::project","position":{"start":{"line":668,"column":1},"end":{"line":668,"column":1}},"key":"vUrAXwKeiG"},{"type":"text","value":" function. See if you can generate\n","position":{"start":{"line":668,"column":1},"end":{"line":668,"column":1}},"key":"C1e6GrtDuF"},{"type":"inlineCode","value":"s2_silwood_20m_direct_to_10m","position":{"start":{"line":668,"column":1},"end":{"line":668,"column":1}},"key":"hHzgJ8JHYS"},{"type":"text","value":" and ","position":{"start":{"line":668,"column":1},"end":{"line":668,"column":1}},"key":"bjI8z5VJzj"},{"type":"inlineCode","value":"s2_nhm_20m_direct_to_10m","position":{"start":{"line":668,"column":1},"end":{"line":668,"column":1}},"key":"JWIP3zpKyY"},{"type":"text","value":" using only that function.","position":{"start":{"line":668,"column":1},"end":{"line":668,"column":1}},"key":"gD10PNqHo1"}],"key":"wD0mYrYjpg"}],"class":"tip","key":"BRrhB9EM8a"},{"type":"comment","value":" The cell below is code-block, not code-cell, to avoid running a slow step. ","key":"R1XeIKndJd"},{"type":"code","lang":"r","value":"# It is actually very easy - we can just use one of the existing 10m \n# resolution datasets as the resampling template. This is quite a lot\n# slower than doing it in two stages.\ns2_silwood_20m_direct_to_10m <- project(\n  s2_silwood_20m, silwood_aerial, method=\"cubic\"\n)\ns2_nhm_20m_direct_to_10m <- project(\n  s2_nhm_20m, nhm_aerial, method=\"cubic\"\n)","key":"QucdnD59a9"},{"type":"heading","depth":3,"position":{"start":{"line":688,"column":1},"end":{"line":688,"column":1}},"children":[{"type":"text","value":"Mosaicing rasters","position":{"start":{"line":688,"column":1},"end":{"line":688,"column":1}},"key":"tmqlYuQHWr"}],"identifier":"mosaicing-rasters","label":"Mosaicing rasters","html_id":"mosaicing-rasters","implicit":true,"key":"YiPUZ7xu8k"},{"type":"paragraph","position":{"start":{"line":690,"column":1},"end":{"line":694,"column":1}},"children":[{"type":"text","value":"We can ","position":{"start":{"line":690,"column":1},"end":{"line":690,"column":1}},"key":"pY7tq9h3Rp"},{"type":"strong","position":{"start":{"line":690,"column":1},"end":{"line":690,"column":1}},"children":[{"type":"text","value":"mosaic","position":{"start":{"line":690,"column":1},"end":{"line":690,"column":1}},"key":"pyP2hJI4BQ"}],"key":"Z3PgFGbbdt"},{"type":"text","value":" the two panes of Terrain 5 data for each site from two 5km panes into\na single rectangle of data. The two panes are side by side for Silwood and one above the\nother for the NHM. The plot below shows the 5 x 5 km extent of the two panes. The figure\nalso shows the 3 x 3 km extent of the other data sources - as you can see it overlaps\nthe Terrain 5 panes for both sites, which is why we needed to load two panes.","position":{"start":{"line":690,"column":1},"end":{"line":690,"column":1}},"key":"rrIkFCMJYA"}],"key":"BRUu7rvsC0"},{"type":"admonition","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Stretch goal - plotting tricks","position":{"start":{"line":696,"column":1},"end":{"line":696,"column":1}},"key":"Q9R6pD2EHz"}],"key":"xNCNJslAaJ"},{"type":"paragraph","position":{"start":{"line":699,"column":1},"end":{"line":703,"column":1}},"children":[{"type":"text","value":"The concealed source code below contains the code to create the raster extents plot\nbelow. It includes a couple of useful tricks: changing the spatial extent of the plot to\ninclude more than one dataset, adding mutiple layers to a spatial plot, and using\ncoordinates to add labels. You do not need to know these details for the practical, but\nthis might be something to come back to and look at.","position":{"start":{"line":699,"column":1},"end":{"line":699,"column":1}},"key":"u6gIqBgIQU"}],"key":"zYmNqDAidH"}],"class":"tip","key":"oexOf6eknN"}],"key":"O3Z5mhYQAv"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"options(repr.plot.height=4)\n\npar(mfrow=c(1,2))\n\n# Calculate the union of the extents of the two rasters\nsilwood_dtm_extent <- union(ext(silwood_dtm_SU96NE), ext(silwood_dtm_SU96NW ))\n\n# Plot the extent of the first raster, but using the extent of both datasets\nplot(ext(silwood_dtm_SU96NE), border=\"blue\", ext=silwood_dtm_extent, main=\"Silwood\")\n\n# Get the middle coordinates of the raster and add a label. The `xFromCol` and \n# `yFromRow` functions extract the X and Y coordinates of cell centres from the \n# raster and `mean` then gives the centre of the raster image.\ntext(\n  x=mean(xFromCol(silwood_dtm_SU96NE)), \n  y=mean(yFromRow(silwood_dtm_SU96NE)),\n  labels=\"SU96NE\", col=\"blue\"\n)\n\n# Use `add=TRUE` to add the extent of the second raster and add the label\nplot(ext(silwood_dtm_SU96NW), border=\"red\", add=TRUE)\ntext(\n  x=mean(xFromCol(silwood_dtm_SU96NW)), \n  y=mean(yFromRow(silwood_dtm_SU96NW)),\n  labels=\"SU96NW\", col=\"red\"\n)\n\n# Finally add the extent of the other raster datasets \nplot(ext(silwood_aerial), border=\"black\", add=TRUE)\n\n# Repeat for the NHM datasets\nnhm_dtm_extent <- union(ext(nhm_dtm_TQ27NE), ext(nhm_dtm_TQ28SE))\n\nplot(ext(nhm_dtm_TQ27NE), border=\"blue\", ext=nhm_dtm_extent, main=\"NHM\")\ntext(\n  x=mean(xFromCol(nhm_dtm_TQ27NE)), \n  y=mean(yFromRow(nhm_dtm_TQ27NE)),\n  labels=\"TQ27NE\", col=\"blue\"\n)\nplot(ext(nhm_dtm_TQ28SE), border=\"red\", add=TRUE)\ntext(\n  x=mean(xFromCol(nhm_dtm_TQ28SE)), \n  y=mean(yFromRow(nhm_dtm_TQ28SE)),\n  labels=\"TQ28SE\", col=\"red\"\n)\nplot(ext(nhm_aerial), border=\"black\", add=TRUE)","visibility":"hide","key":"SVnPAivbLD"},{"type":"output","id":"ZsotH4M-gjbmg52CS95Ra","data":[],"visibility":"show","key":"QT44NtVHug"}],"data":{"tags":[]},"visibility":"show","key":"O9DsXIILKO"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":757,"column":1},"end":{"line":761,"column":1}},"children":[{"type":"text","value":"We use the ","position":{"start":{"line":757,"column":1},"end":{"line":757,"column":1}},"key":"bQUidzpTd5"},{"type":"inlineCode","value":"terra::mosaic","position":{"start":{"line":757,"column":1},"end":{"line":757,"column":1}},"key":"WhX4MLNjpu"},{"type":"text","value":" function to combine these two panes into a single dataset for\neach site. There is also the ","position":{"start":{"line":757,"column":1},"end":{"line":757,"column":1}},"key":"afKmB9FI08"},{"type":"inlineCode","value":"terra::merge","position":{"start":{"line":757,"column":1},"end":{"line":757,"column":1}},"key":"lS8Fm4gW3m"},{"type":"text","value":" function: this is used to combine aligned\nraster datasets that are not simply neatly adjoining tiles. It also make life easier if\nwe update these datasets so they use the same raster layer name - they currently are\nnamed by BNG grid pane.","position":{"start":{"line":757,"column":1},"end":{"line":757,"column":1}},"key":"cEu5cQDvLe"}],"key":"pQ2BO4xdvp"}],"key":"K6LCn1gKQG"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Mosaic the two Terrain 5 panes into a single dataset\nsilwood_dtm <- mosaic(silwood_dtm_SU96NE, silwood_dtm_SU96NW)\nnhm_dtm <- mosaic(nhm_dtm_TQ27NE, nhm_dtm_TQ28SE)\n\n# Update the raster layer names\nnames(silwood_dtm) <- names(nhm_dtm) <- \"Elevation\"","key":"ttVhNMWg8K"},{"type":"output","id":"Y63UyJXn_BXqfkFAYaa6w","data":[],"key":"Dqv2sd4srh"}],"key":"Ao8zzaYECx"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":772,"column":1},"end":{"line":773,"column":1}},"children":[{"type":"text","value":"We can check the extents to show what happened - the new Silwood terrain dataset now has\na 10km extent in the X dimension.","position":{"start":{"line":772,"column":1},"end":{"line":772,"column":1}},"key":"H6hrQmHYl8"}],"key":"wvwe930I8J"}],"key":"vwXTuNzXzM"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"print(ext(silwood_dtm_SU96NE))\nprint(ext(silwood_dtm_SU96NW))\nprint(ext(silwood_dtm))","key":"nHGmH5yLrT"},{"type":"output","id":"aHELEv8UQkcJy_Fa1Be6W","data":[],"key":"EzD4FsAIyC"}],"key":"ek60cQmMD1"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":781,"column":1},"end":{"line":781,"column":1}},"children":[{"type":"text","value":"Combining raster bands","position":{"start":{"line":781,"column":1},"end":{"line":781,"column":1}},"key":"UQVqVa6Toh"}],"identifier":"combining-raster-bands","label":"Combining raster bands","html_id":"combining-raster-bands","implicit":true,"key":"GFTQtbX6hy"},{"type":"paragraph","position":{"start":{"line":783,"column":1},"end":{"line":787,"column":1}},"children":[{"type":"text","value":"We can also combine rasters with the same resolution and grid to add more bands onto an\nexisting dataset. We can do this to create a new Sentinel 2 dataset that includes the\noriginal 10 metre resolution bands and the 20 metre bands that we resampled to 10\nmetres. The ","position":{"start":{"line":783,"column":1},"end":{"line":783,"column":1}},"key":"QxeNKA4SU9"},{"type":"inlineCode","value":"terra","position":{"start":{"line":783,"column":1},"end":{"line":783,"column":1}},"key":"x72d3kDhHY"},{"type":"text","value":" package takes the standard ","position":{"start":{"line":783,"column":1},"end":{"line":783,"column":1}},"key":"NtO2SxFGLl"},{"type":"inlineCode","value":"c()","position":{"start":{"line":783,"column":1},"end":{"line":783,"column":1}},"key":"bz1s7PGUQV"},{"type":"text","value":" function for combining R vectors\nand lists and extends that to join raster layers by band.","position":{"start":{"line":783,"column":1},"end":{"line":783,"column":1}},"key":"E1z3NHS7Vb"}],"key":"UfBTr00fmk"}],"key":"JyrpUqWsiT"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Combine the S2 10m bands with the resampled 20 m bands.\ns2_silwood_10m <- c(s2_silwood_10m, s2_silwood_20m_at_10m)\ns2_nhm_10m <- c(s2_nhm_10m, s2_nhm_20m_at_10m)","key":"jfHIYVEDMc"},{"type":"output","id":"HhwrTwA74U2efI0VNQtEw","data":[],"key":"ds0RcjqOT0"}],"key":"LjT2EfolHs"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":795,"column":1},"end":{"line":795,"column":1}},"children":[{"type":"text","value":"Cropping rasters","position":{"start":{"line":795,"column":1},"end":{"line":795,"column":1}},"key":"UErRnh82hb"}],"identifier":"cropping-rasters","label":"Cropping rasters","html_id":"cropping-rasters","implicit":true,"key":"ez821FOuKC"},{"type":"paragraph","position":{"start":{"line":797,"column":1},"end":{"line":800,"column":1}},"children":[{"type":"text","value":"You can reduce the size of a raster dataset to a particular area of interest using the\n","position":{"start":{"line":797,"column":1},"end":{"line":797,"column":1}},"key":"hugGJ9fpQC"},{"type":"inlineCode","value":"terra::crop","position":{"start":{"line":797,"column":1},"end":{"line":797,"column":1}},"key":"oXamYMJUMm"},{"type":"text","value":" function. We will use this to extract the 3km area of interest from the\nnewly mosaiced datasets. All we need to provide is another dataset that has the required\nextent.","position":{"start":{"line":797,"column":1},"end":{"line":797,"column":1}},"key":"v367CLTQYL"}],"key":"I7OdRbT5eP"}],"key":"SJiYytdM9t"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Crop the mosaiced DTM data to the 3km area of interest.\nsilwood_dtm <- crop(silwood_dtm, silwood_aerial)\nnhm_dtm <- crop(nhm_dtm, nhm_aerial)","key":"mvyymqMkqN"},{"type":"output","id":"xpIP1eAyWgTey7GK2hfQC","data":[],"key":"KqBlLhGM7c"}],"key":"qFtOv1QXF4"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":808,"column":1},"end":{"line":808,"column":1}},"children":[{"type":"text","value":"We can again check the extents of the resulting grids to check that they match:","position":{"start":{"line":808,"column":1},"end":{"line":808,"column":1}},"key":"eAeLF9EQJo"}],"key":"uM7diDgeiY"}],"key":"shr77pCJtT"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Crop the mosaiced DTM data to the 3km area of interest.\nprint(ext(silwood_dtm))\nprint(ext(silwood_aerial))","key":"md4T472yoK"},{"type":"output","id":"5nUwb93nBG3SHpP5LDUez","data":[],"key":"SNaSZkrgoX"}],"key":"rD5tcjsvvS"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":816,"column":1},"end":{"line":816,"column":1}},"children":[{"type":"text","value":"Manipulating vector data","position":{"start":{"line":816,"column":1},"end":{"line":816,"column":1}},"key":"LPEHwPhPvH"}],"identifier":"manipulating-vector-data","label":"Manipulating vector data","html_id":"manipulating-vector-data","implicit":true,"key":"VWz60Sohvc"},{"type":"paragraph","position":{"start":{"line":818,"column":1},"end":{"line":819,"column":1}},"children":[{"type":"text","value":"Vector data manipulation is generally either to merge two datasets or to crop data to a\nsmaller spatial extent.","position":{"start":{"line":818,"column":1},"end":{"line":818,"column":1}},"key":"BgTwaVd6DU"}],"key":"GBP3cTFSDB"},{"type":"heading","depth":3,"position":{"start":{"line":821,"column":1},"end":{"line":821,"column":1}},"children":[{"type":"text","value":"Merging vector data","position":{"start":{"line":821,"column":1},"end":{"line":821,"column":1}},"key":"IzYsGfKA4v"}],"identifier":"merging-vector-data","label":"Merging vector data","html_id":"merging-vector-data","implicit":true,"key":"zgLkyhBY0v"},{"type":"paragraph","position":{"start":{"line":823,"column":1},"end":{"line":825,"column":1}},"children":[{"type":"text","value":"Vector data is easier to merge in some ways: because the coordinates are recorded\nas sets of point forming features, you donâ€™t have to worry about cell alignment or\nresolution. However, to merge a set of spatial features:","position":{"start":{"line":823,"column":1},"end":{"line":823,"column":1}},"key":"VGLigQMTYr"}],"key":"IZ6rLUjgv7"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":827,"column":1},"end":{"line":830,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":827,"column":1},"end":{"line":828,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The two datasets have to have the same attributes: the data associated with each\nfeature needs to match.","position":{"start":{"line":827,"column":1},"end":{"line":827,"column":1}},"key":"i2WqH0lrvB"}],"key":"MxcBXYul5p"}],"key":"txaikjWKQG"},{"type":"listItem","spread":true,"position":{"start":{"line":829,"column":1},"end":{"line":830,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The two datasets have to be in the same projection.","position":{"start":{"line":829,"column":1},"end":{"line":829,"column":1}},"key":"WuwohZacqS"}],"key":"TPVT5kuiVu"}],"key":"HgPz1yK6UN"}],"key":"yfpnLYSYxb"},{"type":"paragraph","position":{"start":{"line":831,"column":1},"end":{"line":834,"column":1}},"children":[{"type":"text","value":"Provided these two things are true, then merging two vector datasets is basically the\nsame as binding together the rows of two data frames with the same structure. The ","position":{"start":{"line":831,"column":1},"end":{"line":831,"column":1}},"key":"SeCY17c48B"},{"type":"inlineCode","value":"sf","position":{"start":{"line":831,"column":1},"end":{"line":831,"column":1}},"key":"ga0JXxQoCJ"},{"type":"text","value":"\npackage provides a version of the ","position":{"start":{"line":831,"column":1},"end":{"line":831,"column":1}},"key":"xzrD5PeqdE"},{"type":"inlineCode","value":"rbind","position":{"start":{"line":831,"column":1},"end":{"line":831,"column":1}},"key":"QQBRilZE3c"},{"type":"text","value":" function that joins two ","position":{"start":{"line":831,"column":1},"end":{"line":831,"column":1}},"key":"CJDs2ecsI6"},{"type":"inlineCode","value":"sf","position":{"start":{"line":831,"column":1},"end":{"line":831,"column":1}},"key":"PWttsshvII"},{"type":"text","value":" objects, and we\ncan use this to combine the two VML panes for the sites.","position":{"start":{"line":831,"column":1},"end":{"line":831,"column":1}},"key":"kclYsdQo68"}],"key":"sq07obgD40"}],"key":"a3kOp0hmWV"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Combine the road panes\nsilwood_VML_roads <- rbind(vml_su96ne_roads, vml_su96nw_roads)\nnhm_VML_roads <- rbind(vml_tq28se_roads, vml_tq27ne_roads)\n\n# Combine the water area panes\nsilwood_VML_water <- rbind(vml_su96ne_roads, vml_su96nw_roads)\nnhm_VML_water <- rbind(vml_tq28se_water, vml_tq27ne_water)","key":"biIDW4FJRn"},{"type":"output","id":"yFOtsiMAOfr-THWKcGTNM","data":[],"key":"VlgSPRFrZs"}],"key":"xkmYrKdT0U"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"st_bbox(vml_su96ne_roads)\nst_bbox(vml_su96nw_roads)\nst_bbox(silwood_VML_roads)","key":"i84XPsWNeA"},{"type":"output","id":"7tNy22QFQ9CLPi930aoIm","data":[],"key":"cuTUR7DQaZ"}],"key":"kfF7TqHF1Y"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":852,"column":1},"end":{"line":852,"column":1}},"children":[{"type":"text","value":"Cropping vector data","position":{"start":{"line":852,"column":1},"end":{"line":852,"column":1}},"key":"ZEYM3CuWiP"}],"identifier":"cropping-vector-data","label":"Cropping vector data","html_id":"cropping-vector-data","implicit":true,"key":"n1Kd02b1ob"},{"type":"paragraph","position":{"start":{"line":854,"column":1},"end":{"line":854,"column":1}},"children":[{"type":"text","value":"The VectorMap Local data is also taken from","position":{"start":{"line":854,"column":1},"end":{"line":854,"column":1}},"key":"TZpWuetNkY"}],"key":"K122fK1vJC"},{"type":"comment","value":" \n\n### Vector operations\n\nwithin, voronoi etc?\n\n```{code-cell} r\nwithin_25 <- st_within(nest_boxes, nest_boxes_25, sparse=FALSE)\nn_within_25 <- colSums(within_25)\n```\n ","key":"ux72YURrSz"},{"type":"heading","depth":2,"position":{"start":{"line":868,"column":1},"end":{"line":868,"column":1}},"children":[{"type":"text","value":"Plotting spatial data in R","position":{"start":{"line":868,"column":1},"end":{"line":868,"column":1}},"key":"kuBTDh6QBn"}],"identifier":"plotting-spatial-data-in-r","label":"Plotting spatial data in R","html_id":"plotting-spatial-data-in-r","implicit":true,"key":"RtxqU92MWk"},{"type":"heading","depth":3,"position":{"start":{"line":870,"column":1},"end":{"line":870,"column":1}},"children":[{"type":"text","value":"RGB and false colour plots","position":{"start":{"line":870,"column":1},"end":{"line":870,"column":1}},"key":"QuynDc23ZI"}],"identifier":"rgb-and-false-colour-plots","label":"RGB and false colour plots","html_id":"rgb-and-false-colour-plots","implicit":true,"key":"rCS3izAl7n"},{"type":"paragraph","position":{"start":{"line":872,"column":1},"end":{"line":872,"column":1}},"children":[{"type":"text","value":"If you plot a raster object, it will plot each band separately:","position":{"start":{"line":872,"column":1},"end":{"line":872,"column":1}},"key":"vXc93yFhQA"}],"key":"yH0wZqsXKN"}],"key":"wEb54d1pk3"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Plot the 3 bands of the silwood aerial image\nnames(silwood_aerial) <- c(\"Red\", \"Green\", \"Blue\")\nplot(silwood_aerial, nc=3)","key":"aGv23fbRZC"},{"type":"output","id":"om-ETajjACRoxnxdkwn0C","data":[],"key":"Spokf7HL0v"}],"key":"SswL17Hows"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":880,"column":1},"end":{"line":882,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":880,"column":1},"end":{"line":880,"column":1}},"key":"jKBAmULQZo"},{"type":"inlineCode","value":"terra::plotRGB","position":{"start":{"line":880,"column":1},"end":{"line":880,"column":1}},"key":"bJ5jx3dKQ7"},{"type":"text","value":" function can be used to combine 3 bands to generate a colour image.\nThe ","position":{"start":{"line":880,"column":1},"end":{"line":880,"column":1}},"key":"AfqBiKfLKD"},{"type":"inlineCode","value":"silwood_aerial","position":{"start":{"line":880,"column":1},"end":{"line":880,"column":1}},"key":"urI8Jq6j6K"},{"type":"text","value":" image contains the three RGB bands in the correct order, so we can\nsimply plot it:","position":{"start":{"line":880,"column":1},"end":{"line":880,"column":1}},"key":"KbLdIlCe00"}],"key":"Mrs6igUeVX"}],"key":"eMr1vMUtYA"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Plot the silwood aerial data using the default settings\nplotRGB(silwood_aerial)","key":"X2Ko7sqNbS"},{"type":"output","id":"fYafOsdAfpfzO5bwlp1Xc","data":[],"key":"KS2Dq44DwJ"}],"key":"svbq2r4dul"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":889,"column":1},"end":{"line":891,"column":1}},"children":[{"type":"text","value":"If we want to do the same thing with the RGB data from the Sentinel 2 data then we need\nto adjust the command to give the bands in the right order and also to set the maximum\nscale of the values across the bands.","position":{"start":{"line":889,"column":1},"end":{"line":889,"column":1}},"key":"smwHzxyYxh"}],"key":"H4K3jlFKJY"}],"key":"i7AJQ9uZvj"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Plot the Sentinel data, setting the bands and scale\nplotRGB(s2_silwood_10m, r=3, g=2, b=1, scale=0.76)","key":"b1ahLZ0Thb"},{"type":"output","id":"4LTunrjEPWjZPnqyIgRs6","data":[],"key":"rx35SRogNL"}],"key":"WYXCpSsZOa"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":898,"column":1},"end":{"line":900,"column":1}},"children":[{"type":"text","value":"In fact, the L2A Sentinel 2 product provides a True Colour Image (TCI) that orders and\nscale the RGB bands to give something closer to expected colour. This can be used with\nthe default settings.","position":{"start":{"line":898,"column":1},"end":{"line":898,"column":1}},"key":"lmtAzC8blb"}],"key":"f9Bw1YTRlY"}],"key":"MxU5QCJJse"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Load the L2A TCI image for Silwood and plot using defaults.\ns2_silwood_tci <- rast(\n  \"data/sentinel_2/R10m/silwood/T30UXC_20250711T110651_TCI_10m.tiff\"\n)\nplotRGB(s2_silwood_tci)","key":"aAHmKV4dEs"},{"type":"output","id":"i3J7ktFqngnJzF6Hu13QV","data":[],"key":"AGo3KPtnmF"}],"key":"RPOJGOmQyd"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":910,"column":1},"end":{"line":915,"column":1}},"children":[{"type":"text","value":"Alternatively, you can set different bands as inputs to give a â€œfalse-colour imageâ€. One\ncommon usage is a ","position":{"start":{"line":910,"column":1},"end":{"line":910,"column":1}},"key":"drMQAncrYR"},{"type":"link","url":"https://custom-scripts.sentinel-hub.com/custom-scripts/sentinel-2/false_color_infrared/","position":{"start":{"line":910,"column":1},"end":{"line":910,"column":1}},"children":[{"type":"text","value":"false colour\ninfrared","position":{"start":{"line":910,"column":1},"end":{"line":910,"column":1}},"key":"S6A1vOwa0i"}],"urlSource":"https://custom-scripts.sentinel-hub.com/custom-scripts/sentinel-2/false_color_infrared/","key":"rvekAQBBzn"},{"type":"text","value":"\nimage, which swaps from the ","position":{"start":{"line":910,"column":1},"end":{"line":910,"column":1}},"key":"WGaA8DUYEH"},{"type":"inlineCode","value":"[R, G, B]","position":{"start":{"line":910,"column":1},"end":{"line":910,"column":1}},"key":"hbd0UB5wLc"},{"type":"text","value":" bands to ","position":{"start":{"line":910,"column":1},"end":{"line":910,"column":1}},"key":"gbA4WM5ih1"},{"type":"inlineCode","value":"[NIR, R, G]","position":{"start":{"line":910,"column":1},"end":{"line":910,"column":1}},"key":"BPjr4aFmW3"},{"type":"text","value":". This kind of imagery is\nvery good at pulling out differences between vegetation (bright red), water (dark) and\nurban areas and bare ground (tan or grey).","position":{"start":{"line":910,"column":1},"end":{"line":910,"column":1}},"key":"IlSnZYoBpE"}],"key":"PkhEpGXt4b"}],"key":"aIl2BgIKQA"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Plot the Sentinel data, setting the bands and scale\nplotRGB(s2_silwood_10m, r=4, g=3, b=2, scale=0.8)","key":"Hjal4bdMn8"},{"type":"output","id":"SXPu1_vqiDqzOx-o_SDSJ","data":[],"key":"eqat34BqUN"}],"key":"MEPZN3nEU3"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":922,"column":1},"end":{"line":922,"column":1}},"children":[{"type":"text","value":"Overlaying plots","position":{"start":{"line":922,"column":1},"end":{"line":922,"column":1}},"key":"jyn5Q4517G"}],"identifier":"overlaying-plots","label":"Overlaying plots","html_id":"overlaying-plots","implicit":true,"key":"BJ6yRmPZc1"},{"type":"paragraph","position":{"start":{"line":924,"column":1},"end":{"line":924,"column":1}},"children":[{"type":"text","value":"GIS plots are tricky to do well:","position":{"start":{"line":924,"column":1},"end":{"line":924,"column":1}},"key":"vClYGR15fT"}],"key":"hwh9cG1vFw"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":926,"column":1},"end":{"line":930,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":926,"column":1},"end":{"line":927,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"They often get incredibly crowded and it is best to keep them simple and not show too\nmany elements in a single figure.","position":{"start":{"line":926,"column":1},"end":{"line":926,"column":1}},"key":"V2qQ4xRUGK"}],"key":"i16Zj8ET87"}],"key":"Nv5RyGyVvy"},{"type":"listItem","spread":true,"position":{"start":{"line":928,"column":1},"end":{"line":930,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"They also have a fixed aspect ratio - the shape of the plot is dictated by the extent\nof the data - and so they can be difficult to size properly for publication.","position":{"start":{"line":928,"column":1},"end":{"line":928,"column":1}},"key":"XATNbBVacx"}],"key":"uzP2RpUfaY"}],"key":"RWjVx3aNZ6"}],"key":"AaBJc1R6o7"},{"type":"paragraph","position":{"start":{"line":931,"column":1},"end":{"line":931,"column":1}},"children":[{"type":"text","value":"There are a lot","position":{"start":{"line":931,"column":1},"end":{"line":931,"column":1}},"key":"cbpaEAhGRl"}],"key":"HzWa7RbviV"},{"type":"heading","depth":2,"position":{"start":{"line":933,"column":1},"end":{"line":933,"column":1}},"children":[{"type":"text","value":"Raster calculations","position":{"start":{"line":933,"column":1},"end":{"line":933,"column":1}},"key":"v5FHel521s"}],"identifier":"raster-calculations","label":"Raster calculations","html_id":"raster-calculations","implicit":true,"key":"ly8Tqtoc6O"},{"type":"paragraph","position":{"start":{"line":935,"column":1},"end":{"line":941,"column":1}},"children":[{"type":"text","value":"A layer in a continuous raster dataset is basically just a large numeric matrix. This\nmeans you can use raster layers in equations to calulate new composite indices that\nemphasize different parts of the spectral signal. There are a very large number of\nremote sensing indices and the ","position":{"start":{"line":935,"column":1},"end":{"line":935,"column":1}},"key":"L3wx4OxDNE"},{"type":"link","url":"https://custom-scripts.sentinel-hub.com/custom-scripts/sentinel/sentinel-2/","position":{"start":{"line":935,"column":1},"end":{"line":935,"column":1}},"children":[{"type":"text","value":"Sentinel-Hub scripts\nsite","position":{"start":{"line":935,"column":1},"end":{"line":935,"column":1}},"key":"SJVgUaF3jB"}],"urlSource":"https://custom-scripts.sentinel-hub.com/custom-scripts/sentinel/sentinel-2/","key":"smsmNtBpjS"},{"type":"text","value":"\nprovides formulae for a wide range of options. Here we will look at two simple\nvegetation indices.","position":{"start":{"line":935,"column":1},"end":{"line":935,"column":1}},"key":"KurMZLFTAy"}],"key":"Qc184l5j9C"},{"type":"heading","depth":3,"position":{"start":{"line":943,"column":1},"end":{"line":943,"column":1}},"children":[{"type":"text","value":"NDVI","position":{"start":{"line":943,"column":1},"end":{"line":943,"column":1}},"key":"jW62WcvFlF"}],"identifier":"ndvi","label":"NDVI","html_id":"ndvi","implicit":true,"key":"K0SsO3Ysvm"},{"type":"paragraph","position":{"start":{"line":945,"column":1},"end":{"line":945,"column":1}},"children":[{"type":"text","value":"The normalised difference vegetation index (NDVI) is defined as:","position":{"start":{"line":945,"column":1},"end":{"line":945,"column":1}},"key":"CgJTO8yCO8"}],"key":"pOCcSlBRrB"},{"type":"math","value":"NDVI = \\frac{\\text{NIR} - \\text{RED}}{\\text{NIR} + \\text{RED}}","position":{"start":{"line":947,"column":1},"end":{"line":949,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>N</mi><mi>D</mi><mi>V</mi><mi>I</mi><mo>=</mo><mfrac><mrow><mtext>NIR</mtext><mo>âˆ’</mo><mtext>RED</mtext></mrow><mrow><mtext>NIR</mtext><mo>+</mo><mtext>RED</mtext></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">NDVI = \\frac{\\text{NIR} - \\text{RED}}{\\text{NIR} + \\text{RED}}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">D</span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.1297em;vertical-align:-0.7693em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3603em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord text\"><span class=\"mord\">NIR</span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord text\"><span class=\"mord\">RED</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord text\"><span class=\"mord\">NIR</span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">âˆ’</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord text\"><span class=\"mord\">RED</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7693em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span>","enumerator":"1","key":"hevdbjUp3O"},{"type":"paragraph","position":{"start":{"line":951,"column":1},"end":{"line":954,"column":1}},"children":[{"type":"text","value":"where NIR is band data for the near infrared and RED is band data in the red spectrum,\nwhich are Sentinel 2 bands B8 and B4. The index returns values from -1 (water) through 0\n(rock and bare ground) to 1 (rainforest). See ","position":{"start":{"line":951,"column":1},"end":{"line":951,"column":1}},"key":"uIWkSv2a45"},{"type":"link","url":"https://custom-scripts.sentinel-hub.com/sentinel-2/ndvi/","position":{"start":{"line":951,"column":1},"end":{"line":951,"column":1}},"children":[{"type":"text","value":"the Sentinel-Hub NDVI script page for\nmore details","position":{"start":{"line":951,"column":1},"end":{"line":951,"column":1}},"key":"Lo45gN3CI8"}],"urlSource":"https://custom-scripts.sentinel-hub.com/sentinel-2/ndvi/","key":"rgw1G4X6lh"},{"type":"text","value":".","position":{"start":{"line":951,"column":1},"end":{"line":951,"column":1}},"key":"yupZKzw1SZ"}],"key":"s5FEqYhAKd"}],"key":"f4mShKPqGi"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Calculate the NDVI index for the two sites\nndvi_nhm <- (\n  s2_nhm_10m[[\"NIR\"]] - s2_nhm_10m[[\"R\"]]) / \n  (s2_nhm_10m[[\"NIR\"]] + s2_nhm_10m[[\"R\"]]\n)\nndvi_silwood <- (\n  s2_silwood_10m[[\"NIR\"]] - s2_silwood_10m[[\"R\"]]) / \n  (s2_silwood_10m[[\"NIR\"]] + s2_silwood_10m[[\"R\"]]\n)\n# Rename the single band \nnames(ndvi_silwood) <- names(ndvi_nhm) <- \"NDVI\"\n\n# Plot the NDVI index data\npar(mfrow=c(1, 2))\nplot(ndvi_silwood)\nplot(ndvi_nhm)","key":"dJnKEisqDg"},{"type":"output","id":"eq7UER_0b7LLITTKclkvP","data":[],"key":"hVCn42DOF2"}],"key":"nNp7QCWM8O"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":975,"column":1},"end":{"line":975,"column":1}},"children":[{"type":"text","value":"EVI","position":{"start":{"line":975,"column":1},"end":{"line":975,"column":1}},"key":"ta58jJza2N"}],"identifier":"evi","label":"EVI","html_id":"evi","implicit":true,"key":"DmbxdbCpVx"},{"type":"paragraph","position":{"start":{"line":977,"column":1},"end":{"line":980,"column":1}},"children":[{"type":"text","value":"The enhanced vegetation index (EVI) is very similar but includes scaling factors and\nuses the Blue band (Sentinel B2) to improve how well the index captures vegetation. The\nscale again extends from -1 to 1. See ","position":{"start":{"line":977,"column":1},"end":{"line":977,"column":1}},"key":"TwK2A7MUg8"},{"type":"link","url":"https://custom-scripts.sentinel-hub.com/sentinel-2/evi/","position":{"start":{"line":977,"column":1},"end":{"line":977,"column":1}},"children":[{"type":"text","value":"the Sentinel-Hub EVI script page for\nmore details","position":{"start":{"line":977,"column":1},"end":{"line":977,"column":1}},"key":"RIx6Rvj618"}],"urlSource":"https://custom-scripts.sentinel-hub.com/sentinel-2/evi/","key":"WSpuE5s2p1"},{"type":"text","value":".","position":{"start":{"line":977,"column":1},"end":{"line":977,"column":1}},"key":"vg0UvsQ3Uo"}],"key":"tVkd3iquTy"},{"type":"math","value":"EVI = 2.5 \\cdot \\left( \\frac{\\text{NIR} - \\text{RED}}\n  {\\text{NIR} + 6 \\cdot \\text{RED} - 7.5 \\cdot \\text{BLUE} + 1} \\right)","position":{"start":{"line":982,"column":1},"end":{"line":985,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>E</mi><mi>V</mi><mi>I</mi><mo>=</mo><mn>2.5</mn><mo>â‹…</mo><mrow><mo fence=\"true\">(</mo><mfrac><mrow><mtext>NIR</mtext><mo>âˆ’</mo><mtext>RED</mtext></mrow><mrow><mtext>NIR</mtext><mo>+</mo><mn>6</mn><mo>â‹…</mo><mtext>RED</mtext><mo>âˆ’</mo><mn>7.5</mn><mo>â‹…</mo><mtext>BLUE</mtext><mo>+</mo><mn>1</mn></mrow></mfrac><mo fence=\"true\">)</mo></mrow></mrow><annotation encoding=\"application/x-tex\">EVI = 2.5 \\cdot \\left( \\frac{\\text{NIR} - \\text{RED}}\n  {\\text{NIR} + 6 \\cdot \\text{RED} - 7.5 \\cdot \\text{BLUE} + 1} \\right)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2.5</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">â‹…</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.4em;vertical-align:-0.95em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">(</span></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3603em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord text\"><span class=\"mord\">NIR</span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\">6</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">â‹…</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord text\"><span class=\"mord\">RED</span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">âˆ’</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\">7.5</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">â‹…</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord text\"><span class=\"mord\">BLUE</span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\">1</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord text\"><span class=\"mord\">NIR</span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">âˆ’</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord text\"><span class=\"mord\">RED</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7693em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mclose delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">)</span></span></span></span></span></span></span>","enumerator":"2","key":"tyeysr47JH"}],"key":"qOgckcQHj1"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Calculate the EVI index for the two sites\nevi_nhm <- 2.5 * \n  (s2_nhm_10m[[\"NIR\"]] - s2_nhm_10m[[\"R\"]]) / \n  (s2_nhm_10m[[\"NIR\"]] + \n    6 * s2_nhm_10m[[\"R\"]] - \n    7.5 * s2_nhm_10m[[\"B\"]] + 1)\n  \nevi_silwood <- 2.5 * \n  (s2_silwood_10m[[\"NIR\"]] - s2_silwood_10m[[\"R\"]]) / \n  (s2_silwood_10m[[\"NIR\"]] + \n    6 * s2_silwood_10m[[\"R\"]] - \n    7.5 * s2_silwood_10m[[\"B\"]] + 1)\n\n# Rename the single band \nnames(evi_silwood) <- names(evi_nhm) <- \"EVI\"","key":"iUHMTKUwtw"},{"type":"output","id":"CHyF3gOrYk-qQ4XmFu8yH","data":[],"key":"fNsGWUIAPf"}],"key":"cCxqpZBBw0"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":1005,"column":1},"end":{"line":1009,"column":1}},"children":[{"type":"text","value":"There is an issue with the EVI data for the NHM site: there are some anomalous high\nvalues in the satellite data that lead to extreme EVI values. You can see these local\nissues as hotspots if you try plotting these bands (e.g. ","position":{"start":{"line":1005,"column":1},"end":{"line":1005,"column":1}},"key":"RpBOR6BrfM"},{"type":"inlineCode","value":"plot(s2_nhm_10m[[\"NIR\"]])","position":{"start":{"line":1005,"column":1},"end":{"line":1005,"column":1}},"key":"GeOejDDWvn"},{"type":"text","value":").\nWe can fix that problem by setting extreme values to ","position":{"start":{"line":1005,"column":1},"end":{"line":1005,"column":1}},"key":"JPIyzAA50F"},{"type":"inlineCode","value":"NA","position":{"start":{"line":1005,"column":1},"end":{"line":1005,"column":1}},"key":"gEUveaWA1l"},{"type":"text","value":" - this is another useful\nmethod for manipulating raster data.","position":{"start":{"line":1005,"column":1},"end":{"line":1005,"column":1}},"key":"bSEbv44krv"}],"key":"SxynJZdhUZ"}],"key":"elteUJ29Hl"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Remove anomalous EVI values\nevi_nhm[evi_nhm > 1] <- NA\nevi_nhm[evi_nhm < -1] <- NA","key":"eqZ6mq71m0"},{"type":"output","id":"fCS1zhDre2JBxbm6kkvvf","data":[],"key":"Q7or1pMUma"}],"key":"nhWAEBRDUD"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":1017,"column":1},"end":{"line":1017,"column":1}},"children":[{"type":"text","value":"Now we can plot the EVI maps.","position":{"start":{"line":1017,"column":1},"end":{"line":1017,"column":1}},"key":"ZNIqe5XvQV"}],"key":"HBShQKUlQb"}],"key":"QIgAlO4onZ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Plot the EVI index data\npar(mfrow=c(1, 2))\nplot(evi_silwood)\nplot(evi_nhm)","key":"MuhlIkfVZG"},{"type":"output","id":"6GAS0HwUMKif-a7mJzXQh","data":[],"key":"qAaRsec4SJ"}],"key":"KrJIjZ2fGI"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":1026,"column":1},"end":{"line":1026,"column":1}},"children":[{"type":"text","value":"Sampling from raster datasets","position":{"start":{"line":1026,"column":1},"end":{"line":1026,"column":1}},"key":"OzdNKrhhBT"}],"identifier":"sampling-from-raster-datasets","label":"Sampling from raster datasets","html_id":"sampling-from-raster-datasets","implicit":true,"key":"AEB6BXbV5x"},{"type":"paragraph","position":{"start":{"line":1028,"column":1},"end":{"line":1031,"column":1}},"children":[{"type":"text","value":"A common need in spatial analysis is to get raster values from locations: for example,\nwhat are the EVI values at the nest box locations, or what are the heights of the sensor\nlocation sites. We can do this using the ","position":{"start":{"line":1028,"column":1},"end":{"line":1028,"column":1}},"key":"lTllUKSSa5"},{"type":"inlineCode","value":"terra::extract","position":{"start":{"line":1028,"column":1},"end":{"line":1028,"column":1}},"key":"putotIuTW7"},{"type":"text","value":" function, which takes a raster\nand a vector dataset and returns the cell values under the vector features.","position":{"start":{"line":1028,"column":1},"end":{"line":1028,"column":1}},"key":"mgJFT9RJki"}],"key":"ufCbyuAhJd"},{"type":"heading","depth":3,"position":{"start":{"line":1033,"column":1},"end":{"line":1033,"column":1}},"children":[{"type":"text","value":"Point features","position":{"start":{"line":1033,"column":1},"end":{"line":1033,"column":1}},"key":"Ju3e4dTmjH"}],"identifier":"point-features","label":"Point features","html_id":"point-features","implicit":true,"key":"HfYo0PrHCf"},{"type":"paragraph","position":{"start":{"line":1035,"column":1},"end":{"line":1035,"column":1}},"children":[{"type":"text","value":"With point features this is very easy - you get the values under each point.","position":{"start":{"line":1035,"column":1},"end":{"line":1035,"column":1}},"key":"v7JfytCVPV"}],"key":"le0oZnBeQC"}],"key":"laQ135eFLH"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Extract the EVI values under the nest boxes\nnest_box_evi <- extract(evi_silwood, nest_boxes)\nhist(nest_box_evi$EVI)","key":"SJF9QNbS6S"},{"type":"output","id":"qW3FoFDeAqrg00ZA6ngJg","data":[],"key":"XUXThE4NKk"}],"key":"lI1aZbW8NE"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":1043,"column":1},"end":{"line":1046,"column":1}},"children":[{"type":"text","value":"It is a little more difficult for the sensors because the heights are in two different\ndatasets, so we need to use extract twice and then combine the results. The\n","position":{"start":{"line":1043,"column":1},"end":{"line":1043,"column":1}},"key":"LMQdxtjzkc"},{"type":"inlineCode","value":"terra::extract","position":{"start":{"line":1043,"column":1},"end":{"line":1043,"column":1}},"key":"M2RXYQwgkA"},{"type":"text","value":" function returns a row with NA if there is no data for a site, so we\ncan merge the data simply by joining the two datasets together and dropping the NA rows.","position":{"start":{"line":1043,"column":1},"end":{"line":1043,"column":1}},"key":"o2r6PLv9Fq"}],"key":"s2IT81Llvp"}],"key":"j5FVt4CDMd"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Extract the heights at the two sites\nsensor_elevations_silwood <- extract(silwood_dtm, sensor_locations)\nsensor_elevations_nhm <- extract(nhm_dtm, sensor_locations)\n\n# Combine the values from the two rasters and drop to the combined data\nsensor_elevations <- na.omit(rbind(sensor_elevations_silwood, sensor_elevations_nhm))\n\n# Show the data\nhead(sensor_elevations)","key":"kPH0wwRnL4"},{"type":"output","id":"fto8HcJGYYLUecNIk3PME","data":[],"key":"XsR9jcS8zA"}],"key":"R2taTtzNfo"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":1060,"column":1},"end":{"line":1060,"column":1}},"children":[{"type":"text","value":"Line features","position":{"start":{"line":1060,"column":1},"end":{"line":1060,"column":1}},"key":"GKZvg8dGnb"}],"identifier":"line-features","label":"Line features","html_id":"line-features","implicit":true,"key":"lNtB4u6ssG"},{"type":"paragraph","position":{"start":{"line":1062,"column":1},"end":{"line":1065,"column":1}},"children":[{"type":"text","value":"You might also want to know what the values under a line feature are: either because you\nwant a distribution of those values, or possible because you want a sequence of values\n","position":{"start":{"line":1062,"column":1},"end":{"line":1062,"column":1}},"key":"rr6vNTvm8u"},{"type":"emphasis","position":{"start":{"line":1062,"column":1},"end":{"line":1062,"column":1}},"children":[{"type":"text","value":"along","position":{"start":{"line":1062,"column":1},"end":{"line":1062,"column":1}},"key":"UjEUdVvqR9"}],"key":"EtYvxERAXV"},{"type":"text","value":" the feature. These two things are different - weâ€™ll look at them using the\nSilmas walk/run route.","position":{"start":{"line":1062,"column":1},"end":{"line":1062,"column":1}},"key":"im8zZ2CZFh"}],"key":"DsKumUTWsF"},{"type":"paragraph","position":{"start":{"line":1067,"column":1},"end":{"line":1070,"column":1}},"children":[{"type":"text","value":"If we just use extract with the line features, then ","position":{"start":{"line":1067,"column":1},"end":{"line":1067,"column":1}},"key":"tlwpdhGXB9"},{"type":"inlineCode","value":"terra::extract","position":{"start":{"line":1067,"column":1},"end":{"line":1067,"column":1}},"key":"CL0InQmKMu"},{"type":"text","value":" returns the values\nof all of the cells that the line touches. The values are not in sequence along the line\nfeature - they are just all the values it touches. We can see the cells that are being\nselected by ","position":{"start":{"line":1067,"column":1},"end":{"line":1067,"column":1}},"key":"tPaPJptMw4"},{"type":"strong","position":{"start":{"line":1067,"column":1},"end":{"line":1067,"column":1}},"children":[{"type":"text","value":"rasterising","position":{"start":{"line":1067,"column":1},"end":{"line":1067,"column":1}},"key":"i38KA7xsuP"}],"key":"bU13X7glDI"},{"type":"text","value":" the route.","position":{"start":{"line":1067,"column":1},"end":{"line":1067,"column":1}},"key":"NDAFbWlNnE"}],"key":"BfoDemnTUL"}],"key":"ogztJoaNeA"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Extract the heights under the Silmas route\nsilmas_heights <- extract(silwood_dtm, silmas_route, xy=TRUE)\n\npar(mfrow=c(1,2))\n# Convert the Silmas route into a raster to show the sampled cells\nsilmas_route_raster <- rasterize(silmas_route, silwood_dtm)\n# Show the height distribution.\nhist(silmas_heights$Elevation)","key":"NvOEuxK8WX"},{"type":"output","id":"BG22QdYs7MsIXtbbKrV5A","data":[],"key":"I8y4neTgQ3"}],"key":"T1swyLbbv7"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":1083,"column":1},"end":{"line":1088,"column":1}},"children":[{"type":"text","value":"If you want to get a ","position":{"start":{"line":1083,"column":1},"end":{"line":1083,"column":1}},"key":"UM6PySvFFP"},{"type":"emphasis","position":{"start":{"line":1083,"column":1},"end":{"line":1083,"column":1}},"children":[{"type":"text","value":"sequence of values along a linear feature","position":{"start":{"line":1083,"column":1},"end":{"line":1083,"column":1}},"key":"K5ZflB9plH"}],"key":"avIOHzJX9y"},{"type":"text","value":" then you need to\nextract the values in order. To do this, you need to convert the linear feature to\npoints by ","position":{"start":{"line":1083,"column":1},"end":{"line":1083,"column":1}},"key":"RcK6KpByej"},{"type":"strong","position":{"start":{"line":1083,"column":1},"end":{"line":1083,"column":1}},"children":[{"type":"text","value":"casting","position":{"start":{"line":1083,"column":1},"end":{"line":1083,"column":1}},"key":"QcNMJSjZ8K"}],"key":"n8iIqRfz2d"},{"type":"text","value":" it to the simpler feature type. This gives us a warning that\nbasically just says that it is assigning the attributes for the whole linear feature to\neach and every point, and that might not be sensible. If the points are very spaced out,\nyou can use ","position":{"start":{"line":1083,"column":1},"end":{"line":1083,"column":1}},"key":"GEjeEhXOZN"},{"type":"inlineCode","value":"sf::st_segmentize","position":{"start":{"line":1083,"column":1},"end":{"line":1083,"column":1}},"key":"QZ5xTMrEQh"},{"type":"text","value":" to interpolate more points along the feature.","position":{"start":{"line":1083,"column":1},"end":{"line":1083,"column":1}},"key":"X0NbF7m0YC"}],"key":"VKmgQIm5en"}],"key":"iBxvHS0BpV"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"silmas_points <- st_cast(silmas_route, \"POINT\")","key":"cgCaZoamPY"},{"type":"output","id":"mAxegQU0-sPHGeP6BkT0k","data":[],"key":"fsJyQVRuxY"}],"key":"hfeoD8RWw0"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":1094,"column":1},"end":{"line":1096,"column":1}},"children":[{"type":"text","value":"We can now use ","position":{"start":{"line":1094,"column":1},"end":{"line":1094,"column":1}},"key":"OErBAwhYJR"},{"type":"inlineCode","value":"terra::extract","position":{"start":{"line":1094,"column":1},"end":{"line":1094,"column":1}},"key":"zAX0bnLrYF"},{"type":"text","value":" on the points to get the heights in sequence. We can\nalso use Pythagorasâ€™ theorem to get the cumulative distance along the route from the\ncoordinates.","position":{"start":{"line":1094,"column":1},"end":{"line":1094,"column":1}},"key":"XF0loNKpa4"}],"key":"OaoTjFSve4"}],"key":"k533HPB2wD"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Get the height of each GPS point along the route\nsilmas_heights <- extract(silwood_dtm, silmas_points)\n\n# Get the coordinates of the points and use Pythagoras to ge the distance.\ncoords <- as.data.frame(st_coordinates(silmas_points))\ncoords$distance <- c(0, sqrt(diff(coords$X)**2 + diff(coords$Y)**2))\ncoords$total_distance <- cumsum(coords$distance)\ncoords$height <-silmas_heights$Elevation\n\n# Plot the height profile of the Silmas walk\nplot(height~ total_distance, data=coords, type=\"l\")","key":"kMDNFWrY3F"},{"type":"output","id":"6VoJuzbF58cI2zPawxaSi","data":[],"key":"RgnA7ZhuDX"}],"key":"Pt6HqqVhr8"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":1112,"column":1},"end":{"line":1112,"column":1}},"children":[{"type":"text","value":"Polygon features","position":{"start":{"line":1112,"column":1},"end":{"line":1112,"column":1}},"key":"i7S6ejdZaT"}],"identifier":"polygon-features","label":"Polygon features","html_id":"polygon-features","implicit":true,"key":"u5J6GHiu41"},{"type":"paragraph","position":{"start":{"line":1114,"column":1},"end":{"line":1118,"column":1}},"children":[{"type":"text","value":"It is extremely common to want to get a distribution or summary statistic of raster\nvalues within a polygon feature: for example, what is the average elevation within 50\nmetres of each of the sensor locations? The first thing to do is to get polygons that\nform a 50m radius circle around each sensor locations using the ","position":{"start":{"line":1114,"column":1},"end":{"line":1114,"column":1}},"key":"Wosa3wQSHW"},{"type":"inlineCode","value":"sf::st_buffer","position":{"start":{"line":1114,"column":1},"end":{"line":1114,"column":1}},"key":"UXHaYwodew"},{"type":"text","value":"\nfunction.","position":{"start":{"line":1114,"column":1},"end":{"line":1114,"column":1}},"key":"kGCfMYNjPs"}],"key":"H2jOgJENK8"}],"key":"unee3pM6ng"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Get 50m radius polygons around the sensor points\nsensor_locations_50 <- st_buffer(sensor_locations, 50)","key":"rbyF9Ikglf"},{"type":"output","id":"JQemV841Lmb2MEKqXfLIV","data":[],"key":"mdzTugcCR9"}],"key":"gAJ9WSONN4"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":1125,"column":1},"end":{"line":1129,"column":1}},"children":[{"type":"text","value":"You can use ","position":{"start":{"line":1125,"column":1},"end":{"line":1125,"column":1}},"key":"k8EgUAkmOi"},{"type":"inlineCode","value":"sf::st_buffer","position":{"start":{"line":1125,"column":1},"end":{"line":1125,"column":1}},"key":"jLF64DkvRF"},{"type":"text","value":" with any features to get polygons extending out from the\nfeature, and you can in fact use negative distances to get polygons ","position":{"start":{"line":1125,"column":1},"end":{"line":1125,"column":1}},"key":"TZkLhN5WGn"},{"type":"emphasis","position":{"start":{"line":1125,"column":1},"end":{"line":1125,"column":1}},"children":[{"type":"text","value":"within","position":{"start":{"line":1125,"column":1},"end":{"line":1125,"column":1}},"key":"j4P6WBGFEy"}],"key":"OkIqk9ho91"},{"type":"text","value":" existing\npolygons. We can then use the polygon features with ","position":{"start":{"line":1125,"column":1},"end":{"line":1125,"column":1}},"key":"U4GsQjVr8Y"},{"type":"inlineCode","value":"terra::extract","position":{"start":{"line":1125,"column":1},"end":{"line":1125,"column":1}},"key":"db9DV9Smfb"},{"type":"text","value":" to get a data frame\nof the values from the digital elevation map associated with each sensor location. We\nagain need to join the results from the two sites together and drop any NA rows.","position":{"start":{"line":1125,"column":1},"end":{"line":1125,"column":1}},"key":"GXthuTHQoH"}],"key":"eOaMGAHF0f"}],"key":"hE5AOhfX3y"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Get the values within the 50m buffer for each sensor location, \nsilwood_sensor_heights <- extract(silwood_dtm, sensor_locations_50)\nnhm_sensor_heights <- extract(nhm_dtm, sensor_locations_50)\nsensor_heights <- na.omit(rbind(silwood_sensor_heights, nhm_sensor_heights))\n\n# How many values per site?\ntable(sensor_heights$ID)\n\n# Height variation between sensors\nboxplot(Elevation ~ ID, data= sensor_heights)","key":"qEaT6juoIb"},{"type":"output","id":"5hA25uUKAFjbcUVoOYPvy","data":[],"key":"Jc7hfBJPmJ"}],"key":"iMXwKGsuhP"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":1144,"column":1},"end":{"line":1144,"column":1}},"children":[{"type":"text","value":"We can also extract data from categorical rasters:","position":{"start":{"line":1144,"column":1},"end":{"line":1144,"column":1}},"key":"gywHcF1125"}],"key":"CANnbXN8Lh"}],"key":"UoDZc5p251"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Get the values within the 50m buffer for each sensor location, \nsilwood_sensor_LCM <- extract(silwood_LCM, sensor_locations_50)\nnhm_sensor_LCM <- extract(nhm_LCM, sensor_locations_50)\nsensor_LCM <- na.omit(rbind(silwood_sensor_LCM, nhm_sensor_LCM))\n\n# Land cover class counts within 50m of each sensor.\nxtabs(~ LandCover + ID, data= sensor_LCM, drop.unused.levels=TRUE)","key":"dwgjjMacGE"},{"type":"output","id":"09MIbqJid0Ws1HaxPhQHI","data":[],"key":"npti6oGgeH"}],"key":"EtAV6jhUuu"},{"type":"block","children":[{"type":"admonition","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Side note","position":{"start":{"line":1156,"column":1},"end":{"line":1156,"column":1}},"key":"gwT1G3H9S7"}],"key":"sUg0fkoZhg"},{"type":"paragraph","position":{"start":{"line":1158,"column":1},"end":{"line":1162,"column":1}},"children":[{"type":"text","value":"As a sidenote, the standard way this works is to use the ","position":{"start":{"line":1158,"column":1},"end":{"line":1158,"column":1}},"key":"zPACqPJa2v"},{"type":"inlineCode","value":"terra::rasterize","position":{"start":{"line":1158,"column":1},"end":{"line":1158,"column":1}},"key":"kJq3Jkl73f"},{"type":"text","value":" function to\nfind all of the raster cells where the cell centre falls within a polygon feature, but\nyou can optionally choose to also include any cells that the cell boundary touches,\nusing the ","position":{"start":{"line":1158,"column":1},"end":{"line":1158,"column":1}},"key":"HuYC4yQx4d"},{"type":"inlineCode","value":"touches=TRUE","position":{"start":{"line":1158,"column":1},"end":{"line":1158,"column":1}},"key":"qwzyhzRgRj"},{"type":"text","value":" setting. The plot below shows the two alternatives for a single\nsensor polygon:","position":{"start":{"line":1158,"column":1},"end":{"line":1158,"column":1}},"key":"ZzMzwNWIzb"}],"key":"Pe8uma5krK"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Create an extent around a single sensor\nzoom_to_site_one <- ext(c(493835,  493955, 169200, 169330))\n\n# Rasterize using the two methods\ncell_touches_false <- rasterize(sensor_locations_50[1,], silwood_dtm)\ncell_touches_true <- rasterize(sensor_locations_50[1,], silwood_dtm, touches=TRUE)\n\n# Plot side by side as DTM overplotted with rasterized polygon and polygon border\npar(mfrow=c(1,2))\n\nplot(\n  silwood_dtm, ext=zoom_to_site_one, legend=FALSE, \n  col=gray.colors(20), main=\"touches=FALSE\"\n)\nplot(cell_touches_false, add=TRUE, legend=FALSE, col=\"firebrick\")\nplot(st_geometry(sensor_locations_50[1,]), col=NA, add=TRUE)\n\nplot(\n  silwood_dtm, ext=zoom_to_site_one, legend=FALSE, \n  col=gray.colors(20), main=\"touches=TRUE\"\n)\nplot(cell_touches_true, add=TRUE, legend=FALSE, col=\"firebrick\")\nplot(st_geometry(sensor_locations_50[1,]), col=NA, add=TRUE)","visibility":"hide","key":"ZlIiE1l2R6"},{"type":"output","id":"7Id4MkksDf15-pKa9ejuQ","data":[],"visibility":"show","key":"do31w6jU6X"}],"data":{"tags":[]},"visibility":"show","key":"BX6UgJ1UB9"}],"key":"BFhFty9j4x"},{"type":"heading","depth":3,"position":{"start":{"line":1194,"column":1},"end":{"line":1194,"column":1}},"children":[{"type":"text","value":"Zonal statistics","position":{"start":{"line":1194,"column":1},"end":{"line":1194,"column":1}},"key":"P6HV2nm4tc"}],"identifier":"zonal-statistics","label":"Zonal statistics","html_id":"zonal-statistics","implicit":true,"key":"QK8KL7mTxw"},{"type":"paragraph","position":{"start":{"line":1196,"column":1},"end":{"line":1200,"column":1}},"children":[{"type":"text","value":"You can also sample from a raster dataset using another raster dataset. In practice,\nthis is what is happening when you extract data from a vector feature - the different\nfeatures get converted into raster layers in order to identify which cells to extract.\nBut if you already have a categorical raster, you can simply use the ","position":{"start":{"line":1196,"column":1},"end":{"line":1196,"column":1}},"key":"cf9d0PwXgI"},{"type":"inlineCode","value":"terra::zonal","position":{"start":{"line":1196,"column":1},"end":{"line":1196,"column":1}},"key":"a6zJOerZ75"},{"type":"text","value":"\nfunction to extract the values under each raster cateogory.","position":{"start":{"line":1196,"column":1},"end":{"line":1196,"column":1}},"key":"I9ZoEa6vcY"}],"key":"rPwY6gwOkj"}],"key":"nAAv1yhPmG"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Extract the EVI values for each LCM raster cell\nevi_by_LCM <- zonal(evi_silwood, silwood_LCM, wide=FALSE)\nhead(evi_by_LCM)","key":"CRXIW5hrrn"},{"type":"output","id":"Vdcl17ANWVb1qd7Z1rB-7","data":[],"key":"ZbmcaoZyyH"}],"key":"I0z4O11QyC"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":1208,"column":1},"end":{"line":1208,"column":1}},"children":[{"type":"text","value":"We can then visualise the range of EVI values by land cover class:","position":{"start":{"line":1208,"column":1},"end":{"line":1208,"column":1}},"key":"Mav8bWszCn"}],"key":"Vt9ewBZLfB"}],"key":"yCN6YDUR7g"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"par(mar = c(4,12,1,1))\nplot(EVI ~ as.factor(LandCover), data=evi_by_LCM, horizontal=TRUE, las=1, xlab=\"\")","key":"Lp4xOyojBF"},{"type":"output","id":"FeJtmmZfep1kzJeVXk3Ce","data":[],"key":"UKgaJJZ8SS"}],"key":"Bd59DIYg2B"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":1215,"column":1},"end":{"line":1215,"column":1}},"children":[{"type":"text","value":"Image classification","position":{"start":{"line":1215,"column":1},"end":{"line":1215,"column":1}},"key":"RruhZMa0ut"}],"identifier":"image-classification","label":"Image classification","html_id":"image-classification","implicit":true,"key":"I7kzX8FPgc"},{"type":"paragraph","position":{"start":{"line":1217,"column":1},"end":{"line":1223,"column":1}},"children":[{"type":"text","value":"We already have the CEH Land Cover map, but we may be able to get a better local model\nof land cover by classifying the Sentinel 2 data. Image classification is the process of\ntaking spectral data from an image and identifying particular spectral signatures\n(combinations of values in the different bands) with a land cover category. You ","position":{"start":{"line":1217,"column":1},"end":{"line":1217,"column":1}},"key":"ZQhxNOSG6X"},{"type":"emphasis","position":{"start":{"line":1217,"column":1},"end":{"line":1217,"column":1}},"children":[{"type":"text","value":"can","position":{"start":{"line":1217,"column":1},"end":{"line":1217,"column":1}},"key":"eSeMK6uZUR"}],"key":"xFADYS78jz"},{"type":"text","value":"\nclassify simple RGB images, but it is often better to use data with more spectral bands:\nas we saw with the false colour infrared image, some bands are great at picking out\nparticular features.","position":{"start":{"line":1217,"column":1},"end":{"line":1217,"column":1}},"key":"V9TslVIiLo"}],"key":"DgU0NRkKCs"},{"type":"heading","depth":3,"position":{"start":{"line":1225,"column":1},"end":{"line":1225,"column":1}},"children":[{"type":"text","value":"Unsupervised classification","position":{"start":{"line":1225,"column":1},"end":{"line":1225,"column":1}},"key":"cLNWejAwuN"}],"identifier":"unsupervised-classification","label":"Unsupervised classification","html_id":"unsupervised-classification","implicit":true,"key":"RxhUozeVu9"},{"type":"paragraph","position":{"start":{"line":1227,"column":1},"end":{"line":1229,"column":1}},"children":[{"type":"text","value":"Unsupervised classification tries to extract clusters of spectral signatures from the\ndata. There are many approaches, but the basic aim of the algorithms is to try and find\nsets of points in the image that have similar spectral signatures.","position":{"start":{"line":1227,"column":1},"end":{"line":1227,"column":1}},"key":"FHpAmp1EmK"}],"key":"IHjMxi0UgA"},{"type":"paragraph","position":{"start":{"line":1231,"column":1},"end":{"line":1235,"column":1}},"children":[{"type":"text","value":"Here we will use the base R ","position":{"start":{"line":1231,"column":1},"end":{"line":1231,"column":1}},"key":"Mz53jT7Wue"},{"type":"inlineCode","value":"stats::kmeans","position":{"start":{"line":1231,"column":1},"end":{"line":1231,"column":1}},"key":"Urjm56Tpbc"},{"type":"text","value":" function to carry out k-means clustering on\nthe data. The ","position":{"start":{"line":1231,"column":1},"end":{"line":1231,"column":1}},"key":"Ds6wSO0URD"},{"type":"inlineCode","value":"k","position":{"start":{"line":1231,"column":1},"end":{"line":1231,"column":1}},"key":"ckSKdar2Id"},{"type":"text","value":" of the k-means is the number of clusters we want to identify, and here\nwe are letting the algorithm pick 10 random starting points from with the image spectra\nand then iterating to try and find stable sets of clusters. It then repeats that process\nwith different starting choices and returns a classification across all of the runs.","position":{"start":{"line":1231,"column":1},"end":{"line":1231,"column":1}},"key":"FIYXdiPYj8"}],"key":"tjBrLNBOVz"}],"key":"Zm1ICnQ3G9"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# We need to convert the raster data into a data frame giving the \n# spectral signature of each cell\nvalues <- as.data.frame(s2_silwood_10m)\nhead(values)","key":"VQWsHbOOi3"},{"type":"output","id":"TeyXPThm4nYBNKtCtcIyu","data":[],"key":"qsxm59iGhX"}],"key":"CoLrNbxjwX"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Now we can run the clustering\nn_cats <- 6\ns2_kmeans <- kmeans(\n  values, centers=n_cats, iter.max = 500, nstart = 5, algorithm=\"Lloyd\"\n)\n\n# We can now take the cluster attribute from the output and put those values\n# back into a 10m resolution raster\ns2_kmeans_map <- rast(s2_silwood_10m, nlyr=1)\nvalues(s2_kmeans_map) <- s2_kmeans$cluster","key":"DyL7ugIaFE"},{"type":"output","id":"-0Io27WjagSY52AuLQOpA","data":[],"key":"S1ycwDjNzD"}],"key":"Ix1vboamzX"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":1257,"column":1},"end":{"line":1258,"column":1}},"children":[{"type":"text","value":"Now that we have the map, we can add labels and category names, as we did above for the\nCEH dataset.","position":{"start":{"line":1257,"column":1},"end":{"line":1257,"column":1}},"key":"H2iI9vT3VR"}],"key":"VtAt2KWB2h"}],"key":"SFDCxdv2k6"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"labels <- data.frame(ID=1:n_cats, category=paste0(\"Category_\", 1:n_cats))\n#colours <- data.frame(ID=1:n_cats, colours=hcl.colors(n_cats, \"Dark 2\"))\n\ncolours <- data.frame(ID=1:n_cats, colours=carto_pal(n_cats, \"Safe\"))\n\nlevels(s2_kmeans_map) <- labels\ncoltab(s2_kmeans_map) <- colours\n\nplot(s2_kmeans_map)","key":"qDmg0f4sf8"},{"type":"output","id":"lrM2fPBo5cyM12VrKF9R_","data":[],"key":"OwxGy7H2tx"}],"key":"eovIyQuw9E"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":1274,"column":1},"end":{"line":1274,"column":1}},"children":[{"type":"text","value":"Supervised classification","position":{"start":{"line":1274,"column":1},"end":{"line":1274,"column":1}},"key":"FMapyLb6Vb"}],"identifier":"supervised-classification","label":"Supervised classification","html_id":"supervised-classification","implicit":true,"key":"Y3JU6psj1o"},{"type":"paragraph","position":{"start":{"line":1276,"column":1},"end":{"line":1279,"column":1}},"children":[{"type":"text","value":"The classes from an unsupervised classification are a purely statistical construction:\nthey often do identify meaningful land cover types, but they need to be interpreted and\nit is common to re-run the process with different numbers of classes, or to merge\nclasses that identify very similar regions.","position":{"start":{"line":1276,"column":1},"end":{"line":1276,"column":1}},"key":"e2M0Nmp3e7"}],"key":"RZPduqVpWJ"},{"type":"paragraph","position":{"start":{"line":1281,"column":1},"end":{"line":1286,"column":1}},"children":[{"type":"text","value":"The alternative of supervised classification avoids that by starting with a training\ndataset of sites with known categories. The spectral signatures of those sites can then\nbe used to assign other sites to classes based on their similarity to the training data.\nThis does mean that you need to put together a training dataset: this can be done by\nphysically exploring the location with a GPS and assigning classes (â€œground truthingâ€)\nor by selecting points from the imagery that belong to known classes.","position":{"start":{"line":1281,"column":1},"end":{"line":1281,"column":1}},"key":"trkr7Y8TpL"}],"key":"EfPjNM7RBO"},{"type":"paragraph","position":{"start":{"line":1288,"column":1},"end":{"line":1291,"column":1}},"children":[{"type":"text","value":"Here we use a training set drawn from inspecting the imagery, saved as a set of X and Y\npoint coordinates and the land cover category at that point. Note that there are\nmultiple sites for each class, giving a distribution of signatures associated with each\nclass.","position":{"start":{"line":1288,"column":1},"end":{"line":1288,"column":1}},"key":"YTN2QH9WAC"}],"key":"DDBxDth1zM"}],"key":"HNAlTA7Psp"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Load the classification data and convert it to an SF point dataset\ntraining_sites <- read.csv(\"data/S2_classification_data.csv\")\ntraining_sites <- st_as_sf(training_sites, coords=c(\"x\",\"y\"), crs=\"EPSG:27700\")\n\n# Plot the data over the top of an aerial image. This is a bit of a hack\n# as it plots the vector data first to get the legend, then plots the aerial\n#Â photo over the top and then the training sites _again_.\nplot(training_sites, reset=FALSE)\nplotRGB(silwood_aerial, add=TRUE)\nplot(training_sites, add=TRUE)\n\n# Show a table of the number of training sites for each category.\ntable(training_sites$category)","key":"okfBzT5S5e"},{"type":"output","id":"25ftFqt2xVcbhxbFbiTC3","data":[],"key":"yeJtRSA7Dq"}],"key":"xTWhuEMm0v"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":1309,"column":1},"end":{"line":1310,"column":1}},"children":[{"type":"text","value":"We can then extract the spectral signatures at each of those sites to give a spectral\ntraining dataset to use in classification.","position":{"start":{"line":1309,"column":1},"end":{"line":1309,"column":1}},"key":"UDem7kqfD8"}],"key":"VuUd4WhjcG"}],"key":"EI7OXAeXrK"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Extract a data frame of band values at each training site and add the\n# category field to the dataset.\ntraining_spectra <- extract(s2_silwood_10m, training_sites, ID=FALSE)\ntraining_spectra$category <- training_sites$category","key":"t8MhbhmuG3"},{"type":"output","id":"FN1E1-cH3cRwTqtclKKfD","data":[],"key":"QJP0sB9N0t"}],"key":"WYnKEV1Dlq"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":1319,"column":1},"end":{"line":1322,"column":1}},"children":[{"type":"text","value":"We will use a regression tree model using the ","position":{"start":{"line":1319,"column":1},"end":{"line":1319,"column":1}},"key":"vLmydzXBaW"},{"type":"inlineCode","value":"rpart::rpart","position":{"start":{"line":1319,"column":1},"end":{"line":1319,"column":1}},"key":"nLac2OSj91"},{"type":"text","value":" function to assign spectral\nsignatures to classes. A regression tree finds critical values in the different bands\nthat separate different classes and provides a simple decision tree based on the\ntraining data that can then be used to classify the whole image.","position":{"start":{"line":1319,"column":1},"end":{"line":1319,"column":1}},"key":"oDDCojUMdz"}],"key":"lrgKbtXgW4"}],"key":"hbcRVASBZX"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Fit a regression tree of the land cover category as a function of the bands\ns2_class_model <- rpart(\n  category ~  B + G + R + NIR + RE5 + RE6 + RE7 + NNIR + SWIR1 + SWIR2,\n  data = training_spectra, method = 'class', minsplit = 5\n)\n\n# Show the regression tree.\nprint(s2_class_model)","key":"ZvuRtWhPbv"},{"type":"output","id":"wGG01acc6_wSJUPu1eRjA","data":[],"key":"sVSxN86Syw"}],"key":"UUjnKYR0DO"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":1335,"column":1},"end":{"line":1337,"column":1}},"children":[{"type":"text","value":"The model can then be used to predict values for all of the pixels. The resulting\nraster has one layer for each land cover type that gives the probability that the pixel\nis in that class.","position":{"start":{"line":1335,"column":1},"end":{"line":1335,"column":1}},"key":"cyeKbNO40O"}],"key":"Xodix0m0GU"}],"key":"M39DSv1ACP"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Generate the predictions for the whole map\ns2_class_probability <- predict(s2_silwood_10m, s2_class_model)\n\n# Plot 3 of the probability layers\nplot(s2_class_probability[[1:3]], nc=3)","key":"yWibpsl9v5"},{"type":"output","id":"o5Hc0QHzy2AfcxK9LJXHP","data":[],"key":"StW9ea4NiL"}],"key":"p8L6XeprRy"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":1347,"column":1},"end":{"line":1348,"column":1}},"children":[{"type":"text","value":"We can convert it into a land cover map by assigning each pixel to the class where it\nhas the highest probability.","position":{"start":{"line":1347,"column":1},"end":{"line":1347,"column":1}},"key":"gzCF2dR7qF"}],"key":"xIljrSLiOB"}],"key":"p7zF7QGJPh"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Find the layer with the highest probability. The index of that code gives the \n# associated land  cover type\ns2_class_map <- which.max(s2_class_probability)\n\n# Assign level labels to the index codes.\nlevels(s2_class_map) <- data.frame(id=1:7, class=names(s2_class_probability))\nplot(lulc, col=carto_pal(7, \"Safe\"))","key":"qqcFyXTLYl"},{"type":"output","id":"9GYKWcjbPVg8UGyCejzKx","data":[],"key":"J8lUcUHYUf"}],"key":"GnynCzaiRY"},{"type":"block","children":[{"type":"code","lang":"r","value":"pick_training_sites <- function(category, df = NULL) {\n    #' Function to add training data locations by clicking on a displayed map.\n    #' \n    #' The function returns a data frame with the X and Y coordinates of the clicked\n    #' points and a category field giving the `category` label for with the points.\n    #' Press 'Escape' to finish collecting points and return a dataframe of coordinates.\n    #' The returned dataframe for one category can be passed back into the `df`\n    #' argument to append sites for a new category to the existing data. \n\n    # Pick the points from a plotted GIS map\n    xy <- draw(\"points\", pch=4)\n    # Convert the selected coordinates to a dataframe and add the category label\n    new_data <- as.data.frame(crds(xy))\n    new_data$category <- category\n\n    # Return the new_data appended to any existing data\n    return(rbind(df, new_data))\n}\n\n# Plot the image\nplotRGB(silwood_serial)\n\n# Build up the training set by clicking on the image and then pressing\n# escape to move onto the next category\ndf <- pick_training_sites(\"Urban\")\ndf <- pick_training_sites(\"Grassland\", df=df)\ndf <- pick_training_sites(\"Water\", df=df)\ndf <- pick_training_sites(\"Silwood Lake\", df=df)\ndf <- pick_training_sites(\"Bare Ground\", df=df)\ndf <- pick_training_sites(\"Woodland\", df=df)\ndf <- pick_training_sites(\"Road\", df=df)\n\n# Export the data\nwrite.csv(df, \"data/S2_classification_data.csv\", row.names=FALSE)","key":"zueGlHaWJF"}],"key":"iunoBxN5cW"}],"key":"DMSdpfmHEC"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Required packages and data","url":"/required-packages","group":"GIS and Spatial Methods in R"}}},"domain":"http://localhost:3000"}