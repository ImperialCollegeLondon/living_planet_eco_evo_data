<!DOCTYPE html><html lang="en" class="" style="scroll-padding:60px"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Spatial methods in Ecological and Evolutionary Data Science - Ecological and Evolutionary Data Science</title><meta property="og:title" content="Spatial methods in Ecological and Evolutionary Data Science - Ecological and Evolutionary Data Science"/><meta name="generator" content="mystmd"/><meta name="keywords" content=""/><link rel="stylesheet" href="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/_assets/app-KKSZXL3E.css"/><link rel="stylesheet" href="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/_assets/thebe-core-VKVHG5VY.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jupyter-matplotlib@0.11.3/css/mpl_widget.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous"/><link rel="icon" href="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/favicon.ico"/><link rel="stylesheet" href="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/myst-theme.css"/><script>
  const savedTheme = localStorage.getItem("myst:theme");
  const theme = window.matchMedia("(prefers-color-scheme: light)").matches ? 'light' : 'dark';
  const classes = document.documentElement.classList;
  const hasAnyTheme = classes.contains('light') || classes.contains('dark');
  if (!hasAnyTheme) classes.add(savedTheme ?? theme);
</script></head><body class="m-0 transition-colors duration-500 bg-white dark:bg-stone-900"><div class="myst-skip-to-article fixed top-1 left-1 h-[0px] w-[0px] focus-within:z-40 focus-within:h-auto focus-within:w-auto bg-white overflow-hidden focus-within:p-2 focus-within:ring-1" aria-label="skip to content options"><a href="#skip-to-frontmatter" class="myst-skip-to-link block px-2 py-1 text-black underline">Skip to article frontmatter</a><a href="#skip-to-article" class="myst-skip-to-link block px-2 py-1 text-black underline">Skip to article content</a></div><dialog id="myst-no-css" style="position:fixed;left:0px;top:0px;width:100vw;height:100vh;font-size:4rem;padding:1rem;color:black;background:white"><strong>Site not loading correctly?</strong><p>This may be due to an incorrect <code>BASE_URL</code> configuration. See<!-- --> <a href="https://mystmd.org/guide/deployment#deploy-base-url">the MyST Documentation</a> <!-- -->for reference.</p><script>
    (() => {
            // Test for has-styling variable set by the MyST stylesheet
            const node = document.currentScript.parentNode;
            const hasCSS = window.getComputedStyle(node).getPropertyValue("--has-styling");
            if (hasCSS === ""){
                    node.showModal();
            }

    })()
</script></dialog><div class="myst-top-nav bg-white/80 backdrop-blur dark:bg-stone-900/80 shadow dark:shadow-stone-700 p-3 md:px-8 sticky w-screen top-0 z-30 h-[60px]"><nav class="myst-top-nav-bar flex items-center justify-between flex-nowrap max-w-[1440px] mx-auto"><div class="flex flex-row xl:min-w-[19.5rem] mr-2 sm:mr-7 justify-start items-center shrink-0"><div class="block xl:hidden"><button class="myst-top-nav-menu-button flex items-center border-stone-400 text-stone-800 hover:text-stone-900 dark:text-stone-200 hover:dark:text-stone-100"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="m-1"><path fill-rule="evenodd" d="M3 6.75A.75.75 0 0 1 3.75 6h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 6.75ZM3 12a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 12Zm0 5.25a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75a.75.75 0 0 1-.75-.75Z" clip-rule="evenodd"></path></svg><span class="sr-only">Open Menu</span></button></div><a class="myst-home-link flex items-center ml-3 dark:text-white w-fit md:ml-5 xl:ml-7" href="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/"><span class="text-md sm:text-xl tracking-tight sm:mr-5">Made with MyST</span></a></div><div class="flex items-center flex-grow w-auto"><div class="flex-grow hidden text-md lg:block"></div><div class="flex-grow block"></div><button type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R75cp:" data-state="closed" class="myst-search-bar flex items-center h-10 aspect-square sm:w-64 text-left text-gray-600 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 myst-search-bar-disabled hover:ring-blue-500 dark:hover:ring-blue-500 hover:border-blue-500 dark:hover:border-blue-500"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="p-2.5 h-10 w-10 aspect-square"><path fill-rule="evenodd" d="M10.5 3.75a6.75 6.75 0 1 0 0 13.5 6.75 6.75 0 0 0 0-13.5ZM2.25 10.5a8.25 8.25 0 1 1 14.59 5.28l4.69 4.69a.75.75 0 1 1-1.06 1.06l-4.69-4.69A8.25 8.25 0 0 1 2.25 10.5Z" clip-rule="evenodd"></path></svg><span class="myst-search-text-placeholder hidden sm:block grow">Search</span><div aria-hidden="true" class="myst-search-shortcut items-center hidden mx-1 font-mono text-sm text-gray-600 sm:flex gap-x-1"><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none hide-mac">CTRL</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none show-mac">⌘</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none ">K</kbd><script>
;(() => {
const script = document.currentScript;
const root = script.parentElement;

const isMac = /mac/i.test(
      window.navigator.userAgentData?.platform ?? window.navigator.userAgent,
    );
root.querySelectorAll(".hide-mac").forEach(node => {node.classList.add(isMac ? "hidden" : "block")});
root.querySelectorAll(".show-mac").forEach(node => {node.classList.add(!isMac ? "hidden" : "block")});
})()</script></div></button><button class="myst-theme-button theme rounded-full aspect-square border border-stone-700 dark:border-white hover:bg-neutral-100 border-solid overflow-hidden text-stone-700 dark:text-white hover:text-stone-500 dark:hover:text-neutral-800 w-8 h-8 mx-3" title="Toggle theme between light and dark mode" aria-label="Toggle theme between light and dark mode"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="myst-theme-moon-icon h-full w-full p-0.5 hidden dark:block"><path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 0 1 .162.819A8.97 8.97 0 0 0 9 6a9 9 0 0 0 9 9 8.97 8.97 0 0 0 3.463-.69.75.75 0 0 1 .981.98 10.503 10.503 0 0 1-9.694 6.46c-5.799 0-10.5-4.7-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 0 1 .818.162Z" clip-rule="evenodd"></path></svg><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="myst-theme-sun-icon h-full w-full p-0.5 dark:hidden"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"></path></svg></button><div class="block sm:hidden"></div><div class="hidden sm:block"></div></div></nav></div><div class="myst-primary-sidebar fixed xl:article-grid grid-gap xl:w-screen xl:pointer-events-none overflow-auto max-xl:min-w-[300px] hidden z-10" style="top:60px"><div class="myst-primary-sidebar-pointer pointer-events-auto xl:col-margin-left flex-col overflow-hidden hidden xl:flex"><div class="myst-primary-sidebar-nav flex-grow py-6 overflow-y-auto primary-scrollbar"><nav aria-label="Navigation" class="myst-primary-sidebar-topnav overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px] lg:hidden"><div class="w-full px-1 dark:text-white font-medium"></div></nav><div class="my-3 border-b-2 lg:hidden"></div><nav aria-label="Table of Contents" class="myst-primary-sidebar-toc flex-grow overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px]"><div class="myst-toc w-full px-1 dark:text-white"><a title="Ecological and Evolutionary Data Science" class="block break-words focus:outline outline-blue-200 outline-2 rounded myst-toc-item p-2 my-1 rounded-lg hover:bg-slate-300/30 font-bold" href="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/">Ecological and Evolutionary Data Science</a><a title="Required packages and data" class="block break-words focus:outline outline-blue-200 outline-2 rounded myst-toc-item p-2 my-1 rounded-lg hover:bg-slate-300/30" href="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/practical-requirements">Requirements</a><a title="Spatial methods in Ecological and Evolutionary Data Science" class="block break-words focus:outline outline-blue-200 outline-2 rounded myst-toc-item p-2 my-1 rounded-lg hover:bg-slate-300/30" href="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/gis-practical">Spatial Methods</a><a title="Microclimate sensor data analysis in R" class="block break-words focus:outline outline-blue-200 outline-2 rounded myst-toc-item p-2 my-1 rounded-lg hover:bg-slate-300/30" href="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/microclimate-sensor-analysis-easylog">Microclimate</a></div></nav></div><div class="myst-primary-sidebar-footer flex-none py-6 transition-all duration-700 translate-y-6 opacity-0"><a class="myst-made-with-myst flex mx-auto text-gray-700 w-fit hover:text-blue-700 dark:text-gray-200 dark:hover:text-blue-400" href="https://mystmd.org/made-with-myst" target="_blank" rel="noreferrer"><svg style="width:24px;height:24px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" stroke="none"><g id="icon"><path fill="currentColor" d="M23.8,54.8v-3.6l4.7-0.8V17.5l-4.7-0.8V13H36l13.4,31.7h0.2l13-31.7h12.6v3.6l-4.7,0.8v32.9l4.7,0.8v3.6h-15
          v-3.6l4.9-0.8V20.8H65L51.4,53.3h-3.8l-14-32.5h-0.1l0.2,17.4v12.1l5,0.8v3.6H23.8z"></path><path fill="#F37726" d="M47,86.9c0-5.9-3.4-8.8-10.1-8.8h-8.4c-5.2,0-9.4-1.3-12.5-3.8c-3.1-2.5-5.4-6.2-6.8-11l4.8-1.6
          c1.8,5.6,6.4,8.6,13.8,8.8h9.2c6.4,0,10.8,2.5,13.1,7.5c2.3-5,6.7-7.5,13.1-7.5h8.4c7.8,0,12.7-2.9,14.6-8.7l4.8,1.6
          c-1.4,4.9-3.6,8.6-6.8,11.1c-3.1,2.5-7.3,3.7-12.4,3.8H63c-6.7,0-10,2.9-10,8.8"></path></g></svg><span class="self-center ml-2 text-sm">Made with MyST</span></a></div></div></div><main class="article-grid grid-gap"><article class="article-grid subgrid-gap col-screen article content"><div class="hidden"></div><div id="skip-to-frontmatter" aria-label="article frontmatter" class="myst-fm-block mb-8 pt-9"><div class="myst-fm-block-header flex items-center mb-5 h-6 text-sm font-light"><div class="flex-grow"></div><div class="myst-fm-block-badges"></div><div class="myst-fm-downloads-dropdown relative flex inline-block mx-1 grow-0" data-headlessui-state=""><button class="myst-fm-downloads-button relative ml-2 -mr-1" id="headlessui-menu-button-:Rs8ucp:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state=""><span class="sr-only">Downloads</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem" class="myst-fm-downloads-icon"><title>Download</title><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"></path></svg></button></div></div><h1 class="myst-fm-block-title mb-0">Spatial methods in Ecological and Evolutionary Data Science</h1><header class="myst-fm-authors-affiliations mt-4 not-prose"><div class="myst-fm-authors-list"><span class="myst-fm-author font-semibold text-sm myst-fm-author-item inline-block"><button class="myst-fm-author-popover focus:shadow-[0_0_0_2px] focus:shadow-black outline-none hover:underline" aria-label="Author Details" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R78ucp:" data-state="closed"><span class="myst-fm-author-name">David Orme</span></button></span></div></header></div><div class="block my-10 lg:sticky lg:z-10 lg:h-0 lg:pt-0 lg:my-0 lg:ml-10 lg:col-margin-right" style="top:60px"><nav></nav></div><div id="skip-to-article"></div><p>This webpage provides one long self-paced practical that provides an introduction to key
spatial data handling and analysis techniques for use with the Ecological and
Evolutionary Data Science. This practical uses <a target="_blank" rel="noreferrer" href="https://cran.r-project,org" class="">the R programming
language</a> to load, manipulate and analyse spatial data. See
more here on <a target="_blank" rel="noreferrer" href="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/why_r_for_gis-98934107745e15d4197d5f7cf4b74b1f.md" class="">why we use R for GIS</a>.</p><p>There are a lot of other sites that provide information on using R for GIS:</p><ul><li><p>The core textbook for this practical is <a target="_blank" rel="noreferrer" href="https://r.geocompx.org/" class="">Geocomputation with
R</a> - it forms part of a broader set of resources from the
<a target="_blank" rel="noreferrer" href="https://geocompx.org/" class="">geocompx</a> group that provide resources for reproducible
geographic data analysis, modeling, and visualization in several open source
languages, also including Python and Julia.</p></li><li><p>Another great resource is the <a target="_blank" rel="noreferrer" href="https://rspatial.org/index.html" class=""><code>rspatial</code> website</a>,
which provides a lot of information on using <code>terra</code> and other spatial tools in R.</p></li></ul><h2 id="aims-of-the-the-practical" class="relative group"><span class="heading-text">Aims of the the practical</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#aims-of-the-the-practical" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>The practical aims to:</p><ul><li><p>Provide you with some high quality spatial datasets for the Silwood and NHM sites
that provide additional information that you can use to develop your hypotheses in
your coursework for the module.</p></li><li><p>Run through most of the major GIS techniques that you will need to use to integrate
raster and vector datasets in order to get to a final dataset addressing your
hypotheses.</p></li><li><p>Provide <em>simple</em> plotting options using the basic R graphics commands. For more
advanced mapping, see the <a target="_blank" rel="noreferrer" href="https://r.geocompx.org/adv-map" class="">“Making maps with R”</a>
chapter in “Geocomputation with R”.</p></li></ul><h2 id="how-to-use-the-practical" class="relative group"><span class="heading-text">How to use the practical</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#how-to-use-the-practical" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>This practical is self-paced: work through it at your own speed and ask questions as
needed! It builds up and then saves a set of datasets that you can use in your
assessment, so you will need to:</p><ol start="1"><li><p>Follow <a class="" href="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/practical-requirements">this guide</a> on setting up packages and data for
this practical.</p></li><li><p>Create a new R script file to run the practical analyses.</p></li><li><p>Copy example code from the practical into your script and run it from your script.</p></li><li><p>Check you understand what the code is doing - add extra comments, ask questions.</p></li><li><p>The practical contains exercises where you are asked to use the previous example to
write and run your own code. Write your solution into your script file and again add
comments for when you come back to it!</p></li><li><p>The practical contains solutions for all the exercises, but do try and solve them
yourself.</p></li><li><p>At the end of the practical, you should have:</p><ul><li><p>A set of GIS data files that allow you to add further environmental context to the
outputs of the sensor data exercises.</p></li><li><p>A complete script that builds up those files from the original source data.</p></li></ul></li></ol><h2 id="required-packages" class="relative group"><span class="heading-text">Required packages</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#required-packages" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>We will need to load the following packages:</p><div id="TyEMJYpz8T" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre">library(terra)       # core raster GIS package
library(sf)          # core vector GIS package
library(rcartocolor) # plotting
library(rpart)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="XHcrdH45TnD7_pQRWmE_L" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><p>You will see a whole load of package loading messages about GDAL, GEOS, PROJ which are
not shown here. Don’t worry about this - they are not errors, just R linking to some key
open source GIS toolkits.</p><h2 id="spatial-datasets" class="relative group"><span class="heading-text">Spatial datasets</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#spatial-datasets" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>We will be using a number of different datasets in both vector and raster format, at a
range of resolutions. They are not all in the same projection and so we will need to
supply coordinate system details. These can be very complex, but fortunately the <a target="_blank" rel="noreferrer" href="https://epsg.io/" class="">EPSG
database</a> now provides a set of consistent codes that can be use to
specify coordinate systems.</p><p>We will first load the location data from field datasets, which use GPS point location
data in the WGS84 projection (<a target="_blank" rel="noreferrer" href="https://epsg.io/4326" class="">EPSG:4326</a>) with units in degrees:</p><ul><li><p>The sensor deployment locations (16 sites across both the NHM and Silwood).</p></li><li><p>The blue tit nest box sites at Silwood (222 sites)</p></li></ul><p>We will then load a set of additional data files in a wide range of formats. The
following datasets are all downloaded from the <a target="_blank" rel="noreferrer" href="https://digimap.edina.ac.uk/" class="">Edina
Digimap</a> system. This is a UK national GIS resource for
higher education, which you should be able to use for any UK based GIS whilst you are at
the college using your college credentials. All of these datasets use the the OSGB36 /
British National Grid projected coordinate system
(<a target="_blank" rel="noreferrer" href="https://epsg.io/27700" class=""><code>EPSG:27700</code></a>), with units in metres.</p><ul><li><p>Aerial photography: RGB raster data at 25cm resolution with a single 3 x 3 km pane each
of the two sites.</p></li><li><p>The Ordnance Survey (OS) Terrain 5 digital elevation dataset: raster data at 5m
resolution with 2 pairs of 5 x 5 km panes for each site.</p></li><li><p>The CEH LandCover Map 2024: a raster land cover classification map with a single 3 x 3
km pane for each site.</p></li><li><p>The OS VectorMap Local dataset: two 5 x 5 km panes of vector data for each site.</p></li></ul><p>There are then two final datasets:</p><ul><li><p>Satellite data from the Sentinel 2 L2A product at a range of resolutions, using the
<a href="https://en.wikipedia.org/wiki/Universal_Transverse_Mercator_coordinate_system" class="italic" target="_blank" rel="noreferrer" data-state="closed">Universal Transverse Mercator
system</a>.
This projection uses multiple zones for different parts of the planet and the UK data
is in UTM zone 30N (<a target="_blank" rel="noreferrer" href="https://epsg.io/32630" class="">EPSG code <code>EPSG:32630</code></a>), with units of
meters.</p></li><li><p>The GPS route for Silwood Christmas (Silmas) fun run and walking route. This is again
in WGS84 projection.</p></li></ul><p>The sections below show how to load each dataset.</p><h3 id="sensor-locations" class="relative group"><span class="heading-text">Sensor locations</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#sensor-locations" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>The sensor stations at Silwood and the NHM are recorded as  a CSV file, providing
station data including the latitude and longitude of each site. This file is directly
downloaded from the Epicollect5 project. This is vector point data: precise locations
from GPS associated with additional site data.</p><ul><li><p>The data is first loaded as a simple CSV file.</p></li><li><p>We then need to convert the data to an <code>sf</code> (simple features) object. This is very
like a normal R data frame, but contains an additional <code>geometry</code> field that contains
the vector data geometries and the coordinate system. This is done using the
<code>sf::st_sf</code> function to set the CSV fields that contain the point coordinates.</p></li></ul><div id="MTotYUwzpm" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre"># Load the data from the CSV file
sensor_locations &lt;- read.csv(&quot;../data/SensorSites/2025/sensor_sites_2025.csv&quot;)

# Convert to an sf object by setting the fields containing X and Y data and set 
# the projection of the dataset
sensor_locations &lt;- st_as_sf(
  sensor_locations, 
  coords=c(&quot;long_Sensor_location&quot;,&quot;lat_Sensor_location&quot;),
  crs=&quot;EPSG:4326&quot;
)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="z4-ZkdSJmk54uRnWKVyqR" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><h3 id="nest-boxes" class="relative group"><span class="heading-text">Nest boxes</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#nest-boxes" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>The locations of the Silwood blue tit nest boxes were also recorded using GPS. This is a
long-term dataset and these data have already been processed into specific GIS format:
the widely used <a href="https://en.wikipedia.org/wiki/Shapefile" class="italic" target="_blank" rel="noreferrer" data-state="closed">shapefile format</a>. The
<code>sf::st_read</code> function is used to read existing GIS format files directly into an <code>sf</code>
object.</p><div id="PygrE137vT" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre">nest_boxes &lt;- st_read(&quot;../data/SpatialMethods/NestBoxes/NestBoxes.shp&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="7Rv2Fk5a7S94PtULnvctW" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>Reading layer `NestBoxes&#x27; from data source 
  `/Users/dorme/Teaching/GIS/living_planet_eco_evo_data/practicals/data/SpatialMethods/NestBoxes/NestBoxes.shp&#x27; 
  using driver `ESRI Shapefile&#x27;
replacing null geometries with empty geometries
Simple feature collection with 222 features and 9 fields (with 2 geometries empty)
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: -0.6544148 ymin: 51.40618 xmax: -0.638663 ymax: 51.41621
Geodetic CRS:  WGS 84
</span></code></pre></div></div></div><p>As you can see from the output above, loading a GIS file using <code>sf::stread</code> produces
quite a lot of information. This practical handout will generally hide that to keep the
page size down. We can also look at what an <code>sf</code> object looks like if you print it out:
very like a dataframe with some extra header data.</p><div id="wmCgLSCOsQ" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre">print(head(nest_boxes))</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="fhs0rOnUl8DntT5A4GdPZ" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>Simple feature collection with 6 features and 9 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: -0.6409471 ymin: 51.40993 xmax: -0.638663 ymax: 51.41213
Geodetic CRS:  WGS 84
  NestboxID TreeID TreeTag              Species Latitude  Longitude
1       A01   3938      NA fraxinus.excelsior¬† 51.40993 -0.6386630
2       A03    611    1322        quercus.robur 51.41107 -0.6400258
3       A04   3847      NA  acer.pseudoplatanus 51.41167 -0.6393205
4       A05   3859      NA       betula.pendula 51.41195 -0.6403336
5       A06    636    1351        quercus.robur 51.41196 -0.6407162
6       A07    660    5772        quercus.robur 51.41213 -0.6409471
         SPlocation Type State                    geometry
1 Observatory copse   26 alive  POINT (-0.638663 51.40993)
2 Observatory copse   26 alive POINT (-0.6400258 51.41107)
3 Observatory copse   26 alive POINT (-0.6393205 51.41167)
4 Observatory copse   26 alive POINT (-0.6403336 51.41195)
5    Merten&#x27;s acres   26 alive POINT (-0.6407162 51.41196)
6    Merten&#x27;s acres   26 alive POINT (-0.6409471 51.41213)
</span></code></pre></div></div></div><aside class="myst-admonition myst-admonition-danger my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-red-600 danger"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-red-600 bg-red-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-red-600"><path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12ZM12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75Zm0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z" clip-rule="evenodd"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Shapefile - not one file!</div></div><div class="myst-admonition-body px-4 py-1"><p>Confusingly, a <strong>shapefile dataset is not a single file</strong> - a shapefile dataset consists
of a set of related files with the same shared file name and a range of file type
suffixes (<code>.shp</code>, <code>.dbf</code>, <code>.shx</code> and <code>.prj</code> are the core subfiles but other suffixes are
common). You <strong>must keep all of these files together</strong>, or the dataset will not load
correctly.</p></div></aside><h3 id="woodland-survey" class="relative group"><span class="heading-text">Woodland survey</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#woodland-survey" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>The Silwood woodland survey transect points: another CSV file providing latitude and
longitude of transect locations.</p><p>TODO</p><h3 id="aerial-photography" class="relative group"><span class="heading-text">Aerial photography</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#aerial-photography" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>These raster datasets provide 3km by 3km panes of 25cm resolution <a target="_blank" rel="noreferrer" href="https://digimap.edina.ac.uk/aerial" class="">aerial photography
imagery</a> for the two sites. These files are provided
as GeoTIFF data files - these are essentially just <a href="https://en.wikipedia.org/wiki/TIFF" class="italic" target="_blank" rel="noreferrer" data-state="closed">standard TIFF
image</a> files but contain metadata that provides the
spatial context of each pixel in the image and the projection information.</p><p>Raster data can be loaded using the <code>terra::rast</code> function.</p><div id="dhf51tE3CM" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre">nhm_aerial &lt;- rast(&#x27;../data/SpatialMethods/aerial/nhm_aerial.tiff&#x27;)
silwood_aerial &lt;- rast(&#x27;../data/SpatialMethods/aerial/silwood_aerial.tiff&#x27;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="ddwwfjfOUhSauJEMcXW5u" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><p>Printing out one of those fhiles shows the spatial information of the raster and then a
table showing the names of the bands in the raster and their range. These files contain
three band to provide RGB imagery.</p><div id="AVYuqrba62" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre">print(nhm_aerial)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="uXa6z-EJG8eAgiWoG51qu" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>class       : SpatRaster 
size        : 12000, 12000, 3  (nrow, ncol, nlyr)
resolution  : 0.25, 0.25  (x, y)
extent      : 525000, 528000, 178000, 181000  (xmin, xmax, ymin, ymax)
coord. ref. : OSGB36 / British National Grid (EPSG:27700) 
source      : nhm_aerial.tiff 
names       : tq2578_rgb_250_09_1, tq2578_rgb_250_09_2, tq2578_rgb_250_09_3 
min values  :                   0,                   6,                   5 
max values  :                 255,                 255,                 255 
</span></code></pre></div></div></div><h3 id="os-terrain-5" class="relative group"><span class="heading-text">OS Terrain 5</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#os-terrain-5" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>These raster datasets provide continuous elevation data at 5m
resolution from the <a target="_blank" rel="noreferrer" href="https://www.ordnancesurvey.co.uk/products/os-terrain-5" class="">Ordnance Survey Terrain 5 Digital Terrain Map (DTM)
dataset</a>. Each site has
two adjoining panes of data.</p><aside class="myst-admonition myst-admonition-tip my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-green-600 tip"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-green-600 bg-green-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-green-600"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Aside: coordinates in the British National Grid</div></div><div class="myst-admonition-body px-4 py-1"><p>The odd file names come from the British National Grid mapping system. The code <code>SU96NE</code>
indicates the north east quadrant of a 10 x 10 km cell that is found 9 cells east and 6
cells north within the 100 x 100 km <code>SU</code> cell. The <code>SU</code> cell itself is one of 25 cells
within the 500 x 500 km <code>S</code> cell. You can add more digits to give more resolution. An 8
digit grid reference has a 10 metre precision: the Hamilton building is at <code>SU 9469 6871</code> and the NHM Wildlife Garden is at <code>TQ 2656 7899</code>.</p><p>See <a target="_blank" rel="noreferrer" href="https://digimap.edina.ac.uk/help/our-maps-and-../data/SpatialMethods/bng/" class="">here for more details</a>.</p></div></aside><p>These files are <code>ASC</code> format files - a very simple text based format that contains the
cell coordinates but <em>not</em> the projection metadata, so we need to add that information.</p><div id="TWbkCzLZeC" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre"># Load the DTM data from ASC format files
silwood_dtm_SU96NE &lt;- rast(&quot;../data/SpatialMethods/dtm_5m/SU96NE.asc&quot;)
silwood_dtm_SU96NW &lt;- rast(&quot;../data/SpatialMethods/dtm_5m/SU96NW.asc&quot;)
nhm_dtm_TQ27NE &lt;- rast(&quot;../data/SpatialMethods/dtm_5m/TQ27NE.asc&quot;)
nhm_dtm_TQ28SE &lt;- rast(&quot;../data/SpatialMethods/dtm_5m/TQ28SE.asc&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="afw5Z3CMWw1kKRoYMe1io" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><p>If we look at one of those datasets, you can see that the cell coordinates, resolution
and overall dataset size have been set but that the <code>coord. ref</code> attribute is empty.</p><div id="VxhBc4HuDO" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre"># Look at the object data
silwood_dtm_SU96NE</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="bBCkBefa09dmatSzCJfg5" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div class="myst-jp-safe-output-text font-mono text-sm whitespace-pre-wrap"><code><span>class       : SpatRaster 
size        : 1000, 1000, 1  (nrow, ncol, nlyr)
resolution  : 5, 5  (x, y)
extent      : 495000, 5e+05, 165000, 170000  (xmin, xmax, ymin, ymax)
coord. ref. :  
source      : SU96NE.asc 
name        : SU96NE </span></code></div></div></div><p>We need to set the projection manually using the <code>terra::crs</code> function and then check
that the attribute has been set.</p><div id="QBGhnfFVyB" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre"># Set the projection information for the DTM datasets
crs(silwood_dtm_SU96NE) &lt;- crs(silwood_dtm_SU96NW) &lt;- &quot;EPSG:27700&quot;
crs(nhm_dtm_TQ27NE) &lt;- crs(nhm_dtm_TQ28SE) &lt;- &quot;EPSG:27700&quot;

# Print the modified dataset
silwood_dtm_SU96NE</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="m_VM9g4U7s6vWG0cG2D9A" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div class="myst-jp-safe-output-text font-mono text-sm whitespace-pre-wrap"><code><span>class       : SpatRaster 
size        : 1000, 1000, 1  (nrow, ncol, nlyr)
resolution  : 5, 5  (x, y)
extent      : 495000, 5e+05, 165000, 170000  (xmin, xmax, ymin, ymax)
coord. ref. : OSGB36 / British National Grid (EPSG:27700) 
source      : SU96NE.asc 
name        : SU96NE </span></code></div></div></div><h3 id="ceh-land-cover" class="relative group"><span class="heading-text">CEH Land Cover</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#ceh-land-cover" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>The Centre for Ecology and Hydrology produces a UK wide land cover map at 10 metre
resolution. The datasets here are taken from the most recent <a target="_blank" rel="noreferrer" href="https://catalogue.ceh.ac.uk/documents/5af9e97d-9f33-495d-8323-e57734388533" class="">Land Cover Map
2024</a>.</p><p>The land cover categories are assigned using a classification of multi-band spectral
data from satellites onto the spectral signatures of known training sites. Each cell is
assigned to the category with training signatures that most closely match the spectral
signature of the cell.</p><div id="bBgfisuVRN" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre"># Load the land cover map datasets
silwood_LCM &lt;- rast(&quot;../data/SpatialMethods/lcm_2024/Silwood_LCM2024.tiff&quot;)
nhm_LCM &lt;- rast(&quot;../data/SpatialMethods/lcm_2024/NHM_LCM2024.tiff&quot;)

# Look at the raster details
print(silwood_LCM)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="1pxOrYGHEZTEqy-jZexpn" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>class       : SpatRaster 
size        : 300, 300, 2  (nrow, ncol, nlyr)
resolution  : 10, 10  (x, y)
extent      : 493000, 496000, 167000, 170000  (xmin, xmax, ymin, ymax)
coord. ref. : OSGB36 / British National Grid (EPSG:27700) 
source      : Silwood_LCM2024.tiff 
names       : gblcm2024_10m_1, gblcm2024_10m_2 
min values  :               1,              13 
max values  :              21,             100 
</span></code></pre></div></div></div><p>The LCM2024 files contain <strong>two raster bands</strong>. The first band is a numeric code
giving the land cover category. The second band give the probability of the cell having
that land cover type, based on the underlying classification. As loaded, these values
are just numeric, so if we plot the data, we will get two continuous colour legends:</p><div id="gEb994XOid" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre">plot(silwood_LCM)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="KylqIU1GHTeXa0xrZOPoG" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/353687db9b78344b4d8af2b5f9c9dd70.png" alt="plot without title"/></div></div><p>We can add category labels and better category colours to make the data easier to use.
The labels and some colours are defined in a separate CSV file:</p><div id="Z34Skp2VM6" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre">lcm_info &lt;- read.csv(&quot;../data/SpatialMethods/lcm_2024/LCM2024_info.csv&quot;)

# Set the band names, the category code labels and the colour tables
levels(nhm_LCM) &lt;- lcm_info[c(&quot;value&quot;, &quot;label&quot;)]
coltab(nhm_LCM) &lt;- lcm_info[c(&quot;value&quot;, &quot;color&quot;)]
names(nhm_LCM) &lt;- c(&quot;LandCover&quot;, &quot;Certainty&quot;)

coltab(silwood_LCM) &lt;- lcm_info[c(&quot;value&quot;, &quot;color&quot;)]
levels(silwood_LCM) &lt;- lcm_info[c(&quot;value&quot;, &quot;label&quot;)]
names(silwood_LCM) &lt;- c(&quot;LandCover&quot;, &quot;Certainty&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="jtL8oFDGmcGGLdSzwIKm1" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><p>Now we can now plot maps that have actual category labels:</p><div id="AZGbFRpctZ" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre">par(mfrow=c(1,2))
plot(silwood_LCM[&quot;LandCover&quot;])
plot(nhm_LCM[&quot;LandCover&quot;])</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="J1ksWjedpqcmzf5EZ-xoB" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/b0d65980d2bb655d1cae63130ca13787.png" alt="plot without title"/></div></div><p>And look at the frequencies of the different categories using the <code>terra::freq</code> function:</p><div id="KQDdzh8myX" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre">nhm_freq &lt;- freq(nhm_LCM[&quot;LandCover&quot;])
silwood_freq &lt;- freq(silwood_LCM[&quot;LandCover&quot;])

# Join the two datasets, including all categories
merge(
  nhm_freq, silwood_freq, 
  by=&quot;value&quot;, all=TRUE, suffixes = c(&quot;.nhm&quot;, &quot;.silwood&quot;)
)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="p9IqGk29AC1RyOneVGn7_" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><p>We can also use the data within raster layers with other non-spatial data exploration
techniques. For example, we can look at the distribution of cell certainties associated
with each category.</p><div id="AkOU6iprsr" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre">par(mar = c(4, 12, 1, 1))

# Plot cell assignment certainties as a function of land cover category
boxplot(
  silwood_LCM[&quot;Certainty&quot;], silwood_LCM[&quot;LandCover&quot;], 
  las = 1, ylab = &quot;&quot;, horizontal=TRUE, main=&quot;Silwood&quot;, xlab=&quot;Certainty&quot;
)
boxplot(
  nhm_LCM[&quot;Certainty&quot;], nhm_LCM[&quot;LandCover&quot;], 
  las = 1, ylab = &quot;&quot;, horizontal=TRUE, main=&quot;NHM&quot;, xlab=&quot;Certainty&quot;
)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="-KD_5Jm-kwcuP-ZOg0jcx" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/97167a505dd09d44d6fd44897f2218dd.png" alt="Plot with title “Silwood”"/><img src="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/3ec0958cc72576dcdc148d3e14a24b4d.png" alt="Plot with title “NHM”"/></div></div><h3 id="os-vectormap-local" class="relative group"><span class="heading-text">OS VectorMap Local</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#os-vectormap-local" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>The <a target="_blank" rel="noreferrer" href="https://www.ordnancesurvey.co.uk/products/os-vectormap-local" class="">Ordnance Survey VectorMap
Local</a> dataset provides
very high precision vector data on spatial features in the UK. These files are saved in
the <a href="https://en.wikipedia.org/wiki/GeoPackage" class="italic" target="_blank" rel="noreferrer" data-state="closed">GeoPackage file format (<code>.gpkg</code>)</a>. As
with the Terrain 5 data, the data from Edina Digimap consists of two 5 x 5 km panes for
each site.</p><p>A GeoPackage file can contain multiple vector datasets in a single file: these are
usually called “layers” and so you will typically load one layer at a time. The code
below uses the <code>sf::st_layers</code> command to show the available layers within one of the
VML datasets.</p><div id="aoUe0AnGGv" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre">print(st_layers(&quot;../data/SpatialMethods/VML/vml-su96ne.gpkg&quot;))</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="btZoB_U3xX7x8fPKaRFa3" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>Driver: GPKG 
Available layers:
                layer_name geometry_type features fields
1            Landform_Area       Polygon     1137      3
2             Urban_Extent       Polygon        5      3
3                 Building       Polygon     3776      3
4               Water_Area       Polygon      197      3
5                   Bridge       Polygon        1      3
6             General_Line   Line String    17433      3
7            Building_Line   Line String     3839      3
8          Height_Contours   Line String      251      3
9            Landform_Line   Line String      101      3
10              Water_Line   Line String      659      3
11 Administrative_Boundary   Line String       11      3
12         Rail_Centreline   Line String       41      3
13         Road_Centreline   Line String     1333      5
14            General_Text         Point      366      9
15    Road_Centreline_Text         Point     1564      9
16           Building_Text         Point      120      9
17             Height_Text         Point      247      9
18              Water_Text         Point       97      9
19           General_Point         Point       20      5
20            Water_Points         Point       69      5
21           Height_Points         Point       93      5
                         crs_name
1  OSGB36 / British National Grid
2  OSGB36 / British National Grid
3  OSGB36 / British National Grid
4  OSGB36 / British National Grid
5  OSGB36 / British National Grid
6  OSGB36 / British National Grid
7  OSGB36 / British National Grid
8  OSGB36 / British National Grid
9  OSGB36 / British National Grid
10 OSGB36 / British National Grid
11 OSGB36 / British National Grid
12 OSGB36 / British National Grid
13 OSGB36 / British National Grid
14 OSGB36 / British National Grid
15 OSGB36 / British National Grid
16 OSGB36 / British National Grid
17 OSGB36 / British National Grid
18 OSGB36 / British National Grid
19 OSGB36 / British National Grid
20 OSGB36 / British National Grid
21 OSGB36 / British National Grid
</span></code></pre></div></div></div><p>We can then use the <code>sf::st_read</code> function to read specific different layers for each
site.</p><div id="r12oBOgBlR" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre"># Load the two panes of VML road centrelines for each site.
vml_tq28se_roads &lt;- st_read(
  dsn = &quot;../data/SpatialMethods/VML/vml-tq28se.gpkg&quot;, layer = &quot;Road_Centreline&quot;
)
vml_tq27ne_roads &lt;- st_read(
  dsn = &quot;../data/SpatialMethods/VML/vml-tq27ne.gpkg&quot;, layer = &quot;Road_Centreline&quot;
)
vml_su96ne_roads &lt;- st_read(
  dsn = &quot;../data/SpatialMethods/VML/vml-su96ne.gpkg&quot;, layer = &quot;Road_Centreline&quot;
)
vml_su96nw_roads &lt;- st_read(
  dsn = &quot;../data/SpatialMethods/VML/vml-su96nw.gpkg&quot;, layer = &quot;Road_Centreline&quot;
)

# Do the same for water bodies
vml_tq28se_water &lt;- st_read(
  dsn = &quot;../data/SpatialMethods/VML/vml-tq28se.gpkg&quot;, layer = &quot;Water_Area&quot;
)
vml_tq27ne_water &lt;- st_read(
  dsn = &quot;../data/SpatialMethods/VML/vml-tq27ne.gpkg&quot;, layer = &quot;Water_Area&quot;
)
vml_su96ne_water &lt;- st_read(
  dsn = &quot;../data/SpatialMethods/VML/vml-su96ne.gpkg&quot;, layer = &quot;Water_Area&quot;
)
vml_su96nw_water &lt;- st_read(
  dsn = &quot;../data/SpatialMethods/VML/vml-su96nw.gpkg&quot;, layer = &quot;Water_Area&quot;
)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="SqoEHpE-5_dzpR82iXlDY" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5 hidden"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>Reading layer `Road_Centreline&#x27; from data source 
  `/Users/dorme/Teaching/GIS/living_planet_eco_evo_data/practicals/data/SpatialMethods/VML/vml-tq28se.gpkg&#x27; 
  using driver `GPKG&#x27;
Simple feature collection with 8916 features and 5 fields
Geometry type: LINESTRING
Dimension:     XY
Bounding box:  xmin: 524731 ymin: 179744.5 xmax: 530112 ymax: 185228.1
Projected CRS: OSGB36 / British National Grid
</span></code></pre></div><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>Reading layer `Road_Centreline&#x27; from data source 
  `/Users/dorme/Teaching/GIS/living_planet_eco_evo_data/practicals/data/SpatialMethods/VML/vml-tq27ne.gpkg&#x27; 
  using driver `GPKG&#x27;
Simple feature collection with 8122 features and 5 fields
Geometry type: LINESTRING
Dimension:     XY
Bounding box:  xmin: 524579.6 ymin: 174853.7 xmax: 530153.2 ymax: 180470.7
Projected CRS: OSGB36 / British National Grid
</span></code></pre></div><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>Reading layer `Road_Centreline&#x27; from data source 
  `/Users/dorme/Teaching/GIS/living_planet_eco_evo_data/practicals/data/SpatialMethods/VML/vml-su96ne.gpkg&#x27; 
  using driver `GPKG&#x27;
Simple feature collection with 1333 features and 5 fields
Geometry type: LINESTRING
Dimension:     XY
Bounding box:  xmin: 494774.3 ymin: 164397 xmax: 500586 ymax: 170268.6
Projected CRS: OSGB36 / British National Grid
</span></code></pre></div><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>Reading layer `Road_Centreline&#x27; from data source 
  `/Users/dorme/Teaching/GIS/living_planet_eco_evo_data/practicals/data/SpatialMethods/VML/vml-su96nw.gpkg&#x27; 
  using driver `GPKG&#x27;
Simple feature collection with 1956 features and 5 fields
Geometry type: LINESTRING
Dimension:     XY
Bounding box:  xmin: 488519.8 ymin: 164588.5 xmax: 495366 ymax: 170367.4
Projected CRS: OSGB36 / British National Grid
</span></code></pre></div><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>Reading layer `Water_Area&#x27; from data source 
  `/Users/dorme/Teaching/GIS/living_planet_eco_evo_data/practicals/data/SpatialMethods/VML/vml-tq28se.gpkg&#x27; 
  using driver `GPKG&#x27;
Simple feature collection with 129 features and 3 fields
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: 524874.3 ymin: 179936 xmax: 530118.6 ymax: 184188.5
Projected CRS: OSGB36 / British National Grid
</span></code></pre></div><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>Reading layer `Water_Area&#x27; from data source 
  `/Users/dorme/Teaching/GIS/living_planet_eco_evo_data/practicals/data/SpatialMethods/VML/vml-tq27ne.gpkg&#x27; 
  using driver `GPKG&#x27;
Simple feature collection with 113 features and 3 fields
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: 525000 ymin: 174967.8 xmax: 530019.1 ymax: 180203.8
Projected CRS: OSGB36 / British National Grid
</span></code></pre></div><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>Reading layer `Water_Area&#x27; from data source 
  `/Users/dorme/Teaching/GIS/living_planet_eco_evo_data/practicals/data/SpatialMethods/VML/vml-su96ne.gpkg&#x27; 
  using driver `GPKG&#x27;
Simple feature collection with 197 features and 3 fields
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: 494889.5 ymin: 164949.9 xmax: 500058.7 ymax: 170239.3
Projected CRS: OSGB36 / British National Grid
</span></code></pre></div><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>Reading layer `Water_Area&#x27; from data source 
  `/Users/dorme/Teaching/GIS/living_planet_eco_evo_data/practicals/data/SpatialMethods/VML/vml-su96nw.gpkg&#x27; 
  using driver `GPKG&#x27;
Simple feature collection with 241 features and 3 fields
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: 489969.7 ymin: 165112.2 xmax: 495114.6 ymax: 170260.6
Projected CRS: OSGB36 / British National Grid
</span></code></pre></div></div></div><h3 id="sentinel-2-data" class="relative group"><span class="heading-text">Sentinel 2 data</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#sentinel-2-data" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>The Sentinel 2 satellite mission collects spectral data from <a target="_blank" rel="noreferrer" href="https://custom-scripts.sentinel-hub.com/sentinel-2/bands/" class="">13
bands</a> across the visible,
near infra-red and infra-red at resolutions from 10m to 60m. See the <a target="_blank" rel="noreferrer" href="https://sentiwiki.copernicus.eu/web/sentinel-2" class="">Copernicus
Sentinel 2 data wiki</a> for more
information about the mission and data processing.</p><p>The <code>sentinel_2</code> folder contains data from a single (relatively cloud free!) scene from
the <a target="_blank" rel="noreferrer" href="https://sentiwiki.copernicus.eu/web/s2-products#S2Products-Level-2AProductsS2-Products-L2Atrue" class="">Sentinel 2 Level 2A data
product</a>
that was downloaded using the <a target="_blank" rel="noreferrer" href="https://browser.dataspace.copernicus.eu/" class="">Copernicus data
browser</a>. The L2A data product has been
processed to remove atmospheric effects to give modelled surface reflectance values for
each band and also to add some extra calculated layers, such as true colour images (more
on this later!).</p><p>A single scene of L2A data covers roughly 110 x 110 km and contains about 1 GB of data,
so has been cropped down to the two study sites (see <span data-state="closed"><a href="#cropping-rasters" class="hover-link">below</a></span>). The
code below loads the four 10m resolution bands into a single raster for each site by
providing a vector of file names to the <code>terra::rast</code> function. It also rescales the
data: remote sensing data is often stored as integer data to save file space and needs
converting to actual values, in this case by dividing by 10000.</p><div id="FhgVc68PSh" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre"># Load the four 10m resolution Sentinel 2 bands for Silwood
s2_silwood_10m &lt;- rast(
    c(
        &quot;../data/SpatialMethods/sentinel_2/R10m/silwood/T30UXC_20250711T110651_B02_10m.tiff&quot;,
        &quot;../data/SpatialMethods/sentinel_2/R10m/silwood/T30UXC_20250711T110651_B03_10m.tiff&quot;,
        &quot;../data/SpatialMethods/sentinel_2/R10m/silwood/T30UXC_20250711T110651_B04_10m.tiff&quot;,
        &quot;../data/SpatialMethods/sentinel_2/R10m/silwood/T30UXC_20250711T110651_B08_10m.tiff&quot;
    ),
)  / 10000

# Name the bands 
names(s2_silwood_10m) &lt;- c(&quot;B&quot;, &quot;G&quot;, &quot;R&quot;, &quot;NIR&quot;)

# Do the same for the NHM
s2_nhm_10m &lt;- rast(
    c(
        &quot;../data/SpatialMethods/sentinel_2/R10m/nhm/T30UXC_20250711T110651_B02_10m.tiff&quot;,
        &quot;../data/SpatialMethods/sentinel_2/R10m/nhm/T30UXC_20250711T110651_B03_10m.tiff&quot;,
        &quot;../data/SpatialMethods/sentinel_2/R10m/nhm/T30UXC_20250711T110651_B04_10m.tiff&quot;,
        &quot;../data/SpatialMethods/sentinel_2/R10m/nhm/T30UXC_20250711T110651_B08_10m.tiff&quot;
    ),
) / 10000
names(s2_nhm_10m) &lt;- c(&quot;B&quot;, &quot;G&quot;, &quot;R&quot;, &quot;NIR&quot;)

# Show the resulting object structure
print(s2_silwood_10m)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="GglOslpatHVDuAf9OBQ3h" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>class       : SpatRaster 
size        : 312, 312, 4  (nrow, ncol, nlyr)
resolution  : 10, 10  (x, y)
extent      : 662390, 665510, 5696240, 5699360  (xmin, xmax, ymin, ymax)
coord. ref. : WGS 84 / UTM zone 30N (EPSG:32630) 
source(s)   : memory
names       :      B,     G,      R,    NIR 
min values  : 0.1067, 0.110, 0.1085, 0.1060 
max values  : 0.5808, 0.616, 0.6088, 0.7964 
</span></code></pre></div></div></div><aside class="myst-admonition myst-admonition-note my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-blue-500"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-blue-600 bg-blue-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-blue-600"><path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Exercise</div></div><div class="myst-admonition-body px-4 py-1"><p>The Sentinel 2 dataset directory also includes the band data sampled at 20m and 60m
resolution. The 60m bands are largely aimed at detecting water vapour and clouds, but
the 20 metre bands include red edge, narrow near infrared and short wave infrared data
that can be useful. Use the code above as a template to load Bands 5, 6, 7, 8A, 11 and
12 from the 20 meter directories for each site. Note that the 20m directory also
contains downsampled data from the 10 metre bands.</p><p>The resulting objects should be called <code>s2_silwood_20m</code> and <code>s2_nhm_20m</code> and the bands
should be named <code>RE5</code>, <code>RE6</code>, <code>RE7</code>, <code>NNIR</code>, <code>SWIR1</code> and <code>SWIR2</code>.</p></div></aside><details class="myst-admonition myst-admonition-tip my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-green-600 dropdown"><summary class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-green-600 bg-green-50 dark:bg-slate-900 cursor-pointer hover:shadow-[inset_0_0_0px_30px_#00000003] dark:hover:shadow-[inset_0_0_0px_30px_#FFFFFF03]"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-green-600"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Show solution</div><div class="self-center flex-none text-sm font-thin text-neutral-700 dark:text-neutral-200"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none transition-transform details-toggle"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></div></summary><div class="myst-admonition-body px-4 py-1 details-body"><div id="LfLayIYro2" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre"># Load the six 20m resolution Sentinel 2 bands for Silwood
s2_silwood_20m &lt;- rast(
    c(
        &quot;../data/SpatialMethods/sentinel_2/R20m/silwood/T30UXC_20250711T110651_B05_20m.tiff&quot;,
        &quot;../data/SpatialMethods/sentinel_2/R20m/silwood/T30UXC_20250711T110651_B06_20m.tiff&quot;,
        &quot;../data/SpatialMethods/sentinel_2/R20m/silwood/T30UXC_20250711T110651_B07_20m.tiff&quot;,
        &quot;../data/SpatialMethods/sentinel_2/R20m/silwood/T30UXC_20250711T110651_B8A_20m.tiff&quot;,
        &quot;../data/SpatialMethods/sentinel_2/R20m/silwood/T30UXC_20250711T110651_B11_20m.tiff&quot;,
        &quot;../data/SpatialMethods/sentinel_2/R20m/silwood/T30UXC_20250711T110651_B12_20m.tiff&quot;
    ),
) / 10000

# Name the bands 
names(s2_silwood_20m) &lt;- c(&quot;RE5&quot;, &quot;RE6&quot;, &quot;RE7&quot;, &quot;NNIR&quot;, &quot;SWIR1&quot;, &quot;SWIR2&quot;)

# Load the seven 20m resolution Sentinel 2 bands for the NHM
s2_nhm_20m &lt;- rast(
    c(
        &quot;../data/SpatialMethods/sentinel_2/R20m/nhm/T30UXC_20250711T110651_B05_20m.tiff&quot;,
        &quot;../data/SpatialMethods/sentinel_2/R20m/nhm/T30UXC_20250711T110651_B06_20m.tiff&quot;,
        &quot;../data/SpatialMethods/sentinel_2/R20m/nhm/T30UXC_20250711T110651_B07_20m.tiff&quot;,
        &quot;../data/SpatialMethods/sentinel_2/R20m/nhm/T30UXC_20250711T110651_B8A_20m.tiff&quot;,
        &quot;../data/SpatialMethods/sentinel_2/R20m/nhm/T30UXC_20250711T110651_B11_20m.tiff&quot;,
        &quot;../data/SpatialMethods/sentinel_2/R20m/nhm/T30UXC_20250711T110651_B12_20m.tiff&quot;
    ),
) / 10000

# Name the bands 
names(s2_nhm_20m) &lt;- c(&quot;RE5&quot;, &quot;RE6&quot;, &quot;RE7&quot;, &quot;NNIR&quot;, &quot;SWIR1&quot;, &quot;SWIR2&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="33MKVxtvJaoM8qulVH_YM" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div></div></details><h3 id="silmas-walk-run-route" class="relative group"><span class="heading-text">Silmas walk/run route</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#silmas-walk-run-route" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>The last dataset is a <a href="https://en.wikipedia.org/wiki/GPS_Exchange_Format" class="italic" target="_blank" rel="noreferrer" data-state="closed">GPS Exchange Format (GPX)
file</a> containing the course of the
Silmas fun run and walking route. The GPX format is a commonly used format to record
routes and points from GPS devices. Again, the format holds multiple layers:</p><div id="IIsXvsYdBy" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre">print(st_layers(&quot;../data/SpatialMethods/Silmas_Fun_Run.gpx&quot;))</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="g8CJ1dbH4oJLSGPxe1yqp" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>Driver: GPX 
Available layers:
    layer_name     geometry_type features fields crs_name
1    waypoints             Point        0     23   WGS 84
2       routes       Line String        0     12   WGS 84
3       tracks Multi Line String        1     12   WGS 84
4 route_points             Point        0     25   WGS 84
5 track_points             Point      425     26   WGS 84
</span></code></pre></div></div></div><p>With GPX files, there are a fixed number of layers. They are not all used in this file:
we have a single linear feature in <code>tracks</code> layer, which is the Silmas route, and then
the 425 point features in the <code>track_points</code> layer, which are the points along
along that route. We will load the  <code>tracks</code> layer:</p><div id="uzCoSK1Snm" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre">silmas_route &lt;- st_read(
  dsn=&quot;../data/SpatialMethods/Silmas_Fun_Run.gpx&quot;, layer=&quot;tracks&quot;
)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="nIfc5fztWxSPVfcVgH0A-" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>Reading layer `tracks&#x27; from data source 
  `/Users/dorme/Teaching/GIS/living_planet_eco_evo_data/practicals/data/SpatialMethods/Silmas_Fun_Run.gpx&#x27; 
  using driver `GPX&#x27;
Simple feature collection with 1 feature and 12 fields
Geometry type: MULTILINESTRING
Dimension:     XY
Bounding box:  xmin: -0.650703 ymin: 51.40805 xmax: -0.63996 ymax: 51.42044
Geodetic CRS:  WGS 84
</span></code></pre></div></div></div><h2 id="plotting-gis-data" class="relative group"><span class="heading-text">Plotting GIS data</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#plotting-gis-data" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><aside class="myst-admonition myst-admonition-hint my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-green-600"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-green-600 bg-green-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-green-600"><path stroke-linecap="round" stroke-linejoin="round" d="M12 18v-5.25m0 0a6.01 6.01 0 0 0 1.5-.189m-1.5.189a6.01 6.01 0 0 1-1.5-.189m3.75 7.478a12.06 12.06 0 0 1-4.5 0m3.75 2.383a14.406 14.406 0 0 1-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 1 0-7.517 0c.85.493 1.509 1.333 1.509 2.316V18"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Hint</div></div><div class="myst-admonition-body px-4 py-1"><p>These are very basic plotting tips for GIS data, but are all we need for this
practical.</p></div></aside><h3 id="plotting-vector-data" class="relative group"><span class="heading-text">Plotting vector data</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#plotting-vector-data" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>If you plot a vector dataset, then it will generate a panel for each vector attribute in
the dataset (up to a limit!).</p><div id="MkuGsaI67B" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre">plot(nest_boxes)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="t8WIgsaBUycYq401CSk_B" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/41283114c132e9c6e409775e81df4392.png" alt="Plot with title “State”"/></div></div><p>If you want to plot just one of those attributes, then you can use <code>[]</code> subsets to do
so, and R will generate a key for it.</p><div id="tGwcK7YuIV" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre">plot(nest_boxes[&#x27;SPlocation&#x27;], key.pos=4)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="one8AKWpF9-5qGjG3qx7E" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/65a477570ff7d4a1cec6bedca555c32d.png" alt="Plot with title “SPlocation”"/></div></div><p>If you just want to plot the features geometry, then you can use <code>sf::st_geometry</code>. You
can use <code>add=TRUE</code> to overplot features and you can use extent to change the spatial
area being plotted. It can be tricky to set the area of the plot so that it will include
all features. One trick here is to get the extent (or bounding box) of the layers you
want to plot and then convert them to polygons using <code>sf::st_as_sfc</code> and then take the
spatial union(<code>sf::st_union</code>) of those boxes. Long-winded but reliable!</p><div id="D2BK1EFuDt" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre"># Get the plot extent as the union of the bounding boxes
plot_extent &lt;- st_union(
  st_as_sfc(st_bbox(nest_boxes)),
  st_as_sfc(st_bbox(silmas_route))
)

# Plot the nest box points and overplot the Silmas route
plot(st_geometry(nest_boxes), col=&quot;forestgreen&quot;, extent=plot_extent)
plot(st_geometry(silmas_route), col=&quot;red&quot;, add=TRUE)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="dYV4I3DxZIBm4jWDpol4I" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/ab8967b6d63b733cbf2bb2ae3fc6ab4f.png" alt="plot without title"/></div></div><h3 id="plotting-raster-data" class="relative group"><span class="heading-text">Plotting raster data</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#plotting-raster-data" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>If you plot a raster object, it will plot each band separately:</p><div id="djGx5f7Q0d" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre"># Plot the 3 bands of the silwood aerial image
names(silwood_aerial) &lt;- c(&quot;Red&quot;, &quot;Green&quot;, &quot;Blue&quot;)
plot(silwood_aerial, nc=3)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="CMqb49kOk4vmW4AqCmhqK" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/1c7a163a843c3b333adeeeacc99c35c7.png" alt="plot without title"/></div></div><p>If you instead want to combine image bands to create a three colour image, then the
<code>terra::plotRGB</code>  can be used to combine 3 bands to generate a colour composite image.
The <code>silwood_aerial</code> image contains the three RGB bands in the correct order, so we can
simply plot it:</p><div id="UozIrqcISX" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre"># Plot the silwood aerial data using the default settings
plotRGB(silwood_aerial)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="yq_yQdW2ZVSUmYQNEwH6x" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/4cf441355b5010624f07456881e68713.png" alt="plot without title"/></div></div><p>If we want to do the same thing with the RGB data from the Sentinel 2 data then we need
to adjust the command to give the bands in the right order and also to set the maximum
scale of the values across the bands.</p><div id="Wz70JCDyqJ" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre"># Plot the Sentinel data, setting the bands and scale
plotRGB(s2_silwood_10m, r=3, g=2, b=1, scale=0.80)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="35Ex1uhK_XjlZiqQqwXlM" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/5e61dc2194cf8f4667cdb4e451ee0e9c.png" alt="plot without title"/></div></div><p>In fact, the L2A Sentinel 2 product provides a True Colour Image (TCI) that orders and
scale the RGB bands to give something closer to expected colour. This can be used with
the default settings.</p><div id="yInNqcE45O" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre"># Load the L2A TCI image for Silwood and plot using defaults.
s2_silwood_tci &lt;- rast(
  &quot;../data/SpatialMethods/sentinel_2/R10m/silwood/T30UXC_20250711T110651_TCI_10m.tiff&quot;
)
plotRGB(s2_silwood_tci)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="f0L2akhSsPfRD_Srowxl_" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/41dcf70fba4b1861cecedecb55293c5f.png" alt="plot without title"/></div></div><p>Alternatively, you can set different bands as inputs to give a “false-colour image”. One
common usage is a <a target="_blank" rel="noreferrer" href="https://custom-scripts.sentinel-hub.com/custom-scripts/sentinel-2/false_color_infrared/" class="">false colour
infrared</a>
image, which swaps from the <code>[R, G, B]</code> bands to <code>[NIR, R, G]</code>. This kind of imagery is
very good at pulling out differences between vegetation (bright red), water (dark) and
urban areas and bare ground (tan or grey).</p><div id="UAgnN01adk" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre"># Plot the Sentinel data, setting the bands and scale
plotRGB(s2_silwood_10m, r=4, g=3, b=2, scale=0.8)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="4IQPwY6zJf5GCJtPwLTsz" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/edddae724d2632173ffa1b69f6a81728.png" alt="plot without title"/></div></div><h2 id="reprojecting-spatial-data" class="relative group"><span class="heading-text">Reprojecting spatial data</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#reprojecting-spatial-data" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>We now have a large number of different datasets, but they are not all in the same GIS
projection. We cannot use the datasets together until they use the same coordinate
system. We will use the “OSGB 1936 / British National Grid” (or BNG) projection for all
of the rest of the practical. It is a projected coordinate system, which means we can
use metres to measure distances, and it is also the standard mapping system for the UK.</p><h3 id="reprojecting-vector-datasets" class="relative group"><span class="heading-text">Reprojecting vector datasets</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#reprojecting-vector-datasets" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>It is relatively easy to reproject vector datasets: all of the features in a vector
dataset are built up from pairs of point. Reprojection is therefore just a matter of
recalculating the coordinates in the new projection - the underlying equation might be
complex but we are just moving points between two systems.</p><p>We can show the current range of coordinates for a dataset by looking at the <strong>extent</strong>
of the data before.</p><div id="PvqHIhtCev" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre"># Show the extent of the sensor locations in the current WGS84 projection
ext(sensor_locations)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="vtksJ6kG6UB3RJPpvHB6E" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div class="myst-jp-safe-output-text font-mono text-sm whitespace-pre-wrap"><code><span>SpatExtent : -0.651972, -0.178122, 51.406849, 51.496483 (xmin, xmax, ymin, ymax)</span></code></div></div></div><p>The <code>sf::st_transform</code> function can then be used to transform data from one projection
to another.</p><div id="iRICtQx3Ks" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre"># Convert the WGS84 vector datasets to BNG
sensor_locations &lt;- st_transform(sensor_locations, crs=&quot;EPSG:27700&quot;)
nest_boxes &lt;- st_transform(nest_boxes, crs=&quot;EPSG:27700&quot;)
silmas_route &lt;- st_transform(silmas_route, crs=&quot;EPSG:27700&quot;)

# Show the new extent
ext(sensor_locations)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="T4D720_2IbFdxwMjmmBfP" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div class="myst-jp-safe-output-text font-mono text-sm whitespace-pre-wrap"><code><span>SpatExtent : 493848.9919019, 526566.980292927, 168404.466202018, 179077.21373909 (xmin, xmax, ymin, ymax)</span></code></div></div></div><h3 id="reprojecting-raster-datasets" class="relative group"><span class="heading-text">Reprojecting raster datasets</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#reprojecting-raster-datasets" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>This is more involved than reprojecting vector data. You have a series of raster cell
values in one projection and then want to insert representative values into a set of
cells on a different projection. The borders of those new cells could have all sorts of
odd relationships to the current ones.</p><p>We can show the issue by superimposing two grids:</p><ul><li><p>A 200 m resolution grid using the extent of the BNG projection datasets for Silwood
(red cells).</p></li><li><p>A very similar 200m grid taken from the extent of the Sentinel 2 data in the UTM30N
projection for the same site and then reprojected into the BNG (grey cells)</p></li></ul><div id="kLM4CnvZww" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose hidden my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre"># Create a BNG raster at 200m resolution for the study site
grid_BNG &lt;- rast(ext(silwood_aerial), res = 200, crs = &quot;EPSG:27700&quot;)
# Convert to an sf polygon dataset of grid cells
grid_BNG &lt;- st_as_sf(as.polygons(grid_BNG))

# Create a UTM30N raster at 200 m resolution for the study site
grid_UTM30N &lt;- rast(ext(s2_silwood_10m), res = 200, crs = &quot;EPSG:32630&quot;)
# Convert to an sf polygon dataset _and_ then transform to BNG
grid_UTM30N &lt;- st_as_sf(as.polygons(grid_UTM30N))
grid_UTM30N_in_BNG &lt;- st_transform(grid_UTM30N, &quot;EPSG:27700&quot;)

# Plot the two sets of grid cells over each other
plot(st_geometry(grid_UTM30N_in_BNG), reset=FALSE, border=&quot;grey&quot;)
plot(st_geometry(grid_BNG), border=&#x27;red&#x27;, add=TRUE)

# Add coordinates on the axes
axis(1)
axis(2)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="DTUexaDR1B5BuSpeujYQD" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/80c797e78385b2075eb80b51a55931dc.png" alt="plot without title"/></div></div><details class="myst-admonition myst-admonition-note my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-blue-500 dropdown"><summary class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-blue-600 bg-blue-50 dark:bg-slate-900 cursor-pointer hover:shadow-[inset_0_0_0px_30px_#00000003] dark:hover:shadow-[inset_0_0_0px_30px_#FFFFFF03]"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-blue-600"><path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Plot source</div><div class="self-center flex-none text-sm font-thin text-neutral-700 dark:text-neutral-200"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none transition-transform details-toggle"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></div></summary><div class="myst-admonition-body px-4 py-1 details-body"><p>In case you are interested in how the plot was created.</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre"># Create a BNG raster at 200m resolution for the study site
grid_BNG &lt;- rast(ext(silwood_aerial), res = 200, crs = &quot;EPSG:27700&quot;)
# Convert to an sf polygon dataset of grid cells
grid_BNG &lt;- st_as_sf(as.polygons(grid_BNG))

# Create a UTM30N raster at 200 m resolution for the study site
grid_UTM30N &lt;- rast(ext(s2_silwood_10m), res = 200, crs = &quot;EPSG:32630&quot;)
# Convert to an sf polygon dataset _and_ then transform to BNG
grid_UTM30N &lt;- st_as_sf(as.polygons(grid_UTM30N))
grid_UTM30N_in_BNG &lt;- st_transform(grid_UTM30N, &quot;EPSG:27700&quot;)

# Plot the two sets of grid cells over each other
plot(st_geometry(grid_UTM30N_in_BNG), reset=FALSE, border=&quot;grey&quot;)
plot(st_geometry(grid_BNG), border=&#x27;red&#x27;, add=TRUE)

# Add coordinates on the axes
axis(1)
axis(2)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div></div></details><p>As you can see, even when the resolutions are the same, there is no neat one-to-one
relationship between the two sets of cells: the axes of the two grids are not exactly
parallel and the coordinates of the cell boundaries are not the same.</p><p>The <code>terra::project</code> function both <strong>converts the coordinates</strong> from one projection to
another and <strong>resamples the data</strong> from one grid to another. There are various methods
to carry out resampling - see the <code>method</code> details in <code>?project</code> but they basically fall
into two groups:</p><ul><li><p>Most are interpolations methods for getting a representative <strong>continuous value</strong> for
each cell from the data in the original raster grid. They range from simple <code>average</code>
values of intersecting cells, to more complex polynomials and splines (e.g <code>cubic</code>)
that use a moving window of a neighbourhood of cells to construct an estimate for the
new cell.</p></li><li><p>Other approaches select a single value from the source grid: the <code>near</code> method takes
the value from the source raster cell closest to the centre of the new cell, and the
<code>mode</code> value takes the modal value of the set of overlapping cells. Both of these
approaches are intended for use with categorical raster data, where it makes no sense
to interpolate values between category codes.</p></li></ul><p>To use the <code>terra::project</code> function, you need to provide a raster with the target
resolution and projection to use as a template. To reproject the Sentinel 2 data, we can
simply use the Land Cover map datasets, which are also have a 10m resolution and have
been cropped to the study area.</p><div id="ILK9fwjV9c" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre">s2_silwood_10m &lt;- project(s2_silwood_10m, silwood_LCM, method=&quot;cubic&quot;)
s2_nhm_10m &lt;- project(s2_nhm_10m, nhm_LCM, method=&quot;cubic&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="411q9bQDH3J-NPXat5ERV" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><aside class="myst-admonition myst-admonition-note my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-blue-500"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-blue-600 bg-blue-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-blue-600"><path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Exercise</div></div><div class="myst-admonition-body px-4 py-1"><p>Repeat this reprojection for the 20 metre resolution Sentinel 2 datasets that you
created earlier (<code>s2_silwood_20m</code> and <code>s2_nhm_20m</code>).</p><p>You should reproject the data to the same 20 metre resolution. We do not have an
existing BNG raster dataset at this resolution, so you will need to make one.</p></div></aside><details class="myst-admonition myst-admonition-tip my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-green-600 dropdown"><summary class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-green-600 bg-green-50 dark:bg-slate-900 cursor-pointer hover:shadow-[inset_0_0_0px_30px_#00000003] dark:hover:shadow-[inset_0_0_0px_30px_#FFFFFF03]"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-green-600"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Show solution</div><div class="self-center flex-none text-sm font-thin text-neutral-700 dark:text-neutral-200"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none transition-transform details-toggle"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></div></summary><div class="myst-admonition-body px-4 py-1 details-body"><div id="v2uEvJHDMX" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre"># Make 20 metre resolution templates for the study sites
silwood_template_20m &lt;- rast(ext(silwood_aerial), res=20, crs=&quot;EPSG:27700&quot;)
nhm_template_20m &lt;- rast(ext(nhm_aerial), res=20, crs=&quot;EPSG:27700&quot;)

# Reproject S2 20m bands into BNG
s2_silwood_20m &lt;- project(s2_silwood_20m, silwood_template_20m, method=&quot;cubic&quot;)
s2_nhm_20m &lt;- project(s2_nhm_20m, nhm_template_20m, method=&quot;cubic&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="C4K1rZ-rifXUN1DVflfru" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div></div></details><h2 id="manipulating-raster-data" class="relative group"><span class="heading-text">Manipulating raster data</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#manipulating-raster-data" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Even once you have raster datasets in the same resolution, it is common to want to
manipulate them to get multiple datasets into the same extent and resolution. This
section covers:</p><ul><li><p>upscaling and downscaling raster resolution,</p></li><li><p>joining adjacent raster tiles into a single dataset,</p></li><li><p>combining raster bands for datasets with the same extent and resolution, and</p></li><li><p>cropping datasets to a smaller extent.</p></li></ul><h3 id="changing-raster-resolution" class="relative group"><span class="heading-text">Changing raster resolution</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#changing-raster-resolution" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>If you want to change the resolution or grid of an existing raster grid <strong>without
changing the projection</strong> then you there are a few options:</p><ul><li><p>If you want to change the grid resolution by a simple factor while keeping the same
basic grid cell alignments and extent, then you can use the <code>terra::aggregate</code> and
<code>terra::disagg</code> functions.</p></li><li><p>If you need to change the grid to a raster resolution that is not a simple factor or
need to move the cell boundaries to match another dataset, then you will need the
<code>terra::resample</code> function. This functions much like <code>terra::project</code> without the
coordinate transformation, and has the same methods for resampling onto the new grid.</p></li></ul><p>Here, we will use disaggregation to resample the 20 metre resolution Sentinel 2 bands to
10 metre resolution. We will use <code>method=bilinear</code> which uses a simple linear model to
assign new cell values; the alternative <code>method=near</code> would simply duplicate the value
from the nearest coarser resolution cell into each of the smaller cells.</p><div id="M2KvHi5WUn" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre">s2_silwood_20m_at_10m &lt;- disagg(s2_silwood_20m, fact=2, method=&quot;bilinear&quot;)
s2_nhm_20m_at_10m &lt;- disagg(s2_nhm_20m, fact=2, method=&quot;bilinear&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="BoAXDa5YDT7CoUngrYPF9" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><p>We can use the <code>terra::res</code> function to show the resolutions of the two versions.</p><div id="pEJ9lcGLoY" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre">print(res(s2_silwood_20m))
print(res(s2_silwood_20m_at_10m))</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="PGJfS2xzIrzwcqX3Im0lT" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>[1] 20 20
</span></code></pre></div><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>[1] 10 10
</span></code></pre></div></div></div><aside class="myst-admonition myst-admonition-tip my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-green-600 tip"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-green-600 bg-green-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-green-600"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Stretch goal: projecting Sentinel 2 to 10m resolution</div></div><div class="myst-admonition-body px-4 py-1"><p>We could also have got the 20 metre resolution Sentinel 2 bands resampled to 10 metres
using  only the <code>terra::project</code> function. See if you can generate
<code>s2_silwood_20m_direct_to_10m</code> and <code>s2_nhm_20m_direct_to_10m</code> using only that function.</p></div></aside><details class="myst-admonition myst-admonition-tip my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-green-600 dropdown"><summary class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-green-600 bg-green-50 dark:bg-slate-900 cursor-pointer hover:shadow-[inset_0_0_0px_30px_#00000003] dark:hover:shadow-[inset_0_0_0px_30px_#FFFFFF03]"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-green-600"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Show solution</div><div class="self-center flex-none text-sm font-thin text-neutral-700 dark:text-neutral-200"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none transition-transform details-toggle"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></div></summary><div class="myst-admonition-body px-4 py-1 details-body"><div id="hPHEnW5CBR" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre"># It is actually very easy - we can just use the existing 10m CEH Land Cover Map
# datasets as the resampling template.
s2_silwood_20m_direct_to_10m &lt;- project(
  s2_silwood_20m, silwood_lcm, method=&quot;cubic&quot;
)
s2_nhm_20m_direct_to_10m &lt;- project(
  s2_nhm_20m, nhm_lcm, method=&quot;cubic&quot;
)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="leBG_QYSN3-tYNTeQXV5r" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div></div></details><h3 id="mosaicing-rasters" class="relative group"><span class="heading-text">Mosaicing rasters</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#mosaicing-rasters" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>We can <strong>mosaic</strong> the two panes of Terrain 5 data for each site from two 5km panes into
a single rectangle of data. The two panes are side by side for Silwood and one above the
other for the NHM. The plot below shows the 5 x 5 km extent of the two panes. The figure
also shows the 3 x 3 km extent of the other data sources - as you can see it overlaps
the Terrain 5 panes for both sites, which is why we needed to load two panes.</p><div id="tiEgkpKMvU" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose hidden my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre">options(repr.plot.height=4)

par(mfrow=c(1,2))

# Calculate the union of the extents of the two rasters
silwood_dtm_extent &lt;- union(ext(silwood_dtm_SU96NE), ext(silwood_dtm_SU96NW ))

# Plot the extent of the first raster, but using the extent of both datasets
plot(ext(silwood_dtm_SU96NE), border=&quot;blue&quot;, ext=silwood_dtm_extent, main=&quot;Silwood&quot;)

# Get the middle coordinates of the raster and add a label. The `xFromCol` and 
# `yFromRow` functions extract the X and Y coordinates of cell centres from the 
# raster and `mean` then gives the centre of the raster image.
text(
  x=mean(xFromCol(silwood_dtm_SU96NE)), 
  y=mean(yFromRow(silwood_dtm_SU96NE)),
  labels=&quot;SU96NE&quot;, col=&quot;blue&quot;
)

# Use `add=TRUE` to add the extent of the second raster and add the label
plot(ext(silwood_dtm_SU96NW), border=&quot;red&quot;, add=TRUE)
text(
  x=mean(xFromCol(silwood_dtm_SU96NW)), 
  y=mean(yFromRow(silwood_dtm_SU96NW)),
  labels=&quot;SU96NW&quot;, col=&quot;red&quot;
)

# Finally add the extent of the other raster datasets 
plot(ext(silwood_aerial), border=&quot;black&quot;, add=TRUE)

# Repeat for the NHM datasets
nhm_dtm_extent &lt;- union(ext(nhm_dtm_TQ27NE), ext(nhm_dtm_TQ28SE))

plot(ext(nhm_dtm_TQ27NE), border=&quot;blue&quot;, ext=nhm_dtm_extent, main=&quot;NHM&quot;)
text(
  x=mean(xFromCol(nhm_dtm_TQ27NE)), 
  y=mean(yFromRow(nhm_dtm_TQ27NE)),
  labels=&quot;TQ27NE&quot;, col=&quot;blue&quot;
)
plot(ext(nhm_dtm_TQ28SE), border=&quot;red&quot;, add=TRUE)
text(
  x=mean(xFromCol(nhm_dtm_TQ28SE)), 
  y=mean(yFromRow(nhm_dtm_TQ28SE)),
  labels=&quot;TQ28SE&quot;, col=&quot;red&quot;
)
plot(ext(nhm_aerial), border=&quot;black&quot;, add=TRUE)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="wMQ0p7GGa6M9zK0XuM5yf" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/4d499388b40f1f64148ab7880c92258b.png" alt="Plot with title “”"/></div></div><details class="myst-admonition myst-admonition-note my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-blue-500 dropdown"><summary class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-blue-600 bg-blue-50 dark:bg-slate-900 cursor-pointer hover:shadow-[inset_0_0_0px_30px_#00000003] dark:hover:shadow-[inset_0_0_0px_30px_#FFFFFF03]"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-blue-600"><path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Show source code for plot</div><div class="self-center flex-none text-sm font-thin text-neutral-700 dark:text-neutral-200"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none transition-transform details-toggle"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></div></summary><div class="myst-admonition-body px-4 py-1 details-body"><p>The plot above uses a few useful plotting tricks for spatial data:</p><ul><li><p>changing the spatial extent of the plot to include more than one dataset,</p></li><li><p>adding mutiple layers to a spatial plot, and</p></li><li><p>using coordinates to add text.</p></li></ul><p>You do not need to know these details for the practical, but this might be something to
come back to and look at.</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre">options(repr.plot.height=4)

par(mfrow=c(1,2))

# Calculate the union of the extents of the two rasters
silwood_dtm_extent &lt;- union(ext(silwood_dtm_SU96NE), ext(silwood_dtm_SU96NW ))

# Plot the extent of the first raster, but using the extent of both datasets
plot(ext(silwood_dtm_SU96NE), border=&quot;blue&quot;, ext=silwood_dtm_extent, main=&quot;Silwood&quot;)

# Get the middle coordinates of the raster and add a label. The `xFromCol` and 
# `yFromRow` functions extract the X and Y coordinates of cell centres from the 
# raster and `mean` then gives the centre of the raster image.
text(
  x=mean(xFromCol(silwood_dtm_SU96NE)), 
  y=mean(yFromRow(silwood_dtm_SU96NE)),
  labels=&quot;SU96NE&quot;, col=&quot;blue&quot;
)

# Use `add=TRUE` to add the extent of the second raster and add the label
plot(ext(silwood_dtm_SU96NW), border=&quot;red&quot;, add=TRUE)
text(
  x=mean(xFromCol(silwood_dtm_SU96NW)), 
  y=mean(yFromRow(silwood_dtm_SU96NW)),
  labels=&quot;SU96NW&quot;, col=&quot;red&quot;
)

# Finally add the extent of the other raster datasets 
plot(ext(silwood_aerial), border=&quot;black&quot;, add=TRUE)

# Repeat for the NHM datasets
nhm_dtm_extent &lt;- union(ext(nhm_dtm_TQ27NE), ext(nhm_dtm_TQ28SE))

plot(ext(nhm_dtm_TQ27NE), border=&quot;blue&quot;, ext=nhm_dtm_extent, main=&quot;NHM&quot;)
text(
  x=mean(xFromCol(nhm_dtm_TQ27NE)), 
  y=mean(yFromRow(nhm_dtm_TQ27NE)),
  labels=&quot;TQ27NE&quot;, col=&quot;blue&quot;
)
plot(ext(nhm_dtm_TQ28SE), border=&quot;red&quot;, add=TRUE)
text(
  x=mean(xFromCol(nhm_dtm_TQ28SE)), 
  y=mean(yFromRow(nhm_dtm_TQ28SE)),
  labels=&quot;TQ28SE&quot;, col=&quot;red&quot;
)
plot(ext(nhm_aerial), border=&quot;black&quot;, add=TRUE)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div></div></details><p>We use the <code>terra::mosaic</code> function to combine these two panes into a single dataset for
each site. There is also the <code>terra::merge</code> function: this is used to combine aligned
raster datasets that are not simply neatly adjoining tiles. It also make life easier if
we update these datasets so they use the same raster layer name - they currently are
named by BNG grid pane.</p><div id="mfFLmdlAXt" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre"># Mosaic the two Terrain 5 panes into a single dataset
silwood_dtm &lt;- mosaic(silwood_dtm_SU96NE, silwood_dtm_SU96NW)
nhm_dtm &lt;- mosaic(nhm_dtm_TQ27NE, nhm_dtm_TQ28SE)

# Update the raster layer names
names(silwood_dtm) &lt;- names(nhm_dtm) &lt;- &quot;Elevation&quot;</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="0sHcvytyuB-VzDMLzuI58" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><p>We can check the extents to show what happened - the new Silwood terrain dataset now has
a 10km extent in the X dimension.</p><div id="ejNXcwO08E" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre">print(ext(silwood_dtm_SU96NE))
print(ext(silwood_dtm_SU96NW))
print(ext(silwood_dtm))</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="rfEaScCjVPTOsEyV8VJYU" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>SpatExtent : 495000, 5e+05, 165000, 170000 (xmin, xmax, ymin, ymax)
</span></code></pre></div><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>SpatExtent : 490000, 495000, 165000, 170000 (xmin, xmax, ymin, ymax)
</span></code></pre></div><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>SpatExtent : 490000, 5e+05, 165000, 170000 (xmin, xmax, ymin, ymax)
</span></code></pre></div></div></div><h3 id="combining-raster-bands" class="relative group"><span class="heading-text">Combining raster bands</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#combining-raster-bands" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>We can also combine rasters with the same resolution and grid to add more bands onto an
existing dataset. We can do this to create a new Sentinel 2 dataset that includes the
original 10 metre resolution bands and the 20 metre bands that we resampled to 10
metres. The <code>terra</code> package takes the standard <code>c()</code> function for combining R vectors
and lists and extends that to join raster layers by band.</p><div id="pHIBFMlrUd" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre"># Combine the S2 10m bands with the resampled 20 m bands.
s2_silwood_10m &lt;- c(s2_silwood_10m, s2_silwood_20m_at_10m)
s2_nhm_10m &lt;- c(s2_nhm_10m, s2_nhm_20m_at_10m)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="Pq_imm9C97G7s-8KV6Kbi" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><h3 id="cropping-rasters" class="relative group"><span class="heading-text">Cropping rasters</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#cropping-rasters" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>You can reduce the size of a raster dataset to a particular area of interest using the
<code>terra::crop</code> function. We will use this to extract the 3km area of interest from the
newly mosaiced datasets. All we need to provide is another dataset that has the required
extent.</p><div id="gdxemUABIx" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre"># Crop the mosaiced DTM data to the 3km area of interest.
silwood_dtm &lt;- crop(silwood_dtm, silwood_aerial)
nhm_dtm &lt;- crop(nhm_dtm, nhm_aerial)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="w0UZD_rvQNUrNvxYFg7Tc" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><p>We can again check the extents of the resulting grids to check that they match:</p><div id="HQ4MpI9FVn" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre"># Crop the mosaiced DTM data to the 3km area of interest.
print(ext(silwood_dtm))
print(ext(silwood_aerial))</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="5e3V4Icefv6Jvg73rxjlB" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>SpatExtent : 493000, 496000, 167000, 170000 (xmin, xmax, ymin, ymax)
</span></code></pre></div><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>SpatExtent : 493000, 496000, 167000, 170000 (xmin, xmax, ymin, ymax)
</span></code></pre></div></div></div><h2 id="manipulating-vector-data" class="relative group"><span class="heading-text">Manipulating vector data</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#manipulating-vector-data" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Vector data manipulation is generally either to merge two datasets or to crop data to a
smaller spatial extent.</p><h3 id="merging-vector-data" class="relative group"><span class="heading-text">Merging vector data</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#merging-vector-data" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Vector data is easier to merge in some ways: because the coordinates are recorded
as sets of point forming features, you don’t have to worry about cell alignment or
resolution. However, to merge a set of spatial features:</p><ul><li><p>The two datasets have to have the same attributes: the data associated with each
feature needs to match.</p></li><li><p>The two datasets have to be in the same projection.</p></li></ul><p>Provided these two things are true, then merging two vector datasets is basically the
same as binding together the rows of two data frames with the same structure. The <code>sf</code>
package provides a version of the <code>rbind</code> function that joins two <code>sf</code> objects, and we
can use this to combine the two VML panes for the sites.</p><div id="l020ISTN2H" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre"># Combine the road panes
silwood_VML_roads &lt;- rbind(vml_su96ne_roads, vml_su96nw_roads)
nhm_VML_roads &lt;- rbind(vml_tq28se_roads, vml_tq27ne_roads)

# Combine the water area panes
silwood_VML_water &lt;- rbind(vml_su96ne_water, vml_su96nw_water)
nhm_VML_water &lt;- rbind(vml_tq28se_water, vml_tq27ne_water)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="WyzDQmvmlWWzM9t_WKEB4" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><p>If we plot the extents of the new combined data (grey) and the source panes (red and
blue) for Silwood, you can see that the panes are not neatly aligned with actual BNG
grid cell bounds used by the elevation data (dashed panes). Raster cells by definition
fall onto a neat grid, but vector features cross boundaries and it is common for
datasets to include features that fall outside the strict pane boundaries.</p><div id="i3w05opMWb" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre"># Merged data
plot(st_as_sfc(st_bbox(silwood_VML_roads)), border=&#x27;grey&#x27;, lwd=4)

# SU96NW panes of vector (solid) and raster (dashed) data
plot(st_as_sfc(st_bbox(vml_su96nw_roads)), border=&#x27;blue&#x27;, add=TRUE)
plot(st_as_sfc(st_bbox(silwood_dtm_SU96NW)), border=&#x27;blue&#x27;, add=TRUE, lty=2)

# SU96NE panes of vector (solid) and raster (dashed) data
plot(st_as_sfc(st_bbox(vml_su96ne_roads)), border=&#x27;red&#x27;, add=TRUE)
plot(st_as_sfc(st_bbox(silwood_dtm_SU96NE)), border=&#x27;red&#x27;, add=TRUE, lty=2)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="YLLoG6DHXGkBxt3FkV1xI" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/894d644252b57c6884559fbf3d2b210c.png" alt="plot without title"/></div></div><h3 id="cropping-vector-data" class="relative group"><span class="heading-text">Cropping vector data</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#cropping-vector-data" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>We can crop the VML data down to the study site using the <code>sf::st_crop</code> function. It is
usually faster and easier to reduce datasets to only the focal area you are working
with.</p><div id="MyLz696Wew" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre"># Crop the two vector datasets
silwood_VML_roads &lt;- st_crop(silwood_VML_roads, silwood_aerial)
nhm_VML_roads &lt;- st_crop(nhm_VML_roads, nhm_aerial)
silwood_VML_water &lt;- st_crop(silwood_VML_water, silwood_aerial)
nhm_VML_water &lt;- st_crop(nhm_VML_water, nhm_aerial)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="-KmOFTCmEmLRNhvxDsS--" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>Warning message:
“attribute variables are assumed to be spatially constant throughout all geometries”
</span></code></pre></div><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>Warning message:
“attribute variables are assumed to be spatially constant throughout all geometries”
</span></code></pre></div><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>Warning message:
“attribute variables are assumed to be spatially constant throughout all geometries”
</span></code></pre></div><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>Warning message:
“attribute variables are assumed to be spatially constant throughout all geometries”
</span></code></pre></div></div></div><p>We can now create a simple plot overlaying the vector roads and water over the top of
the digital elevations maps, again using <code>sf::st_geometry</code> to just show the geometries
of the vector features.</p><div id="KqXXwzm1IN" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre">par(mfrow=c(1, 2))

plot(silwood_dtm, col=grey.colors(20), main=&quot;Silwood&quot;)
plot(st_geometry(silwood_VML_roads), col=&quot;firebrick&quot;, add = TRUE)
plot(st_geometry(silwood_VML_water), col=&quot;cornflowerblue&quot;, border=NA, add = TRUE)

plot(nhm_dtm, col=grey.colors(20), main=&quot;NHM&quot;)
plot(st_geometry(nhm_VML_roads), col=&quot;firebrick&quot;, add = TRUE)
plot(st_geometry(nhm_VML_water), col=&quot;cornflowerblue&quot;, border=NA, add = TRUE)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="66lXR7-gvqYQgKslscFtN" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/4a5bd97d889d3e8a3f57aa1da26e88c9.png" alt="plot without title"/></div></div><h2 id="raster-calculations" class="relative group"><span class="heading-text">Raster calculations</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#raster-calculations" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>A layer in a continuous raster dataset is basically just a large numeric matrix. This
means you can use raster layers in equations to calulate new composite indices that
emphasize different parts of the spectral signal. There are a very large number of
remote sensing indices and the <a target="_blank" rel="noreferrer" href="https://custom-scripts.sentinel-hub.com/custom-scripts/sentinel/sentinel-2/" class="">Sentinel-Hub scripts
site</a>
provides formulae for a wide range of options. Here we will look at two simple
vegetation indices.</p><h3 id="ndvi" class="relative group"><span class="heading-text">NDVI</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#ndvi" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>The normalised difference vegetation index (NDVI) is defined as:</p><div id="vHxfJShoEE" class="flex my-5 group"><div class="flex-grow overflow-x-auto overflow-y-hidden"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>N</mi><mi>D</mi><mi>V</mi><mi>I</mi><mo>=</mo><mfrac><mrow><mtext>NIR</mtext><mo>−</mo><mtext>RED</mtext></mrow><mrow><mtext>NIR</mtext><mo>+</mo><mtext>RED</mtext></mrow></mfrac></mrow><annotation encoding="application/x-tex">NDVI = \frac{\text{NIR} - \text{RED}}{\text{NIR} + \text{RED}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.1297em;vertical-align:-0.7693em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord">NIR</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord text"><span class="mord">RED</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord">NIR</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord text"><span class="mord">RED</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></div><div class="relative self-center flex-none pl-2 m-0 text-right select-none"><a class="no-underline text-inherit hover:text-inherit text-inherit hover:text-inherit select-none hover:underline" href="#vHxfJShoEE" title="Link to this Equation" aria-label="Link to this Equation">(<!-- -->1<!-- -->)</a></div></div><p>where NIR is band data for the near infrared and RED is band data in the red spectrum,
which are Sentinel 2 bands B8 and B4. The index returns values from -1 (water) through 0
(rock and bare ground) to 1 (rainforest). See <a target="_blank" rel="noreferrer" href="https://custom-scripts.sentinel-hub.com/sentinel-2/ndvi/" class="">the Sentinel-Hub NDVI script page for
more details</a>.</p><div id="yFuAXiRQbd" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre"># Calculate the NDVI index for the two sites
ndvi_nhm &lt;- (
  s2_nhm_10m[[&quot;NIR&quot;]] - s2_nhm_10m[[&quot;R&quot;]]) / 
  (s2_nhm_10m[[&quot;NIR&quot;]] + s2_nhm_10m[[&quot;R&quot;]]
)
ndvi_silwood &lt;- (
  s2_silwood_10m[[&quot;NIR&quot;]] - s2_silwood_10m[[&quot;R&quot;]]) / 
  (s2_silwood_10m[[&quot;NIR&quot;]] + s2_silwood_10m[[&quot;R&quot;]]
)
# Rename the single band 
names(ndvi_silwood) &lt;- names(ndvi_nhm) &lt;- &quot;NDVI&quot;

# Plot the NDVI index data
par(mfrow=c(1, 2))
plot(ndvi_silwood)
plot(ndvi_nhm)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="AGkxW_E4p2oHXKIrg9gHM" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/3f00cef70fb4e794a355fdf60b1d44db.png" alt="plot without title"/></div></div><h3 id="evi" class="relative group"><span class="heading-text">EVI</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#evi" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>The enhanced vegetation index (EVI) is very similar but includes scaling factors and
uses the Blue band (Sentinel B2) to improve how well the index captures vegetation. The
scale again extends from -1 to 1. See <a target="_blank" rel="noreferrer" href="https://custom-scripts.sentinel-hub.com/sentinel-2/evi/" class="">the Sentinel-Hub EVI script page for
more details</a>.</p><div id="dG7t9vKVlE" class="flex my-5 group"><div class="flex-grow overflow-x-auto overflow-y-hidden"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>E</mi><mi>V</mi><mi>I</mi><mo>=</mo><mn>2.5</mn><mo>⋅</mo><mrow><mo fence="true">(</mo><mfrac><mrow><mtext>NIR</mtext><mo>−</mo><mtext>RED</mtext></mrow><mrow><mtext>NIR</mtext><mo>+</mo><mn>6</mn><mo>⋅</mo><mtext>RED</mtext><mo>−</mo><mn>7.5</mn><mo>⋅</mo><mtext>BLUE</mtext><mo>+</mo><mn>1</mn></mrow></mfrac><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">EVI = 2.5 \cdot \left( \frac{\text{NIR} - \text{RED}}
  {\text{NIR} + 6 \cdot \text{RED} - 7.5 \cdot \text{BLUE} + 1} \right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2.5</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord">NIR</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">6</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord text"><span class="mord">RED</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">7.5</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord text"><span class="mord">BLUE</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord">NIR</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord text"><span class="mord">RED</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span></span></span></span></span></div><div class="relative self-center flex-none pl-2 m-0 text-right select-none"><a class="no-underline text-inherit hover:text-inherit text-inherit hover:text-inherit select-none hover:underline" href="#dG7t9vKVlE" title="Link to this Equation" aria-label="Link to this Equation">(<!-- -->2<!-- -->)</a></div></div><div id="ayySQo1ypB" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre"># Calculate the EVI index for the two sites
evi_nhm &lt;- 2.5 * 
  (s2_nhm_10m[[&quot;NIR&quot;]] - s2_nhm_10m[[&quot;R&quot;]]) / 
  (s2_nhm_10m[[&quot;NIR&quot;]] + 
    6 * s2_nhm_10m[[&quot;R&quot;]] - 
    7.5 * s2_nhm_10m[[&quot;B&quot;]] + 1)
  
evi_silwood &lt;- 2.5 * 
  (s2_silwood_10m[[&quot;NIR&quot;]] - s2_silwood_10m[[&quot;R&quot;]]) / 
  (s2_silwood_10m[[&quot;NIR&quot;]] + 
    6 * s2_silwood_10m[[&quot;R&quot;]] - 
    7.5 * s2_silwood_10m[[&quot;B&quot;]] + 1)

# Rename the single band 
names(evi_silwood) &lt;- names(evi_nhm) &lt;- &quot;EVI&quot;</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="xJQ_8Dpbqc33H80z0IWll" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><p>There is an issue with the EVI data for the NHM site: there are some anomalous high
values in the satellite data that lead to extreme EVI values. You can see these local
issues as hotspots if you try plotting these bands (e.g. <code>plot(s2_nhm_10m[[&quot;NIR&quot;]])</code>).
We can fix that problem by setting extreme values to <code>NA</code> - this is another useful
method for manipulating raster data.</p><div id="ZQmX1om5Jd" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre"># Remove anomalous EVI values
evi_nhm[evi_nhm &gt; 1] &lt;- NA
evi_nhm[evi_nhm &lt; -1] &lt;- NA</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="HgWYgl4cXaav9PzyjD_Ox" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><p>Now we can plot the EVI maps.</p><div id="bBa8jKWWPf" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre"># Plot the EVI index data
par(mfrow=c(1, 2))
plot(evi_silwood)
plot(evi_nhm)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="OjBa5P8KTI2N7aLZQMySa" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/1ff462089c8065cf45374b000c933935.png" alt="plot without title"/></div></div><h2 id="sampling-from-raster-datasets" class="relative group"><span class="heading-text">Sampling from raster datasets</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#sampling-from-raster-datasets" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>A common need in spatial analysis is to get raster values from locations: for example,
what are the EVI values at the nest box locations, or what are the heights of the sensor
location sites. We can do this using the <code>terra::extract</code> function, which takes a raster
and a vector dataset and returns the cell values under the vector features.</p><h3 id="point-features" class="relative group"><span class="heading-text">Point features</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#point-features" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>With point features this is very easy - you get the values under each point.</p><div id="jpcoHbPBSK" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre"># Extract the EVI values under the nest boxes
nest_box_evi &lt;- extract(evi_silwood, nest_boxes)
hist(nest_box_evi$EVI)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="6krkX0a0wPQoaAKSWvQLM" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/bd3ef93ea390c5879505596401e9b175.png" alt="Plot with title “Histogram of nest_box_evi$EVI”"/></div></div><p>It is a little more difficult for the sensors because the heights are in two different
datasets, so we need to use extract twice and then combine the results. The
<code>terra::extract</code> function returns a row with NA if there is no data for a site, so we
can merge the data simply by joining the two datasets together and dropping the NA rows.</p><div id="YrVeFKEH0O" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre"># Extract the heights at the two sites
sensor_elevations_silwood &lt;- extract(silwood_dtm, sensor_locations)
sensor_elevations_nhm &lt;- extract(nhm_dtm, sensor_locations)

# Combine the values from the two rasters and drop to the combined data
sensor_elevations &lt;- na.omit(rbind(sensor_elevations_silwood, sensor_elevations_nhm))

# Show the data
head(sensor_elevations)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="c_qCGndw0S7wCDW6RxX_2" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><h3 id="line-features" class="relative group"><span class="heading-text">Line features</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#line-features" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>You might also want to know what the values under a line feature are: either because you
want a distribution of those values, or possible because you want a sequence of values
<em>along</em> the feature. These two things are different - we’ll look at them using the
Silmas walk/run route.</p><p>If we just use extract with the line features, then <code>terra::extract</code> returns the values
of all of the cells that the line touches. The values are not in sequence along the line
feature - they are just all the values it touches. We can see the cells that are being
selected by <strong>rasterising</strong> the route.</p><div id="qn7xmvrPsV" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre"># Extract the heights under the Silmas route
silmas_heights &lt;- extract(silwood_dtm, silmas_route, xy=TRUE)

par(mfrow=c(1,2))
# Convert the Silmas route into a raster to show the sampled cells
silmas_route_raster &lt;- rasterize(silmas_route, silwood_dtm)
plot(silwood_dtm, col=grey.colors(20))
plot(silmas_route_raster, col=&quot;red&quot;, add=TRUE, legend=FALSE)

# Show the height distribution of all the cells that the route crosses
hist(silmas_heights$Elevation, xlab = &quot;Elevation of Silmas route cells (m)&quot;, main=&quot;&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="POSySw-BB-xymhiUNcg_Q" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/0f732e910a1c8c172e6bc8ac19bcdbc1.png" alt="Plot with title “”"/></div></div><p>If you want to get a <em>sequence of values along a linear feature</em> then you need to
extract the values in order. To do this, you need to convert the linear feature to
points by <strong>casting</strong> it to the simpler feature type. This gives us a warning that
basically just says that it is assigning the attributes for the whole linear feature to
each and every point, and that might not be sensible. If the points are very spaced out,
you can use <code>sf::st_segmentize</code> to interpolate more points along the feature.</p><div id="aJdhraUVCV" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre">silmas_points &lt;- st_cast(silmas_route, &quot;POINT&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="WohPN8jsDuuICstUffBX1" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>Warning message in st_cast.sf(silmas_route, &quot;POINT&quot;):
“repeating attributes for all sub-geometries for which they may not be constant”
</span></code></pre></div></div></div><p>We can now use <code>terra::extract</code> on the points to get the heights in sequence. We can
also use Pythagoras’ theorem to get the cumulative distance along the route from the
coordinates.</p><div id="XVWtMtu3gm" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre"># Get the height of each GPS point along the route
silmas_heights &lt;- extract(silwood_dtm, silmas_points)

# Get the coordinates of the points and use Pythagoras to ge the distance.
coords &lt;- as.data.frame(st_coordinates(silmas_points))
coords$distance &lt;- c(0, sqrt(diff(coords$X)**2 + diff(coords$Y)**2))
coords$total_distance &lt;- cumsum(coords$distance)
coords$height &lt;-silmas_heights$Elevation

# Plot the height profile of the Silmas walk
plot(height~ total_distance, data=coords, type=&quot;l&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="3h8i125FZfLASb2GukERQ" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/af39057b286072859cacde457eb63811.png" alt="plot without title"/></div></div><h3 id="polygon-features" class="relative group"><span class="heading-text">Polygon features</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#polygon-features" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>It is extremely common to want to get a distribution or summary statistic of raster
values within a polygon feature: for example, what is the average elevation within 50
metres of each of the sensor locations? The first thing to do is to get polygons that
form a 50m radius circle around each sensor locations using the <code>sf::st_buffer</code>
function.</p><div id="SSYAP5EPU0" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre"># Get 50m radius polygons around the sensor points
sensor_locations_50 &lt;- st_buffer(sensor_locations, 50)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="UJWNAFqSA4CsokikV8azG" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><p>You can use <code>sf::st_buffer</code> with any features to get polygons extending out from the
feature, and you can in fact use negative distances to get polygons <em>within</em> existing
polygons. We can then use the polygon features with <code>terra::extract</code> to get a data frame
of the values from the digital elevation map associated with each sensor location. We
again need to join the results from the two sites together and drop any NA rows.</p><div id="cxeEDZsUhm" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre"># Get the values within the 50m buffer for each sensor location, 
silwood_sensor_heights &lt;- extract(silwood_dtm, sensor_locations_50)
nhm_sensor_heights &lt;- extract(nhm_dtm, sensor_locations_50)
sensor_heights &lt;- na.omit(rbind(silwood_sensor_heights, nhm_sensor_heights))

# How many values per site?
table(sensor_heights$ID)

# Height variation between sensors
boxplot(Elevation ~ ID, data= sensor_heights)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="5GyGunvN7oyCYEJsmLDcd" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div class="myst-jp-safe-output-text font-mono text-sm whitespace-pre-wrap"><code><span>
  1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18 
314 314 315 313 311 313 311 313 315 315 311 311 313 316 313 316 313 313 </span></code></div><img src="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/4c4f22722a7093553e5c2aa4c58a398c.png" alt="plot without title"/></div></div><p>We can also extract data from categorical rasters:</p><div id="gp7cO6BhEU" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre"># Get the values within the 50m buffer for each sensor location, 
silwood_sensor_LCM &lt;- extract(silwood_LCM, sensor_locations_50)
nhm_sensor_LCM &lt;- extract(nhm_LCM, sensor_locations_50)
sensor_LCM &lt;- na.omit(rbind(silwood_sensor_LCM, nhm_sensor_LCM))

# Land cover class counts within 50m of each sensor.
xtabs(~ LandCover + ID, data= sensor_LCM, drop.unused.levels=TRUE)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="nQwyXKFep2diPBl-xm6Q6" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div class="myst-jp-safe-output-text font-mono text-sm whitespace-pre-wrap"><code><span>                      ID
LandCover               1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18
  Broadleaved woodland 50 51 44 11 18  0 68 78 77 46 69 68  1 75  0  5  5  5
  Coniferous woodland   0 26  3  0  1  0  0  0  0  8  4  0  0  0  0  0  0  0
  Arable                0  0  0  0  0  0  0  0  0  0  0  0  0  0  1  1  2  2
  Improved grassland   19  0 11 66  0  0  7  0  0 13  0  9  0  4  0  0  0  0
  Neutral grassland     0  0  1  0  0  0  4  0  0  0  0  3  0  0  0  0  0  0
  Heather and shrub     2  1  0  0  0  0  0  0  0  2  1  0  0  0  0  0  0  0
  Freshwater            0  0 18  0  0  0  0  0  0  0  4  0  0  0  0  0  0  0
  Urban                 1  0  0  0  0 14  0  0  0  0  0  0 14  0 69 67 54 48
  Suburban              4  3  0  0 60 64  0  0  0  6  0  0 60  0  8  8 16 23</span></code></div></div></div><aside class="myst-admonition myst-admonition-note my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-blue-500"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-blue-600 bg-blue-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-blue-600"><path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Side note</div></div><div class="myst-admonition-body px-4 py-1"><p>As a sidenote, the standard way this works is to use the <code>terra::rasterize</code> function to
find all of the raster cells where the cell centre falls within a polygon feature, but
you can optionally choose to also include any cells that the cell boundary touches,
using the <code>touches=TRUE</code> setting. The plot below shows the two alternatives for a single
sensor polygon.</p></div></aside><div id="vdeRidi3Un" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><details class="myst-dropdown rounded-md my-5 shadow dark:shadow-2xl dark:shadow-neutral-900 overflow-hidden bg-gray-50 dark:bg-stone-800"><summary class="myst-dropdown-header m-0 text-lg font-medium py-1 min-h-[2em] pl-3 cursor-pointer hover:shadow-[inset_0_0_0px_30px_#00000003] dark:hover:shadow-[inset_0_0_0px_30px_#FFFFFF03] bg-gray-100 dark:bg-slate-900"><span class="myst-dropdown-header-title text-neutral-900 dark:text-white"><span class="block float-right text-sm font-thin text-neutral-700 dark:text-neutral-200"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="myst-dropdown-header-icon inline-block pl-2 mr-2 -translate-y-[1px] details-toggle transition-transform"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></span>Source</span></summary><div class="myst-dropdown-body px-4 py-1 details-body"><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre"># Create an extent around a single sensor
zoom_to_site_one &lt;- ext(c(493835,  493955, 169200, 169330))

# Rasterize using the two methods
cell_touches_false &lt;- rasterize(sensor_locations_50[1,], silwood_dtm)
cell_touches_true &lt;- rasterize(sensor_locations_50[1,], silwood_dtm, touches=TRUE)

# Plot side by side as DTM overplotted with rasterized polygon and polygon border
par(mfrow=c(1,2))

plot(
  silwood_dtm, ext=zoom_to_site_one, legend=FALSE, 
  col=gray.colors(20), main=&quot;touches=FALSE&quot;
)
plot(cell_touches_false, add=TRUE, legend=FALSE, col=&quot;firebrick&quot;)
plot(st_geometry(sensor_locations_50[1,]), col=NA, add=TRUE)

plot(
  silwood_dtm, ext=zoom_to_site_one, legend=FALSE, 
  col=gray.colors(20), main=&quot;touches=TRUE&quot;
)
plot(cell_touches_true, add=TRUE, legend=FALSE, col=&quot;firebrick&quot;)
plot(st_geometry(sensor_locations_50[1,]), col=NA, add=TRUE)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div></div></details><div data-mdast-node-id="MpAAKumlT5NP3wtkAH5uw" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/96a0494f4dd28bf5b720ffe56e521f3c.png" alt="plot without title"/></div></div><h3 id="zonal-statistics" class="relative group"><span class="heading-text">Zonal statistics</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#zonal-statistics" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>You can also sample from a raster dataset using another raster dataset. In practice,
this is what is happening when you extract data from a vector feature - the different
features get converted into raster layers in order to identify which cells to extract.
But if you already have a categorical raster, you can simply use the <code>terra::zonal</code>
function to extract the values under each raster cateogory.</p><div id="rWU3Zc4NFj" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre"># Extract the EVI values for each LCM raster cell
evi_by_LCM &lt;- zonal(evi_silwood, silwood_LCM, wide=FALSE)
head(evi_by_LCM)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="txtsk2ljDTGtxLjeZn2PZ" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><p>We can then visualise the range of EVI values by land cover class:</p><div id="URNah3Y3FC" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre">par(mar = c(4,12,1,1))
plot(EVI ~ as.factor(LandCover), data=evi_by_LCM, horizontal=TRUE, las=1, xlab=&quot;&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="YSZQsIUY9zIAIjNbrWe2W" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/421499d09bfdfb32dbf3ac20721a528d.png" alt="plot without title"/></div></div><h2 id="image-classification" class="relative group"><span class="heading-text">Image classification</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#image-classification" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>We already have the CEH Land Cover map, but we may be able to get a better local model
of land cover by classifying the Sentinel 2 data. Image classification is the process of
taking spectral data from an image and identifying particular spectral signatures
(combinations of values in the different bands) with a land cover category. You <em>can</em>
classify simple RGB images, but it is often better to use data with more spectral bands:
as we saw with the false colour infrared image, some bands are great at picking out
particular features.</p><h3 id="unsupervised-classification" class="relative group"><span class="heading-text">Unsupervised classification</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#unsupervised-classification" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Unsupervised classification tries to extract clusters of spectral signatures from the
data. There are many approaches, but the basic aim of the algorithms is to try and find
sets of points in the image that have similar spectral signatures.</p><p>Here we will use the base R <code>stats::kmeans</code> function to carry out k-means clustering on
the data. The <code>k</code> of the k-means is the number of clusters we want to identify, and here
we are letting the algorithm pick 10 random starting points from with the image spectra
and then iterating to try and find stable sets of clusters. It then repeats that process
with different starting choices and returns a classification across all of the runs.</p><div id="hi4aLewbk0" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre"># We need to convert the raster data into a data frame giving the 
# spectral signature of each cell
values &lt;- as.data.frame(s2_silwood_10m)
head(values)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="To1fXwrb_Kl8Ywb8p0t0a" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><div id="piS1G7Cb8F" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre"># Now we can run the clustering
n_cats &lt;- 6
s2_kmeans &lt;- kmeans(
  values, centers=n_cats, iter.max = 500, nstart = 5, algorithm=&quot;Lloyd&quot;
)

# We can now take the cluster attribute from the output and put those values
# back into a 10m resolution raster
s2_kmeans_map &lt;- rast(s2_silwood_10m, nlyr=1)
values(s2_kmeans_map) &lt;- s2_kmeans$cluster</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="3iX0lrKCKpBXme0PcQf5P" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><p>Now that we have the map, we can add labels and category names, as we did above for the
CEH dataset.</p><div id="nkIH9ZnEIA" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre">labels &lt;- data.frame(ID=1:n_cats, category=paste0(&quot;Category_&quot;, 1:n_cats))
#colours &lt;- data.frame(ID=1:n_cats, colours=hcl.colors(n_cats, &quot;Dark 2&quot;))

colours &lt;- data.frame(ID=1:n_cats, colours=carto_pal(n_cats, &quot;Safe&quot;))

levels(s2_kmeans_map) &lt;- labels
coltab(s2_kmeans_map) &lt;- colours

plot(s2_kmeans_map)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="fkOcXT2u06Tdc-G43rEPk" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/a0a9c7811c51585a79fbbc76d3a3df46.png" alt="plot without title"/></div></div><h3 id="supervised-classification" class="relative group"><span class="heading-text">Supervised classification</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#supervised-classification" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>The classes from an unsupervised classification are a purely statistical construction:
they often do identify meaningful land cover types, but they need to be interpreted and
it is common to re-run the process with different numbers of classes, or to merge
classes that identify very similar regions.</p><p>The alternative of supervised classification avoids that by starting with a training
dataset of sites with known categories. The spectral signatures of those sites can then
be used to assign other sites to classes based on their similarity to the training data.
This does mean that you need to put together a training dataset in one of two ways:</p><ul><li><p>physically exploring the location with a GPS and assigning classes based on field data
(“ground truthing”), or</p></li><li><p>selecting points from the imagery that visually belong to a particular class
(“digitization”).</p></li></ul><p>Here we use a training set drawn from inspecting the imagery, saved as a set of X and Y
point coordinates and the land cover category at that point. There are multiple sites
for each class, giving a distribution of signatures associated with each class.</p><div id="yFvJUTqVMt" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre"># Load the classification data and convert it to an SF point dataset
training_sites &lt;- read.csv(&quot;../data/SpatialMethods/S2_classification_data.csv&quot;)
training_sites &lt;- st_as_sf(training_sites, coords=c(&quot;x&quot;,&quot;y&quot;), crs=&quot;EPSG:27700&quot;)

# Plot the data over the top of an aerial image. This is a bit of a hack
# as it plots the vector data first to get the legend, then plots the aerial
# photo over the top and then the training sites _again_.
plot(training_sites, reset=FALSE)
plotRGB(silwood_aerial, add=TRUE)
plot(training_sites, add=TRUE)

# Show a table of the number of training sites for each category.
table(training_sites$category)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="3PiGwKYXf0JE4PKmrzjh0" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div class="myst-jp-safe-output-text font-mono text-sm whitespace-pre-wrap"><code><span>
 Bare Ground    Grassland         Road Silwood Lake        Urban        Water 
           9           36           10            4           24            9 
    Woodland 
          37 </span></code></div><img src="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/ff18bad7336bc32d46fb818f435a9bc8.png" alt="Plot with title “category”"/></div></div><p>We can then extract the spectral signatures at each of those sites to give a spectral
training dataset to use in classification.</p><div id="aIQCmKUKOB" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre"># Extract a data frame of band values at each training site and add the
# category field to the dataset.
training_spectra &lt;- extract(s2_silwood_10m, training_sites, ID=FALSE)
training_spectra$category &lt;- training_sites$category</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="l5F2vzia1Wg3mkTGbOiCG" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><p>We will use a regression tree model using the <code>rpart::rpart</code> function to assign spectral
signatures to classes. A regression tree finds critical values in the different bands
that separate different classes and provides a simple decision tree based on the
training data that can then be used to classify the whole image.</p><div id="uLhOn81Bjx" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre"># Fit a regression tree of the land cover category as a function of the bands
s2_class_model &lt;- rpart(
  category ~  B + G + R + NIR + RE5 + RE6 + RE7 + NNIR + SWIR1 + SWIR2,
  data = training_spectra, method = &#x27;class&#x27;, minsplit = 5
)

# Show the regression tree.
print(s2_class_model)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="VlrpIASIA4qWgeEIWykyk" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>n= 129 

node), split, n, loss, yval, (yprob)
      * denotes terminal node

 1) root 129 92 Woodland (0.07 0.28 0.078 0.031 0.19 0.07 0.29)  
   2) R&gt;=0.1304218 81 45 Grassland (0.11 0.44 0.099 0.049 0.3 0 0)  
     4) SWIR1&gt;=0.356181 43  7 Grassland (0.12 0.84 0 0 0.047 0 0)  
       8) B&gt;=0.2016674 3  0 Bare Ground (1 0 0 0 0 0 0) *
       9) B&lt; 0.2016674 40  4 Grassland (0.05 0.9 0 0 0.05 0 0)  
        18) NIR&gt;=0.3257478 38  2 Grassland (0.053 0.95 0 0 0 0 0) *
        19) NIR&lt; 0.3257478 2  0 Urban (0 0 0 0 1 0 0) *
     5) SWIR1&lt; 0.356181 38 16 Urban (0.11 0 0.21 0.11 0.58 0 0)  
      10) RE5&lt; 0.2091596 12  5 Road (0 0 0.58 0.33 0.083 0 0)  
        20) RE6&gt;=0.2886455 7  0 Road (0 0 1 0 0 0 0) *
        21) RE6&lt; 0.2886455 5  1 Silwood Lake (0 0 0 0.8 0.2 0 0) *
      11) RE5&gt;=0.2091596 26  5 Urban (0.15 0 0.038 0 0.81 0 0) *
   3) R&lt; 0.1304218 48 11 Woodland (0 0 0.042 0 0 0.19 0.77)  
     6) NIR&lt; 0.30421 10  1 Water (0 0 0.1 0 0 0.9 0) *
     7) NIR&gt;=0.30421 38  1 Woodland (0 0 0.026 0 0 0 0.97) *
</span></code></pre></div></div></div><p>The model can then be used to predict values for all of the pixels. The resulting
raster has one layer for each land cover type that gives the probability that the pixel
is in that class.</p><div id="NfrYr9FASF" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre"># Generate the predictions for the whole map
s2_class_probability &lt;- predict(s2_silwood_10m, s2_class_model)

# Plot 3 of the probability layers
plot(s2_class_probability[[1:3]], nc=3)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="HEwDyVVuTQjdyIFNkK9YT" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/dc466da9142a3731297483fbdd05a185.png" alt="plot without title"/></div></div><p>We can convert it into a land cover map by assigning each pixel to the class where it
has the highest probability.</p><div id="Y3ontkeUXy" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre"># Find the layer with the highest probability. The index of that code gives the 
# associated land  cover type
s2_class_map &lt;- which.max(s2_class_probability)

# Assign level labels to the index codes.
levels(s2_class_map) &lt;- data.frame(id=1:7, class=names(s2_class_probability))
plot(s2_class_map, col=carto_pal(7, &quot;Safe&quot;))</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="eM1sS3rqz8e5KKI-k0Qci" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/c9fa9f1e5d862136edc9aec3dde72e1b.png" alt="plot without title"/></div></div><p>It is good practice to partition your training dataset to then test the accuracy of the
classification - can your model successfully predict the classes of the data retained in
the test partition. There are a lot of approaches to this (k-fold cross validation is a
common one) but these are outside the scope of this practical.</p><details class="myst-admonition myst-admonition-tip my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-green-600 dropdown"><summary class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-green-600 bg-green-50 dark:bg-slate-900 cursor-pointer hover:shadow-[inset_0_0_0px_30px_#00000003] dark:hover:shadow-[inset_0_0_0px_30px_#FFFFFF03]"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-green-600"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Generating training data</div><div class="self-center flex-none text-sm font-thin text-neutral-700 dark:text-neutral-200"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none transition-transform details-toggle"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></div></summary><div class="myst-admonition-body px-4 py-1 details-body"><p>Digitizing training data is one of those tasks where it may be easier to use a dedicated
GIS program like GIS. This is mostly because it is easier to zoom in on an image to
precisely place the training locations.</p><p>However, you can use R to create training datasets. The code below defines a function
that can be used to generate a training data frame and then extend it with training data
for different classes.</p><div id="HQguvDIpYB" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre">pick_training_sites &lt;- function(category, df = NULL) {
    #&#x27; Function to add training data locations by clicking on a displayed map.
    #&#x27; 
    #&#x27; The function returns a data frame with the X and Y coordinates of the clicked
    #&#x27; points and a category field giving the `category` label for with the points.
    #&#x27; Press &#x27;Escape&#x27; to finish collecting points and return a dataframe of coordinates.
    #&#x27; The returned dataframe for one category can be passed back into the `df`
    #&#x27; argument to append sites for a new category to the existing data. 

    # Pick the points from a plotted GIS map
    xy &lt;- draw(&quot;points&quot;, pch=4)
    # Convert the selected coordinates to a dataframe and add the category label
    new_data &lt;- as.data.frame(crds(xy))
    new_data$category &lt;- category

    # Return the new_data appended to any existing data
    return(rbind(df, new_data))
}

# Plot the image
plotRGB(silwood_aerial)

# Build up the training set by clicking on the image and then pressing
# &quot;escape&quot; to finish defining one class and to move onto the next category
df &lt;- pick_training_sites(&quot;Urban&quot;)
df &lt;- pick_training_sites(&quot;Grassland&quot;, df=df)
df &lt;- pick_training_sites(&quot;Water&quot;, df=df)
df &lt;- pick_training_sites(&quot;Silwood Lake&quot;, df=df)
df &lt;- pick_training_sites(&quot;Bare Ground&quot;, df=df)
df &lt;- pick_training_sites(&quot;Woodland&quot;, df=df)
df &lt;- pick_training_sites(&quot;Road&quot;, df=df)

# Export the data
write.csv(df, &quot;../data/SpatialMethods/S2_classification_data.csv&quot;, row.names=FALSE)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="R4LEYRQ4o7WppsfWVQut_" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div></div></details><h2 id="saving-gis-files" class="relative group"><span class="heading-text">Saving GIS files</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#saving-gis-files" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><div id="x9yPWFWbNl" class="myst-jp-nb-block relative group/block hidden"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre"># Remove any existing data output folder rather than have to stick a load of 
# overwrite=TRUE arguments in the student facing text.
if (dir.exists(&quot;spatial_method_practical_outputs&quot;)) {
  unlink(&quot;spatial_method_practical_outputs&quot;, recursive=TRUE)
}</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="7wL37-3TM1ZymAtyt1eIr" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><p>We have created a lot of new dataset during this practical, which we should save for
future use. The first thing to do is create a new directory to save the data files in:</p><div id="WfMq5snVzy" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre"># Create an output directory
dir.create(&quot;spatial_method_practical_outputs&quot;)
setwd(&quot;spatial_method_practical_outputs&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="4NHFXSrPEGSiG8KtlXKHD" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><h3 id="saving-raster-data" class="relative group"><span class="heading-text">Saving raster data</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#saving-raster-data" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>We can write raster data out using the <code>terra::writeRaster</code> function. This
function writes all the bands in the dataset out to a single file. The function uses the
file suffix of the file name you provide to set the output format: there are lots of
formats, but GeoTIFF is widely used and a good general choice.</p><div id="dAnzBokGtr" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre"># Create an output directory
dir.create(&quot;spatial_method_practical_outputs&quot;)
setwd(&quot;spatial_method_practical_outputs&quot;)

# Save the NDVI and EVI data
writeRaster(ndvi_silwood, &quot;NDVI_Silwood.tiff&quot;)
writeRaster(ndvi_nhm, &quot;NDVI_NHM.tiff&quot;)

writeRaster(evi_silwood, &quot;EVI_Silwood.tiff&quot;)
writeRaster(evi_nhm, &quot;EVI_NHM.tiff&quot;)

# Save the multiband Sentinel 2 data
writeRaster(s2_silwood_10m, &quot;Sentinel2_Silwood.tiff&quot;)
writeRaster(s2_nhm_10m, &quot;Sentinel2_NHM.tiff&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="eClnD7iVaX7ACIgeHYbOt" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><h3 id="saving-vector-data" class="relative group"><span class="heading-text">Saving vector data</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#saving-vector-data" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>The <code>sf_st::write</code> function is used to write vector data to file. Again, the file format
is inferred from the output file name. This <code>sf_st::write</code> function is slightly more
complex because file formats work in slightly different ways. The function has three
main arguments:</p><ul><li><p><code>obj</code>: The <code>sf</code> object you want to write to a file.</p></li><li><p><code>dsn</code>: The <em>data source name</em> that usually gives a filename that the data will be
written to.</p></li><li><p><code>layer</code>: A <em>layer name</em> within the data source that the data will be saved under. Not
all formats support multiple layers (e.g. shapefiles), so you do not always need to
provide a layer name.</p></li></ul><p>There are many, <em>many</em> vector file formats - see the help file on <code>sf::st_drivers()</code> and
the output</p><div id="anSmDiuzpD" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre">st_drivers()$name</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="Udc8MllkVsKOvWKh1PVyt" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><p>The GeoPackage format is generally more convenient because it is a single file and can
hold multiple layers.  The code below saves the four processed VML subsets to a single
GeoPackage file.</p><div id="t2evrkGszf" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre"># Save the VML to GPKG
st_write(silwood_VML_roads, dsn=&quot;OS_VML_Silwood_NHM.gpkg&quot;, layer=&quot;silwood_VML_roads&quot;)
st_write(nhm_VML_roads, dsn=&quot;OS_VML_Silwood_NHM.gpkg&quot;, layer=&quot;nhm_VML_roads&quot;)
st_write(silwood_VML_water, dsn=&quot;OS_VML_Silwood_NHM.gpkg&quot;, layer=&quot;silwood_VML_water&quot;)
st_write(nhm_VML_water, dsn=&quot;OS_VML_Silwood_NHM.gpkg&quot;, layer=&quot;nhm_VML_water&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="wg1TQR1q4qvRousoXa3he" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>Writing layer `silwood_VML_roads&#x27; to data source 
  `OS_VML_Silwood_NHM.gpkg&#x27; using driver `GPKG&#x27;
Writing 780 features with 5 fields and geometry type Unknown (any).
</span></code></pre></div><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>Writing layer `nhm_VML_roads&#x27; to data source 
  `OS_VML_Silwood_NHM.gpkg&#x27; using driver `GPKG&#x27;
Writing 3154 features with 5 fields and geometry type Unknown (any).
</span></code></pre></div><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>Writing layer `silwood_VML_water&#x27; to data source 
  `OS_VML_Silwood_NHM.gpkg&#x27; using driver `GPKG&#x27;
Writing 113 features with 3 fields and geometry type Polygon.
</span></code></pre></div><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>Writing layer `nhm_VML_water&#x27; to data source 
  `OS_VML_Silwood_NHM.gpkg&#x27; using driver `GPKG&#x27;
Writing 37 features with 3 fields and geometry type Polygon.
</span></code></pre></div></div></div><p>Although the Shapefile format is more widely known, the inconvience of having multiple
files is high and often leads to problems with incomplete datasets. It also has some odd
constraints - as you can see in the output below, there is a limit to the length of
attribute table field names in shapefiles.</p><div id="mBxC5OBnGM" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-r" style="white-space:pre"># Save the sensors as shapefile
st_write(sensor_locations, dsn=&quot;sensor_locations.shp&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="86zNwO6Dep7YyVRf2rBUj" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>Warning message in abbreviate_shapefile_names(obj):
“Field names abbreviated for ESRI Shapefile driver”
</span></code></pre></div><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>Writing layer `sensor_locations&#x27; to data source 
  `sensor_locations.shp&#x27; using driver `ESRI Shapefile&#x27;
Writing 18 features with 24 fields and geometry type Point.
</span></code></pre></div></div></div><div class="myst-backmatter-parts"></div><div class="myst-footer-links flex pt-10 mb-10 space-x-4"><a class="myst-footer-link flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700 myst-footer-link-prev" href="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/practical-requirements"><div class="flex h-full align-middle"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="myst-footer-link-icon self-center transition-transform group-hover:-translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"></path></svg><div class="flex-grow text-right"><div class="myst-footer-link-group text-xs text-gray-500 dark:text-gray-400">Ecological and Evolutionary Data Science</div>Requirements</div></div></a><a class="myst-footer-link flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700 myst-footer-link-next" href="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/microclimate-sensor-analysis-easylog"><div class="flex h-full align-middle"><div class="flex-grow"><div class="myst-footer-link-group text-xs text-gray-500 dark:text-gray-400">Ecological and Evolutionary Data Science</div>Microclimate</div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="myst-footer-link-icon self-center transition-transform group-hover:translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3"></path></svg></div></a></div></article></main><script>((a,l)=>{if(!window.history.state||!window.history.state.key){let d=Math.random().toString(32).slice(2);window.history.replaceState({key:d},"")}try{let u=JSON.parse(sessionStorage.getItem(a)||"{}")[l||window.history.state.key];typeof u=="number"&&window.scrollTo(0,u)}catch(d){console.error(d),sessionStorage.removeItem(a)}})("positions", null)</script><link rel="modulepreload" href="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/entry.client-PCJPW7TK.js"/><link rel="modulepreload" href="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/_shared/chunk-AQ2CODAG.js"/><link rel="modulepreload" href="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/_shared/chunk-JJXTQVMA.js"/><link rel="modulepreload" href="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/_shared/chunk-OZE3FFNP.js"/><link rel="modulepreload" href="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/_shared/chunk-UGO2RSJF.js"/><link rel="modulepreload" href="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/_shared/chunk-HHKX4TLX.js"/><link rel="modulepreload" href="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/_shared/chunk-YATQFWLS.js"/><link rel="modulepreload" href="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/_shared/chunk-MBMQ6BQC.js"/><link rel="modulepreload" href="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/_shared/chunk-OCWQY3HK.js"/><link rel="modulepreload" href="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/_shared/chunk-CVDX4WR7.js"/><link rel="modulepreload" href="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/_shared/chunk-3EBOCCHJ.js"/><link rel="modulepreload" href="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/_shared/chunk-O4VQNZ62.js"/><link rel="modulepreload" href="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/_shared/chunk-NK7RXO5Q.js"/><link rel="modulepreload" href="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/_shared/chunk-GUCIBHGO.js"/><link rel="modulepreload" href="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/root-TRTRBUUN.js"/><link rel="modulepreload" href="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/_shared/chunk-6NUWI4AQ.js"/><link rel="modulepreload" href="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/_shared/chunk-M5KN76GI.js"/><link rel="modulepreload" href="https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/routes/$-VLPGWU3Z.js"/><script>window.__remixContext = {"url":"/gis-practical","state":{"loaderData":{"root":{"config":{"version":2,"myst":"1.6.3","options":{"folders":false},"nav":[],"actions":[],"projects":[{"title":"Ecological and Evolutionary Data Science","toc":[{"file":"intro.md"},{"file":"practical_requirements.md"},{"file":"gis_practical/gis_practical.md"},{"file":"microclimate/microclimate_sensor_analysis_EasyLog.md"}],"exports":[],"bibliography":[],"index":"index","pages":[{"slug":"practical-requirements","title":"Required packages and data","short_title":"Requirements","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"gis-practical","title":"Spatial methods in Ecological and Evolutionary Data Science","short_title":"Spatial Methods","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"microclimate-sensor-analysis-easylog","title":"Microclimate sensor data analysis in R","short_title":"Microclimate","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1}]}]},"CONTENT_CDN_PORT":"3101","MODE":"static","BASE_URL":"https://imperialcollegelondon.github.io/living_planet_eco_evo_data"},"routes/$":{"config":{"version":2,"myst":"1.6.3","options":{"folders":false},"nav":[],"actions":[],"projects":[{"title":"Ecological and Evolutionary Data Science","toc":[{"file":"intro.md"},{"file":"practical_requirements.md"},{"file":"gis_practical/gis_practical.md"},{"file":"microclimate/microclimate_sensor_analysis_EasyLog.md"}],"exports":[],"bibliography":[],"index":"index","pages":[{"slug":"practical-requirements","title":"Required packages and data","short_title":"Requirements","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"gis-practical","title":"Spatial methods in Ecological and Evolutionary Data Science","short_title":"Spatial Methods","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"microclimate-sensor-analysis-easylog","title":"Microclimate sensor data analysis in R","short_title":"Microclimate","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1}]}]},"page":{"version":2,"kind":"Notebook","sha256":"f6d3908a315a22e720e0a7c738a9751483329d7b11155c95fd58d33df5865da5","slug":"gis-practical","location":"/gis_practical/gis_practical.md","dependencies":[],"frontmatter":{"title":"Spatial methods in Ecological and Evolutionary Data Science","short_title":"Spatial Methods","authors":[{"nameParsed":{"literal":"David Orme","given":"David","family":"Orme"},"name":"David Orme","id":"contributors-gis_practical-generated-uid-0"}],"kernelspec":{"name":"ir","display_name":"R","language":"R"},"jupytext":{"formats":"md:myst","text_representation":{"extension":".md","format_name":"myst","format_version":"0.13","jupytext_version":"1.18.1"}},"content_includes_title":false,"exports":[{"format":"md","filename":"gis_practical.md","url":"https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/gis_practical-f04574476e9c1361d42c6a70882b1e37.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":20,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"This webpage provides one long self-paced practical that provides an introduction to key\nspatial data handling and analysis techniques for use with the Ecological and\nEvolutionary Data Science. This practical uses ","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"gxq20FlIYM"},{"type":"link","url":"https://cran.r-project,org","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"the R programming\nlanguage","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"GnNldoEtqF"}],"urlSource":"https://cran.r-project,org","key":"jIe2OUaE5f"},{"type":"text","value":" to load, manipulate and analyse spatial data. See\nmore here on ","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"N2Y0EQ8NjU"},{"type":"link","url":"https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/why_r_for_gis-98934107745e15d4197d5f7cf4b74b1f.md","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"why we use R for GIS","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"dWLuzzcyIw"}],"urlSource":"./why_r_for_gis.md","static":true,"protocol":"file","key":"xSrMRj6TP0"},{"type":"text","value":".","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"QAo0EraR6b"}],"key":"FAVsIQ0fq0"},{"type":"paragraph","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"text","value":"There are a lot of other sites that provide information on using R for GIS:","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"ysRmRMQOKQ"}],"key":"fZuqNm0v16"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":28,"column":1},"end":{"line":36,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":28,"column":1},"end":{"line":33,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":28,"column":1},"end":{"line":32,"column":1}},"children":[{"type":"text","value":"The core textbook for this practical is ","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"m8tBhFdaBQ"},{"type":"link","url":"https://r.geocompx.org/","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"text","value":"Geocomputation with\nR","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"QWgnlovzDu"}],"urlSource":"https://r.geocompx.org/","key":"uaavRr3wPy"},{"type":"text","value":" - it forms part of a broader set of resources from the\n","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"uM47yDwJ7A"},{"type":"link","url":"https://geocompx.org/","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"text","value":"geocompx","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"Kc6mtgQKEC"}],"urlSource":"https://geocompx.org/","key":"ZTYXHrTReC"},{"type":"text","value":" group that provide resources for reproducible\ngeographic data analysis, modeling, and visualization in several open source\nlanguages, also including Python and Julia.","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"PM6V8y61po"}],"key":"DZ3ZpoDefl"}],"key":"imQyDw1iJj"},{"type":"listItem","spread":true,"position":{"start":{"line":34,"column":1},"end":{"line":36,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":34,"column":1},"end":{"line":35,"column":1}},"children":[{"type":"text","value":"Another great resource is the ","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"qU0YsSvTSv"},{"type":"link","url":"https://rspatial.org/index.html","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"children":[{"type":"inlineCode","value":"rspatial","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"HBLJ76ZhBj"},{"type":"text","value":" website","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"HfAExMAy2W"}],"urlSource":"https://rspatial.org/index.html","key":"GrXRMq5qAt"},{"type":"text","value":",\nwhich provides a lot of information on using ","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"ZZJyiAqZT8"},{"type":"inlineCode","value":"terra","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"PU6joYJhwt"},{"type":"text","value":" and other spatial tools in R.","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"ANe5DSuN2M"}],"key":"JncaRMBqba"}],"key":"KLqGOr7MlA"}],"key":"TSGtU7aCUv"},{"type":"heading","depth":2,"position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"children":[{"type":"text","value":"Aims of the the practical","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"rvn3KTu7Lf"}],"identifier":"aims-of-the-the-practical","label":"Aims of the the practical","html_id":"aims-of-the-the-practical","implicit":true,"key":"TC3A2PGD7u"},{"type":"paragraph","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"children":[{"type":"text","value":"The practical aims to:","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"ib3OOJNVhL"}],"key":"rXHQwNDleq"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":41,"column":1},"end":{"line":52,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":41,"column":1},"end":{"line":44,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":41,"column":1},"end":{"line":43,"column":1}},"children":[{"type":"text","value":"Provide you with some high quality spatial datasets for the Silwood and NHM sites\nthat provide additional information that you can use to develop your hypotheses in\nyour coursework for the module.","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"key":"TaXkWXGWDm"}],"key":"PjcRiUcPxy"}],"key":"Gu6yLDPCK1"},{"type":"listItem","spread":true,"position":{"start":{"line":45,"column":1},"end":{"line":48,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":45,"column":1},"end":{"line":47,"column":1}},"children":[{"type":"text","value":"Run through most of the major GIS techniques that you will need to use to integrate\nraster and vector datasets in order to get to a final dataset addressing your\nhypotheses.","position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"key":"QTAXrhEFpW"}],"key":"ekTmpxlAi9"}],"key":"o0MqiQWjXb"},{"type":"listItem","spread":true,"position":{"start":{"line":49,"column":1},"end":{"line":52,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":49,"column":1},"end":{"line":51,"column":1}},"children":[{"type":"text","value":"Provide ","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"key":"S28MLkNnLe"},{"type":"emphasis","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"children":[{"type":"text","value":"simple","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"key":"PDGt6auFBt"}],"key":"EI5OgWc70P"},{"type":"text","value":" plotting options using the basic R graphics commands. For more\nadvanced mapping, see the ","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"key":"AOWFBKUhuq"},{"type":"link","url":"https://r.geocompx.org/adv-map","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"children":[{"type":"text","value":"“Making maps with R”","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"key":"H2Q5A9lVT2"}],"urlSource":"https://r.geocompx.org/adv-map","key":"ZEuOXx43KS"},{"type":"text","value":"\nchapter in “Geocomputation with R”.","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"key":"swN3xxGDsg"}],"key":"xjEVmKO9La"}],"key":"Q1hI4L0y9s"}],"key":"I9LiqUR0oZ"},{"type":"heading","depth":2,"position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"children":[{"type":"text","value":"How to use the practical","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"oGPcLzbBam"}],"identifier":"how-to-use-the-practical","label":"How to use the practical","html_id":"how-to-use-the-practical","implicit":true,"key":"wqGXjhEsEk"},{"type":"paragraph","position":{"start":{"line":55,"column":1},"end":{"line":57,"column":1}},"children":[{"type":"text","value":"This practical is self-paced: work through it at your own speed and ask questions as\nneeded! It builds up and then saves a set of datasets that you can use in your\nassessment, so you will need to:","position":{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},"key":"yuncyINODh"}],"key":"ETN8XvJU1L"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":59,"column":1},"end":{"line":74,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":59,"column":1},"end":{"line":60,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":59,"column":1},"end":{"line":60,"column":1}},"children":[{"type":"text","value":"Follow ","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"key":"F7ImreGHhT"},{"type":"link","url":"/practical-requirements","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"children":[{"type":"text","value":"this guide","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"key":"FjkCUhFQuI"}],"urlSource":"../practical_requirements.md","dataUrl":"/practical-requirements.json","internal":true,"protocol":"file","key":"UVcziYrUrL"},{"type":"text","value":" on setting up packages and data for\nthis practical.","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"key":"seUqxwa0sP"}],"key":"cknS0Swkky"}],"key":"Y5MmpQC0hO"},{"type":"listItem","spread":true,"position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"children":[{"type":"text","value":"Create a new R script file to run the practical analyses.","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"K21v6fnMYF"}],"key":"TQCt7rvwJW"}],"key":"D2CBIB6FvX"},{"type":"listItem","spread":true,"position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"children":[{"type":"text","value":"Copy example code from the practical into your script and run it from your script.","position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"key":"B14GIEzbpB"}],"key":"HlGmm72W4N"}],"key":"yNQ3xKzz2M"},{"type":"listItem","spread":true,"position":{"start":{"line":63,"column":1},"end":{"line":63,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":63,"column":1},"end":{"line":63,"column":1}},"children":[{"type":"text","value":"Check you understand what the code is doing - add extra comments, ask questions.","position":{"start":{"line":63,"column":1},"end":{"line":63,"column":1}},"key":"pv688gImvQ"}],"key":"zQUmiUAcVj"}],"key":"jlgq076Nie"},{"type":"listItem","spread":true,"position":{"start":{"line":64,"column":1},"end":{"line":66,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":64,"column":1},"end":{"line":66,"column":1}},"children":[{"type":"text","value":"The practical contains exercises where you are asked to use the previous example to\nwrite and run your own code. Write your solution into your script file and again add\ncomments for when you come back to it!","position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"key":"ZfHBeQKwQR"}],"key":"wLmQWAW36M"}],"key":"T6mAipcuVE"},{"type":"listItem","spread":true,"position":{"start":{"line":67,"column":1},"end":{"line":68,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":67,"column":1},"end":{"line":68,"column":1}},"children":[{"type":"text","value":"The practical contains solutions for all the exercises, but do try and solve them\nyourself.","position":{"start":{"line":67,"column":1},"end":{"line":67,"column":1}},"key":"d3DNaaFsYx"}],"key":"JYDRseuH0z"}],"key":"PhoWyUdFT0"},{"type":"listItem","spread":true,"position":{"start":{"line":69,"column":1},"end":{"line":74,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":69,"column":1},"end":{"line":69,"column":1}},"children":[{"type":"text","value":"At the end of the practical, you should have:","position":{"start":{"line":69,"column":1},"end":{"line":69,"column":1}},"key":"EWTgrvopfb"}],"key":"ztqKEx5BmR"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":71,"column":1},"end":{"line":74,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":71,"column":1},"end":{"line":72,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"A set of GIS data files that allow you to add further environmental context to the\noutputs of the sensor data exercises.","position":{"start":{"line":71,"column":1},"end":{"line":71,"column":1}},"key":"oSEgIFyI4u"}],"key":"LVbB7U0MYo"}],"key":"nzRpPX3Kkb"},{"type":"listItem","spread":true,"position":{"start":{"line":73,"column":1},"end":{"line":74,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"A complete script that builds up those files from the original source data.","position":{"start":{"line":73,"column":1},"end":{"line":73,"column":1}},"key":"CXmpaHTu0w"}],"key":"rMJpX0rjjw"}],"key":"WsXzadYIdi"}],"key":"tQeSOVXl43"}],"key":"fvwBHwxRIi"}],"key":"znp78WdLjv"},{"type":"heading","depth":2,"position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"children":[{"type":"text","value":"Required packages","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"bhSZiHRzhm"}],"identifier":"required-packages","label":"Required packages","html_id":"required-packages","implicit":true,"key":"E9UYbXOoTR"},{"type":"paragraph","position":{"start":{"line":77,"column":1},"end":{"line":77,"column":1}},"children":[{"type":"text","value":"We will need to load the following packages:","position":{"start":{"line":77,"column":1},"end":{"line":77,"column":1}},"key":"Pig9zN4Ljp"}],"key":"WS49hptp7F"}],"key":"fTV3zlKjHx"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"library(terra)       # core raster GIS package\nlibrary(sf)          # core vector GIS package\nlibrary(rcartocolor) # plotting\nlibrary(rpart)","visibility":"show","key":"j72Kr9Tu7l"},{"type":"output","id":"XHcrdH45TnD7_pQRWmE_L","data":[],"visibility":"show","key":"BHINH3w8AF"}],"data":{"tags":["remove-stderr"]},"visibility":"show","key":"TyEMJYpz8T"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":87,"column":1},"end":{"line":89,"column":1}},"children":[{"type":"text","value":"You will see a whole load of package loading messages about GDAL, GEOS, PROJ which are\nnot shown here. Don’t worry about this - they are not errors, just R linking to some key\nopen source GIS toolkits.","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"q5lacwviC5"}],"key":"h3QOxMtBVM"},{"type":"heading","depth":2,"position":{"start":{"line":91,"column":1},"end":{"line":91,"column":1}},"children":[{"type":"text","value":"Spatial datasets","position":{"start":{"line":91,"column":1},"end":{"line":91,"column":1}},"key":"lkAX6Hqzri"}],"identifier":"spatial-datasets","label":"Spatial datasets","html_id":"spatial-datasets","implicit":true,"key":"lp9UBNtWcY"},{"type":"paragraph","position":{"start":{"line":93,"column":1},"end":{"line":97,"column":1}},"children":[{"type":"text","value":"We will be using a number of different datasets in both vector and raster format, at a\nrange of resolutions. They are not all in the same projection and so we will need to\nsupply coordinate system details. These can be very complex, but fortunately the ","position":{"start":{"line":93,"column":1},"end":{"line":93,"column":1}},"key":"Net6EPbXP1"},{"type":"link","url":"https://epsg.io/","position":{"start":{"line":93,"column":1},"end":{"line":93,"column":1}},"children":[{"type":"text","value":"EPSG\ndatabase","position":{"start":{"line":93,"column":1},"end":{"line":93,"column":1}},"key":"QWkFsjSo35"}],"urlSource":"https://epsg.io/","key":"GtKkiQhFSY"},{"type":"text","value":" now provides a set of consistent codes that can be use to\nspecify coordinate systems.","position":{"start":{"line":93,"column":1},"end":{"line":93,"column":1}},"key":"YiP51ivTet"}],"key":"Kgt3cqAMKd"},{"type":"paragraph","position":{"start":{"line":99,"column":1},"end":{"line":100,"column":1}},"children":[{"type":"text","value":"We will first load the location data from field datasets, which use GPS point location\ndata in the WGS84 projection (","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"Ltahsx0rpT"},{"type":"link","url":"https://epsg.io/4326","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"children":[{"type":"text","value":"EPSG:4326","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"A5f1oFuepp"}],"urlSource":"https://epsg.io/4326","key":"lVCI2ae9mp"},{"type":"text","value":") with units in degrees:","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"Vx52EwHDf3"}],"key":"OxxXyluePo"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":102,"column":1},"end":{"line":103,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":102,"column":1},"end":{"line":102,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The sensor deployment locations (16 sites across both the NHM and Silwood).","position":{"start":{"line":102,"column":1},"end":{"line":102,"column":1}},"key":"k7PpBE6emg"}],"key":"SkTKRlQElZ"}],"key":"BEw2v4PEKk"},{"type":"listItem","spread":true,"position":{"start":{"line":103,"column":1},"end":{"line":103,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The blue tit nest box sites at Silwood (222 sites)","position":{"start":{"line":103,"column":1},"end":{"line":103,"column":1}},"key":"LbeECoQ4Ux"}],"key":"MT2wqKN1hs"}],"key":"vSDXCw3rFL"}],"key":"YnfyQsQKV1"},{"type":"comment","value":" * The woodland survey data sites.","key":"cNvJtLw9pw"},{"type":"paragraph","position":{"start":{"line":106,"column":1},"end":{"line":112,"column":1}},"children":[{"type":"text","value":"We will then load a set of additional data files in a wide range of formats. The\nfollowing datasets are all downloaded from the ","position":{"start":{"line":106,"column":1},"end":{"line":106,"column":1}},"key":"GD64z0IwWE"},{"type":"link","url":"https://digimap.edina.ac.uk/","position":{"start":{"line":106,"column":1},"end":{"line":106,"column":1}},"children":[{"type":"text","value":"Edina\nDigimap","position":{"start":{"line":106,"column":1},"end":{"line":106,"column":1}},"key":"rqqoyVDYwC"}],"urlSource":"https://digimap.edina.ac.uk/","key":"JPpYhoV6UP"},{"type":"text","value":" system. This is a UK national GIS resource for\nhigher education, which you should be able to use for any UK based GIS whilst you are at\nthe college using your college credentials. All of these datasets use the the OSGB36 /\nBritish National Grid projected coordinate system\n(","position":{"start":{"line":106,"column":1},"end":{"line":106,"column":1}},"key":"w3UdEwo2Y8"},{"type":"link","url":"https://epsg.io/27700","position":{"start":{"line":106,"column":1},"end":{"line":106,"column":1}},"children":[{"type":"inlineCode","value":"EPSG:27700","position":{"start":{"line":106,"column":1},"end":{"line":106,"column":1}},"key":"dR8OPFnFK7"}],"urlSource":"https://epsg.io/27700","key":"mcZ5juZVdY"},{"type":"text","value":"), with units in metres.","position":{"start":{"line":106,"column":1},"end":{"line":106,"column":1}},"key":"imHE7okgd7"}],"key":"AfJqusKkI8"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":114,"column":1},"end":{"line":121,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":114,"column":1},"end":{"line":115,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Aerial photography: RGB raster data at 25cm resolution with a single 3 x 3 km pane each\nof the two sites.","position":{"start":{"line":114,"column":1},"end":{"line":114,"column":1}},"key":"yoXqpISq7A"}],"key":"GCu408srNP"}],"key":"piOkGlyi70"},{"type":"listItem","spread":true,"position":{"start":{"line":116,"column":1},"end":{"line":117,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The Ordnance Survey (OS) Terrain 5 digital elevation dataset: raster data at 5m\nresolution with 2 pairs of 5 x 5 km panes for each site.","position":{"start":{"line":116,"column":1},"end":{"line":116,"column":1}},"key":"Fg4eu10try"}],"key":"y1Frwwk6gC"}],"key":"yCBo7SLeNC"},{"type":"listItem","spread":true,"position":{"start":{"line":118,"column":1},"end":{"line":119,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The CEH LandCover Map 2024: a raster land cover classification map with a single 3 x 3\nkm pane for each site.","position":{"start":{"line":118,"column":1},"end":{"line":118,"column":1}},"key":"wWTgrXKUbS"}],"key":"tq8YE63gzC"}],"key":"E5H5m6Dgi0"},{"type":"listItem","spread":true,"position":{"start":{"line":120,"column":1},"end":{"line":121,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The OS VectorMap Local dataset: two 5 x 5 km panes of vector data for each site.","position":{"start":{"line":120,"column":1},"end":{"line":120,"column":1}},"key":"VaOabKD9zU"}],"key":"Avcysbcpts"}],"key":"AZs8XOzKhA"}],"key":"vO3FkowKa9"},{"type":"paragraph","position":{"start":{"line":122,"column":1},"end":{"line":122,"column":1}},"children":[{"type":"text","value":"There are then two final datasets:","position":{"start":{"line":122,"column":1},"end":{"line":122,"column":1}},"key":"UNFFB12oHb"}],"key":"SVO08eBnAu"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":124,"column":1},"end":{"line":133,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":124,"column":1},"end":{"line":130,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":124,"column":1},"end":{"line":129,"column":1}},"children":[{"type":"text","value":"Satellite data from the Sentinel 2 L2A product at a range of resolutions, using the\n","position":{"start":{"line":124,"column":1},"end":{"line":124,"column":1}},"key":"IyzDgn8EHm"},{"type":"link","url":"https://en.wikipedia.org/wiki/Universal_Transverse_Mercator_coordinate_system","position":{"start":{"line":124,"column":1},"end":{"line":124,"column":1}},"children":[{"type":"text","value":"Universal Transverse Mercator\nsystem","position":{"start":{"line":124,"column":1},"end":{"line":124,"column":1}},"key":"ZtMYIsN6QO"}],"urlSource":"https://en.wikipedia.org/wiki/Universal_Transverse_Mercator_coordinate_system","data":{"page":"Universal_Transverse_Mercator_coordinate_system","wiki":"https://en.wikipedia.org/","lang":"en"},"internal":false,"protocol":"wiki","key":"M6h9aCgFi0"},{"type":"text","value":".\nThis projection uses multiple zones for different parts of the planet and the UK data\nis in UTM zone 30N (","position":{"start":{"line":124,"column":1},"end":{"line":124,"column":1}},"key":"kYiF4TVzh5"},{"type":"link","url":"https://epsg.io/32630","position":{"start":{"line":124,"column":1},"end":{"line":124,"column":1}},"children":[{"type":"text","value":"EPSG code ","position":{"start":{"line":124,"column":1},"end":{"line":124,"column":1}},"key":"WMfu8vzCr7"},{"type":"inlineCode","value":"EPSG:32630","position":{"start":{"line":124,"column":1},"end":{"line":124,"column":1}},"key":"qArRpiE6Bj"}],"urlSource":"https://epsg.io/32630","key":"iomsy3QKsB"},{"type":"text","value":"), with units of\nmeters.","position":{"start":{"line":124,"column":1},"end":{"line":124,"column":1}},"key":"HkbDQWLTUj"}],"key":"wIKYl1A5TG"}],"key":"xQg8hqoBIz"},{"type":"listItem","spread":true,"position":{"start":{"line":131,"column":1},"end":{"line":133,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":131,"column":1},"end":{"line":132,"column":1}},"children":[{"type":"text","value":"The GPS route for Silwood Christmas (Silmas) fun run and walking route. This is again\nin WGS84 projection.","position":{"start":{"line":131,"column":1},"end":{"line":131,"column":1}},"key":"GYmsWNR29C"}],"key":"tx1RwywVq7"}],"key":"p5vfDNwnRd"}],"key":"DHp4RMhwQM"},{"type":"paragraph","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"children":[{"type":"text","value":"The sections below show how to load each dataset.","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"key":"y2vJ1BjN6N"}],"key":"ElkDTGMQX3"},{"type":"heading","depth":3,"position":{"start":{"line":136,"column":1},"end":{"line":136,"column":1}},"children":[{"type":"text","value":"Sensor locations","position":{"start":{"line":136,"column":1},"end":{"line":136,"column":1}},"key":"X6Z9m2F4QJ"}],"identifier":"sensor-locations","label":"Sensor locations","html_id":"sensor-locations","implicit":true,"key":"h0TWYJIjJH"},{"type":"paragraph","position":{"start":{"line":138,"column":1},"end":{"line":141,"column":1}},"children":[{"type":"text","value":"The sensor stations at Silwood and the NHM are recorded as  a CSV file, providing\nstation data including the latitude and longitude of each site. This file is directly\ndownloaded from the Epicollect5 project. This is vector point data: precise locations\nfrom GPS associated with additional site data.","position":{"start":{"line":138,"column":1},"end":{"line":138,"column":1}},"key":"wXC55Ndzqf"}],"key":"aHGK8w7iaB"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":143,"column":1},"end":{"line":149,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":143,"column":1},"end":{"line":144,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":143,"column":1},"end":{"line":143,"column":1}},"children":[{"type":"text","value":"The data is first loaded as a simple CSV file.","position":{"start":{"line":143,"column":1},"end":{"line":143,"column":1}},"key":"ElhXt81jFy"}],"key":"rRaSTAi64A"}],"key":"aZbi1xunn7"},{"type":"listItem","spread":true,"position":{"start":{"line":145,"column":1},"end":{"line":149,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":145,"column":1},"end":{"line":148,"column":1}},"children":[{"type":"text","value":"We then need to convert the data to an ","position":{"start":{"line":145,"column":1},"end":{"line":145,"column":1}},"key":"QEd78af7Cl"},{"type":"inlineCode","value":"sf","position":{"start":{"line":145,"column":1},"end":{"line":145,"column":1}},"key":"LnK2y40fVf"},{"type":"text","value":" (simple features) object. This is very\nlike a normal R data frame, but contains an additional ","position":{"start":{"line":145,"column":1},"end":{"line":145,"column":1}},"key":"bAmZCj0qTs"},{"type":"inlineCode","value":"geometry","position":{"start":{"line":145,"column":1},"end":{"line":145,"column":1}},"key":"kSEB2QLpxB"},{"type":"text","value":" field that contains\nthe vector data geometries and the coordinate system. This is done using the\n","position":{"start":{"line":145,"column":1},"end":{"line":145,"column":1}},"key":"ygNrIO8CCT"},{"type":"inlineCode","value":"sf::st_sf","position":{"start":{"line":145,"column":1},"end":{"line":145,"column":1}},"key":"JOQGuaL1K3"},{"type":"text","value":" function to set the CSV fields that contain the point coordinates.","position":{"start":{"line":145,"column":1},"end":{"line":145,"column":1}},"key":"HtJQc7esq9"}],"key":"DdyktvOQBB"}],"key":"vGNmrtItUC"}],"key":"MvQRAV5zk9"}],"key":"mlYnn1TK5F"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Load the data from the CSV file\nsensor_locations \u003c- read.csv(\"../data/SensorSites/2025/sensor_sites_2025.csv\")\n\n# Convert to an sf object by setting the fields containing X and Y data and set \n# the projection of the dataset\nsensor_locations \u003c- st_as_sf(\n  sensor_locations, \n  coords=c(\"long_Sensor_location\",\"lat_Sensor_location\"),\n  crs=\"EPSG:4326\"\n)","key":"THvzWDFz8k"},{"type":"output","id":"z4-ZkdSJmk54uRnWKVyqR","data":[],"key":"LH3a2oD3rj"}],"key":"MTotYUwzpm"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":163,"column":1},"end":{"line":163,"column":1}},"children":[{"type":"text","value":"Nest boxes","position":{"start":{"line":163,"column":1},"end":{"line":163,"column":1}},"key":"J7GZtWhZUe"}],"identifier":"nest-boxes","label":"Nest boxes","html_id":"nest-boxes","implicit":true,"key":"dTkZsVhU1B"},{"type":"paragraph","position":{"start":{"line":165,"column":1},"end":{"line":169,"column":1}},"children":[{"type":"text","value":"The locations of the Silwood blue tit nest boxes were also recorded using GPS. This is a\nlong-term dataset and these data have already been processed into specific GIS format:\nthe widely used ","position":{"start":{"line":165,"column":1},"end":{"line":165,"column":1}},"key":"hlhgQ1fH8l"},{"type":"link","url":"https://en.wikipedia.org/wiki/Shapefile","position":{"start":{"line":165,"column":1},"end":{"line":165,"column":1}},"children":[{"type":"text","value":"shapefile format","position":{"start":{"line":165,"column":1},"end":{"line":165,"column":1}},"key":"yMn1xleorZ"}],"urlSource":"https://en.wikipedia.org/wiki/Shapefile","data":{"page":"Shapefile","wiki":"https://en.wikipedia.org/","lang":"en"},"internal":false,"protocol":"wiki","key":"EPcBMGySRT"},{"type":"text","value":". The\n","position":{"start":{"line":165,"column":1},"end":{"line":165,"column":1}},"key":"iEMagJluwF"},{"type":"inlineCode","value":"sf::st_read","position":{"start":{"line":165,"column":1},"end":{"line":165,"column":1}},"key":"jPs8ab6rVf"},{"type":"text","value":" function is used to read existing GIS format files directly into an ","position":{"start":{"line":165,"column":1},"end":{"line":165,"column":1}},"key":"U3qPuqFjKb"},{"type":"inlineCode","value":"sf","position":{"start":{"line":165,"column":1},"end":{"line":165,"column":1}},"key":"RUTNRlbqyi"},{"type":"text","value":"\nobject.","position":{"start":{"line":165,"column":1},"end":{"line":165,"column":1}},"key":"uxdTyvPqZQ"}],"key":"an9bpY3oAn"}],"key":"DfQVY0IE9p"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"nest_boxes \u003c- st_read(\"../data/SpatialMethods/NestBoxes/NestBoxes.shp\")","key":"gQtxUh4hO7"},{"type":"output","id":"7Rv2Fk5a7S94PtULnvctW","data":[{"output_type":"stream","name":"stdout","text":"Reading layer `NestBoxes' from data source \n  `/Users/dorme/Teaching/GIS/living_planet_eco_evo_data/practicals/data/SpatialMethods/NestBoxes/NestBoxes.shp' \n  using driver `ESRI Shapefile'\nreplacing null geometries with empty geometries\nSimple feature collection with 222 features and 9 fields (with 2 geometries empty)\nGeometry type: POINT\nDimension:     XY\nBounding box:  xmin: -0.6544148 ymin: 51.40618 xmax: -0.638663 ymax: 51.41621\nGeodetic CRS:  WGS 84\n"}],"key":"LEQYZMEr1R"}],"key":"PygrE137vT"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":175,"column":1},"end":{"line":178,"column":1}},"children":[{"type":"text","value":"As you can see from the output above, loading a GIS file using ","position":{"start":{"line":175,"column":1},"end":{"line":175,"column":1}},"key":"RLO8SVnPaw"},{"type":"inlineCode","value":"sf::stread","position":{"start":{"line":175,"column":1},"end":{"line":175,"column":1}},"key":"cAYSMXPwoI"},{"type":"text","value":" produces\nquite a lot of information. This practical handout will generally hide that to keep the\npage size down. We can also look at what an ","position":{"start":{"line":175,"column":1},"end":{"line":175,"column":1}},"key":"qyS6TNmSHv"},{"type":"inlineCode","value":"sf","position":{"start":{"line":175,"column":1},"end":{"line":175,"column":1}},"key":"l1fVCMZOLf"},{"type":"text","value":" object looks like if you print it out:\nvery like a dataframe with some extra header data.","position":{"start":{"line":175,"column":1},"end":{"line":175,"column":1}},"key":"ejhIzlSomL"}],"key":"rd1mwnuHSy"}],"key":"f27M9zIwiJ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"print(head(nest_boxes))","key":"AfzySKtauS"},{"type":"output","id":"fhs0rOnUl8DntT5A4GdPZ","data":[{"output_type":"stream","name":"stdout","text":"Simple feature collection with 6 features and 9 fields\nGeometry type: POINT\nDimension:     XY\nBounding box:  xmin: -0.6409471 ymin: 51.40993 xmax: -0.638663 ymax: 51.41213\nGeodetic CRS:  WGS 84\n  NestboxID TreeID TreeTag              Species Latitude  Longitude\n1       A01   3938      NA fraxinus.excelsior¬† 51.40993 -0.6386630\n2       A03    611    1322        quercus.robur 51.41107 -0.6400258\n3       A04   3847      NA  acer.pseudoplatanus 51.41167 -0.6393205\n4       A05   3859      NA       betula.pendula 51.41195 -0.6403336\n5       A06    636    1351        quercus.robur 51.41196 -0.6407162\n6       A07    660    5772        quercus.robur 51.41213 -0.6409471\n         SPlocation Type State                    geometry\n1 Observatory copse   26 alive  POINT (-0.638663 51.40993)\n2 Observatory copse   26 alive POINT (-0.6400258 51.41107)\n3 Observatory copse   26 alive POINT (-0.6393205 51.41167)\n4 Observatory copse   26 alive POINT (-0.6403336 51.41195)\n5    Merten's acres   26 alive POINT (-0.6407162 51.41196)\n6    Merten's acres   26 alive POINT (-0.6409471 51.41213)\n"}],"key":"wj3MK1y7R2"}],"key":"wmCgLSCOsQ"},{"type":"block","children":[{"type":"admonition","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Shapefile - not one file!","position":{"start":{"line":184,"column":1},"end":{"line":184,"column":1}},"key":"P4RwWONF9g"}],"key":"W7o4RmuAyY"},{"type":"paragraph","position":{"start":{"line":187,"column":1},"end":{"line":191,"column":1}},"children":[{"type":"text","value":"Confusingly, a ","position":{"start":{"line":187,"column":1},"end":{"line":187,"column":1}},"key":"WWaimKhnRm"},{"type":"strong","position":{"start":{"line":187,"column":1},"end":{"line":187,"column":1}},"children":[{"type":"text","value":"shapefile dataset is not a single file","position":{"start":{"line":187,"column":1},"end":{"line":187,"column":1}},"key":"GDQWYYatRb"}],"key":"SVIWXnYtsj"},{"type":"text","value":" - a shapefile dataset consists\nof a set of related files with the same shared file name and a range of file type\nsuffixes (","position":{"start":{"line":187,"column":1},"end":{"line":187,"column":1}},"key":"zj3LSWx7eQ"},{"type":"inlineCode","value":".shp","position":{"start":{"line":187,"column":1},"end":{"line":187,"column":1}},"key":"egHbcTpU3i"},{"type":"text","value":", ","position":{"start":{"line":187,"column":1},"end":{"line":187,"column":1}},"key":"pauOYpe3G3"},{"type":"inlineCode","value":".dbf","position":{"start":{"line":187,"column":1},"end":{"line":187,"column":1}},"key":"XL5BHtW084"},{"type":"text","value":", ","position":{"start":{"line":187,"column":1},"end":{"line":187,"column":1}},"key":"sor4KijUBL"},{"type":"inlineCode","value":".shx","position":{"start":{"line":187,"column":1},"end":{"line":187,"column":1}},"key":"yfaRTszPQQ"},{"type":"text","value":" and ","position":{"start":{"line":187,"column":1},"end":{"line":187,"column":1}},"key":"vpNL3KOsTR"},{"type":"inlineCode","value":".prj","position":{"start":{"line":187,"column":1},"end":{"line":187,"column":1}},"key":"t4n0i2h6EU"},{"type":"text","value":" are the core subfiles but other suffixes are\ncommon). You ","position":{"start":{"line":187,"column":1},"end":{"line":187,"column":1}},"key":"WQkFpU8DOK"},{"type":"strong","position":{"start":{"line":187,"column":1},"end":{"line":187,"column":1}},"children":[{"type":"text","value":"must keep all of these files together","position":{"start":{"line":187,"column":1},"end":{"line":187,"column":1}},"key":"TrsQ52hlWo"}],"key":"Vog96regji"},{"type":"text","value":", or the dataset will not load\ncorrectly.","position":{"start":{"line":187,"column":1},"end":{"line":187,"column":1}},"key":"PoZk910W9Y"}],"key":"uYlz3uudRd"}],"class":"danger","key":"aUP3NgUIiZ"},{"type":"heading","depth":3,"position":{"start":{"line":194,"column":1},"end":{"line":194,"column":1}},"children":[{"type":"text","value":"Woodland survey","position":{"start":{"line":194,"column":1},"end":{"line":194,"column":1}},"key":"fekiAdWrUo"}],"identifier":"woodland-survey","label":"Woodland survey","html_id":"woodland-survey","implicit":true,"key":"GdER4MAXEv"},{"type":"paragraph","position":{"start":{"line":196,"column":1},"end":{"line":197,"column":1}},"children":[{"type":"text","value":"The Silwood woodland survey transect points: another CSV file providing latitude and\nlongitude of transect locations.","position":{"start":{"line":196,"column":1},"end":{"line":196,"column":1}},"key":"eo4IfC3VPD"}],"key":"jPZ0qljfDL"},{"type":"paragraph","position":{"start":{"line":199,"column":1},"end":{"line":199,"column":1}},"children":[{"type":"text","value":"TODO","position":{"start":{"line":199,"column":1},"end":{"line":199,"column":1}},"key":"qGA6NonCs1"}],"key":"K7e5NmSHm4"},{"type":"heading","depth":3,"position":{"start":{"line":201,"column":1},"end":{"line":201,"column":1}},"children":[{"type":"text","value":"Aerial photography","position":{"start":{"line":201,"column":1},"end":{"line":201,"column":1}},"key":"zXTZo11rdH"}],"identifier":"aerial-photography","label":"Aerial photography","html_id":"aerial-photography","implicit":true,"key":"oDfYwt5eyD"},{"type":"paragraph","position":{"start":{"line":203,"column":1},"end":{"line":207,"column":1}},"children":[{"type":"text","value":"These raster datasets provide 3km by 3km panes of 25cm resolution ","position":{"start":{"line":203,"column":1},"end":{"line":203,"column":1}},"key":"jTz4etKDsk"},{"type":"link","url":"https://digimap.edina.ac.uk/aerial","position":{"start":{"line":203,"column":1},"end":{"line":203,"column":1}},"children":[{"type":"text","value":"aerial photography\nimagery","position":{"start":{"line":203,"column":1},"end":{"line":203,"column":1}},"key":"oHOYTUe9dc"}],"urlSource":"https://digimap.edina.ac.uk/aerial","key":"Ir46l9ryWD"},{"type":"text","value":" for the two sites. These files are provided\nas GeoTIFF data files - these are essentially just ","position":{"start":{"line":203,"column":1},"end":{"line":203,"column":1}},"key":"QtNqmKU95T"},{"type":"link","url":"https://en.wikipedia.org/wiki/TIFF","position":{"start":{"line":203,"column":1},"end":{"line":203,"column":1}},"children":[{"type":"text","value":"standard TIFF\nimage","position":{"start":{"line":203,"column":1},"end":{"line":203,"column":1}},"key":"nvpMoEmUvd"}],"urlSource":"https://en.wikipedia.org/wiki/TIFF","data":{"page":"TIFF","wiki":"https://en.wikipedia.org/","lang":"en"},"internal":false,"protocol":"wiki","key":"mlgVsR1p8V"},{"type":"text","value":" files but contain metadata that provides the\nspatial context of each pixel in the image and the projection information.","position":{"start":{"line":203,"column":1},"end":{"line":203,"column":1}},"key":"Fb4yxlf9AZ"}],"key":"svMs7yD3XV"},{"type":"paragraph","position":{"start":{"line":209,"column":1},"end":{"line":209,"column":1}},"children":[{"type":"text","value":"Raster data can be loaded using the ","position":{"start":{"line":209,"column":1},"end":{"line":209,"column":1}},"key":"TDr5Ttl0zF"},{"type":"inlineCode","value":"terra::rast","position":{"start":{"line":209,"column":1},"end":{"line":209,"column":1}},"key":"CMPtePGyDO"},{"type":"text","value":" function.","position":{"start":{"line":209,"column":1},"end":{"line":209,"column":1}},"key":"n0RbMXvxKJ"}],"key":"YzWygFr3fn"}],"key":"uD7b2PtkQi"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"nhm_aerial \u003c- rast('../data/SpatialMethods/aerial/nhm_aerial.tiff')\nsilwood_aerial \u003c- rast('../data/SpatialMethods/aerial/silwood_aerial.tiff')","key":"wqHNyRb4Tm"},{"type":"output","id":"ddwwfjfOUhSauJEMcXW5u","data":[],"key":"metnsGnHn4"}],"key":"dhf51tE3CM"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":216,"column":1},"end":{"line":218,"column":1}},"children":[{"type":"text","value":"Printing out one of those fhiles shows the spatial information of the raster and then a\ntable showing the names of the bands in the raster and their range. These files contain\nthree band to provide RGB imagery.","position":{"start":{"line":216,"column":1},"end":{"line":216,"column":1}},"key":"KkoH4M2S43"}],"key":"SVkYOXD8Kg"}],"key":"h1wD6nRR7E"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"print(nhm_aerial)","key":"IHPDonb3Dj"},{"type":"output","id":"uXa6z-EJG8eAgiWoG51qu","data":[{"output_type":"stream","name":"stdout","text":"class       : SpatRaster \nsize        : 12000, 12000, 3  (nrow, ncol, nlyr)\nresolution  : 0.25, 0.25  (x, y)\nextent      : 525000, 528000, 178000, 181000  (xmin, xmax, ymin, ymax)\ncoord. ref. : OSGB36 / British National Grid (EPSG:27700) \nsource      : nhm_aerial.tiff \nnames       : tq2578_rgb_250_09_1, tq2578_rgb_250_09_2, tq2578_rgb_250_09_3 \nmin values  :                   0,                   6,                   5 \nmax values  :                 255,                 255,                 255 \n"}],"key":"DgOjaydQBA"}],"key":"AVYuqrba62"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":224,"column":1},"end":{"line":224,"column":1}},"children":[{"type":"text","value":"OS Terrain 5","position":{"start":{"line":224,"column":1},"end":{"line":224,"column":1}},"key":"K4agqvFcL7"}],"identifier":"os-terrain-5","label":"OS Terrain 5","html_id":"os-terrain-5","implicit":true,"key":"kziTIO7urX"},{"type":"paragraph","position":{"start":{"line":226,"column":1},"end":{"line":229,"column":1}},"children":[{"type":"text","value":"These raster datasets provide continuous elevation data at 5m\nresolution from the ","position":{"start":{"line":226,"column":1},"end":{"line":226,"column":1}},"key":"K3S0fi4pCS"},{"type":"link","url":"https://www.ordnancesurvey.co.uk/products/os-terrain-5","position":{"start":{"line":226,"column":1},"end":{"line":226,"column":1}},"children":[{"type":"text","value":"Ordnance Survey Terrain 5 Digital Terrain Map (DTM)\ndataset","position":{"start":{"line":226,"column":1},"end":{"line":226,"column":1}},"key":"g4ukOnJgml"}],"urlSource":"https://www.ordnancesurvey.co.uk/products/os-terrain-5","key":"JY8cJAZd9C"},{"type":"text","value":". Each site has\ntwo adjoining panes of data.","position":{"start":{"line":226,"column":1},"end":{"line":226,"column":1}},"key":"rsQhUjA3M6"}],"key":"PqzDYb9Xy9"},{"type":"admonition","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Aside: coordinates in the British National Grid","position":{"start":{"line":231,"column":1},"end":{"line":231,"column":1}},"key":"dgare6uHBi"}],"key":"otdi7BAfsF"},{"type":"paragraph","position":{"start":{"line":234,"column":1},"end":{"line":239,"column":1}},"children":[{"type":"text","value":"The odd file names come from the British National Grid mapping system. The code ","position":{"start":{"line":234,"column":1},"end":{"line":234,"column":1}},"key":"nNB7dSCZme"},{"type":"inlineCode","value":"SU96NE","position":{"start":{"line":234,"column":1},"end":{"line":234,"column":1}},"key":"JhoKFvBVRn"},{"type":"text","value":"\nindicates the north east quadrant of a 10 x 10 km cell that is found 9 cells east and 6\ncells north within the 100 x 100 km ","position":{"start":{"line":234,"column":1},"end":{"line":234,"column":1}},"key":"k1QTivxjXV"},{"type":"inlineCode","value":"SU","position":{"start":{"line":234,"column":1},"end":{"line":234,"column":1}},"key":"P1wcBVJcYJ"},{"type":"text","value":" cell. The ","position":{"start":{"line":234,"column":1},"end":{"line":234,"column":1}},"key":"WrhKjEaYga"},{"type":"inlineCode","value":"SU","position":{"start":{"line":234,"column":1},"end":{"line":234,"column":1}},"key":"G4HOt7ONEn"},{"type":"text","value":" cell itself is one of 25 cells\nwithin the 500 x 500 km ","position":{"start":{"line":234,"column":1},"end":{"line":234,"column":1}},"key":"mP1AIlTIue"},{"type":"inlineCode","value":"S","position":{"start":{"line":234,"column":1},"end":{"line":234,"column":1}},"key":"UXDUm4gBgG"},{"type":"text","value":" cell. You can add more digits to give more resolution. An 8\ndigit grid reference has a 10 metre precision: the Hamilton building is at ","position":{"start":{"line":234,"column":1},"end":{"line":234,"column":1}},"key":"lHp2xdXJDx"},{"type":"inlineCode","value":"SU 9469 6871","position":{"start":{"line":234,"column":1},"end":{"line":234,"column":1}},"key":"IaZkLsLYKm"},{"type":"text","value":" and the NHM Wildlife Garden is at ","position":{"start":{"line":234,"column":1},"end":{"line":234,"column":1}},"key":"zCIOo2Dl8h"},{"type":"inlineCode","value":"TQ 2656 7899","position":{"start":{"line":234,"column":1},"end":{"line":234,"column":1}},"key":"qk6z8AGwnC"},{"type":"text","value":".","position":{"start":{"line":234,"column":1},"end":{"line":234,"column":1}},"key":"UVtrfB13gD"}],"key":"oTTrxDT406"},{"type":"paragraph","position":{"start":{"line":241,"column":1},"end":{"line":241,"column":1}},"children":[{"type":"text","value":"See ","position":{"start":{"line":241,"column":1},"end":{"line":241,"column":1}},"key":"vtLVuroWBd"},{"type":"link","url":"https://digimap.edina.ac.uk/help/our-maps-and-../data/SpatialMethods/bng/","position":{"start":{"line":241,"column":1},"end":{"line":241,"column":1}},"children":[{"type":"text","value":"here for more details","position":{"start":{"line":241,"column":1},"end":{"line":241,"column":1}},"key":"Jae6ZbudBa"}],"urlSource":"https://digimap.edina.ac.uk/help/our-maps-and-../data/SpatialMethods/bng/","key":"tmZFzFE3fC"},{"type":"text","value":".","position":{"start":{"line":241,"column":1},"end":{"line":241,"column":1}},"key":"R3WzZPWrBS"}],"key":"DE78x8mmPl"}],"class":"tip","key":"Wvn4Lmw663"},{"type":"paragraph","position":{"start":{"line":244,"column":1},"end":{"line":245,"column":1}},"children":[{"type":"text","value":"These files are ","position":{"start":{"line":244,"column":1},"end":{"line":244,"column":1}},"key":"msx1cp7M8w"},{"type":"inlineCode","value":"ASC","position":{"start":{"line":244,"column":1},"end":{"line":244,"column":1}},"key":"iyCSuMhUPK"},{"type":"text","value":" format files - a very simple text based format that contains the\ncell coordinates but ","position":{"start":{"line":244,"column":1},"end":{"line":244,"column":1}},"key":"w7iuaxNGhd"},{"type":"emphasis","position":{"start":{"line":244,"column":1},"end":{"line":244,"column":1}},"children":[{"type":"text","value":"not","position":{"start":{"line":244,"column":1},"end":{"line":244,"column":1}},"key":"wc3xQi4elO"}],"key":"kvGTGCw2tq"},{"type":"text","value":" the projection metadata, so we need to add that information.","position":{"start":{"line":244,"column":1},"end":{"line":244,"column":1}},"key":"jGQhQetl50"}],"key":"nAEMv4C0Hc"}],"key":"lSoU9TB7qn"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Load the DTM data from ASC format files\nsilwood_dtm_SU96NE \u003c- rast(\"../data/SpatialMethods/dtm_5m/SU96NE.asc\")\nsilwood_dtm_SU96NW \u003c- rast(\"../data/SpatialMethods/dtm_5m/SU96NW.asc\")\nnhm_dtm_TQ27NE \u003c- rast(\"../data/SpatialMethods/dtm_5m/TQ27NE.asc\")\nnhm_dtm_TQ28SE \u003c- rast(\"../data/SpatialMethods/dtm_5m/TQ28SE.asc\")","key":"TI0OZXybYw"},{"type":"output","id":"afw5Z3CMWw1kKRoYMe1io","data":[],"key":"J5RarvPrEm"}],"key":"TWbkCzLZeC"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":255,"column":1},"end":{"line":256,"column":1}},"children":[{"type":"text","value":"If we look at one of those datasets, you can see that the cell coordinates, resolution\nand overall dataset size have been set but that the ","position":{"start":{"line":255,"column":1},"end":{"line":255,"column":1}},"key":"sJTrpwD72K"},{"type":"inlineCode","value":"coord. ref","position":{"start":{"line":255,"column":1},"end":{"line":255,"column":1}},"key":"iFWUA2tSOU"},{"type":"text","value":" attribute is empty.","position":{"start":{"line":255,"column":1},"end":{"line":255,"column":1}},"key":"r5m9sWhTbI"}],"key":"rWIRhTZ1vT"}],"key":"lgdVeHFTxO"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Look at the object data\nsilwood_dtm_SU96NE","key":"MtkgFPtbL2"},{"type":"output","id":"bBCkBefa09dmatSzCJfg5","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"class       : SpatRaster \nsize        : 1000, 1000, 1  (nrow, ncol, nlyr)\nresolution  : 5, 5  (x, y)\nextent      : 495000, 5e+05, 165000, 170000  (xmin, xmax, ymin, ymax)\ncoord. ref. :  \nsource      : SU96NE.asc \nname        : SU96NE ","content_type":"text/plain"}}}],"key":"yS0NKvzYC1"}],"key":"VxhBc4HuDO"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":263,"column":1},"end":{"line":264,"column":1}},"children":[{"type":"text","value":"We need to set the projection manually using the ","position":{"start":{"line":263,"column":1},"end":{"line":263,"column":1}},"key":"niQN76Z1KR"},{"type":"inlineCode","value":"terra::crs","position":{"start":{"line":263,"column":1},"end":{"line":263,"column":1}},"key":"F9y67mLI0W"},{"type":"text","value":" function and then check\nthat the attribute has been set.","position":{"start":{"line":263,"column":1},"end":{"line":263,"column":1}},"key":"S70ttqO884"}],"key":"NGOoE4hwzG"}],"key":"DFEfhWcgJC"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Set the projection information for the DTM datasets\ncrs(silwood_dtm_SU96NE) \u003c- crs(silwood_dtm_SU96NW) \u003c- \"EPSG:27700\"\ncrs(nhm_dtm_TQ27NE) \u003c- crs(nhm_dtm_TQ28SE) \u003c- \"EPSG:27700\"\n\n# Print the modified dataset\nsilwood_dtm_SU96NE","key":"NPdp1Kj6Au"},{"type":"output","id":"m_VM9g4U7s6vWG0cG2D9A","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"class       : SpatRaster \nsize        : 1000, 1000, 1  (nrow, ncol, nlyr)\nresolution  : 5, 5  (x, y)\nextent      : 495000, 5e+05, 165000, 170000  (xmin, xmax, ymin, ymax)\ncoord. ref. : OSGB36 / British National Grid (EPSG:27700) \nsource      : SU96NE.asc \nname        : SU96NE ","content_type":"text/plain"}}}],"key":"mPwQMQHbr9"}],"key":"QBGhnfFVyB"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":275,"column":1},"end":{"line":275,"column":1}},"children":[{"type":"text","value":"CEH Land Cover","position":{"start":{"line":275,"column":1},"end":{"line":275,"column":1}},"key":"NPMY3lrVp5"}],"identifier":"ceh-land-cover","label":"CEH Land Cover","html_id":"ceh-land-cover","implicit":true,"key":"IAJEH7XjAU"},{"type":"paragraph","position":{"start":{"line":277,"column":1},"end":{"line":279,"column":1}},"children":[{"type":"text","value":"The Centre for Ecology and Hydrology produces a UK wide land cover map at 10 metre\nresolution. The datasets here are taken from the most recent ","position":{"start":{"line":277,"column":1},"end":{"line":277,"column":1}},"key":"bXuzKz1mmj"},{"type":"link","url":"https://catalogue.ceh.ac.uk/documents/5af9e97d-9f33-495d-8323-e57734388533","position":{"start":{"line":277,"column":1},"end":{"line":277,"column":1}},"children":[{"type":"text","value":"Land Cover Map\n2024","position":{"start":{"line":277,"column":1},"end":{"line":277,"column":1}},"key":"VOzlBV5Urq"}],"urlSource":"https://catalogue.ceh.ac.uk/documents/5af9e97d-9f33-495d-8323-e57734388533","key":"maOn3HRJLw"},{"type":"text","value":".","position":{"start":{"line":277,"column":1},"end":{"line":277,"column":1}},"key":"tqVlTmEUbz"}],"key":"XTJfUD3uoI"},{"type":"paragraph","position":{"start":{"line":281,"column":1},"end":{"line":284,"column":1}},"children":[{"type":"text","value":"The land cover categories are assigned using a classification of multi-band spectral\ndata from satellites onto the spectral signatures of known training sites. Each cell is\nassigned to the category with training signatures that most closely match the spectral\nsignature of the cell.","position":{"start":{"line":281,"column":1},"end":{"line":281,"column":1}},"key":"jduuNXCWRg"}],"key":"ZYjlAqctbj"}],"key":"EXTq4mhKSm"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Load the land cover map datasets\nsilwood_LCM \u003c- rast(\"../data/SpatialMethods/lcm_2024/Silwood_LCM2024.tiff\")\nnhm_LCM \u003c- rast(\"../data/SpatialMethods/lcm_2024/NHM_LCM2024.tiff\")\n\n# Look at the raster details\nprint(silwood_LCM)","key":"WnKhtx54VB"},{"type":"output","id":"1pxOrYGHEZTEqy-jZexpn","data":[{"output_type":"stream","name":"stdout","text":"class       : SpatRaster \nsize        : 300, 300, 2  (nrow, ncol, nlyr)\nresolution  : 10, 10  (x, y)\nextent      : 493000, 496000, 167000, 170000  (xmin, xmax, ymin, ymax)\ncoord. ref. : OSGB36 / British National Grid (EPSG:27700) \nsource      : Silwood_LCM2024.tiff \nnames       : gblcm2024_10m_1, gblcm2024_10m_2 \nmin values  :               1,              13 \nmax values  :              21,             100 \n"}],"key":"m5btTZrOTy"}],"key":"bBgfisuVRN"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":295,"column":1},"end":{"line":298,"column":1}},"children":[{"type":"text","value":"The LCM2024 files contain ","position":{"start":{"line":295,"column":1},"end":{"line":295,"column":1}},"key":"ey7X4wK1LM"},{"type":"strong","position":{"start":{"line":295,"column":1},"end":{"line":295,"column":1}},"children":[{"type":"text","value":"two raster bands","position":{"start":{"line":295,"column":1},"end":{"line":295,"column":1}},"key":"IVzEChviut"}],"key":"owaFGSNPAl"},{"type":"text","value":". The first band is a numeric code\ngiving the land cover category. The second band give the probability of the cell having\nthat land cover type, based on the underlying classification. As loaded, these values\nare just numeric, so if we plot the data, we will get two continuous colour legends:","position":{"start":{"line":295,"column":1},"end":{"line":295,"column":1}},"key":"JIu1ZP6Ca4"}],"key":"thXQisoGpP"}],"key":"IIhBkPn6dp"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"plot(silwood_LCM)","key":"EnRHzLEfqR"},{"type":"output","id":"KylqIU1GHTeXa0xrZOPoG","data":[{"output_type":"display_data","metadata":{"image/png":{"width":420,"height":420}},"data":{"text/plain":{"content":"plot without title","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"353687db9b78344b4d8af2b5f9c9dd70","path":"https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/353687db9b78344b4d8af2b5f9c9dd70.png"}}}],"key":"oSVarrSNE2"}],"key":"gEb994XOid"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":304,"column":1},"end":{"line":305,"column":1}},"children":[{"type":"text","value":"We can add category labels and better category colours to make the data easier to use.\nThe labels and some colours are defined in a separate CSV file:","position":{"start":{"line":304,"column":1},"end":{"line":304,"column":1}},"key":"ZHOGgVhuOc"}],"key":"tlX9wJpnSI"}],"key":"VNO3fHumjT"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"lcm_info \u003c- read.csv(\"../data/SpatialMethods/lcm_2024/LCM2024_info.csv\")\n\n# Set the band names, the category code labels and the colour tables\nlevels(nhm_LCM) \u003c- lcm_info[c(\"value\", \"label\")]\ncoltab(nhm_LCM) \u003c- lcm_info[c(\"value\", \"color\")]\nnames(nhm_LCM) \u003c- c(\"LandCover\", \"Certainty\")\n\ncoltab(silwood_LCM) \u003c- lcm_info[c(\"value\", \"color\")]\nlevels(silwood_LCM) \u003c- lcm_info[c(\"value\", \"label\")]\nnames(silwood_LCM) \u003c- c(\"LandCover\", \"Certainty\")","key":"pa6CPWyVsE"},{"type":"output","id":"jtL8oFDGmcGGLdSzwIKm1","data":[],"key":"iQOgOy3abd"}],"key":"Z34Skp2VM6"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":320,"column":1},"end":{"line":320,"column":1}},"children":[{"type":"text","value":"Now we can now plot maps that have actual category labels:","position":{"start":{"line":320,"column":1},"end":{"line":320,"column":1}},"key":"antR973KhF"}],"key":"FxewbTpgRk"}],"key":"GsonnhyT3Y"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"par(mfrow=c(1,2))\nplot(silwood_LCM[\"LandCover\"])\nplot(nhm_LCM[\"LandCover\"])","key":"Yd5AxGVOGl"},{"type":"output","id":"J1ksWjedpqcmzf5EZ-xoB","data":[{"output_type":"display_data","metadata":{"image/png":{"width":420,"height":420}},"data":{"text/plain":{"content":"plot without title","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"b0d65980d2bb655d1cae63130ca13787","path":"https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/b0d65980d2bb655d1cae63130ca13787.png"}}}],"key":"HflsLS2IiH"}],"key":"AZGbFRpctZ"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":328,"column":1},"end":{"line":328,"column":1}},"children":[{"type":"text","value":"And look at the frequencies of the different categories using the ","position":{"start":{"line":328,"column":1},"end":{"line":328,"column":1}},"key":"CT9njNZBoC"},{"type":"inlineCode","value":"terra::freq","position":{"start":{"line":328,"column":1},"end":{"line":328,"column":1}},"key":"uevYPZoCZh"},{"type":"text","value":" function:","position":{"start":{"line":328,"column":1},"end":{"line":328,"column":1}},"key":"KQXJ85MqGn"}],"key":"jjzLrMcCJP"}],"key":"pgswfDPCkU"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"nhm_freq \u003c- freq(nhm_LCM[\"LandCover\"])\nsilwood_freq \u003c- freq(silwood_LCM[\"LandCover\"])\n\n# Join the two datasets, including all categories\nmerge(\n  nhm_freq, silwood_freq, \n  by=\"value\", all=TRUE, suffixes = c(\".nhm\", \".silwood\")\n)","key":"PKPajALQ6R"},{"type":"output","id":"p9IqGk29AC1RyOneVGn7_","data":[{"output_type":"display_data","metadata":{},"data":{"text/html":{"content":"\u003ctable class=\"dataframe\"\u003e\n\u003ccaption\u003eA data.frame: 13 × 5\u003c/caption\u003e\n\u003cthead\u003e\n\t\u003ctr\u003e\u003cth scope=col\u003evalue\u003c/th\u003e\u003cth scope=col\u003elayer.nhm\u003c/th\u003e\u003cth scope=col\u003ecount.nhm\u003c/th\u003e\u003cth scope=col\u003elayer.silwood\u003c/th\u003e\u003cth scope=col\u003ecount.silwood\u003c/th\u003e\u003c/tr\u003e\n\t\u003ctr\u003e\u003cth scope=col\u003e\u0026lt;chr\u0026gt;\u003c/th\u003e\u003cth scope=col\u003e\u0026lt;dbl\u0026gt;\u003c/th\u003e\u003cth scope=col\u003e\u0026lt;dbl\u0026gt;\u003c/th\u003e\u003cth scope=col\u003e\u0026lt;dbl\u0026gt;\u003c/th\u003e\u003cth scope=col\u003e\u0026lt;dbl\u0026gt;\u003c/th\u003e\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\t\u003ctr\u003e\u003ctd\u003eAcid grassland      \u003c/td\u003e\u003ctd\u003eNA\u003c/td\u003e\u003ctd\u003e   NA\u003c/td\u003e\u003ctd\u003e 1\u003c/td\u003e\u003ctd\u003e  170\u003c/td\u003e\u003c/tr\u003e\n\t\u003ctr\u003e\u003ctd\u003eArable              \u003c/td\u003e\u003ctd\u003e 1\u003c/td\u003e\u003ctd\u003e  176\u003c/td\u003e\u003ctd\u003e 1\u003c/td\u003e\u003ctd\u003e  561\u003c/td\u003e\u003c/tr\u003e\n\t\u003ctr\u003e\u003ctd\u003eBroadleaved woodland\u003c/td\u003e\u003ctd\u003e 1\u003c/td\u003e\u003ctd\u003e 4664\u003c/td\u003e\u003ctd\u003e 1\u003c/td\u003e\u003ctd\u003e23269\u003c/td\u003e\u003c/tr\u003e\n\t\u003ctr\u003e\u003ctd\u003eConiferous woodland \u003c/td\u003e\u003ctd\u003e 1\u003c/td\u003e\u003ctd\u003e  191\u003c/td\u003e\u003ctd\u003e 1\u003c/td\u003e\u003ctd\u003e11379\u003c/td\u003e\u003c/tr\u003e\n\t\u003ctr\u003e\u003ctd\u003eFen, Marsh and Swamp\u003c/td\u003e\u003ctd\u003e 1\u003c/td\u003e\u003ctd\u003e   14\u003c/td\u003e\u003ctd\u003eNA\u003c/td\u003e\u003ctd\u003e   NA\u003c/td\u003e\u003c/tr\u003e\n\t\u003ctr\u003e\u003ctd\u003eFreshwater          \u003c/td\u003e\u003ctd\u003e 1\u003c/td\u003e\u003ctd\u003e 1828\u003c/td\u003e\u003ctd\u003e 1\u003c/td\u003e\u003ctd\u003e 1905\u003c/td\u003e\u003c/tr\u003e\n\t\u003ctr\u003e\u003ctd\u003eHeather and shrub   \u003c/td\u003e\u003ctd\u003e 1\u003c/td\u003e\u003ctd\u003e    6\u003c/td\u003e\u003ctd\u003e 1\u003c/td\u003e\u003ctd\u003e 1172\u003c/td\u003e\u003c/tr\u003e\n\t\u003ctr\u003e\u003ctd\u003eHeather grassland   \u003c/td\u003e\u003ctd\u003e 1\u003c/td\u003e\u003ctd\u003e    7\u003c/td\u003e\u003ctd\u003eNA\u003c/td\u003e\u003ctd\u003e   NA\u003c/td\u003e\u003c/tr\u003e\n\t\u003ctr\u003e\u003ctd\u003eImproved grassland  \u003c/td\u003e\u003ctd\u003e 1\u003c/td\u003e\u003ctd\u003e14716\u003c/td\u003e\u003ctd\u003e 1\u003c/td\u003e\u003ctd\u003e19186\u003c/td\u003e\u003c/tr\u003e\n\t\u003ctr\u003e\u003ctd\u003eNeutral grassland   \u003c/td\u003e\u003ctd\u003e 1\u003c/td\u003e\u003ctd\u003e   97\u003c/td\u003e\u003ctd\u003e 1\u003c/td\u003e\u003ctd\u003e  651\u003c/td\u003e\u003c/tr\u003e\n\t\u003ctr\u003e\u003ctd\u003eSuburban            \u003c/td\u003e\u003ctd\u003e 1\u003c/td\u003e\u003ctd\u003e 6054\u003c/td\u003e\u003ctd\u003e 1\u003c/td\u003e\u003ctd\u003e28930\u003c/td\u003e\u003c/tr\u003e\n\t\u003ctr\u003e\u003ctd\u003eUrban               \u003c/td\u003e\u003ctd\u003e 1\u003c/td\u003e\u003ctd\u003e62241\u003c/td\u003e\u003ctd\u003e 1\u003c/td\u003e\u003ctd\u003e 2777\u003c/td\u003e\u003c/tr\u003e\n\t\u003ctr\u003e\u003ctd\u003eNA                  \u003c/td\u003e\u003ctd\u003e 1\u003c/td\u003e\u003ctd\u003e    6\u003c/td\u003e\u003ctd\u003eNA\u003c/td\u003e\u003ctd\u003e   NA\u003c/td\u003e\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n","content_type":"text/html"},"text/markdown":{"content":"\nA data.frame: 13 × 5\n\n| value \u0026lt;chr\u0026gt; | layer.nhm \u0026lt;dbl\u0026gt; | count.nhm \u0026lt;dbl\u0026gt; | layer.silwood \u0026lt;dbl\u0026gt; | count.silwood \u0026lt;dbl\u0026gt; |\n|---|---|---|---|---|\n| Acid grassland       | NA |    NA |  1 |   170 |\n| Arable               |  1 |   176 |  1 |   561 |\n| Broadleaved woodland |  1 |  4664 |  1 | 23269 |\n| Coniferous woodland  |  1 |   191 |  1 | 11379 |\n| Fen, Marsh and Swamp |  1 |    14 | NA |    NA |\n| Freshwater           |  1 |  1828 |  1 |  1905 |\n| Heather and shrub    |  1 |     6 |  1 |  1172 |\n| Heather grassland    |  1 |     7 | NA |    NA |\n| Improved grassland   |  1 | 14716 |  1 | 19186 |\n| Neutral grassland    |  1 |    97 |  1 |   651 |\n| Suburban             |  1 |  6054 |  1 | 28930 |\n| Urban                |  1 | 62241 |  1 |  2777 |\n| NA                   |  1 |     6 | NA |    NA |\n\n","content_type":"text/markdown"},"text/latex":{"content":"A data.frame: 13 × 5\n\\begin{tabular}{lllll}\n value \u0026 layer.nhm \u0026 count.nhm \u0026 layer.silwood \u0026 count.silwood\\\\\n \u003cchr\u003e \u0026 \u003cdbl\u003e \u0026 \u003cdbl\u003e \u0026 \u003cdbl\u003e \u0026 \u003cdbl\u003e\\\\\n\\hline\n\t Acid grassland       \u0026 NA \u0026    NA \u0026  1 \u0026   170\\\\\n\t Arable               \u0026  1 \u0026   176 \u0026  1 \u0026   561\\\\\n\t Broadleaved woodland \u0026  1 \u0026  4664 \u0026  1 \u0026 23269\\\\\n\t Coniferous woodland  \u0026  1 \u0026   191 \u0026  1 \u0026 11379\\\\\n\t Fen, Marsh and Swamp \u0026  1 \u0026    14 \u0026 NA \u0026    NA\\\\\n\t Freshwater           \u0026  1 \u0026  1828 \u0026  1 \u0026  1905\\\\\n\t Heather and shrub    \u0026  1 \u0026     6 \u0026  1 \u0026  1172\\\\\n\t Heather grassland    \u0026  1 \u0026     7 \u0026 NA \u0026    NA\\\\\n\t Improved grassland   \u0026  1 \u0026 14716 \u0026  1 \u0026 19186\\\\\n\t Neutral grassland    \u0026  1 \u0026    97 \u0026  1 \u0026   651\\\\\n\t Suburban             \u0026  1 \u0026  6054 \u0026  1 \u0026 28930\\\\\n\t Urban                \u0026  1 \u0026 62241 \u0026  1 \u0026  2777\\\\\n\t NA                   \u0026  1 \u0026     6 \u0026 NA \u0026    NA\\\\\n\\end{tabular}\n","content_type":"text/latex"},"text/plain":{"content":"   value                layer.nhm count.nhm layer.silwood count.silwood\n1  Acid grassland       NA           NA      1              170        \n2  Arable                1          176      1              561        \n3  Broadleaved woodland  1         4664      1            23269        \n4  Coniferous woodland   1          191      1            11379        \n5  Fen, Marsh and Swamp  1           14     NA               NA        \n6  Freshwater            1         1828      1             1905        \n7  Heather and shrub     1            6      1             1172        \n8  Heather grassland     1            7     NA               NA        \n9  Improved grassland    1        14716      1            19186        \n10 Neutral grassland     1           97      1              651        \n11 Suburban              1         6054      1            28930        \n12 Urban                 1        62241      1             2777        \n13 NA                    1            6     NA               NA        ","content_type":"text/plain"}}}],"key":"A8YHZRrcE0"}],"key":"KQDdzh8myX"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":341,"column":1},"end":{"line":343,"column":1}},"children":[{"type":"text","value":"We can also use the data within raster layers with other non-spatial data exploration\ntechniques. For example, we can look at the distribution of cell certainties associated\nwith each category.","position":{"start":{"line":341,"column":1},"end":{"line":341,"column":1}},"key":"Fz6wNtFTE2"}],"key":"n0fYmSeBwS"}],"key":"hieRVZtGGO"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"par(mar = c(4, 12, 1, 1))\n\n# Plot cell assignment certainties as a function of land cover category\nboxplot(\n  silwood_LCM[\"Certainty\"], silwood_LCM[\"LandCover\"], \n  las = 1, ylab = \"\", horizontal=TRUE, main=\"Silwood\", xlab=\"Certainty\"\n)\nboxplot(\n  nhm_LCM[\"Certainty\"], nhm_LCM[\"LandCover\"], \n  las = 1, ylab = \"\", horizontal=TRUE, main=\"NHM\", xlab=\"Certainty\"\n)","key":"sg1YXNWnyh"},{"type":"output","id":"-KD_5Jm-kwcuP-ZOg0jcx","data":[{"output_type":"display_data","metadata":{"image/png":{"width":420,"height":420}},"data":{"text/plain":{"content":"Plot with title “Silwood”","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"97167a505dd09d44d6fd44897f2218dd","path":"https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/97167a505dd09d44d6fd44897f2218dd.png"}}},{"output_type":"display_data","metadata":{"image/png":{"width":420,"height":420}},"data":{"text/plain":{"content":"Plot with title “NHM”","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"3ec0958cc72576dcdc148d3e14a24b4d","path":"https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/3ec0958cc72576dcdc148d3e14a24b4d.png"}}}],"key":"rcMaSWT4vp"}],"key":"AkOU6iprsr"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":359,"column":1},"end":{"line":359,"column":1}},"children":[{"type":"text","value":"OS VectorMap Local","position":{"start":{"line":359,"column":1},"end":{"line":359,"column":1}},"key":"Lv57PR8Hhe"}],"identifier":"os-vectormap-local","label":"OS VectorMap Local","html_id":"os-vectormap-local","implicit":true,"key":"OKyyHZBrdP"},{"type":"paragraph","position":{"start":{"line":361,"column":1},"end":{"line":366,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":361,"column":1},"end":{"line":361,"column":1}},"key":"HKJSHltzge"},{"type":"link","url":"https://www.ordnancesurvey.co.uk/products/os-vectormap-local","position":{"start":{"line":361,"column":1},"end":{"line":361,"column":1}},"children":[{"type":"text","value":"Ordnance Survey VectorMap\nLocal","position":{"start":{"line":361,"column":1},"end":{"line":361,"column":1}},"key":"VybF3olUu0"}],"urlSource":"https://www.ordnancesurvey.co.uk/products/os-vectormap-local","key":"gpVZF6Qb9N"},{"type":"text","value":" dataset provides\nvery high precision vector data on spatial features in the UK. These files are saved in\nthe ","position":{"start":{"line":361,"column":1},"end":{"line":361,"column":1}},"key":"Rt6lLiNGye"},{"type":"link","url":"https://en.wikipedia.org/wiki/GeoPackage","position":{"start":{"line":361,"column":1},"end":{"line":361,"column":1}},"children":[{"type":"text","value":"GeoPackage file format (","position":{"start":{"line":361,"column":1},"end":{"line":361,"column":1}},"key":"QuakIFDgXn"},{"type":"inlineCode","value":".gpkg","position":{"start":{"line":361,"column":1},"end":{"line":361,"column":1}},"key":"H7jMQOaniy"},{"type":"text","value":")","position":{"start":{"line":361,"column":1},"end":{"line":361,"column":1}},"key":"QIi4rmp1OA"}],"urlSource":"https://en.wikipedia.org/wiki/GeoPackage","data":{"page":"GeoPackage","wiki":"https://en.wikipedia.org/","lang":"en"},"internal":false,"protocol":"wiki","key":"cNxJsM01Tj"},{"type":"text","value":". As\nwith the Terrain 5 data, the data from Edina Digimap consists of two 5 x 5 km panes for\neach site.","position":{"start":{"line":361,"column":1},"end":{"line":361,"column":1}},"key":"mCya6daegw"}],"key":"cykCcWoWUO"},{"type":"paragraph","position":{"start":{"line":368,"column":1},"end":{"line":371,"column":1}},"children":[{"type":"text","value":"A GeoPackage file can contain multiple vector datasets in a single file: these are\nusually called “layers” and so you will typically load one layer at a time. The code\nbelow uses the ","position":{"start":{"line":368,"column":1},"end":{"line":368,"column":1}},"key":"xK2acHj5jr"},{"type":"inlineCode","value":"sf::st_layers","position":{"start":{"line":368,"column":1},"end":{"line":368,"column":1}},"key":"Xenm8MS5NS"},{"type":"text","value":" command to show the available layers within one of the\nVML datasets.","position":{"start":{"line":368,"column":1},"end":{"line":368,"column":1}},"key":"iXq5pEOwd1"}],"key":"AvmG5fnF8y"}],"key":"nnnmBkSpxj"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"print(st_layers(\"../data/SpatialMethods/VML/vml-su96ne.gpkg\"))","key":"ejJHypuSEC"},{"type":"output","id":"btZoB_U3xX7x8fPKaRFa3","data":[{"output_type":"stream","name":"stdout","text":"Driver: GPKG \nAvailable layers:\n                layer_name geometry_type features fields\n1            Landform_Area       Polygon     1137      3\n2             Urban_Extent       Polygon        5      3\n3                 Building       Polygon     3776      3\n4               Water_Area       Polygon      197      3\n5                   Bridge       Polygon        1      3\n6             General_Line   Line String    17433      3\n7            Building_Line   Line String     3839      3\n8          Height_Contours   Line String      251      3\n9            Landform_Line   Line String      101      3\n10              Water_Line   Line String      659      3\n11 Administrative_Boundary   Line String       11      3\n12         Rail_Centreline   Line String       41      3\n13         Road_Centreline   Line String     1333      5\n14            General_Text         Point      366      9\n15    Road_Centreline_Text         Point     1564      9\n16           Building_Text         Point      120      9\n17             Height_Text         Point      247      9\n18              Water_Text         Point       97      9\n19           General_Point         Point       20      5\n20            Water_Points         Point       69      5\n21           Height_Points         Point       93      5\n                         crs_name\n1  OSGB36 / British National Grid\n2  OSGB36 / British National Grid\n3  OSGB36 / British National Grid\n4  OSGB36 / British National Grid\n5  OSGB36 / British National Grid\n6  OSGB36 / British National Grid\n7  OSGB36 / British National Grid\n8  OSGB36 / British National Grid\n9  OSGB36 / British National Grid\n10 OSGB36 / British National Grid\n11 OSGB36 / British National Grid\n12 OSGB36 / British National Grid\n13 OSGB36 / British National Grid\n14 OSGB36 / British National Grid\n15 OSGB36 / British National Grid\n16 OSGB36 / British National Grid\n17 OSGB36 / British National Grid\n18 OSGB36 / British National Grid\n19 OSGB36 / British National Grid\n20 OSGB36 / British National Grid\n21 OSGB36 / British National Grid\n"}],"key":"WGk2lHxJBv"}],"key":"aoUe0AnGGv"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":377,"column":1},"end":{"line":378,"column":1}},"children":[{"type":"text","value":"We can then use the ","position":{"start":{"line":377,"column":1},"end":{"line":377,"column":1}},"key":"h8TV8e69dm"},{"type":"inlineCode","value":"sf::st_read","position":{"start":{"line":377,"column":1},"end":{"line":377,"column":1}},"key":"IvwVfaQidM"},{"type":"text","value":" function to read specific different layers for each\nsite.","position":{"start":{"line":377,"column":1},"end":{"line":377,"column":1}},"key":"mAtMe5ngtM"}],"key":"maZkDrKSUa"}],"key":"XhSx4mIXzo"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Load the two panes of VML road centrelines for each site.\nvml_tq28se_roads \u003c- st_read(\n  dsn = \"../data/SpatialMethods/VML/vml-tq28se.gpkg\", layer = \"Road_Centreline\"\n)\nvml_tq27ne_roads \u003c- st_read(\n  dsn = \"../data/SpatialMethods/VML/vml-tq27ne.gpkg\", layer = \"Road_Centreline\"\n)\nvml_su96ne_roads \u003c- st_read(\n  dsn = \"../data/SpatialMethods/VML/vml-su96ne.gpkg\", layer = \"Road_Centreline\"\n)\nvml_su96nw_roads \u003c- st_read(\n  dsn = \"../data/SpatialMethods/VML/vml-su96nw.gpkg\", layer = \"Road_Centreline\"\n)\n\n# Do the same for water bodies\nvml_tq28se_water \u003c- st_read(\n  dsn = \"../data/SpatialMethods/VML/vml-tq28se.gpkg\", layer = \"Water_Area\"\n)\nvml_tq27ne_water \u003c- st_read(\n  dsn = \"../data/SpatialMethods/VML/vml-tq27ne.gpkg\", layer = \"Water_Area\"\n)\nvml_su96ne_water \u003c- st_read(\n  dsn = \"../data/SpatialMethods/VML/vml-su96ne.gpkg\", layer = \"Water_Area\"\n)\nvml_su96nw_water \u003c- st_read(\n  dsn = \"../data/SpatialMethods/VML/vml-su96nw.gpkg\", layer = \"Water_Area\"\n)","visibility":"show","key":"OcyPbqLRTI"},{"type":"output","id":"SqoEHpE-5_dzpR82iXlDY","data":[{"output_type":"stream","name":"stdout","text":"Reading layer `Road_Centreline' from data source \n  `/Users/dorme/Teaching/GIS/living_planet_eco_evo_data/practicals/data/SpatialMethods/VML/vml-tq28se.gpkg' \n  using driver `GPKG'\nSimple feature collection with 8916 features and 5 fields\nGeometry type: LINESTRING\nDimension:     XY\nBounding box:  xmin: 524731 ymin: 179744.5 xmax: 530112 ymax: 185228.1\nProjected CRS: OSGB36 / British National Grid\n"},{"output_type":"stream","name":"stdout","text":"Reading layer `Road_Centreline' from data source \n  `/Users/dorme/Teaching/GIS/living_planet_eco_evo_data/practicals/data/SpatialMethods/VML/vml-tq27ne.gpkg' \n  using driver `GPKG'\nSimple feature collection with 8122 features and 5 fields\nGeometry type: LINESTRING\nDimension:     XY\nBounding box:  xmin: 524579.6 ymin: 174853.7 xmax: 530153.2 ymax: 180470.7\nProjected CRS: OSGB36 / British National Grid\n"},{"output_type":"stream","name":"stdout","text":"Reading layer `Road_Centreline' from data source \n  `/Users/dorme/Teaching/GIS/living_planet_eco_evo_data/practicals/data/SpatialMethods/VML/vml-su96ne.gpkg' \n  using driver `GPKG'\nSimple feature collection with 1333 features and 5 fields\nGeometry type: LINESTRING\nDimension:     XY\nBounding box:  xmin: 494774.3 ymin: 164397 xmax: 500586 ymax: 170268.6\nProjected CRS: OSGB36 / British National Grid\n"},{"output_type":"stream","name":"stdout","text":"Reading layer `Road_Centreline' from data source \n  `/Users/dorme/Teaching/GIS/living_planet_eco_evo_data/practicals/data/SpatialMethods/VML/vml-su96nw.gpkg' \n  using driver `GPKG'\nSimple feature collection with 1956 features and 5 fields\nGeometry type: LINESTRING\nDimension:     XY\nBounding box:  xmin: 488519.8 ymin: 164588.5 xmax: 495366 ymax: 170367.4\nProjected CRS: OSGB36 / British National Grid\n"},{"output_type":"stream","name":"stdout","text":"Reading layer `Water_Area' from data source \n  `/Users/dorme/Teaching/GIS/living_planet_eco_evo_data/practicals/data/SpatialMethods/VML/vml-tq28se.gpkg' \n  using driver `GPKG'\nSimple feature collection with 129 features and 3 fields\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 524874.3 ymin: 179936 xmax: 530118.6 ymax: 184188.5\nProjected CRS: OSGB36 / British National Grid\n"},{"output_type":"stream","name":"stdout","text":"Reading layer `Water_Area' from data source \n  `/Users/dorme/Teaching/GIS/living_planet_eco_evo_data/practicals/data/SpatialMethods/VML/vml-tq27ne.gpkg' \n  using driver `GPKG'\nSimple feature collection with 113 features and 3 fields\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 525000 ymin: 174967.8 xmax: 530019.1 ymax: 180203.8\nProjected CRS: OSGB36 / British National Grid\n"},{"output_type":"stream","name":"stdout","text":"Reading layer `Water_Area' from data source \n  `/Users/dorme/Teaching/GIS/living_planet_eco_evo_data/practicals/data/SpatialMethods/VML/vml-su96ne.gpkg' \n  using driver `GPKG'\nSimple feature collection with 197 features and 3 fields\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 494889.5 ymin: 164949.9 xmax: 500058.7 ymax: 170239.3\nProjected CRS: OSGB36 / British National Grid\n"},{"output_type":"stream","name":"stdout","text":"Reading layer `Water_Area' from data source \n  `/Users/dorme/Teaching/GIS/living_planet_eco_evo_data/practicals/data/SpatialMethods/VML/vml-su96nw.gpkg' \n  using driver `GPKG'\nSimple feature collection with 241 features and 3 fields\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 489969.7 ymin: 165112.2 xmax: 495114.6 ymax: 170260.6\nProjected CRS: OSGB36 / British National Grid\n"}],"visibility":"remove","key":"EaemmQCu7d"}],"data":{"tags":[]},"visibility":"show","key":"r12oBOgBlR"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":412,"column":1},"end":{"line":412,"column":1}},"children":[{"type":"text","value":"Sentinel 2 data","position":{"start":{"line":412,"column":1},"end":{"line":412,"column":1}},"key":"qhCEzr2YlC"}],"identifier":"sentinel-2-data","label":"Sentinel 2 data","html_id":"sentinel-2-data","implicit":true,"key":"IuC3W41pe3"},{"type":"paragraph","position":{"start":{"line":414,"column":1},"end":{"line":418,"column":1}},"children":[{"type":"text","value":"The Sentinel 2 satellite mission collects spectral data from ","position":{"start":{"line":414,"column":1},"end":{"line":414,"column":1}},"key":"WDG4ylhotp"},{"type":"link","url":"https://custom-scripts.sentinel-hub.com/sentinel-2/bands/","position":{"start":{"line":414,"column":1},"end":{"line":414,"column":1}},"children":[{"type":"text","value":"13\nbands","position":{"start":{"line":414,"column":1},"end":{"line":414,"column":1}},"key":"OeuFZZWUCm"}],"urlSource":"https://custom-scripts.sentinel-hub.com/sentinel-2/bands/","key":"jKHmI6UuiE"},{"type":"text","value":" across the visible,\nnear infra-red and infra-red at resolutions from 10m to 60m. See the ","position":{"start":{"line":414,"column":1},"end":{"line":414,"column":1}},"key":"nYSkDrKZf3"},{"type":"link","url":"https://sentiwiki.copernicus.eu/web/sentinel-2","position":{"start":{"line":414,"column":1},"end":{"line":414,"column":1}},"children":[{"type":"text","value":"Copernicus\nSentinel 2 data wiki","position":{"start":{"line":414,"column":1},"end":{"line":414,"column":1}},"key":"mH92W3JCAy"}],"urlSource":"https://sentiwiki.copernicus.eu/web/sentinel-2","key":"E60rHG3UyF"},{"type":"text","value":" for more\ninformation about the mission and data processing.","position":{"start":{"line":414,"column":1},"end":{"line":414,"column":1}},"key":"PCZb91bmJZ"}],"key":"Z3SCMASnVt"},{"type":"paragraph","position":{"start":{"line":420,"column":1},"end":{"line":427,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":420,"column":1},"end":{"line":420,"column":1}},"key":"eFLboBTEQA"},{"type":"inlineCode","value":"sentinel_2","position":{"start":{"line":420,"column":1},"end":{"line":420,"column":1}},"key":"thIaumVrKJ"},{"type":"text","value":" folder contains data from a single (relatively cloud free!) scene from\nthe ","position":{"start":{"line":420,"column":1},"end":{"line":420,"column":1}},"key":"rEONj9DAQd"},{"type":"link","url":"https://sentiwiki.copernicus.eu/web/s2-products#S2Products-Level-2AProductsS2-Products-L2Atrue","position":{"start":{"line":420,"column":1},"end":{"line":420,"column":1}},"children":[{"type":"text","value":"Sentinel 2 Level 2A data\nproduct","position":{"start":{"line":420,"column":1},"end":{"line":420,"column":1}},"key":"yOz1RG70Hc"}],"urlSource":"https://sentiwiki.copernicus.eu/web/s2-products#S2Products-Level-2AProductsS2-Products-L2Atrue","key":"C1AJQZYMpc"},{"type":"text","value":"\nthat was downloaded using the ","position":{"start":{"line":420,"column":1},"end":{"line":420,"column":1}},"key":"DMxmZj0d1v"},{"type":"link","url":"https://browser.dataspace.copernicus.eu/","position":{"start":{"line":420,"column":1},"end":{"line":420,"column":1}},"children":[{"type":"text","value":"Copernicus data\nbrowser","position":{"start":{"line":420,"column":1},"end":{"line":420,"column":1}},"key":"thDbYeUQAk"}],"urlSource":"https://browser.dataspace.copernicus.eu/","key":"nEmDcUi3g6"},{"type":"text","value":". The L2A data product has been\nprocessed to remove atmospheric effects to give modelled surface reflectance values for\neach band and also to add some extra calculated layers, such as true colour images (more\non this later!).","position":{"start":{"line":420,"column":1},"end":{"line":420,"column":1}},"key":"pSoI3XIxXD"}],"key":"GUwnV4nY1v"},{"type":"paragraph","position":{"start":{"line":429,"column":1},"end":{"line":434,"column":1}},"children":[{"type":"text","value":"A single scene of L2A data covers roughly 110 x 110 km and contains about 1 GB of data,\nso has been cropped down to the two study sites (see ","position":{"start":{"line":429,"column":1},"end":{"line":429,"column":1}},"key":"IOv37Wov8i"},{"type":"crossReference","position":{"start":{"line":429,"column":1},"end":{"line":429,"column":1}},"children":[{"type":"text","value":"below","position":{"start":{"line":429,"column":1},"end":{"line":429,"column":1}},"key":"jfvtWTGFrt"}],"identifier":"cropping-rasters","label":"cropping-rasters","kind":"heading","template":"{name}","resolved":true,"html_id":"cropping-rasters","key":"Y8CFNjibeD"},{"type":"text","value":"). The\ncode below loads the four 10m resolution bands into a single raster for each site by\nproviding a vector of file names to the ","position":{"start":{"line":429,"column":1},"end":{"line":429,"column":1}},"key":"Ybh2e3YtBP"},{"type":"inlineCode","value":"terra::rast","position":{"start":{"line":429,"column":1},"end":{"line":429,"column":1}},"key":"NbI9V3tGVb"},{"type":"text","value":" function. It also rescales the\ndata: remote sensing data is often stored as integer data to save file space and needs\nconverting to actual values, in this case by dividing by 10000.","position":{"start":{"line":429,"column":1},"end":{"line":429,"column":1}},"key":"pxn6r1rOvD"}],"key":"Oyzp4NlZzm"}],"key":"Qti68lZkcn"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Load the four 10m resolution Sentinel 2 bands for Silwood\ns2_silwood_10m \u003c- rast(\n    c(\n        \"../data/SpatialMethods/sentinel_2/R10m/silwood/T30UXC_20250711T110651_B02_10m.tiff\",\n        \"../data/SpatialMethods/sentinel_2/R10m/silwood/T30UXC_20250711T110651_B03_10m.tiff\",\n        \"../data/SpatialMethods/sentinel_2/R10m/silwood/T30UXC_20250711T110651_B04_10m.tiff\",\n        \"../data/SpatialMethods/sentinel_2/R10m/silwood/T30UXC_20250711T110651_B08_10m.tiff\"\n    ),\n)  / 10000\n\n# Name the bands \nnames(s2_silwood_10m) \u003c- c(\"B\", \"G\", \"R\", \"NIR\")\n\n# Do the same for the NHM\ns2_nhm_10m \u003c- rast(\n    c(\n        \"../data/SpatialMethods/sentinel_2/R10m/nhm/T30UXC_20250711T110651_B02_10m.tiff\",\n        \"../data/SpatialMethods/sentinel_2/R10m/nhm/T30UXC_20250711T110651_B03_10m.tiff\",\n        \"../data/SpatialMethods/sentinel_2/R10m/nhm/T30UXC_20250711T110651_B04_10m.tiff\",\n        \"../data/SpatialMethods/sentinel_2/R10m/nhm/T30UXC_20250711T110651_B08_10m.tiff\"\n    ),\n) / 10000\nnames(s2_nhm_10m) \u003c- c(\"B\", \"G\", \"R\", \"NIR\")\n\n# Show the resulting object structure\nprint(s2_silwood_10m)","key":"J8GnmsddJR"},{"type":"output","id":"GglOslpatHVDuAf9OBQ3h","data":[{"output_type":"stream","name":"stdout","text":"class       : SpatRaster \nsize        : 312, 312, 4  (nrow, ncol, nlyr)\nresolution  : 10, 10  (x, y)\nextent      : 662390, 665510, 5696240, 5699360  (xmin, xmax, ymin, ymax)\ncoord. ref. : WGS 84 / UTM zone 30N (EPSG:32630) \nsource(s)   : memory\nnames       :      B,     G,      R,    NIR \nmin values  : 0.1067, 0.110, 0.1085, 0.1060 \nmax values  : 0.5808, 0.616, 0.6088, 0.7964 \n"}],"key":"SSYJsE1MRI"}],"key":"FhgVc68PSh"},{"type":"block","children":[{"type":"admonition","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Exercise","position":{"start":{"line":465,"column":1},"end":{"line":465,"column":1}},"key":"JySUloAN31"}],"key":"YX3gHk7zLG"},{"type":"paragraph","position":{"start":{"line":467,"column":1},"end":{"line":472,"column":1}},"children":[{"type":"text","value":"The Sentinel 2 dataset directory also includes the band data sampled at 20m and 60m\nresolution. The 60m bands are largely aimed at detecting water vapour and clouds, but\nthe 20 metre bands include red edge, narrow near infrared and short wave infrared data\nthat can be useful. Use the code above as a template to load Bands 5, 6, 7, 8A, 11 and\n12 from the 20 meter directories for each site. Note that the 20m directory also\ncontains downsampled data from the 10 metre bands.","position":{"start":{"line":467,"column":1},"end":{"line":467,"column":1}},"key":"N4A8CSl7SX"}],"key":"RgHC3QyBtk"},{"type":"paragraph","position":{"start":{"line":474,"column":1},"end":{"line":475,"column":1}},"children":[{"type":"text","value":"The resulting objects should be called ","position":{"start":{"line":474,"column":1},"end":{"line":474,"column":1}},"key":"gVNsOK4oyR"},{"type":"inlineCode","value":"s2_silwood_20m","position":{"start":{"line":474,"column":1},"end":{"line":474,"column":1}},"key":"pyVkmKGRFw"},{"type":"text","value":" and ","position":{"start":{"line":474,"column":1},"end":{"line":474,"column":1}},"key":"w7j4d3sLlQ"},{"type":"inlineCode","value":"s2_nhm_20m","position":{"start":{"line":474,"column":1},"end":{"line":474,"column":1}},"key":"gWX1qDyB5W"},{"type":"text","value":" and the bands\nshould be named ","position":{"start":{"line":474,"column":1},"end":{"line":474,"column":1}},"key":"RTYZSHsRCw"},{"type":"inlineCode","value":"RE5","position":{"start":{"line":474,"column":1},"end":{"line":474,"column":1}},"key":"IRhL1fpPgq"},{"type":"text","value":", ","position":{"start":{"line":474,"column":1},"end":{"line":474,"column":1}},"key":"no2JWdUtb5"},{"type":"inlineCode","value":"RE6","position":{"start":{"line":474,"column":1},"end":{"line":474,"column":1}},"key":"wgKeTwV8vd"},{"type":"text","value":", ","position":{"start":{"line":474,"column":1},"end":{"line":474,"column":1}},"key":"PS664lpjcS"},{"type":"inlineCode","value":"RE7","position":{"start":{"line":474,"column":1},"end":{"line":474,"column":1}},"key":"POckQzM9rE"},{"type":"text","value":", ","position":{"start":{"line":474,"column":1},"end":{"line":474,"column":1}},"key":"WTcuNN3GAw"},{"type":"inlineCode","value":"NNIR","position":{"start":{"line":474,"column":1},"end":{"line":474,"column":1}},"key":"dr5Hcj50oo"},{"type":"text","value":", ","position":{"start":{"line":474,"column":1},"end":{"line":474,"column":1}},"key":"FKqOH5spLp"},{"type":"inlineCode","value":"SWIR1","position":{"start":{"line":474,"column":1},"end":{"line":474,"column":1}},"key":"hxKUCczweD"},{"type":"text","value":" and ","position":{"start":{"line":474,"column":1},"end":{"line":474,"column":1}},"key":"Qcvio0HV8h"},{"type":"inlineCode","value":"SWIR2","position":{"start":{"line":474,"column":1},"end":{"line":474,"column":1}},"key":"oYH6dsjXd0"},{"type":"text","value":".","position":{"start":{"line":474,"column":1},"end":{"line":474,"column":1}},"key":"VqEyoLL0TM"}],"key":"j4G0lDmrzF"}],"key":"KPkIhNZoN8"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Show solution","position":{"start":{"line":478,"column":1},"end":{"line":478,"column":1}},"key":"xTqwOsPhMi"}],"key":"ikMFLJZVoS"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Load the six 20m resolution Sentinel 2 bands for Silwood\ns2_silwood_20m \u003c- rast(\n    c(\n        \"../data/SpatialMethods/sentinel_2/R20m/silwood/T30UXC_20250711T110651_B05_20m.tiff\",\n        \"../data/SpatialMethods/sentinel_2/R20m/silwood/T30UXC_20250711T110651_B06_20m.tiff\",\n        \"../data/SpatialMethods/sentinel_2/R20m/silwood/T30UXC_20250711T110651_B07_20m.tiff\",\n        \"../data/SpatialMethods/sentinel_2/R20m/silwood/T30UXC_20250711T110651_B8A_20m.tiff\",\n        \"../data/SpatialMethods/sentinel_2/R20m/silwood/T30UXC_20250711T110651_B11_20m.tiff\",\n        \"../data/SpatialMethods/sentinel_2/R20m/silwood/T30UXC_20250711T110651_B12_20m.tiff\"\n    ),\n) / 10000\n\n# Name the bands \nnames(s2_silwood_20m) \u003c- c(\"RE5\", \"RE6\", \"RE7\", \"NNIR\", \"SWIR1\", \"SWIR2\")\n\n# Load the seven 20m resolution Sentinel 2 bands for the NHM\ns2_nhm_20m \u003c- rast(\n    c(\n        \"../data/SpatialMethods/sentinel_2/R20m/nhm/T30UXC_20250711T110651_B05_20m.tiff\",\n        \"../data/SpatialMethods/sentinel_2/R20m/nhm/T30UXC_20250711T110651_B06_20m.tiff\",\n        \"../data/SpatialMethods/sentinel_2/R20m/nhm/T30UXC_20250711T110651_B07_20m.tiff\",\n        \"../data/SpatialMethods/sentinel_2/R20m/nhm/T30UXC_20250711T110651_B8A_20m.tiff\",\n        \"../data/SpatialMethods/sentinel_2/R20m/nhm/T30UXC_20250711T110651_B11_20m.tiff\",\n        \"../data/SpatialMethods/sentinel_2/R20m/nhm/T30UXC_20250711T110651_B12_20m.tiff\"\n    ),\n) / 10000\n\n# Name the bands \nnames(s2_nhm_20m) \u003c- c(\"RE5\", \"RE6\", \"RE7\", \"NNIR\", \"SWIR1\", \"SWIR2\")","key":"vXvHExwMQ3"},{"type":"output","id":"33MKVxtvJaoM8qulVH_YM","data":[],"key":"iKQPedXs6E"}],"key":"LfLayIYro2"}],"class":"dropdown","key":"CY21kLA6NF"},{"type":"heading","depth":3,"position":{"start":{"line":516,"column":1},"end":{"line":516,"column":1}},"children":[{"type":"text","value":"Silmas walk/run route","position":{"start":{"line":516,"column":1},"end":{"line":516,"column":1}},"key":"cIwOyXT6nD"}],"identifier":"silmas-walk-run-route","label":"Silmas walk/run route","html_id":"silmas-walk-run-route","implicit":true,"key":"mLIhLu7Pcp"},{"type":"paragraph","position":{"start":{"line":518,"column":1},"end":{"line":521,"column":1}},"children":[{"type":"text","value":"The last dataset is a ","position":{"start":{"line":518,"column":1},"end":{"line":518,"column":1}},"key":"vDhx8NOUjo"},{"type":"link","url":"https://en.wikipedia.org/wiki/GPS_Exchange_Format","position":{"start":{"line":518,"column":1},"end":{"line":518,"column":1}},"children":[{"type":"text","value":"GPS Exchange Format (GPX)\nfile","position":{"start":{"line":518,"column":1},"end":{"line":518,"column":1}},"key":"bGmPGDMBTd"}],"urlSource":"https://en.wikipedia.org/wiki/GPS_Exchange_Format","data":{"page":"GPS_Exchange_Format","wiki":"https://en.wikipedia.org/","lang":"en"},"internal":false,"protocol":"wiki","key":"mPQFvWaMOc"},{"type":"text","value":" containing the course of the\nSilmas fun run and walking route. The GPX format is a commonly used format to record\nroutes and points from GPS devices. Again, the format holds multiple layers:","position":{"start":{"line":518,"column":1},"end":{"line":518,"column":1}},"key":"Msm5omwmlC"}],"key":"EXHSEofR92"}],"key":"Xh3XcmKDyW"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"print(st_layers(\"../data/SpatialMethods/Silmas_Fun_Run.gpx\"))","key":"dZrSZD5CZO"},{"type":"output","id":"g8CJ1dbH4oJLSGPxe1yqp","data":[{"output_type":"stream","name":"stdout","text":"Driver: GPX \nAvailable layers:\n    layer_name     geometry_type features fields crs_name\n1    waypoints             Point        0     23   WGS 84\n2       routes       Line String        0     12   WGS 84\n3       tracks Multi Line String        1     12   WGS 84\n4 route_points             Point        0     25   WGS 84\n5 track_points             Point      425     26   WGS 84\n"}],"key":"ud84sdLClJ"}],"key":"IIsXvsYdBy"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":527,"column":1},"end":{"line":530,"column":1}},"children":[{"type":"text","value":"With GPX files, there are a fixed number of layers. They are not all used in this file:\nwe have a single linear feature in ","position":{"start":{"line":527,"column":1},"end":{"line":527,"column":1}},"key":"GWILmhcO5E"},{"type":"inlineCode","value":"tracks","position":{"start":{"line":527,"column":1},"end":{"line":527,"column":1}},"key":"x6cuIqw0mv"},{"type":"text","value":" layer, which is the Silmas route, and then\nthe 425 point features in the ","position":{"start":{"line":527,"column":1},"end":{"line":527,"column":1}},"key":"ZpWPlAHHoE"},{"type":"inlineCode","value":"track_points","position":{"start":{"line":527,"column":1},"end":{"line":527,"column":1}},"key":"sC2zixr2DL"},{"type":"text","value":" layer, which are the points along\nalong that route. We will load the  ","position":{"start":{"line":527,"column":1},"end":{"line":527,"column":1}},"key":"Y4zAMX3Dxz"},{"type":"inlineCode","value":"tracks","position":{"start":{"line":527,"column":1},"end":{"line":527,"column":1}},"key":"lov8h50XBv"},{"type":"text","value":" layer:","position":{"start":{"line":527,"column":1},"end":{"line":527,"column":1}},"key":"KKsKx2jTQH"}],"key":"tbq9SOgEIj"}],"key":"dduKEluXOw"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"silmas_route \u003c- st_read(\n  dsn=\"../data/SpatialMethods/Silmas_Fun_Run.gpx\", layer=\"tracks\"\n)","key":"q8Q3rCxqvk"},{"type":"output","id":"nIfc5fztWxSPVfcVgH0A-","data":[{"output_type":"stream","name":"stdout","text":"Reading layer `tracks' from data source \n  `/Users/dorme/Teaching/GIS/living_planet_eco_evo_data/practicals/data/SpatialMethods/Silmas_Fun_Run.gpx' \n  using driver `GPX'\nSimple feature collection with 1 feature and 12 fields\nGeometry type: MULTILINESTRING\nDimension:     XY\nBounding box:  xmin: -0.650703 ymin: 51.40805 xmax: -0.63996 ymax: 51.42044\nGeodetic CRS:  WGS 84\n"}],"key":"DR3Eat0AOd"}],"key":"uzCoSK1Snm"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":538,"column":1},"end":{"line":538,"column":1}},"children":[{"type":"text","value":"Plotting GIS data","position":{"start":{"line":538,"column":1},"end":{"line":538,"column":1}},"key":"FgV0UtGWs8"}],"identifier":"plotting-gis-data","label":"Plotting GIS data","html_id":"plotting-gis-data","implicit":true,"key":"V5bM89xWjO"},{"type":"admonition","kind":"hint","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Hint","key":"SD9UfoWssA"}],"key":"i54j1qUcSa"},{"type":"paragraph","position":{"start":{"line":541,"column":1},"end":{"line":542,"column":1}},"children":[{"type":"text","value":"These are very basic plotting tips for GIS data, but are all we need for this\npractical.","position":{"start":{"line":541,"column":1},"end":{"line":541,"column":1}},"key":"UvoggOMPB1"}],"key":"McbeG4dBGY"}],"key":"mAYcvIpgHk"},{"type":"heading","depth":3,"position":{"start":{"line":545,"column":1},"end":{"line":545,"column":1}},"children":[{"type":"text","value":"Plotting vector data","position":{"start":{"line":545,"column":1},"end":{"line":545,"column":1}},"key":"Mde4BnHwEM"}],"identifier":"plotting-vector-data","label":"Plotting vector data","html_id":"plotting-vector-data","implicit":true,"key":"lcYo591gyB"},{"type":"paragraph","position":{"start":{"line":547,"column":1},"end":{"line":548,"column":1}},"children":[{"type":"text","value":"If you plot a vector dataset, then it will generate a panel for each vector attribute in\nthe dataset (up to a limit!).","position":{"start":{"line":547,"column":1},"end":{"line":547,"column":1}},"key":"d3XNkIzPx6"}],"key":"MTz00WrfD7"}],"key":"eTnensQjAx"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"plot(nest_boxes)","key":"uVZ8vmi5Gs"},{"type":"output","id":"t8WIgsaBUycYq401CSk_B","data":[{"output_type":"display_data","metadata":{"image/png":{"width":420,"height":420}},"data":{"text/plain":{"content":"Plot with title “State”","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"41283114c132e9c6e409775e81df4392","path":"https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/41283114c132e9c6e409775e81df4392.png"}}}],"key":"lLH8wrKuXr"}],"key":"MkuGsaI67B"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":554,"column":1},"end":{"line":555,"column":1}},"children":[{"type":"text","value":"If you want to plot just one of those attributes, then you can use ","position":{"start":{"line":554,"column":1},"end":{"line":554,"column":1}},"key":"S3CCFFuY4T"},{"type":"inlineCode","value":"[]","position":{"start":{"line":554,"column":1},"end":{"line":554,"column":1}},"key":"n3UHp3XLpC"},{"type":"text","value":" subsets to do\nso, and R will generate a key for it.","position":{"start":{"line":554,"column":1},"end":{"line":554,"column":1}},"key":"QEGgthqnQe"}],"key":"WIH0KteBIe"}],"key":"CGDHm1201q"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"plot(nest_boxes['SPlocation'], key.pos=4)","key":"HdnYF9Hs0q"},{"type":"output","id":"one8AKWpF9-5qGjG3qx7E","data":[{"output_type":"display_data","metadata":{"image/png":{"width":420,"height":420}},"data":{"text/plain":{"content":"Plot with title “SPlocation”","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"65a477570ff7d4a1cec6bedca555c32d","path":"https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/65a477570ff7d4a1cec6bedca555c32d.png"}}}],"key":"Yxi20bCHeZ"}],"key":"tGwcK7YuIV"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":561,"column":1},"end":{"line":566,"column":1}},"children":[{"type":"text","value":"If you just want to plot the features geometry, then you can use ","position":{"start":{"line":561,"column":1},"end":{"line":561,"column":1}},"key":"L0DSkf8FmN"},{"type":"inlineCode","value":"sf::st_geometry","position":{"start":{"line":561,"column":1},"end":{"line":561,"column":1}},"key":"muooixizpb"},{"type":"text","value":". You\ncan use ","position":{"start":{"line":561,"column":1},"end":{"line":561,"column":1}},"key":"l7zwzmnT8z"},{"type":"inlineCode","value":"add=TRUE","position":{"start":{"line":561,"column":1},"end":{"line":561,"column":1}},"key":"ZDZanXJ588"},{"type":"text","value":" to overplot features and you can use extent to change the spatial\narea being plotted. It can be tricky to set the area of the plot so that it will include\nall features. One trick here is to get the extent (or bounding box) of the layers you\nwant to plot and then convert them to polygons using ","position":{"start":{"line":561,"column":1},"end":{"line":561,"column":1}},"key":"bXCfQUQib9"},{"type":"inlineCode","value":"sf::st_as_sfc","position":{"start":{"line":561,"column":1},"end":{"line":561,"column":1}},"key":"iTGGAhga6s"},{"type":"text","value":" and then take the\nspatial union(","position":{"start":{"line":561,"column":1},"end":{"line":561,"column":1}},"key":"yapdKsEZgD"},{"type":"inlineCode","value":"sf::st_union","position":{"start":{"line":561,"column":1},"end":{"line":561,"column":1}},"key":"iHgMYHmCRt"},{"type":"text","value":") of those boxes. Long-winded but reliable!","position":{"start":{"line":561,"column":1},"end":{"line":561,"column":1}},"key":"Oect8k5y2o"}],"key":"wKKrSpm1vb"}],"key":"VpbOa7GDNT"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Get the plot extent as the union of the bounding boxes\nplot_extent \u003c- st_union(\n  st_as_sfc(st_bbox(nest_boxes)),\n  st_as_sfc(st_bbox(silmas_route))\n)\n\n# Plot the nest box points and overplot the Silmas route\nplot(st_geometry(nest_boxes), col=\"forestgreen\", extent=plot_extent)\nplot(st_geometry(silmas_route), col=\"red\", add=TRUE)","key":"KhMlou1FR0"},{"type":"output","id":"dYV4I3DxZIBm4jWDpol4I","data":[{"output_type":"display_data","metadata":{"image/png":{"width":420,"height":420}},"data":{"text/plain":{"content":"plot without title","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"ab8967b6d63b733cbf2bb2ae3fc6ab4f","path":"https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/ab8967b6d63b733cbf2bb2ae3fc6ab4f.png"}}}],"key":"bVSRu4JhYa"}],"key":"D2BK1EFuDt"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":580,"column":1},"end":{"line":580,"column":1}},"children":[{"type":"text","value":"Plotting raster data","position":{"start":{"line":580,"column":1},"end":{"line":580,"column":1}},"key":"nuXuYuly9y"}],"identifier":"plotting-raster-data","label":"Plotting raster data","html_id":"plotting-raster-data","implicit":true,"key":"OsORfTFsGo"},{"type":"paragraph","position":{"start":{"line":582,"column":1},"end":{"line":582,"column":1}},"children":[{"type":"text","value":"If you plot a raster object, it will plot each band separately:","position":{"start":{"line":582,"column":1},"end":{"line":582,"column":1}},"key":"OROkFXZnBo"}],"key":"RdMS7Llapl"}],"key":"bZBOmbQRE8"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Plot the 3 bands of the silwood aerial image\nnames(silwood_aerial) \u003c- c(\"Red\", \"Green\", \"Blue\")\nplot(silwood_aerial, nc=3)","key":"dPVmYnCb6j"},{"type":"output","id":"CMqb49kOk4vmW4AqCmhqK","data":[{"output_type":"display_data","metadata":{"image/png":{"width":420,"height":420}},"data":{"text/plain":{"content":"plot without title","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"1c7a163a843c3b333adeeeacc99c35c7","path":"https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/1c7a163a843c3b333adeeeacc99c35c7.png"}}}],"key":"dIK6UOh0nT"}],"key":"djGx5f7Q0d"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":590,"column":1},"end":{"line":593,"column":1}},"children":[{"type":"text","value":"If you instead want to combine image bands to create a three colour image, then the\n","position":{"start":{"line":590,"column":1},"end":{"line":590,"column":1}},"key":"TtycYqYvma"},{"type":"inlineCode","value":"terra::plotRGB","position":{"start":{"line":590,"column":1},"end":{"line":590,"column":1}},"key":"VgWgYleSPl"},{"type":"text","value":"  can be used to combine 3 bands to generate a colour composite image.\nThe ","position":{"start":{"line":590,"column":1},"end":{"line":590,"column":1}},"key":"Pmul65m7FV"},{"type":"inlineCode","value":"silwood_aerial","position":{"start":{"line":590,"column":1},"end":{"line":590,"column":1}},"key":"vsciaCNmad"},{"type":"text","value":" image contains the three RGB bands in the correct order, so we can\nsimply plot it:","position":{"start":{"line":590,"column":1},"end":{"line":590,"column":1}},"key":"mC8iHHhyQH"}],"key":"v3tL3EAW2c"}],"key":"aI49FLBSYn"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Plot the silwood aerial data using the default settings\nplotRGB(silwood_aerial)","key":"E893kx4dAA"},{"type":"output","id":"yq_yQdW2ZVSUmYQNEwH6x","data":[{"output_type":"display_data","metadata":{"image/png":{"width":420,"height":420}},"data":{"text/plain":{"content":"plot without title","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"4cf441355b5010624f07456881e68713","path":"https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/4cf441355b5010624f07456881e68713.png"}}}],"key":"P1EL8AHZGm"}],"key":"UozIrqcISX"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":600,"column":1},"end":{"line":602,"column":1}},"children":[{"type":"text","value":"If we want to do the same thing with the RGB data from the Sentinel 2 data then we need\nto adjust the command to give the bands in the right order and also to set the maximum\nscale of the values across the bands.","position":{"start":{"line":600,"column":1},"end":{"line":600,"column":1}},"key":"T67jDf62QJ"}],"key":"jm3NMTw613"}],"key":"bjQxWyIIak"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Plot the Sentinel data, setting the bands and scale\nplotRGB(s2_silwood_10m, r=3, g=2, b=1, scale=0.80)","key":"pzJ3T2xJMF"},{"type":"output","id":"35Ex1uhK_XjlZiqQqwXlM","data":[{"output_type":"display_data","metadata":{"image/png":{"width":420,"height":420}},"data":{"text/plain":{"content":"plot without title","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"5e61dc2194cf8f4667cdb4e451ee0e9c","path":"https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/5e61dc2194cf8f4667cdb4e451ee0e9c.png"}}}],"key":"hr1Df5qCwE"}],"key":"Wz70JCDyqJ"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":609,"column":1},"end":{"line":611,"column":1}},"children":[{"type":"text","value":"In fact, the L2A Sentinel 2 product provides a True Colour Image (TCI) that orders and\nscale the RGB bands to give something closer to expected colour. This can be used with\nthe default settings.","position":{"start":{"line":609,"column":1},"end":{"line":609,"column":1}},"key":"Zkbmprmxcn"}],"key":"BnJTzWhWLG"}],"key":"lLkryC1Jy7"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Load the L2A TCI image for Silwood and plot using defaults.\ns2_silwood_tci \u003c- rast(\n  \"../data/SpatialMethods/sentinel_2/R10m/silwood/T30UXC_20250711T110651_TCI_10m.tiff\"\n)\nplotRGB(s2_silwood_tci)","key":"aeD7t6PlNe"},{"type":"output","id":"f0L2akhSsPfRD_Srowxl_","data":[{"output_type":"display_data","metadata":{"image/png":{"width":420,"height":420}},"data":{"text/plain":{"content":"plot without title","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"41dcf70fba4b1861cecedecb55293c5f","path":"https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/41dcf70fba4b1861cecedecb55293c5f.png"}}}],"key":"R7cA2T9bM1"}],"key":"yInNqcE45O"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":621,"column":1},"end":{"line":626,"column":1}},"children":[{"type":"text","value":"Alternatively, you can set different bands as inputs to give a “false-colour image”. One\ncommon usage is a ","position":{"start":{"line":621,"column":1},"end":{"line":621,"column":1}},"key":"PV5K2XsN3E"},{"type":"link","url":"https://custom-scripts.sentinel-hub.com/custom-scripts/sentinel-2/false_color_infrared/","position":{"start":{"line":621,"column":1},"end":{"line":621,"column":1}},"children":[{"type":"text","value":"false colour\ninfrared","position":{"start":{"line":621,"column":1},"end":{"line":621,"column":1}},"key":"v6aHX82ql3"}],"urlSource":"https://custom-scripts.sentinel-hub.com/custom-scripts/sentinel-2/false_color_infrared/","key":"f9HVL5xi8F"},{"type":"text","value":"\nimage, which swaps from the ","position":{"start":{"line":621,"column":1},"end":{"line":621,"column":1}},"key":"JA5i0nrBaJ"},{"type":"inlineCode","value":"[R, G, B]","position":{"start":{"line":621,"column":1},"end":{"line":621,"column":1}},"key":"mpzvxjhtWO"},{"type":"text","value":" bands to ","position":{"start":{"line":621,"column":1},"end":{"line":621,"column":1}},"key":"iceK29aX8x"},{"type":"inlineCode","value":"[NIR, R, G]","position":{"start":{"line":621,"column":1},"end":{"line":621,"column":1}},"key":"bU9ptyH8Z9"},{"type":"text","value":". This kind of imagery is\nvery good at pulling out differences between vegetation (bright red), water (dark) and\nurban areas and bare ground (tan or grey).","position":{"start":{"line":621,"column":1},"end":{"line":621,"column":1}},"key":"wCtyGiuZCx"}],"key":"hGxfLpFMH5"}],"key":"JND9MWpfdZ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Plot the Sentinel data, setting the bands and scale\nplotRGB(s2_silwood_10m, r=4, g=3, b=2, scale=0.8)","key":"ZTyd1ETpbQ"},{"type":"output","id":"4IQPwY6zJf5GCJtPwLTsz","data":[{"output_type":"display_data","metadata":{"image/png":{"width":420,"height":420}},"data":{"text/plain":{"content":"plot without title","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"edddae724d2632173ffa1b69f6a81728","path":"https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/edddae724d2632173ffa1b69f6a81728.png"}}}],"key":"xvOYCusPZ2"}],"key":"UAgnN01adk"},{"type":"block","children":[{"type":"comment","value":" \nNOTE - there are no changes to the data objects in this document so there is no \ncode cell required to save changes to the data state.\n","key":"tkPrwTanhm"},{"type":"heading","depth":2,"position":{"start":{"line":638,"column":1},"end":{"line":638,"column":1}},"children":[{"type":"text","value":"Reprojecting spatial data","position":{"start":{"line":638,"column":1},"end":{"line":638,"column":1}},"key":"rAoiH9qMIe"}],"identifier":"reprojecting-spatial-data","label":"Reprojecting spatial data","html_id":"reprojecting-spatial-data","implicit":true,"key":"MKqMmFe0g8"},{"type":"paragraph","position":{"start":{"line":640,"column":1},"end":{"line":644,"column":1}},"children":[{"type":"text","value":"We now have a large number of different datasets, but they are not all in the same GIS\nprojection. We cannot use the datasets together until they use the same coordinate\nsystem. We will use the “OSGB 1936 / British National Grid” (or BNG) projection for all\nof the rest of the practical. It is a projected coordinate system, which means we can\nuse metres to measure distances, and it is also the standard mapping system for the UK.","position":{"start":{"line":640,"column":1},"end":{"line":640,"column":1}},"key":"wlRhPJ3jzy"}],"key":"uiN7btbGkP"},{"type":"heading","depth":3,"position":{"start":{"line":646,"column":1},"end":{"line":646,"column":1}},"children":[{"type":"text","value":"Reprojecting vector datasets","position":{"start":{"line":646,"column":1},"end":{"line":646,"column":1}},"key":"Fyas8vSBO1"}],"identifier":"reprojecting-vector-datasets","label":"Reprojecting vector datasets","html_id":"reprojecting-vector-datasets","implicit":true,"key":"CanGVaI2O8"},{"type":"paragraph","position":{"start":{"line":648,"column":1},"end":{"line":651,"column":1}},"children":[{"type":"text","value":"It is relatively easy to reproject vector datasets: all of the features in a vector\ndataset are built up from pairs of point. Reprojection is therefore just a matter of\nrecalculating the coordinates in the new projection - the underlying equation might be\ncomplex but we are just moving points between two systems.","position":{"start":{"line":648,"column":1},"end":{"line":648,"column":1}},"key":"hHH8Dsioao"}],"key":"OquIgYIW4k"},{"type":"paragraph","position":{"start":{"line":653,"column":1},"end":{"line":654,"column":1}},"children":[{"type":"text","value":"We can show the current range of coordinates for a dataset by looking at the ","position":{"start":{"line":653,"column":1},"end":{"line":653,"column":1}},"key":"iqypYLK85O"},{"type":"strong","position":{"start":{"line":653,"column":1},"end":{"line":653,"column":1}},"children":[{"type":"text","value":"extent","position":{"start":{"line":653,"column":1},"end":{"line":653,"column":1}},"key":"VuBfcsWFO7"}],"key":"oaFIeifOK9"},{"type":"text","value":"\nof the data before.","position":{"start":{"line":653,"column":1},"end":{"line":653,"column":1}},"key":"dynwvbpxGi"}],"key":"fEIUPBOdFk"}],"key":"agPcoqhmiI"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Show the extent of the sensor locations in the current WGS84 projection\next(sensor_locations)","key":"OIQi4c22aK"},{"type":"output","id":"vtksJ6kG6UB3RJPpvHB6E","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"SpatExtent : -0.651972, -0.178122, 51.406849, 51.496483 (xmin, xmax, ymin, ymax)","content_type":"text/plain"}}}],"key":"lYP1h0mI8G"}],"key":"PvqHIhtCev"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":661,"column":1},"end":{"line":662,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":661,"column":1},"end":{"line":661,"column":1}},"key":"KrWdeJ4Rl5"},{"type":"inlineCode","value":"sf::st_transform","position":{"start":{"line":661,"column":1},"end":{"line":661,"column":1}},"key":"SHmB1YUECc"},{"type":"text","value":" function can then be used to transform data from one projection\nto another.","position":{"start":{"line":661,"column":1},"end":{"line":661,"column":1}},"key":"m0t1opMqeV"}],"key":"RZKsmIvo0V"}],"key":"cMxREdOLbT"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Convert the WGS84 vector datasets to BNG\nsensor_locations \u003c- st_transform(sensor_locations, crs=\"EPSG:27700\")\nnest_boxes \u003c- st_transform(nest_boxes, crs=\"EPSG:27700\")\nsilmas_route \u003c- st_transform(silmas_route, crs=\"EPSG:27700\")\n\n# Show the new extent\next(sensor_locations)","key":"G6O2mut1Q2"},{"type":"output","id":"T4D720_2IbFdxwMjmmBfP","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"SpatExtent : 493848.9919019, 526566.980292927, 168404.466202018, 179077.21373909 (xmin, xmax, ymin, ymax)","content_type":"text/plain"}}}],"key":"XHwqTHxseN"}],"key":"iRICtQx3Ks"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":674,"column":1},"end":{"line":674,"column":1}},"children":[{"type":"text","value":"Reprojecting raster datasets","position":{"start":{"line":674,"column":1},"end":{"line":674,"column":1}},"key":"s2kNbWKxMV"}],"identifier":"reprojecting-raster-datasets","label":"Reprojecting raster datasets","html_id":"reprojecting-raster-datasets","implicit":true,"key":"qo0TklDwIt"},{"type":"paragraph","position":{"start":{"line":676,"column":1},"end":{"line":679,"column":1}},"children":[{"type":"text","value":"This is more involved than reprojecting vector data. You have a series of raster cell\nvalues in one projection and then want to insert representative values into a set of\ncells on a different projection. The borders of those new cells could have all sorts of\nodd relationships to the current ones.","position":{"start":{"line":676,"column":1},"end":{"line":676,"column":1}},"key":"D3GGYQefS3"}],"key":"cEhcb2iP1H"},{"type":"paragraph","position":{"start":{"line":681,"column":1},"end":{"line":681,"column":1}},"children":[{"type":"text","value":"We can show the issue by superimposing two grids:","position":{"start":{"line":681,"column":1},"end":{"line":681,"column":1}},"key":"bppIUYJwVG"}],"key":"L37hzXgFFo"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":683,"column":1},"end":{"line":687,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":683,"column":1},"end":{"line":684,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"A 200 m resolution grid using the extent of the BNG projection datasets for Silwood\n(red cells).","position":{"start":{"line":683,"column":1},"end":{"line":683,"column":1}},"key":"bvhDEq4Tr4"}],"key":"clgqyFggaf"}],"key":"bFhAW1p2Ld"},{"type":"listItem","spread":true,"position":{"start":{"line":685,"column":1},"end":{"line":687,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"A very similar 200m grid taken from the extent of the Sentinel 2 data in the UTM30N\nprojection for the same site and then reprojected into the BNG (grey cells)","position":{"start":{"line":685,"column":1},"end":{"line":685,"column":1}},"key":"A6Uco8haOF"}],"key":"rk6aazylYS"}],"key":"AgkkV63YRy"}],"key":"YmsshGHSbO"}],"key":"R4WJVXAPCy"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Create a BNG raster at 200m resolution for the study site\ngrid_BNG \u003c- rast(ext(silwood_aerial), res = 200, crs = \"EPSG:27700\")\n# Convert to an sf polygon dataset of grid cells\ngrid_BNG \u003c- st_as_sf(as.polygons(grid_BNG))\n\n# Create a UTM30N raster at 200 m resolution for the study site\ngrid_UTM30N \u003c- rast(ext(s2_silwood_10m), res = 200, crs = \"EPSG:32630\")\n# Convert to an sf polygon dataset _and_ then transform to BNG\ngrid_UTM30N \u003c- st_as_sf(as.polygons(grid_UTM30N))\ngrid_UTM30N_in_BNG \u003c- st_transform(grid_UTM30N, \"EPSG:27700\")\n\n# Plot the two sets of grid cells over each other\nplot(st_geometry(grid_UTM30N_in_BNG), reset=FALSE, border=\"grey\")\nplot(st_geometry(grid_BNG), border='red', add=TRUE)\n\n# Add coordinates on the axes\naxis(1)\naxis(2)","visibility":"remove","key":"BtoMQpJdvV"},{"type":"output","id":"DTUexaDR1B5BuSpeujYQD","data":[{"output_type":"display_data","metadata":{"image/png":{"width":420,"height":420}},"data":{"text/plain":{"content":"plot without title","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"80c797e78385b2075eb80b51a55931dc","path":"https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/80c797e78385b2075eb80b51a55931dc.png"}}}],"visibility":"show","key":"v3DOdE7BWW"}],"data":{"tags":[]},"visibility":"show","key":"kLM4CnvZww"},{"type":"block","children":[{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Plot source","position":{"start":{"line":711,"column":1},"end":{"line":711,"column":1}},"key":"YAOaxIJyuz"}],"key":"KSjwyeF57d"},{"type":"paragraph","position":{"start":{"line":714,"column":1},"end":{"line":714,"column":1}},"children":[{"type":"text","value":"In case you are interested in how the plot was created.","position":{"start":{"line":714,"column":1},"end":{"line":714,"column":1}},"key":"MZK0xsosjw"}],"key":"haKUL8P8sq"},{"type":"code","lang":"r","value":"# Create a BNG raster at 200m resolution for the study site\ngrid_BNG \u003c- rast(ext(silwood_aerial), res = 200, crs = \"EPSG:27700\")\n# Convert to an sf polygon dataset of grid cells\ngrid_BNG \u003c- st_as_sf(as.polygons(grid_BNG))\n\n# Create a UTM30N raster at 200 m resolution for the study site\ngrid_UTM30N \u003c- rast(ext(s2_silwood_10m), res = 200, crs = \"EPSG:32630\")\n# Convert to an sf polygon dataset _and_ then transform to BNG\ngrid_UTM30N \u003c- st_as_sf(as.polygons(grid_UTM30N))\ngrid_UTM30N_in_BNG \u003c- st_transform(grid_UTM30N, \"EPSG:27700\")\n\n# Plot the two sets of grid cells over each other\nplot(st_geometry(grid_UTM30N_in_BNG), reset=FALSE, border=\"grey\")\nplot(st_geometry(grid_BNG), border='red', add=TRUE)\n\n# Add coordinates on the axes\naxis(1)\naxis(2)","key":"qWGX5dfJ6g"}],"class":"dropdown","key":"Sml26yTnYr"},{"type":"paragraph","position":{"start":{"line":739,"column":1},"end":{"line":741,"column":1}},"children":[{"type":"text","value":"As you can see, even when the resolutions are the same, there is no neat one-to-one\nrelationship between the two sets of cells: the axes of the two grids are not exactly\nparallel and the coordinates of the cell boundaries are not the same.","position":{"start":{"line":739,"column":1},"end":{"line":739,"column":1}},"key":"LLOOGR4VsK"}],"key":"QyOQCrMHPp"},{"type":"paragraph","position":{"start":{"line":743,"column":1},"end":{"line":746,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":743,"column":1},"end":{"line":743,"column":1}},"key":"glo9sHb0sb"},{"type":"inlineCode","value":"terra::project","position":{"start":{"line":743,"column":1},"end":{"line":743,"column":1}},"key":"dAy3KGtc9q"},{"type":"text","value":" function both ","position":{"start":{"line":743,"column":1},"end":{"line":743,"column":1}},"key":"xtOECWQaeN"},{"type":"strong","position":{"start":{"line":743,"column":1},"end":{"line":743,"column":1}},"children":[{"type":"text","value":"converts the coordinates","position":{"start":{"line":743,"column":1},"end":{"line":743,"column":1}},"key":"SJNXLrUl9z"}],"key":"fNqU09Wxow"},{"type":"text","value":" from one projection to\nanother and ","position":{"start":{"line":743,"column":1},"end":{"line":743,"column":1}},"key":"qLkw2ZKsMM"},{"type":"strong","position":{"start":{"line":743,"column":1},"end":{"line":743,"column":1}},"children":[{"type":"text","value":"resamples the data","position":{"start":{"line":743,"column":1},"end":{"line":743,"column":1}},"key":"X3nePf4Cxd"}],"key":"moE38mv3Ig"},{"type":"text","value":" from one grid to another. There are various methods\nto carry out resampling - see the ","position":{"start":{"line":743,"column":1},"end":{"line":743,"column":1}},"key":"JEYve7ZnSL"},{"type":"inlineCode","value":"method","position":{"start":{"line":743,"column":1},"end":{"line":743,"column":1}},"key":"LdkeA6AfN2"},{"type":"text","value":" details in ","position":{"start":{"line":743,"column":1},"end":{"line":743,"column":1}},"key":"y2ZCoE519J"},{"type":"inlineCode","value":"?project","position":{"start":{"line":743,"column":1},"end":{"line":743,"column":1}},"key":"wuT2wIOoLz"},{"type":"text","value":" but they basically fall\ninto two groups:","position":{"start":{"line":743,"column":1},"end":{"line":743,"column":1}},"key":"atD9F4yMgC"}],"key":"hEuuNuiYTr"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":748,"column":1},"end":{"line":759,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":748,"column":1},"end":{"line":753,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":748,"column":1},"end":{"line":752,"column":1}},"children":[{"type":"text","value":"Most are interpolations methods for getting a representative ","position":{"start":{"line":748,"column":1},"end":{"line":748,"column":1}},"key":"uIvrtOE250"},{"type":"strong","position":{"start":{"line":748,"column":1},"end":{"line":748,"column":1}},"children":[{"type":"text","value":"continuous value","position":{"start":{"line":748,"column":1},"end":{"line":748,"column":1}},"key":"uSkmXZkUUT"}],"key":"yt1tNU7WzM"},{"type":"text","value":" for\neach cell from the data in the original raster grid. They range from simple ","position":{"start":{"line":748,"column":1},"end":{"line":748,"column":1}},"key":"WTR4JVwIxF"},{"type":"inlineCode","value":"average","position":{"start":{"line":748,"column":1},"end":{"line":748,"column":1}},"key":"Ws1BMSftD9"},{"type":"text","value":"\nvalues of intersecting cells, to more complex polynomials and splines (e.g ","position":{"start":{"line":748,"column":1},"end":{"line":748,"column":1}},"key":"g8pF9rFbbI"},{"type":"inlineCode","value":"cubic","position":{"start":{"line":748,"column":1},"end":{"line":748,"column":1}},"key":"tyytKZcz9F"},{"type":"text","value":")\nthat use a moving window of a neighbourhood of cells to construct an estimate for the\nnew cell.","position":{"start":{"line":748,"column":1},"end":{"line":748,"column":1}},"key":"kKpjMDd3nL"}],"key":"Pt2hAEkawY"}],"key":"f9umyiOWQ0"},{"type":"listItem","spread":true,"position":{"start":{"line":754,"column":1},"end":{"line":759,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":754,"column":1},"end":{"line":758,"column":1}},"children":[{"type":"text","value":"Other approaches select a single value from the source grid: the ","position":{"start":{"line":754,"column":1},"end":{"line":754,"column":1}},"key":"O3BJFWAIRg"},{"type":"inlineCode","value":"near","position":{"start":{"line":754,"column":1},"end":{"line":754,"column":1}},"key":"s31Eg8KWWT"},{"type":"text","value":" method takes\nthe value from the source raster cell closest to the centre of the new cell, and the\n","position":{"start":{"line":754,"column":1},"end":{"line":754,"column":1}},"key":"nwKxOAOwxY"},{"type":"inlineCode","value":"mode","position":{"start":{"line":754,"column":1},"end":{"line":754,"column":1}},"key":"KrwFk56aOY"},{"type":"text","value":" value takes the modal value of the set of overlapping cells. Both of these\napproaches are intended for use with categorical raster data, where it makes no sense\nto interpolate values between category codes.","position":{"start":{"line":754,"column":1},"end":{"line":754,"column":1}},"key":"lhBbRvicmz"}],"key":"MIksg86Q77"}],"key":"jrzOx3ew1L"}],"key":"sINSZ3gUbZ"},{"type":"paragraph","position":{"start":{"line":760,"column":1},"end":{"line":763,"column":1}},"children":[{"type":"text","value":"To use the ","position":{"start":{"line":760,"column":1},"end":{"line":760,"column":1}},"key":"ZcS2gIldLX"},{"type":"inlineCode","value":"terra::project","position":{"start":{"line":760,"column":1},"end":{"line":760,"column":1}},"key":"MildKc74Rd"},{"type":"text","value":" function, you need to provide a raster with the target\nresolution and projection to use as a template. To reproject the Sentinel 2 data, we can\nsimply use the Land Cover map datasets, which are also have a 10m resolution and have\nbeen cropped to the study area.","position":{"start":{"line":760,"column":1},"end":{"line":760,"column":1}},"key":"mXEwvKqwaF"}],"key":"MlXfpsclIC"}],"key":"FOHWMyM4Ts"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"s2_silwood_10m \u003c- project(s2_silwood_10m, silwood_LCM, method=\"cubic\")\ns2_nhm_10m \u003c- project(s2_nhm_10m, nhm_LCM, method=\"cubic\")","key":"i1NssplpKa"},{"type":"output","id":"411q9bQDH3J-NPXat5ERV","data":[],"key":"nUmeoDzeDA"}],"key":"ILK9fwjV9c"},{"type":"block","children":[{"type":"admonition","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Exercise","position":{"start":{"line":770,"column":1},"end":{"line":770,"column":1}},"key":"wx0kYkNaeV"}],"key":"tzPAOtsQhD"},{"type":"paragraph","position":{"start":{"line":772,"column":1},"end":{"line":773,"column":1}},"children":[{"type":"text","value":"Repeat this reprojection for the 20 metre resolution Sentinel 2 datasets that you\ncreated earlier (","position":{"start":{"line":772,"column":1},"end":{"line":772,"column":1}},"key":"buP6djIHfm"},{"type":"inlineCode","value":"s2_silwood_20m","position":{"start":{"line":772,"column":1},"end":{"line":772,"column":1}},"key":"EC271SuHuI"},{"type":"text","value":" and ","position":{"start":{"line":772,"column":1},"end":{"line":772,"column":1}},"key":"ctOZxsV83o"},{"type":"inlineCode","value":"s2_nhm_20m","position":{"start":{"line":772,"column":1},"end":{"line":772,"column":1}},"key":"y6o2ujZCgU"},{"type":"text","value":").","position":{"start":{"line":772,"column":1},"end":{"line":772,"column":1}},"key":"JNBtji5M6b"}],"key":"RSeaRYdYIj"},{"type":"paragraph","position":{"start":{"line":775,"column":1},"end":{"line":776,"column":1}},"children":[{"type":"text","value":"You should reproject the data to the same 20 metre resolution. We do not have an\nexisting BNG raster dataset at this resolution, so you will need to make one.","position":{"start":{"line":775,"column":1},"end":{"line":775,"column":1}},"key":"P5iIs8Fqef"}],"key":"tHud4523GT"}],"key":"DoOL4djHeO"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Show solution","position":{"start":{"line":780,"column":1},"end":{"line":780,"column":1}},"key":"begUjHhIW7"}],"key":"QprMhexTsy"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Make 20 metre resolution templates for the study sites\nsilwood_template_20m \u003c- rast(ext(silwood_aerial), res=20, crs=\"EPSG:27700\")\nnhm_template_20m \u003c- rast(ext(nhm_aerial), res=20, crs=\"EPSG:27700\")\n\n# Reproject S2 20m bands into BNG\ns2_silwood_20m \u003c- project(s2_silwood_20m, silwood_template_20m, method=\"cubic\")\ns2_nhm_20m \u003c- project(s2_nhm_20m, nhm_template_20m, method=\"cubic\")","key":"pWj47i1CCp"},{"type":"output","id":"C4K1rZ-rifXUN1DVflfru","data":[],"key":"ShfVW8OowS"}],"key":"v2uEvJHDMX"}],"class":"dropdown","key":"n5VCSnKBqV"},{"type":"heading","depth":2,"position":{"start":{"line":796,"column":1},"end":{"line":796,"column":1}},"children":[{"type":"text","value":"Manipulating raster data","position":{"start":{"line":796,"column":1},"end":{"line":796,"column":1}},"key":"HU8AXjor2Z"}],"identifier":"manipulating-raster-data","label":"Manipulating raster data","html_id":"manipulating-raster-data","implicit":true,"key":"b5TzywQ5yN"},{"type":"paragraph","position":{"start":{"line":798,"column":1},"end":{"line":800,"column":1}},"children":[{"type":"text","value":"Even once you have raster datasets in the same resolution, it is common to want to\nmanipulate them to get multiple datasets into the same extent and resolution. This\nsection covers:","position":{"start":{"line":798,"column":1},"end":{"line":798,"column":1}},"key":"EQCRDVdIB7"}],"key":"FGvmYL3iQr"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":802,"column":1},"end":{"line":806,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":802,"column":1},"end":{"line":802,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"upscaling and downscaling raster resolution,","position":{"start":{"line":802,"column":1},"end":{"line":802,"column":1}},"key":"dagiST6qGt"}],"key":"EH1glzWuNw"}],"key":"mzx7Zf8wqM"},{"type":"listItem","spread":true,"position":{"start":{"line":803,"column":1},"end":{"line":803,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"joining adjacent raster tiles into a single dataset,","position":{"start":{"line":803,"column":1},"end":{"line":803,"column":1}},"key":"nBRA3iNjEe"}],"key":"uY5KtGG0Ah"}],"key":"XtP0YAzPBc"},{"type":"listItem","spread":true,"position":{"start":{"line":804,"column":1},"end":{"line":804,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"combining raster bands for datasets with the same extent and resolution, and","position":{"start":{"line":804,"column":1},"end":{"line":804,"column":1}},"key":"MM2oJMOPJj"}],"key":"HAipuu8qME"}],"key":"yE8Btwr8ZV"},{"type":"listItem","spread":true,"position":{"start":{"line":805,"column":1},"end":{"line":806,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"cropping datasets to a smaller extent.","position":{"start":{"line":805,"column":1},"end":{"line":805,"column":1}},"key":"CgcB7rQ2v8"}],"key":"IIOa6dcgU6"}],"key":"xDHe4rbfvM"}],"key":"HY72telIDB"},{"type":"heading","depth":3,"position":{"start":{"line":807,"column":1},"end":{"line":807,"column":1}},"children":[{"type":"text","value":"Changing raster resolution","position":{"start":{"line":807,"column":1},"end":{"line":807,"column":1}},"key":"OjWciLDXLT"}],"identifier":"changing-raster-resolution","label":"Changing raster resolution","html_id":"changing-raster-resolution","implicit":true,"key":"ysPaORdFwF"},{"type":"paragraph","position":{"start":{"line":809,"column":1},"end":{"line":810,"column":1}},"children":[{"type":"text","value":"If you want to change the resolution or grid of an existing raster grid ","position":{"start":{"line":809,"column":1},"end":{"line":809,"column":1}},"key":"GUTrWH5hA7"},{"type":"strong","position":{"start":{"line":809,"column":1},"end":{"line":809,"column":1}},"children":[{"type":"text","value":"without\nchanging the projection","position":{"start":{"line":809,"column":1},"end":{"line":809,"column":1}},"key":"Pzta4stPWX"}],"key":"jc8Rz9bXrr"},{"type":"text","value":" then you there are a few options:","position":{"start":{"line":809,"column":1},"end":{"line":809,"column":1}},"key":"xDYz4Umlc5"}],"key":"dtvp6kChmv"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":812,"column":1},"end":{"line":820,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":812,"column":1},"end":{"line":815,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":812,"column":1},"end":{"line":814,"column":1}},"children":[{"type":"text","value":"If you want to change the grid resolution by a simple factor while keeping the same\nbasic grid cell alignments and extent, then you can use the ","position":{"start":{"line":812,"column":1},"end":{"line":812,"column":1}},"key":"p3se55Wtd1"},{"type":"inlineCode","value":"terra::aggregate","position":{"start":{"line":812,"column":1},"end":{"line":812,"column":1}},"key":"HiH9SeLLN2"},{"type":"text","value":" and\n","position":{"start":{"line":812,"column":1},"end":{"line":812,"column":1}},"key":"DVZTcRiu9O"},{"type":"inlineCode","value":"terra::disagg","position":{"start":{"line":812,"column":1},"end":{"line":812,"column":1}},"key":"PBrBao0aVg"},{"type":"text","value":" functions.","position":{"start":{"line":812,"column":1},"end":{"line":812,"column":1}},"key":"zomSFQxEsc"}],"key":"On1WTJSr86"}],"key":"dMYQm8urU2"},{"type":"listItem","spread":true,"position":{"start":{"line":816,"column":1},"end":{"line":820,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":816,"column":1},"end":{"line":819,"column":1}},"children":[{"type":"text","value":"If you need to change the grid to a raster resolution that is not a simple factor or\nneed to move the cell boundaries to match another dataset, then you will need the\n","position":{"start":{"line":816,"column":1},"end":{"line":816,"column":1}},"key":"C3ePs6q4gA"},{"type":"inlineCode","value":"terra::resample","position":{"start":{"line":816,"column":1},"end":{"line":816,"column":1}},"key":"N5WbPopkxv"},{"type":"text","value":" function. This functions much like ","position":{"start":{"line":816,"column":1},"end":{"line":816,"column":1}},"key":"VCIUcjh2ep"},{"type":"inlineCode","value":"terra::project","position":{"start":{"line":816,"column":1},"end":{"line":816,"column":1}},"key":"N5JrY7TO3c"},{"type":"text","value":" without the\ncoordinate transformation, and has the same methods for resampling onto the new grid.","position":{"start":{"line":816,"column":1},"end":{"line":816,"column":1}},"key":"ArQ5mUct2Y"}],"key":"uFwmKdtrcR"}],"key":"vVqTuuNWXG"}],"key":"ywQp0TnbBM"},{"type":"paragraph","position":{"start":{"line":821,"column":1},"end":{"line":824,"column":1}},"children":[{"type":"text","value":"Here, we will use disaggregation to resample the 20 metre resolution Sentinel 2 bands to\n10 metre resolution. We will use ","position":{"start":{"line":821,"column":1},"end":{"line":821,"column":1}},"key":"Ua5TccwVqH"},{"type":"inlineCode","value":"method=bilinear","position":{"start":{"line":821,"column":1},"end":{"line":821,"column":1}},"key":"P2RR0mnABW"},{"type":"text","value":" which uses a simple linear model to\nassign new cell values; the alternative ","position":{"start":{"line":821,"column":1},"end":{"line":821,"column":1}},"key":"oYe8lbl6l6"},{"type":"inlineCode","value":"method=near","position":{"start":{"line":821,"column":1},"end":{"line":821,"column":1}},"key":"Cmq50v3o1V"},{"type":"text","value":" would simply duplicate the value\nfrom the nearest coarser resolution cell into each of the smaller cells.","position":{"start":{"line":821,"column":1},"end":{"line":821,"column":1}},"key":"EwsiT0Fjw7"}],"key":"IyY0bQvzQV"}],"key":"J3xsiiuwGi"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"s2_silwood_20m_at_10m \u003c- disagg(s2_silwood_20m, fact=2, method=\"bilinear\")\ns2_nhm_20m_at_10m \u003c- disagg(s2_nhm_20m, fact=2, method=\"bilinear\")","key":"BWO2rHmBe2"},{"type":"output","id":"BoAXDa5YDT7CoUngrYPF9","data":[],"key":"AfVu15LoCq"}],"key":"M2KvHi5WUn"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":831,"column":1},"end":{"line":831,"column":1}},"children":[{"type":"text","value":"We can use the ","position":{"start":{"line":831,"column":1},"end":{"line":831,"column":1}},"key":"Nh0psnnq29"},{"type":"inlineCode","value":"terra::res","position":{"start":{"line":831,"column":1},"end":{"line":831,"column":1}},"key":"BFBYi8Vpgp"},{"type":"text","value":" function to show the resolutions of the two versions.","position":{"start":{"line":831,"column":1},"end":{"line":831,"column":1}},"key":"uhVUFB7iVD"}],"key":"C8MF2eOJrX"}],"key":"YqjBLhXDSd"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"print(res(s2_silwood_20m))\nprint(res(s2_silwood_20m_at_10m))","key":"ddqBe5p2xz"},{"type":"output","id":"PGJfS2xzIrzwcqX3Im0lT","data":[{"output_type":"stream","name":"stdout","text":"[1] 20 20\n"},{"output_type":"stream","name":"stdout","text":"[1] 10 10\n"}],"key":"uMEAhMCgUk"}],"key":"pEJ9lcGLoY"},{"type":"block","children":[{"type":"admonition","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Stretch goal: projecting Sentinel 2 to 10m resolution","position":{"start":{"line":838,"column":1},"end":{"line":838,"column":1}},"key":"JKERTg0uVR"}],"key":"XqCmrXSUMl"},{"type":"paragraph","position":{"start":{"line":841,"column":1},"end":{"line":843,"column":1}},"children":[{"type":"text","value":"We could also have got the 20 metre resolution Sentinel 2 bands resampled to 10 metres\nusing  only the ","position":{"start":{"line":841,"column":1},"end":{"line":841,"column":1}},"key":"nVBb0EifrW"},{"type":"inlineCode","value":"terra::project","position":{"start":{"line":841,"column":1},"end":{"line":841,"column":1}},"key":"CpJPop0KfP"},{"type":"text","value":" function. See if you can generate\n","position":{"start":{"line":841,"column":1},"end":{"line":841,"column":1}},"key":"kjASMzalAn"},{"type":"inlineCode","value":"s2_silwood_20m_direct_to_10m","position":{"start":{"line":841,"column":1},"end":{"line":841,"column":1}},"key":"NpDaQ7IwnS"},{"type":"text","value":" and ","position":{"start":{"line":841,"column":1},"end":{"line":841,"column":1}},"key":"A2ULddNKkQ"},{"type":"inlineCode","value":"s2_nhm_20m_direct_to_10m","position":{"start":{"line":841,"column":1},"end":{"line":841,"column":1}},"key":"bo3xON2aNO"},{"type":"text","value":" using only that function.","position":{"start":{"line":841,"column":1},"end":{"line":841,"column":1}},"key":"iJyVO0Ucfv"}],"key":"Uqj3i0CwSa"}],"class":"tip","key":"tfcYwKndmP"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Show solution","position":{"start":{"line":846,"column":1},"end":{"line":846,"column":1}},"key":"FcFgezXPz3"}],"key":"bCvWxJyzZv"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# It is actually very easy - we can just use the existing 10m CEH Land Cover Map\n# datasets as the resampling template.\ns2_silwood_20m_direct_to_10m \u003c- project(\n  s2_silwood_20m, silwood_lcm, method=\"cubic\"\n)\ns2_nhm_20m_direct_to_10m \u003c- project(\n  s2_nhm_20m, nhm_lcm, method=\"cubic\"\n)","visibility":"show","key":"vovWoo508P"},{"type":"output","id":"leBG_QYSN3-tYNTeQXV5r","data":[],"visibility":"show","key":"UQHTSV2i4E"}],"data":{"tags":["skip-execution"]},"visibility":"show","key":"hPHEnW5CBR"}],"class":"dropdown","key":"ogdcyAFaQ2"},{"type":"heading","depth":3,"position":{"start":{"line":864,"column":1},"end":{"line":864,"column":1}},"children":[{"type":"text","value":"Mosaicing rasters","position":{"start":{"line":864,"column":1},"end":{"line":864,"column":1}},"key":"ZKx0a7jC8Z"}],"identifier":"mosaicing-rasters","label":"Mosaicing rasters","html_id":"mosaicing-rasters","implicit":true,"key":"ZrFxCi6spW"},{"type":"paragraph","position":{"start":{"line":866,"column":1},"end":{"line":870,"column":1}},"children":[{"type":"text","value":"We can ","position":{"start":{"line":866,"column":1},"end":{"line":866,"column":1}},"key":"DD76titvBA"},{"type":"strong","position":{"start":{"line":866,"column":1},"end":{"line":866,"column":1}},"children":[{"type":"text","value":"mosaic","position":{"start":{"line":866,"column":1},"end":{"line":866,"column":1}},"key":"TAsTsc1uCj"}],"key":"cHRJqReNxq"},{"type":"text","value":" the two panes of Terrain 5 data for each site from two 5km panes into\na single rectangle of data. The two panes are side by side for Silwood and one above the\nother for the NHM. The plot below shows the 5 x 5 km extent of the two panes. The figure\nalso shows the 3 x 3 km extent of the other data sources - as you can see it overlaps\nthe Terrain 5 panes for both sites, which is why we needed to load two panes.","position":{"start":{"line":866,"column":1},"end":{"line":866,"column":1}},"key":"uTTZbzSAGw"}],"key":"leKOvsfAC8"}],"key":"XgqGmtTj4o"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"options(repr.plot.height=4)\n\npar(mfrow=c(1,2))\n\n# Calculate the union of the extents of the two rasters\nsilwood_dtm_extent \u003c- union(ext(silwood_dtm_SU96NE), ext(silwood_dtm_SU96NW ))\n\n# Plot the extent of the first raster, but using the extent of both datasets\nplot(ext(silwood_dtm_SU96NE), border=\"blue\", ext=silwood_dtm_extent, main=\"Silwood\")\n\n# Get the middle coordinates of the raster and add a label. The `xFromCol` and \n# `yFromRow` functions extract the X and Y coordinates of cell centres from the \n# raster and `mean` then gives the centre of the raster image.\ntext(\n  x=mean(xFromCol(silwood_dtm_SU96NE)), \n  y=mean(yFromRow(silwood_dtm_SU96NE)),\n  labels=\"SU96NE\", col=\"blue\"\n)\n\n# Use `add=TRUE` to add the extent of the second raster and add the label\nplot(ext(silwood_dtm_SU96NW), border=\"red\", add=TRUE)\ntext(\n  x=mean(xFromCol(silwood_dtm_SU96NW)), \n  y=mean(yFromRow(silwood_dtm_SU96NW)),\n  labels=\"SU96NW\", col=\"red\"\n)\n\n# Finally add the extent of the other raster datasets \nplot(ext(silwood_aerial), border=\"black\", add=TRUE)\n\n# Repeat for the NHM datasets\nnhm_dtm_extent \u003c- union(ext(nhm_dtm_TQ27NE), ext(nhm_dtm_TQ28SE))\n\nplot(ext(nhm_dtm_TQ27NE), border=\"blue\", ext=nhm_dtm_extent, main=\"NHM\")\ntext(\n  x=mean(xFromCol(nhm_dtm_TQ27NE)), \n  y=mean(yFromRow(nhm_dtm_TQ27NE)),\n  labels=\"TQ27NE\", col=\"blue\"\n)\nplot(ext(nhm_dtm_TQ28SE), border=\"red\", add=TRUE)\ntext(\n  x=mean(xFromCol(nhm_dtm_TQ28SE)), \n  y=mean(yFromRow(nhm_dtm_TQ28SE)),\n  labels=\"TQ28SE\", col=\"red\"\n)\nplot(ext(nhm_aerial), border=\"black\", add=TRUE)","visibility":"remove","key":"yrkO1J0Bje"},{"type":"output","id":"wMQ0p7GGa6M9zK0XuM5yf","data":[{"output_type":"display_data","metadata":{"image/png":{"width":420,"height":240}},"data":{"text/plain":{"content":"Plot with title “”","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"4d499388b40f1f64148ab7880c92258b","path":"https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/4d499388b40f1f64148ab7880c92258b.png"}}}],"visibility":"show","key":"lIZKc8MpNe"}],"data":{"tags":[]},"visibility":"show","key":"tiEgkpKMvU"},{"type":"block","children":[{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Show source code for plot","position":{"start":{"line":923,"column":1},"end":{"line":923,"column":1}},"key":"RlL1e7mttS"}],"key":"dRM3LVELj2"},{"type":"paragraph","position":{"start":{"line":926,"column":1},"end":{"line":926,"column":1}},"children":[{"type":"text","value":"The plot above uses a few useful plotting tricks for spatial data:","position":{"start":{"line":926,"column":1},"end":{"line":926,"column":1}},"key":"AfChVUSOGw"}],"key":"zUbbkcEeMh"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":928,"column":1},"end":{"line":931,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":928,"column":1},"end":{"line":928,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"changing the spatial extent of the plot to include more than one dataset,","position":{"start":{"line":928,"column":1},"end":{"line":928,"column":1}},"key":"gkDpoh1Z75"}],"key":"Immrt8BKzv"}],"key":"CibJLFcefK"},{"type":"listItem","spread":true,"position":{"start":{"line":929,"column":1},"end":{"line":929,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"adding mutiple layers to a spatial plot, and","position":{"start":{"line":929,"column":1},"end":{"line":929,"column":1}},"key":"Bx7DvnvN4l"}],"key":"pllursekcH"}],"key":"LPRGfQpDLb"},{"type":"listItem","spread":true,"position":{"start":{"line":930,"column":1},"end":{"line":931,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"using coordinates to add text.","position":{"start":{"line":930,"column":1},"end":{"line":930,"column":1}},"key":"yjLFaKjeCO"}],"key":"y4JNn9THdS"}],"key":"Fhx8330Hq1"}],"key":"zv5gHyse8J"},{"type":"paragraph","position":{"start":{"line":932,"column":1},"end":{"line":933,"column":1}},"children":[{"type":"text","value":"You do not need to know these details for the practical, but this might be something to\ncome back to and look at.","position":{"start":{"line":932,"column":1},"end":{"line":932,"column":1}},"key":"IFXyuKxkuc"}],"key":"qchpulbfSN"},{"type":"code","lang":"r","value":"options(repr.plot.height=4)\n\npar(mfrow=c(1,2))\n\n# Calculate the union of the extents of the two rasters\nsilwood_dtm_extent \u003c- union(ext(silwood_dtm_SU96NE), ext(silwood_dtm_SU96NW ))\n\n# Plot the extent of the first raster, but using the extent of both datasets\nplot(ext(silwood_dtm_SU96NE), border=\"blue\", ext=silwood_dtm_extent, main=\"Silwood\")\n\n# Get the middle coordinates of the raster and add a label. The `xFromCol` and \n# `yFromRow` functions extract the X and Y coordinates of cell centres from the \n# raster and `mean` then gives the centre of the raster image.\ntext(\n  x=mean(xFromCol(silwood_dtm_SU96NE)), \n  y=mean(yFromRow(silwood_dtm_SU96NE)),\n  labels=\"SU96NE\", col=\"blue\"\n)\n\n# Use `add=TRUE` to add the extent of the second raster and add the label\nplot(ext(silwood_dtm_SU96NW), border=\"red\", add=TRUE)\ntext(\n  x=mean(xFromCol(silwood_dtm_SU96NW)), \n  y=mean(yFromRow(silwood_dtm_SU96NW)),\n  labels=\"SU96NW\", col=\"red\"\n)\n\n# Finally add the extent of the other raster datasets \nplot(ext(silwood_aerial), border=\"black\", add=TRUE)\n\n# Repeat for the NHM datasets\nnhm_dtm_extent \u003c- union(ext(nhm_dtm_TQ27NE), ext(nhm_dtm_TQ28SE))\n\nplot(ext(nhm_dtm_TQ27NE), border=\"blue\", ext=nhm_dtm_extent, main=\"NHM\")\ntext(\n  x=mean(xFromCol(nhm_dtm_TQ27NE)), \n  y=mean(yFromRow(nhm_dtm_TQ27NE)),\n  labels=\"TQ27NE\", col=\"blue\"\n)\nplot(ext(nhm_dtm_TQ28SE), border=\"red\", add=TRUE)\ntext(\n  x=mean(xFromCol(nhm_dtm_TQ28SE)), \n  y=mean(yFromRow(nhm_dtm_TQ28SE)),\n  labels=\"TQ28SE\", col=\"red\"\n)\nplot(ext(nhm_aerial), border=\"black\", add=TRUE)","key":"YAAXzaEgrU"}],"class":"dropdown","key":"dHgrUozxfl"},{"type":"paragraph","position":{"start":{"line":987,"column":1},"end":{"line":991,"column":1}},"children":[{"type":"text","value":"We use the ","position":{"start":{"line":987,"column":1},"end":{"line":987,"column":1}},"key":"VPX2qZtmBw"},{"type":"inlineCode","value":"terra::mosaic","position":{"start":{"line":987,"column":1},"end":{"line":987,"column":1}},"key":"ZWTlm3Mpr4"},{"type":"text","value":" function to combine these two panes into a single dataset for\neach site. There is also the ","position":{"start":{"line":987,"column":1},"end":{"line":987,"column":1}},"key":"hjLTqnkZl2"},{"type":"inlineCode","value":"terra::merge","position":{"start":{"line":987,"column":1},"end":{"line":987,"column":1}},"key":"WHuPI9Tj8q"},{"type":"text","value":" function: this is used to combine aligned\nraster datasets that are not simply neatly adjoining tiles. It also make life easier if\nwe update these datasets so they use the same raster layer name - they currently are\nnamed by BNG grid pane.","position":{"start":{"line":987,"column":1},"end":{"line":987,"column":1}},"key":"dLc2yWSxYK"}],"key":"nnyJLucAbU"}],"key":"MZbiPYM3r2"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Mosaic the two Terrain 5 panes into a single dataset\nsilwood_dtm \u003c- mosaic(silwood_dtm_SU96NE, silwood_dtm_SU96NW)\nnhm_dtm \u003c- mosaic(nhm_dtm_TQ27NE, nhm_dtm_TQ28SE)\n\n# Update the raster layer names\nnames(silwood_dtm) \u003c- names(nhm_dtm) \u003c- \"Elevation\"","key":"qVpzhYKGDL"},{"type":"output","id":"0sHcvytyuB-VzDMLzuI58","data":[],"key":"jceDJBVTxj"}],"key":"mfFLmdlAXt"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":1002,"column":1},"end":{"line":1003,"column":1}},"children":[{"type":"text","value":"We can check the extents to show what happened - the new Silwood terrain dataset now has\na 10km extent in the X dimension.","position":{"start":{"line":1002,"column":1},"end":{"line":1002,"column":1}},"key":"faXdhsNHmG"}],"key":"I5ya65LLY6"}],"key":"ByR8BasZaL"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"print(ext(silwood_dtm_SU96NE))\nprint(ext(silwood_dtm_SU96NW))\nprint(ext(silwood_dtm))","key":"D5s2dL8jlb"},{"type":"output","id":"rfEaScCjVPTOsEyV8VJYU","data":[{"output_type":"stream","name":"stdout","text":"SpatExtent : 495000, 5e+05, 165000, 170000 (xmin, xmax, ymin, ymax)\n"},{"output_type":"stream","name":"stdout","text":"SpatExtent : 490000, 495000, 165000, 170000 (xmin, xmax, ymin, ymax)\n"},{"output_type":"stream","name":"stdout","text":"SpatExtent : 490000, 5e+05, 165000, 170000 (xmin, xmax, ymin, ymax)\n"}],"key":"eDVimHTNTm"}],"key":"ejNXcwO08E"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":1011,"column":1},"end":{"line":1011,"column":1}},"children":[{"type":"text","value":"Combining raster bands","position":{"start":{"line":1011,"column":1},"end":{"line":1011,"column":1}},"key":"z6WnDJTRxh"}],"identifier":"combining-raster-bands","label":"Combining raster bands","html_id":"combining-raster-bands","implicit":true,"key":"KPmPfcBpCt"},{"type":"paragraph","position":{"start":{"line":1013,"column":1},"end":{"line":1017,"column":1}},"children":[{"type":"text","value":"We can also combine rasters with the same resolution and grid to add more bands onto an\nexisting dataset. We can do this to create a new Sentinel 2 dataset that includes the\noriginal 10 metre resolution bands and the 20 metre bands that we resampled to 10\nmetres. The ","position":{"start":{"line":1013,"column":1},"end":{"line":1013,"column":1}},"key":"WsLymkDZBm"},{"type":"inlineCode","value":"terra","position":{"start":{"line":1013,"column":1},"end":{"line":1013,"column":1}},"key":"ERHa3qmKLw"},{"type":"text","value":" package takes the standard ","position":{"start":{"line":1013,"column":1},"end":{"line":1013,"column":1}},"key":"PXSZjGxgZb"},{"type":"inlineCode","value":"c()","position":{"start":{"line":1013,"column":1},"end":{"line":1013,"column":1}},"key":"ucDzWAbUOz"},{"type":"text","value":" function for combining R vectors\nand lists and extends that to join raster layers by band.","position":{"start":{"line":1013,"column":1},"end":{"line":1013,"column":1}},"key":"W04O3ikCYI"}],"key":"JH0qYkfpVx"}],"key":"NoHFgwLacN"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Combine the S2 10m bands with the resampled 20 m bands.\ns2_silwood_10m \u003c- c(s2_silwood_10m, s2_silwood_20m_at_10m)\ns2_nhm_10m \u003c- c(s2_nhm_10m, s2_nhm_20m_at_10m)","key":"KTgznbbIud"},{"type":"output","id":"Pq_imm9C97G7s-8KV6Kbi","data":[],"key":"F1X77p8Jth"}],"key":"pHIBFMlrUd"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":1025,"column":1},"end":{"line":1025,"column":1}},"children":[{"type":"text","value":"Cropping rasters","position":{"start":{"line":1025,"column":1},"end":{"line":1025,"column":1}},"key":"lazzEhFKXv"}],"identifier":"cropping-rasters","label":"Cropping rasters","html_id":"cropping-rasters","implicit":true,"key":"A3EdDAyLXe"},{"type":"paragraph","position":{"start":{"line":1027,"column":1},"end":{"line":1030,"column":1}},"children":[{"type":"text","value":"You can reduce the size of a raster dataset to a particular area of interest using the\n","position":{"start":{"line":1027,"column":1},"end":{"line":1027,"column":1}},"key":"Fyj91j8I85"},{"type":"inlineCode","value":"terra::crop","position":{"start":{"line":1027,"column":1},"end":{"line":1027,"column":1}},"key":"bwo0x1Z9EV"},{"type":"text","value":" function. We will use this to extract the 3km area of interest from the\nnewly mosaiced datasets. All we need to provide is another dataset that has the required\nextent.","position":{"start":{"line":1027,"column":1},"end":{"line":1027,"column":1}},"key":"L4LXuOK9Ul"}],"key":"Ndh043QKZX"}],"key":"yp9UxOSdFi"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Crop the mosaiced DTM data to the 3km area of interest.\nsilwood_dtm \u003c- crop(silwood_dtm, silwood_aerial)\nnhm_dtm \u003c- crop(nhm_dtm, nhm_aerial)","key":"EwqKGQZTHU"},{"type":"output","id":"w0UZD_rvQNUrNvxYFg7Tc","data":[],"key":"xhQF2ddTww"}],"key":"gdxemUABIx"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":1038,"column":1},"end":{"line":1038,"column":1}},"children":[{"type":"text","value":"We can again check the extents of the resulting grids to check that they match:","position":{"start":{"line":1038,"column":1},"end":{"line":1038,"column":1}},"key":"sSeLKd2iEr"}],"key":"M1FzWw7wjt"}],"key":"pGodZgXVAZ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Crop the mosaiced DTM data to the 3km area of interest.\nprint(ext(silwood_dtm))\nprint(ext(silwood_aerial))","key":"bmbX1PVoRZ"},{"type":"output","id":"5e3V4Icefv6Jvg73rxjlB","data":[{"output_type":"stream","name":"stdout","text":"SpatExtent : 493000, 496000, 167000, 170000 (xmin, xmax, ymin, ymax)\n"},{"output_type":"stream","name":"stdout","text":"SpatExtent : 493000, 496000, 167000, 170000 (xmin, xmax, ymin, ymax)\n"}],"key":"OsA92G2oeO"}],"key":"HQ4MpI9FVn"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":1046,"column":1},"end":{"line":1046,"column":1}},"children":[{"type":"text","value":"Manipulating vector data","position":{"start":{"line":1046,"column":1},"end":{"line":1046,"column":1}},"key":"s8U3wmH6Rq"}],"identifier":"manipulating-vector-data","label":"Manipulating vector data","html_id":"manipulating-vector-data","implicit":true,"key":"G3M0qroeuc"},{"type":"paragraph","position":{"start":{"line":1048,"column":1},"end":{"line":1049,"column":1}},"children":[{"type":"text","value":"Vector data manipulation is generally either to merge two datasets or to crop data to a\nsmaller spatial extent.","position":{"start":{"line":1048,"column":1},"end":{"line":1048,"column":1}},"key":"iAI1yEIqpT"}],"key":"XSa41DY7GS"},{"type":"heading","depth":3,"position":{"start":{"line":1051,"column":1},"end":{"line":1051,"column":1}},"children":[{"type":"text","value":"Merging vector data","position":{"start":{"line":1051,"column":1},"end":{"line":1051,"column":1}},"key":"BdnFAXUyqP"}],"identifier":"merging-vector-data","label":"Merging vector data","html_id":"merging-vector-data","implicit":true,"key":"DKDTPoBwj7"},{"type":"paragraph","position":{"start":{"line":1053,"column":1},"end":{"line":1055,"column":1}},"children":[{"type":"text","value":"Vector data is easier to merge in some ways: because the coordinates are recorded\nas sets of point forming features, you don’t have to worry about cell alignment or\nresolution. However, to merge a set of spatial features:","position":{"start":{"line":1053,"column":1},"end":{"line":1053,"column":1}},"key":"wD4ISzAHCn"}],"key":"Fcl5TQbFPi"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":1057,"column":1},"end":{"line":1060,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":1057,"column":1},"end":{"line":1058,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The two datasets have to have the same attributes: the data associated with each\nfeature needs to match.","position":{"start":{"line":1057,"column":1},"end":{"line":1057,"column":1}},"key":"WebmsnT7bJ"}],"key":"cvhjtwHE5j"}],"key":"PnE42Unckb"},{"type":"listItem","spread":true,"position":{"start":{"line":1059,"column":1},"end":{"line":1060,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The two datasets have to be in the same projection.","position":{"start":{"line":1059,"column":1},"end":{"line":1059,"column":1}},"key":"UUow7OXeSo"}],"key":"bE9vX1lOyD"}],"key":"Cnib9ikWTT"}],"key":"yxVhrOK1hV"},{"type":"paragraph","position":{"start":{"line":1061,"column":1},"end":{"line":1064,"column":1}},"children":[{"type":"text","value":"Provided these two things are true, then merging two vector datasets is basically the\nsame as binding together the rows of two data frames with the same structure. The ","position":{"start":{"line":1061,"column":1},"end":{"line":1061,"column":1}},"key":"shZiRDqV8l"},{"type":"inlineCode","value":"sf","position":{"start":{"line":1061,"column":1},"end":{"line":1061,"column":1}},"key":"GOl5RhuF3L"},{"type":"text","value":"\npackage provides a version of the ","position":{"start":{"line":1061,"column":1},"end":{"line":1061,"column":1}},"key":"mJ4oIzNrG2"},{"type":"inlineCode","value":"rbind","position":{"start":{"line":1061,"column":1},"end":{"line":1061,"column":1}},"key":"c7hlieIQrs"},{"type":"text","value":" function that joins two ","position":{"start":{"line":1061,"column":1},"end":{"line":1061,"column":1}},"key":"PtrTPkwAGA"},{"type":"inlineCode","value":"sf","position":{"start":{"line":1061,"column":1},"end":{"line":1061,"column":1}},"key":"x8vc3VIt4k"},{"type":"text","value":" objects, and we\ncan use this to combine the two VML panes for the sites.","position":{"start":{"line":1061,"column":1},"end":{"line":1061,"column":1}},"key":"IeBbRQxUJY"}],"key":"aTlIQiz4eW"}],"key":"JRvbgpflVA"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Combine the road panes\nsilwood_VML_roads \u003c- rbind(vml_su96ne_roads, vml_su96nw_roads)\nnhm_VML_roads \u003c- rbind(vml_tq28se_roads, vml_tq27ne_roads)\n\n# Combine the water area panes\nsilwood_VML_water \u003c- rbind(vml_su96ne_water, vml_su96nw_water)\nnhm_VML_water \u003c- rbind(vml_tq28se_water, vml_tq27ne_water)","key":"dDfOzt5dSR"},{"type":"output","id":"WyzDQmvmlWWzM9t_WKEB4","data":[],"key":"PdqNDccaFO"}],"key":"l020ISTN2H"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":1076,"column":1},"end":{"line":1080,"column":1}},"children":[{"type":"text","value":"If we plot the extents of the new combined data (grey) and the source panes (red and\nblue) for Silwood, you can see that the panes are not neatly aligned with actual BNG\ngrid cell bounds used by the elevation data (dashed panes). Raster cells by definition\nfall onto a neat grid, but vector features cross boundaries and it is common for\ndatasets to include features that fall outside the strict pane boundaries.","position":{"start":{"line":1076,"column":1},"end":{"line":1076,"column":1}},"key":"W2tzYjmFnJ"}],"key":"R76KqMkoni"}],"key":"A1tiTmkyCk"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Merged data\nplot(st_as_sfc(st_bbox(silwood_VML_roads)), border='grey', lwd=4)\n\n# SU96NW panes of vector (solid) and raster (dashed) data\nplot(st_as_sfc(st_bbox(vml_su96nw_roads)), border='blue', add=TRUE)\nplot(st_as_sfc(st_bbox(silwood_dtm_SU96NW)), border='blue', add=TRUE, lty=2)\n\n# SU96NE panes of vector (solid) and raster (dashed) data\nplot(st_as_sfc(st_bbox(vml_su96ne_roads)), border='red', add=TRUE)\nplot(st_as_sfc(st_bbox(silwood_dtm_SU96NE)), border='red', add=TRUE, lty=2)","key":"zbpmWrhKrZ"},{"type":"output","id":"YLLoG6DHXGkBxt3FkV1xI","data":[{"output_type":"display_data","metadata":{"image/png":{"width":420,"height":240}},"data":{"text/plain":{"content":"plot without title","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"894d644252b57c6884559fbf3d2b210c","path":"https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/894d644252b57c6884559fbf3d2b210c.png"}}}],"key":"uCGbFCPdSm"}],"key":"i3w05opMWb"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":1095,"column":1},"end":{"line":1095,"column":1}},"children":[{"type":"text","value":"Cropping vector data","position":{"start":{"line":1095,"column":1},"end":{"line":1095,"column":1}},"key":"SrxJSwMjHY"}],"identifier":"cropping-vector-data","label":"Cropping vector data","html_id":"cropping-vector-data","implicit":true,"key":"qcslwqG9BN"},{"type":"paragraph","position":{"start":{"line":1097,"column":1},"end":{"line":1099,"column":1}},"children":[{"type":"text","value":"We can crop the VML data down to the study site using the ","position":{"start":{"line":1097,"column":1},"end":{"line":1097,"column":1}},"key":"Z8cY2zwWuV"},{"type":"inlineCode","value":"sf::st_crop","position":{"start":{"line":1097,"column":1},"end":{"line":1097,"column":1}},"key":"umE1bHisk1"},{"type":"text","value":" function. It is\nusually faster and easier to reduce datasets to only the focal area you are working\nwith.","position":{"start":{"line":1097,"column":1},"end":{"line":1097,"column":1}},"key":"Eo7WcWOr6b"}],"key":"c3ulmxK5Jg"}],"key":"OZsGnWLUM0"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Crop the two vector datasets\nsilwood_VML_roads \u003c- st_crop(silwood_VML_roads, silwood_aerial)\nnhm_VML_roads \u003c- st_crop(nhm_VML_roads, nhm_aerial)\nsilwood_VML_water \u003c- st_crop(silwood_VML_water, silwood_aerial)\nnhm_VML_water \u003c- st_crop(nhm_VML_water, nhm_aerial)","key":"iAjTuJnS3a"},{"type":"output","id":"-KmOFTCmEmLRNhvxDsS--","data":[{"output_type":"stream","name":"stderr","text":"Warning message:\n“attribute variables are assumed to be spatially constant throughout all geometries”\n"},{"output_type":"stream","name":"stderr","text":"Warning message:\n“attribute variables are assumed to be spatially constant throughout all geometries”\n"},{"output_type":"stream","name":"stderr","text":"Warning message:\n“attribute variables are assumed to be spatially constant throughout all geometries”\n"},{"output_type":"stream","name":"stderr","text":"Warning message:\n“attribute variables are assumed to be spatially constant throughout all geometries”\n"}],"key":"YIhfNvqdL9"}],"key":"MyLz696Wew"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":1109,"column":1},"end":{"line":1111,"column":1}},"children":[{"type":"text","value":"We can now create a simple plot overlaying the vector roads and water over the top of\nthe digital elevations maps, again using ","position":{"start":{"line":1109,"column":1},"end":{"line":1109,"column":1}},"key":"ywQXqGtZYD"},{"type":"inlineCode","value":"sf::st_geometry","position":{"start":{"line":1109,"column":1},"end":{"line":1109,"column":1}},"key":"r1DeVcEtW1"},{"type":"text","value":" to just show the geometries\nof the vector features.","position":{"start":{"line":1109,"column":1},"end":{"line":1109,"column":1}},"key":"yX8UnCPJUZ"}],"key":"cvMarDFg14"}],"key":"zYpSuhlzlG"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"par(mfrow=c(1, 2))\n\nplot(silwood_dtm, col=grey.colors(20), main=\"Silwood\")\nplot(st_geometry(silwood_VML_roads), col=\"firebrick\", add = TRUE)\nplot(st_geometry(silwood_VML_water), col=\"cornflowerblue\", border=NA, add = TRUE)\n\nplot(nhm_dtm, col=grey.colors(20), main=\"NHM\")\nplot(st_geometry(nhm_VML_roads), col=\"firebrick\", add = TRUE)\nplot(st_geometry(nhm_VML_water), col=\"cornflowerblue\", border=NA, add = TRUE)","key":"vzAWfirWuU"},{"type":"output","id":"66lXR7-gvqYQgKslscFtN","data":[{"output_type":"display_data","metadata":{"image/png":{"width":420,"height":240}},"data":{"text/plain":{"content":"plot without title","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"4a5bd97d889d3e8a3f57aa1da26e88c9","path":"https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/4a5bd97d889d3e8a3f57aa1da26e88c9.png"}}}],"key":"n4pQBf6ANz"}],"key":"KqXXwzm1IN"},{"type":"block","children":[{"type":"comment","value":" \n\n### Vector operations\n\nwithin, voronoi etc?\n\n```{code-cell} r\nwithin_25 \u003c- st_within(nest_boxes, nest_boxes_25, sparse=FALSE)\nn_within_25 \u003c- colSums(within_25)\n```\n ","key":"BmAG5rMrLx"},{"type":"heading","depth":2,"position":{"start":{"line":1137,"column":1},"end":{"line":1137,"column":1}},"children":[{"type":"text","value":"Raster calculations","position":{"start":{"line":1137,"column":1},"end":{"line":1137,"column":1}},"key":"mpRAWGfTPi"}],"identifier":"raster-calculations","label":"Raster calculations","html_id":"raster-calculations","implicit":true,"key":"eUBPOWus0x"},{"type":"paragraph","position":{"start":{"line":1139,"column":1},"end":{"line":1145,"column":1}},"children":[{"type":"text","value":"A layer in a continuous raster dataset is basically just a large numeric matrix. This\nmeans you can use raster layers in equations to calulate new composite indices that\nemphasize different parts of the spectral signal. There are a very large number of\nremote sensing indices and the ","position":{"start":{"line":1139,"column":1},"end":{"line":1139,"column":1}},"key":"mzecKEQGFF"},{"type":"link","url":"https://custom-scripts.sentinel-hub.com/custom-scripts/sentinel/sentinel-2/","position":{"start":{"line":1139,"column":1},"end":{"line":1139,"column":1}},"children":[{"type":"text","value":"Sentinel-Hub scripts\nsite","position":{"start":{"line":1139,"column":1},"end":{"line":1139,"column":1}},"key":"E5lPK7lrhc"}],"urlSource":"https://custom-scripts.sentinel-hub.com/custom-scripts/sentinel/sentinel-2/","key":"Wcz0NaO0be"},{"type":"text","value":"\nprovides formulae for a wide range of options. Here we will look at two simple\nvegetation indices.","position":{"start":{"line":1139,"column":1},"end":{"line":1139,"column":1}},"key":"VdWvxshCgz"}],"key":"XXkJeMJUSk"},{"type":"heading","depth":3,"position":{"start":{"line":1147,"column":1},"end":{"line":1147,"column":1}},"children":[{"type":"text","value":"NDVI","position":{"start":{"line":1147,"column":1},"end":{"line":1147,"column":1}},"key":"O9NICheCYv"}],"identifier":"ndvi","label":"NDVI","html_id":"ndvi","implicit":true,"key":"CDUpcK5yeQ"},{"type":"paragraph","position":{"start":{"line":1149,"column":1},"end":{"line":1149,"column":1}},"children":[{"type":"text","value":"The normalised difference vegetation index (NDVI) is defined as:","position":{"start":{"line":1149,"column":1},"end":{"line":1149,"column":1}},"key":"J7iiHJrnUb"}],"key":"OeLRbzAN2i"},{"type":"math","value":"NDVI = \\frac{\\text{NIR} - \\text{RED}}{\\text{NIR} + \\text{RED}}","position":{"start":{"line":1151,"column":1},"end":{"line":1153,"column":1}},"html":"\u003cspan class=\"katex-display\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eN\u003c/mi\u003e\u003cmi\u003eD\u003c/mi\u003e\u003cmi\u003eV\u003c/mi\u003e\u003cmi\u003eI\u003c/mi\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmfrac\u003e\u003cmrow\u003e\u003cmtext\u003eNIR\u003c/mtext\u003e\u003cmo\u003e−\u003c/mo\u003e\u003cmtext\u003eRED\u003c/mtext\u003e\u003c/mrow\u003e\u003cmrow\u003e\u003cmtext\u003eNIR\u003c/mtext\u003e\u003cmo\u003e+\u003c/mo\u003e\u003cmtext\u003eRED\u003c/mtext\u003e\u003c/mrow\u003e\u003c/mfrac\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003eNDVI = \\frac{\\text{NIR} - \\text{RED}}{\\text{NIR} + \\text{RED}}\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.6833em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.10903em;\"\u003eN\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\"\u003eD\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.22222em;\"\u003eV\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.07847em;\"\u003eI\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:2.1297em;vertical-align:-0.7693em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mopen nulldelimiter\"\u003e\u003c/span\u003e\u003cspan class=\"mfrac\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:1.3603em;\"\u003e\u003cspan style=\"top:-2.314em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord text\"\u003e\u003cspan class=\"mord\"\u003eNIR\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e+\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord text\"\u003e\u003cspan class=\"mord\"\u003eRED\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"top:-3.23em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"frac-line\" style=\"border-bottom-width:0.04em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"top:-3.677em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord text\"\u003e\u003cspan class=\"mord\"\u003eNIR\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e−\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord text\"\u003e\u003cspan class=\"mord\"\u003eRED\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.7693em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mclose nulldelimiter\"\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","enumerator":"1","key":"vHxfJShoEE"},{"type":"paragraph","position":{"start":{"line":1155,"column":1},"end":{"line":1158,"column":1}},"children":[{"type":"text","value":"where NIR is band data for the near infrared and RED is band data in the red spectrum,\nwhich are Sentinel 2 bands B8 and B4. The index returns values from -1 (water) through 0\n(rock and bare ground) to 1 (rainforest). See ","position":{"start":{"line":1155,"column":1},"end":{"line":1155,"column":1}},"key":"RkJJmgyDBH"},{"type":"link","url":"https://custom-scripts.sentinel-hub.com/sentinel-2/ndvi/","position":{"start":{"line":1155,"column":1},"end":{"line":1155,"column":1}},"children":[{"type":"text","value":"the Sentinel-Hub NDVI script page for\nmore details","position":{"start":{"line":1155,"column":1},"end":{"line":1155,"column":1}},"key":"tbOMVmycB4"}],"urlSource":"https://custom-scripts.sentinel-hub.com/sentinel-2/ndvi/","key":"BBveS5uPoH"},{"type":"text","value":".","position":{"start":{"line":1155,"column":1},"end":{"line":1155,"column":1}},"key":"zpdI5fzJeX"}],"key":"SWI9DsiRLF"}],"key":"PjSrx5qiRN"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Calculate the NDVI index for the two sites\nndvi_nhm \u003c- (\n  s2_nhm_10m[[\"NIR\"]] - s2_nhm_10m[[\"R\"]]) / \n  (s2_nhm_10m[[\"NIR\"]] + s2_nhm_10m[[\"R\"]]\n)\nndvi_silwood \u003c- (\n  s2_silwood_10m[[\"NIR\"]] - s2_silwood_10m[[\"R\"]]) / \n  (s2_silwood_10m[[\"NIR\"]] + s2_silwood_10m[[\"R\"]]\n)\n# Rename the single band \nnames(ndvi_silwood) \u003c- names(ndvi_nhm) \u003c- \"NDVI\"\n\n# Plot the NDVI index data\npar(mfrow=c(1, 2))\nplot(ndvi_silwood)\nplot(ndvi_nhm)","key":"PhfyL7Tp4O"},{"type":"output","id":"AGkxW_E4p2oHXKIrg9gHM","data":[{"output_type":"display_data","metadata":{"image/png":{"width":420,"height":240}},"data":{"text/plain":{"content":"plot without title","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"3f00cef70fb4e794a355fdf60b1d44db","path":"https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/3f00cef70fb4e794a355fdf60b1d44db.png"}}}],"key":"zSS53J5o0w"}],"key":"yFuAXiRQbd"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":1179,"column":1},"end":{"line":1179,"column":1}},"children":[{"type":"text","value":"EVI","position":{"start":{"line":1179,"column":1},"end":{"line":1179,"column":1}},"key":"HOYAwV9nRB"}],"identifier":"evi","label":"EVI","html_id":"evi","implicit":true,"key":"nFxrvDIXUe"},{"type":"paragraph","position":{"start":{"line":1181,"column":1},"end":{"line":1184,"column":1}},"children":[{"type":"text","value":"The enhanced vegetation index (EVI) is very similar but includes scaling factors and\nuses the Blue band (Sentinel B2) to improve how well the index captures vegetation. The\nscale again extends from -1 to 1. See ","position":{"start":{"line":1181,"column":1},"end":{"line":1181,"column":1}},"key":"Bvmcigy98J"},{"type":"link","url":"https://custom-scripts.sentinel-hub.com/sentinel-2/evi/","position":{"start":{"line":1181,"column":1},"end":{"line":1181,"column":1}},"children":[{"type":"text","value":"the Sentinel-Hub EVI script page for\nmore details","position":{"start":{"line":1181,"column":1},"end":{"line":1181,"column":1}},"key":"u61gvRcL2y"}],"urlSource":"https://custom-scripts.sentinel-hub.com/sentinel-2/evi/","key":"o4KFtg14yJ"},{"type":"text","value":".","position":{"start":{"line":1181,"column":1},"end":{"line":1181,"column":1}},"key":"afkLSqVgCL"}],"key":"MNmrFEZcrD"},{"type":"math","value":"EVI = 2.5 \\cdot \\left( \\frac{\\text{NIR} - \\text{RED}}\n  {\\text{NIR} + 6 \\cdot \\text{RED} - 7.5 \\cdot \\text{BLUE} + 1} \\right)","position":{"start":{"line":1186,"column":1},"end":{"line":1189,"column":1}},"html":"\u003cspan class=\"katex-display\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eE\u003c/mi\u003e\u003cmi\u003eV\u003c/mi\u003e\u003cmi\u003eI\u003c/mi\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmn\u003e2.5\u003c/mn\u003e\u003cmo\u003e⋅\u003c/mo\u003e\u003cmrow\u003e\u003cmo fence=\"true\"\u003e(\u003c/mo\u003e\u003cmfrac\u003e\u003cmrow\u003e\u003cmtext\u003eNIR\u003c/mtext\u003e\u003cmo\u003e−\u003c/mo\u003e\u003cmtext\u003eRED\u003c/mtext\u003e\u003c/mrow\u003e\u003cmrow\u003e\u003cmtext\u003eNIR\u003c/mtext\u003e\u003cmo\u003e+\u003c/mo\u003e\u003cmn\u003e6\u003c/mn\u003e\u003cmo\u003e⋅\u003c/mo\u003e\u003cmtext\u003eRED\u003c/mtext\u003e\u003cmo\u003e−\u003c/mo\u003e\u003cmn\u003e7.5\u003c/mn\u003e\u003cmo\u003e⋅\u003c/mo\u003e\u003cmtext\u003eBLUE\u003c/mtext\u003e\u003cmo\u003e+\u003c/mo\u003e\u003cmn\u003e1\u003c/mn\u003e\u003c/mrow\u003e\u003c/mfrac\u003e\u003cmo fence=\"true\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003eEVI = 2.5 \\cdot \\left( \\frac{\\text{NIR} - \\text{RED}}\n  {\\text{NIR} + 6 \\cdot \\text{RED} - 7.5 \\cdot \\text{BLUE} + 1} \\right)\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.6833em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.05764em;\"\u003eE\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.22222em;\"\u003eV\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.07847em;\"\u003eI\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.6444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e2.5\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e⋅\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:2.4em;vertical-align:-0.95em;\"\u003e\u003c/span\u003e\u003cspan class=\"minner\"\u003e\u003cspan class=\"mopen delimcenter\" style=\"top:0em;\"\u003e\u003cspan class=\"delimsizing size3\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mopen nulldelimiter\"\u003e\u003c/span\u003e\u003cspan class=\"mfrac\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:1.3603em;\"\u003e\u003cspan style=\"top:-2.314em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord text\"\u003e\u003cspan class=\"mord\"\u003eNIR\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e+\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e6\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e⋅\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord text\"\u003e\u003cspan class=\"mord\"\u003eRED\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e−\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e7.5\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e⋅\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord text\"\u003e\u003cspan class=\"mord\"\u003eBLUE\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e+\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"top:-3.23em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"frac-line\" style=\"border-bottom-width:0.04em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"top:-3.677em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord text\"\u003e\u003cspan class=\"mord\"\u003eNIR\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e−\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord text\"\u003e\u003cspan class=\"mord\"\u003eRED\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.7693em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mclose nulldelimiter\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mclose delimcenter\" style=\"top:0em;\"\u003e\u003cspan class=\"delimsizing size3\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","enumerator":"2","key":"dG7t9vKVlE"}],"key":"JztmmwjMvw"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Calculate the EVI index for the two sites\nevi_nhm \u003c- 2.5 * \n  (s2_nhm_10m[[\"NIR\"]] - s2_nhm_10m[[\"R\"]]) / \n  (s2_nhm_10m[[\"NIR\"]] + \n    6 * s2_nhm_10m[[\"R\"]] - \n    7.5 * s2_nhm_10m[[\"B\"]] + 1)\n  \nevi_silwood \u003c- 2.5 * \n  (s2_silwood_10m[[\"NIR\"]] - s2_silwood_10m[[\"R\"]]) / \n  (s2_silwood_10m[[\"NIR\"]] + \n    6 * s2_silwood_10m[[\"R\"]] - \n    7.5 * s2_silwood_10m[[\"B\"]] + 1)\n\n# Rename the single band \nnames(evi_silwood) \u003c- names(evi_nhm) \u003c- \"EVI\"","key":"NbKgmch2XT"},{"type":"output","id":"xJQ_8Dpbqc33H80z0IWll","data":[],"key":"Bvs4BlrkV4"}],"key":"ayySQo1ypB"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":1209,"column":1},"end":{"line":1213,"column":1}},"children":[{"type":"text","value":"There is an issue with the EVI data for the NHM site: there are some anomalous high\nvalues in the satellite data that lead to extreme EVI values. You can see these local\nissues as hotspots if you try plotting these bands (e.g. ","position":{"start":{"line":1209,"column":1},"end":{"line":1209,"column":1}},"key":"Yw2jfSixeN"},{"type":"inlineCode","value":"plot(s2_nhm_10m[[\"NIR\"]])","position":{"start":{"line":1209,"column":1},"end":{"line":1209,"column":1}},"key":"HxV19K6rA1"},{"type":"text","value":").\nWe can fix that problem by setting extreme values to ","position":{"start":{"line":1209,"column":1},"end":{"line":1209,"column":1}},"key":"zuCtWQXaGx"},{"type":"inlineCode","value":"NA","position":{"start":{"line":1209,"column":1},"end":{"line":1209,"column":1}},"key":"TeqiACg4ol"},{"type":"text","value":" - this is another useful\nmethod for manipulating raster data.","position":{"start":{"line":1209,"column":1},"end":{"line":1209,"column":1}},"key":"qbzwER9mCE"}],"key":"TbDpKnQ32E"}],"key":"ua9wKG5Gq8"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Remove anomalous EVI values\nevi_nhm[evi_nhm \u003e 1] \u003c- NA\nevi_nhm[evi_nhm \u003c -1] \u003c- NA","key":"pNPAzg65ur"},{"type":"output","id":"HgWYgl4cXaav9PzyjD_Ox","data":[],"key":"Ohka3B8F2A"}],"key":"ZQmX1om5Jd"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":1221,"column":1},"end":{"line":1221,"column":1}},"children":[{"type":"text","value":"Now we can plot the EVI maps.","position":{"start":{"line":1221,"column":1},"end":{"line":1221,"column":1}},"key":"cHMdEJ1LOw"}],"key":"VyksKqPoWg"}],"key":"yLrGCuTZgm"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Plot the EVI index data\npar(mfrow=c(1, 2))\nplot(evi_silwood)\nplot(evi_nhm)","key":"zHKNGTnD9e"},{"type":"output","id":"OjBa5P8KTI2N7aLZQMySa","data":[{"output_type":"display_data","metadata":{"image/png":{"width":420,"height":240}},"data":{"text/plain":{"content":"plot without title","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"1ff462089c8065cf45374b000c933935","path":"https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/1ff462089c8065cf45374b000c933935.png"}}}],"key":"IweZmtx7r2"}],"key":"bBa8jKWWPf"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":1230,"column":1},"end":{"line":1230,"column":1}},"children":[{"type":"text","value":"Sampling from raster datasets","position":{"start":{"line":1230,"column":1},"end":{"line":1230,"column":1}},"key":"zu8DWWX6dq"}],"identifier":"sampling-from-raster-datasets","label":"Sampling from raster datasets","html_id":"sampling-from-raster-datasets","implicit":true,"key":"J96d8345cC"},{"type":"paragraph","position":{"start":{"line":1232,"column":1},"end":{"line":1235,"column":1}},"children":[{"type":"text","value":"A common need in spatial analysis is to get raster values from locations: for example,\nwhat are the EVI values at the nest box locations, or what are the heights of the sensor\nlocation sites. We can do this using the ","position":{"start":{"line":1232,"column":1},"end":{"line":1232,"column":1}},"key":"rB6e9HJ1HV"},{"type":"inlineCode","value":"terra::extract","position":{"start":{"line":1232,"column":1},"end":{"line":1232,"column":1}},"key":"ZnATAM0Rra"},{"type":"text","value":" function, which takes a raster\nand a vector dataset and returns the cell values under the vector features.","position":{"start":{"line":1232,"column":1},"end":{"line":1232,"column":1}},"key":"qTEKTBjkrm"}],"key":"efjOWTASys"},{"type":"heading","depth":3,"position":{"start":{"line":1237,"column":1},"end":{"line":1237,"column":1}},"children":[{"type":"text","value":"Point features","position":{"start":{"line":1237,"column":1},"end":{"line":1237,"column":1}},"key":"i8FWne9o1j"}],"identifier":"point-features","label":"Point features","html_id":"point-features","implicit":true,"key":"Humyxnn7D9"},{"type":"paragraph","position":{"start":{"line":1239,"column":1},"end":{"line":1239,"column":1}},"children":[{"type":"text","value":"With point features this is very easy - you get the values under each point.","position":{"start":{"line":1239,"column":1},"end":{"line":1239,"column":1}},"key":"S8KXb6dQfu"}],"key":"nClz10cKym"}],"key":"ERVEbtmfLw"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Extract the EVI values under the nest boxes\nnest_box_evi \u003c- extract(evi_silwood, nest_boxes)\nhist(nest_box_evi$EVI)","key":"yb8L6uD4fF"},{"type":"output","id":"6krkX0a0wPQoaAKSWvQLM","data":[{"output_type":"display_data","metadata":{"image/png":{"width":420,"height":240}},"data":{"text/plain":{"content":"Plot with title “Histogram of nest_box_evi$EVI”","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"bd3ef93ea390c5879505596401e9b175","path":"https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/bd3ef93ea390c5879505596401e9b175.png"}}}],"key":"pBZvcNIfx2"}],"key":"jpcoHbPBSK"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":1247,"column":1},"end":{"line":1250,"column":1}},"children":[{"type":"text","value":"It is a little more difficult for the sensors because the heights are in two different\ndatasets, so we need to use extract twice and then combine the results. The\n","position":{"start":{"line":1247,"column":1},"end":{"line":1247,"column":1}},"key":"EeM86ACHo4"},{"type":"inlineCode","value":"terra::extract","position":{"start":{"line":1247,"column":1},"end":{"line":1247,"column":1}},"key":"aJiLGZhIiu"},{"type":"text","value":" function returns a row with NA if there is no data for a site, so we\ncan merge the data simply by joining the two datasets together and dropping the NA rows.","position":{"start":{"line":1247,"column":1},"end":{"line":1247,"column":1}},"key":"w6yLCfgdag"}],"key":"upI6DFiDsQ"}],"key":"XpJM91Hcob"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Extract the heights at the two sites\nsensor_elevations_silwood \u003c- extract(silwood_dtm, sensor_locations)\nsensor_elevations_nhm \u003c- extract(nhm_dtm, sensor_locations)\n\n# Combine the values from the two rasters and drop to the combined data\nsensor_elevations \u003c- na.omit(rbind(sensor_elevations_silwood, sensor_elevations_nhm))\n\n# Show the data\nhead(sensor_elevations)","key":"z0Ir1JDdcz"},{"type":"output","id":"c_qCGndw0S7wCDW6RxX_2","data":[{"output_type":"display_data","metadata":{},"data":{"text/html":{"content":"\u003ctable class=\"dataframe\"\u003e\n\u003ccaption\u003eA data.frame: 6 × 2\u003c/caption\u003e\n\u003cthead\u003e\n\t\u003ctr\u003e\u003cth\u003e\u003c/th\u003e\u003cth scope=col\u003eID\u003c/th\u003e\u003cth scope=col\u003eElevation\u003c/th\u003e\u003c/tr\u003e\n\t\u003ctr\u003e\u003cth\u003e\u003c/th\u003e\u003cth scope=col\u003e\u0026lt;dbl\u0026gt;\u003c/th\u003e\u003cth scope=col\u003e\u0026lt;dbl\u0026gt;\u003c/th\u003e\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\t\u003ctr\u003e\u003cth scope=row\u003e1\u003c/th\u003e\u003ctd\u003e1\u003c/td\u003e\u003ctd\u003e64.35\u003c/td\u003e\u003c/tr\u003e\n\t\u003ctr\u003e\u003cth scope=row\u003e2\u003c/th\u003e\u003ctd\u003e2\u003c/td\u003e\u003ctd\u003e60.46\u003c/td\u003e\u003c/tr\u003e\n\t\u003ctr\u003e\u003cth scope=row\u003e3\u003c/th\u003e\u003ctd\u003e3\u003c/td\u003e\u003ctd\u003e49.74\u003c/td\u003e\u003c/tr\u003e\n\t\u003ctr\u003e\u003cth scope=row\u003e4\u003c/th\u003e\u003ctd\u003e4\u003c/td\u003e\u003ctd\u003e59.69\u003c/td\u003e\u003c/tr\u003e\n\t\u003ctr\u003e\u003cth scope=row\u003e5\u003c/th\u003e\u003ctd\u003e5\u003c/td\u003e\u003ctd\u003e66.45\u003c/td\u003e\u003c/tr\u003e\n\t\u003ctr\u003e\u003cth scope=row\u003e6\u003c/th\u003e\u003ctd\u003e6\u003c/td\u003e\u003ctd\u003e68.25\u003c/td\u003e\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n","content_type":"text/html"},"text/markdown":{"content":"\nA data.frame: 6 × 2\n\n| \u003c!--/--\u003e | ID \u0026lt;dbl\u0026gt; | Elevation \u0026lt;dbl\u0026gt; |\n|---|---|---|\n| 1 | 1 | 64.35 |\n| 2 | 2 | 60.46 |\n| 3 | 3 | 49.74 |\n| 4 | 4 | 59.69 |\n| 5 | 5 | 66.45 |\n| 6 | 6 | 68.25 |\n\n","content_type":"text/markdown"},"text/latex":{"content":"A data.frame: 6 × 2\n\\begin{tabular}{r|ll}\n  \u0026 ID \u0026 Elevation\\\\\n  \u0026 \u003cdbl\u003e \u0026 \u003cdbl\u003e\\\\\n\\hline\n\t1 \u0026 1 \u0026 64.35\\\\\n\t2 \u0026 2 \u0026 60.46\\\\\n\t3 \u0026 3 \u0026 49.74\\\\\n\t4 \u0026 4 \u0026 59.69\\\\\n\t5 \u0026 5 \u0026 66.45\\\\\n\t6 \u0026 6 \u0026 68.25\\\\\n\\end{tabular}\n","content_type":"text/latex"},"text/plain":{"content":"  ID Elevation\n1 1  64.35    \n2 2  60.46    \n3 3  49.74    \n4 4  59.69    \n5 5  66.45    \n6 6  68.25    ","content_type":"text/plain"}}}],"key":"vlTqkXxky0"}],"key":"YrVeFKEH0O"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":1264,"column":1},"end":{"line":1264,"column":1}},"children":[{"type":"text","value":"Line features","position":{"start":{"line":1264,"column":1},"end":{"line":1264,"column":1}},"key":"korbNAkgYz"}],"identifier":"line-features","label":"Line features","html_id":"line-features","implicit":true,"key":"pfPfuPgMEs"},{"type":"paragraph","position":{"start":{"line":1266,"column":1},"end":{"line":1269,"column":1}},"children":[{"type":"text","value":"You might also want to know what the values under a line feature are: either because you\nwant a distribution of those values, or possible because you want a sequence of values\n","position":{"start":{"line":1266,"column":1},"end":{"line":1266,"column":1}},"key":"wztVHvkU9p"},{"type":"emphasis","position":{"start":{"line":1266,"column":1},"end":{"line":1266,"column":1}},"children":[{"type":"text","value":"along","position":{"start":{"line":1266,"column":1},"end":{"line":1266,"column":1}},"key":"ucx39m16mV"}],"key":"Uwws9LOYl9"},{"type":"text","value":" the feature. These two things are different - we’ll look at them using the\nSilmas walk/run route.","position":{"start":{"line":1266,"column":1},"end":{"line":1266,"column":1}},"key":"VeTInyMlz7"}],"key":"uoQiwXKZjs"},{"type":"paragraph","position":{"start":{"line":1271,"column":1},"end":{"line":1274,"column":1}},"children":[{"type":"text","value":"If we just use extract with the line features, then ","position":{"start":{"line":1271,"column":1},"end":{"line":1271,"column":1}},"key":"gIIBqZLeQz"},{"type":"inlineCode","value":"terra::extract","position":{"start":{"line":1271,"column":1},"end":{"line":1271,"column":1}},"key":"pRQtOLycta"},{"type":"text","value":" returns the values\nof all of the cells that the line touches. The values are not in sequence along the line\nfeature - they are just all the values it touches. We can see the cells that are being\nselected by ","position":{"start":{"line":1271,"column":1},"end":{"line":1271,"column":1}},"key":"ARWCYDAigB"},{"type":"strong","position":{"start":{"line":1271,"column":1},"end":{"line":1271,"column":1}},"children":[{"type":"text","value":"rasterising","position":{"start":{"line":1271,"column":1},"end":{"line":1271,"column":1}},"key":"hemjUrnliI"}],"key":"I0cCm5U561"},{"type":"text","value":" the route.","position":{"start":{"line":1271,"column":1},"end":{"line":1271,"column":1}},"key":"QZTmpqg9NH"}],"key":"tItSApUJth"}],"key":"lrRYqqHSAr"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Extract the heights under the Silmas route\nsilmas_heights \u003c- extract(silwood_dtm, silmas_route, xy=TRUE)\n\npar(mfrow=c(1,2))\n# Convert the Silmas route into a raster to show the sampled cells\nsilmas_route_raster \u003c- rasterize(silmas_route, silwood_dtm)\nplot(silwood_dtm, col=grey.colors(20))\nplot(silmas_route_raster, col=\"red\", add=TRUE, legend=FALSE)\n\n# Show the height distribution of all the cells that the route crosses\nhist(silmas_heights$Elevation, xlab = \"Elevation of Silmas route cells (m)\", main=\"\")","key":"Q5AkiPgCRC"},{"type":"output","id":"POSySw-BB-xymhiUNcg_Q","data":[{"output_type":"display_data","metadata":{"image/png":{"width":420,"height":240}},"data":{"text/plain":{"content":"Plot with title “”","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"0f732e910a1c8c172e6bc8ac19bcdbc1","path":"https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/0f732e910a1c8c172e6bc8ac19bcdbc1.png"}}}],"key":"aaW8B4Sz7a"}],"key":"qn7xmvrPsV"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":1290,"column":1},"end":{"line":1295,"column":1}},"children":[{"type":"text","value":"If you want to get a ","position":{"start":{"line":1290,"column":1},"end":{"line":1290,"column":1}},"key":"rQSqCG1JTP"},{"type":"emphasis","position":{"start":{"line":1290,"column":1},"end":{"line":1290,"column":1}},"children":[{"type":"text","value":"sequence of values along a linear feature","position":{"start":{"line":1290,"column":1},"end":{"line":1290,"column":1}},"key":"ZF8jeJtIK9"}],"key":"sJnsY2WCED"},{"type":"text","value":" then you need to\nextract the values in order. To do this, you need to convert the linear feature to\npoints by ","position":{"start":{"line":1290,"column":1},"end":{"line":1290,"column":1}},"key":"CdRYpKqvtn"},{"type":"strong","position":{"start":{"line":1290,"column":1},"end":{"line":1290,"column":1}},"children":[{"type":"text","value":"casting","position":{"start":{"line":1290,"column":1},"end":{"line":1290,"column":1}},"key":"TcTOkrcj8K"}],"key":"dp36ByuCHh"},{"type":"text","value":" it to the simpler feature type. This gives us a warning that\nbasically just says that it is assigning the attributes for the whole linear feature to\neach and every point, and that might not be sensible. If the points are very spaced out,\nyou can use ","position":{"start":{"line":1290,"column":1},"end":{"line":1290,"column":1}},"key":"SwmJyzZ4Ra"},{"type":"inlineCode","value":"sf::st_segmentize","position":{"start":{"line":1290,"column":1},"end":{"line":1290,"column":1}},"key":"Uknceu9tVd"},{"type":"text","value":" to interpolate more points along the feature.","position":{"start":{"line":1290,"column":1},"end":{"line":1290,"column":1}},"key":"FCWQM9L9LH"}],"key":"hCqtiDc57A"}],"key":"HYEFC2DuSV"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"silmas_points \u003c- st_cast(silmas_route, \"POINT\")","key":"eTP50r0YOi"},{"type":"output","id":"WohPN8jsDuuICstUffBX1","data":[{"output_type":"stream","name":"stderr","text":"Warning message in st_cast.sf(silmas_route, \"POINT\"):\n“repeating attributes for all sub-geometries for which they may not be constant”\n"}],"key":"h4CFyHJzkT"}],"key":"aJdhraUVCV"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":1301,"column":1},"end":{"line":1303,"column":1}},"children":[{"type":"text","value":"We can now use ","position":{"start":{"line":1301,"column":1},"end":{"line":1301,"column":1}},"key":"ydkYmJ4BOS"},{"type":"inlineCode","value":"terra::extract","position":{"start":{"line":1301,"column":1},"end":{"line":1301,"column":1}},"key":"SnaZqqk8QV"},{"type":"text","value":" on the points to get the heights in sequence. We can\nalso use Pythagoras’ theorem to get the cumulative distance along the route from the\ncoordinates.","position":{"start":{"line":1301,"column":1},"end":{"line":1301,"column":1}},"key":"hTjzxGpkVa"}],"key":"izNJKPrO8z"}],"key":"Gg1UF8LXjS"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Get the height of each GPS point along the route\nsilmas_heights \u003c- extract(silwood_dtm, silmas_points)\n\n# Get the coordinates of the points and use Pythagoras to ge the distance.\ncoords \u003c- as.data.frame(st_coordinates(silmas_points))\ncoords$distance \u003c- c(0, sqrt(diff(coords$X)**2 + diff(coords$Y)**2))\ncoords$total_distance \u003c- cumsum(coords$distance)\ncoords$height \u003c-silmas_heights$Elevation\n\n# Plot the height profile of the Silmas walk\nplot(height~ total_distance, data=coords, type=\"l\")","key":"MMo71E70C7"},{"type":"output","id":"3h8i125FZfLASb2GukERQ","data":[{"output_type":"display_data","metadata":{"image/png":{"width":420,"height":240}},"data":{"text/plain":{"content":"plot without title","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"af39057b286072859cacde457eb63811","path":"https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/af39057b286072859cacde457eb63811.png"}}}],"key":"mTqG0WuSpL"}],"key":"XVWtMtu3gm"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":1319,"column":1},"end":{"line":1319,"column":1}},"children":[{"type":"text","value":"Polygon features","position":{"start":{"line":1319,"column":1},"end":{"line":1319,"column":1}},"key":"VIYFusbkTp"}],"identifier":"polygon-features","label":"Polygon features","html_id":"polygon-features","implicit":true,"key":"oqhNevTBVM"},{"type":"paragraph","position":{"start":{"line":1321,"column":1},"end":{"line":1325,"column":1}},"children":[{"type":"text","value":"It is extremely common to want to get a distribution or summary statistic of raster\nvalues within a polygon feature: for example, what is the average elevation within 50\nmetres of each of the sensor locations? The first thing to do is to get polygons that\nform a 50m radius circle around each sensor locations using the ","position":{"start":{"line":1321,"column":1},"end":{"line":1321,"column":1}},"key":"YYd0lSzKaA"},{"type":"inlineCode","value":"sf::st_buffer","position":{"start":{"line":1321,"column":1},"end":{"line":1321,"column":1}},"key":"tGduTRixtb"},{"type":"text","value":"\nfunction.","position":{"start":{"line":1321,"column":1},"end":{"line":1321,"column":1}},"key":"uirtJfnu4w"}],"key":"zm8G0x3TDD"}],"key":"irh8hip8pg"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Get 50m radius polygons around the sensor points\nsensor_locations_50 \u003c- st_buffer(sensor_locations, 50)","key":"H4Qy0HKPFD"},{"type":"output","id":"UJWNAFqSA4CsokikV8azG","data":[],"key":"KTq9lAXkZg"}],"key":"SSYAP5EPU0"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":1332,"column":1},"end":{"line":1336,"column":1}},"children":[{"type":"text","value":"You can use ","position":{"start":{"line":1332,"column":1},"end":{"line":1332,"column":1}},"key":"OmNSPI9cP6"},{"type":"inlineCode","value":"sf::st_buffer","position":{"start":{"line":1332,"column":1},"end":{"line":1332,"column":1}},"key":"tWDcQID5Cb"},{"type":"text","value":" with any features to get polygons extending out from the\nfeature, and you can in fact use negative distances to get polygons ","position":{"start":{"line":1332,"column":1},"end":{"line":1332,"column":1}},"key":"vzb6MCC3aP"},{"type":"emphasis","position":{"start":{"line":1332,"column":1},"end":{"line":1332,"column":1}},"children":[{"type":"text","value":"within","position":{"start":{"line":1332,"column":1},"end":{"line":1332,"column":1}},"key":"NCq0zh8phN"}],"key":"I3v5eaYPN6"},{"type":"text","value":" existing\npolygons. We can then use the polygon features with ","position":{"start":{"line":1332,"column":1},"end":{"line":1332,"column":1}},"key":"PAhWVFy9rH"},{"type":"inlineCode","value":"terra::extract","position":{"start":{"line":1332,"column":1},"end":{"line":1332,"column":1}},"key":"CZ6M4jLLvi"},{"type":"text","value":" to get a data frame\nof the values from the digital elevation map associated with each sensor location. We\nagain need to join the results from the two sites together and drop any NA rows.","position":{"start":{"line":1332,"column":1},"end":{"line":1332,"column":1}},"key":"bQnPxGbEgL"}],"key":"YJmXXrkdOM"}],"key":"NWBhPyASki"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Get the values within the 50m buffer for each sensor location, \nsilwood_sensor_heights \u003c- extract(silwood_dtm, sensor_locations_50)\nnhm_sensor_heights \u003c- extract(nhm_dtm, sensor_locations_50)\nsensor_heights \u003c- na.omit(rbind(silwood_sensor_heights, nhm_sensor_heights))\n\n# How many values per site?\ntable(sensor_heights$ID)\n\n# Height variation between sensors\nboxplot(Elevation ~ ID, data= sensor_heights)","key":"rGgHdLbgLH"},{"type":"output","id":"5GyGunvN7oyCYEJsmLDcd","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"\n  1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18 \n314 314 315 313 311 313 311 313 315 315 311 311 313 316 313 316 313 313 ","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{"image/png":{"width":420,"height":240}},"data":{"text/plain":{"content":"plot without title","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"4c4f22722a7093553e5c2aa4c58a398c","path":"https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/4c4f22722a7093553e5c2aa4c58a398c.png"}}}],"key":"aZ9buxhkfG"}],"key":"cxeEDZsUhm"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":1351,"column":1},"end":{"line":1351,"column":1}},"children":[{"type":"text","value":"We can also extract data from categorical rasters:","position":{"start":{"line":1351,"column":1},"end":{"line":1351,"column":1}},"key":"VGrQH6UtnO"}],"key":"aY2YX6sMaS"}],"key":"QLN6jxVSpv"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Get the values within the 50m buffer for each sensor location, \nsilwood_sensor_LCM \u003c- extract(silwood_LCM, sensor_locations_50)\nnhm_sensor_LCM \u003c- extract(nhm_LCM, sensor_locations_50)\nsensor_LCM \u003c- na.omit(rbind(silwood_sensor_LCM, nhm_sensor_LCM))\n\n# Land cover class counts within 50m of each sensor.\nxtabs(~ LandCover + ID, data= sensor_LCM, drop.unused.levels=TRUE)","key":"uZ0LtJzrl2"},{"type":"output","id":"nQwyXKFep2diPBl-xm6Q6","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"                      ID\nLandCover               1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18\n  Broadleaved woodland 50 51 44 11 18  0 68 78 77 46 69 68  1 75  0  5  5  5\n  Coniferous woodland   0 26  3  0  1  0  0  0  0  8  4  0  0  0  0  0  0  0\n  Arable                0  0  0  0  0  0  0  0  0  0  0  0  0  0  1  1  2  2\n  Improved grassland   19  0 11 66  0  0  7  0  0 13  0  9  0  4  0  0  0  0\n  Neutral grassland     0  0  1  0  0  0  4  0  0  0  0  3  0  0  0  0  0  0\n  Heather and shrub     2  1  0  0  0  0  0  0  0  2  1  0  0  0  0  0  0  0\n  Freshwater            0  0 18  0  0  0  0  0  0  0  4  0  0  0  0  0  0  0\n  Urban                 1  0  0  0  0 14  0  0  0  0  0  0 14  0 69 67 54 48\n  Suburban              4  3  0  0 60 64  0  0  0  6  0  0 60  0  8  8 16 23","content_type":"text/plain"}}}],"key":"vKzoFy02Ak"}],"key":"gp7cO6BhEU"},{"type":"block","children":[{"type":"admonition","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Side note","position":{"start":{"line":1363,"column":1},"end":{"line":1363,"column":1}},"key":"mD1075Txkk"}],"key":"eTT2E9OgNa"},{"type":"paragraph","position":{"start":{"line":1365,"column":1},"end":{"line":1369,"column":1}},"children":[{"type":"text","value":"As a sidenote, the standard way this works is to use the ","position":{"start":{"line":1365,"column":1},"end":{"line":1365,"column":1}},"key":"nUr0NvQoFA"},{"type":"inlineCode","value":"terra::rasterize","position":{"start":{"line":1365,"column":1},"end":{"line":1365,"column":1}},"key":"kGsPbhdzL4"},{"type":"text","value":" function to\nfind all of the raster cells where the cell centre falls within a polygon feature, but\nyou can optionally choose to also include any cells that the cell boundary touches,\nusing the ","position":{"start":{"line":1365,"column":1},"end":{"line":1365,"column":1}},"key":"j8qGk7ol8Y"},{"type":"inlineCode","value":"touches=TRUE","position":{"start":{"line":1365,"column":1},"end":{"line":1365,"column":1}},"key":"R8MHQ8lbsT"},{"type":"text","value":" setting. The plot below shows the two alternatives for a single\nsensor polygon.","position":{"start":{"line":1365,"column":1},"end":{"line":1365,"column":1}},"key":"Q65UAudDoH"}],"key":"hu6xH1Fsvq"}],"key":"ViX9giqYJc"}],"key":"siqhQ7xXfl"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Create an extent around a single sensor\nzoom_to_site_one \u003c- ext(c(493835,  493955, 169200, 169330))\n\n# Rasterize using the two methods\ncell_touches_false \u003c- rasterize(sensor_locations_50[1,], silwood_dtm)\ncell_touches_true \u003c- rasterize(sensor_locations_50[1,], silwood_dtm, touches=TRUE)\n\n# Plot side by side as DTM overplotted with rasterized polygon and polygon border\npar(mfrow=c(1,2))\n\nplot(\n  silwood_dtm, ext=zoom_to_site_one, legend=FALSE, \n  col=gray.colors(20), main=\"touches=FALSE\"\n)\nplot(cell_touches_false, add=TRUE, legend=FALSE, col=\"firebrick\")\nplot(st_geometry(sensor_locations_50[1,]), col=NA, add=TRUE)\n\nplot(\n  silwood_dtm, ext=zoom_to_site_one, legend=FALSE, \n  col=gray.colors(20), main=\"touches=TRUE\"\n)\nplot(cell_touches_true, add=TRUE, legend=FALSE, col=\"firebrick\")\nplot(st_geometry(sensor_locations_50[1,]), col=NA, add=TRUE)","visibility":"hide","key":"GilPzwcodG"},{"type":"output","id":"MpAAKumlT5NP3wtkAH5uw","data":[{"output_type":"display_data","metadata":{"image/png":{"width":420,"height":240}},"data":{"text/plain":{"content":"plot without title","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"96a0494f4dd28bf5b720ffe56e521f3c","path":"https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/96a0494f4dd28bf5b720ffe56e521f3c.png"}}}],"visibility":"show","key":"oskmitMqCZ"}],"data":{"tags":[]},"visibility":"show","key":"vdeRidi3Un"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":1400,"column":1},"end":{"line":1400,"column":1}},"children":[{"type":"text","value":"Zonal statistics","position":{"start":{"line":1400,"column":1},"end":{"line":1400,"column":1}},"key":"YIK7ZBqPhH"}],"identifier":"zonal-statistics","label":"Zonal statistics","html_id":"zonal-statistics","implicit":true,"key":"IKwqH2OVLz"},{"type":"paragraph","position":{"start":{"line":1402,"column":1},"end":{"line":1406,"column":1}},"children":[{"type":"text","value":"You can also sample from a raster dataset using another raster dataset. In practice,\nthis is what is happening when you extract data from a vector feature - the different\nfeatures get converted into raster layers in order to identify which cells to extract.\nBut if you already have a categorical raster, you can simply use the ","position":{"start":{"line":1402,"column":1},"end":{"line":1402,"column":1}},"key":"McXgnoaJwh"},{"type":"inlineCode","value":"terra::zonal","position":{"start":{"line":1402,"column":1},"end":{"line":1402,"column":1}},"key":"EqCYtMyWHU"},{"type":"text","value":"\nfunction to extract the values under each raster cateogory.","position":{"start":{"line":1402,"column":1},"end":{"line":1402,"column":1}},"key":"SLdLwo5QcR"}],"key":"QXspCwKsDn"}],"key":"LVpFVyIOvQ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Extract the EVI values for each LCM raster cell\nevi_by_LCM \u003c- zonal(evi_silwood, silwood_LCM, wide=FALSE)\nhead(evi_by_LCM)","key":"mblVNU0AVe"},{"type":"output","id":"txtsk2ljDTGtxLjeZn2PZ","data":[{"output_type":"display_data","metadata":{},"data":{"text/html":{"content":"\u003ctable class=\"dataframe\"\u003e\n\u003ccaption\u003eA data.frame: 6 × 3\u003c/caption\u003e\n\u003cthead\u003e\n\t\u003ctr\u003e\u003cth\u003e\u003c/th\u003e\u003cth scope=col\u003eLandCover\u003c/th\u003e\u003cth scope=col\u003eCertainty\u003c/th\u003e\u003cth scope=col\u003eEVI\u003c/th\u003e\u003c/tr\u003e\n\t\u003ctr\u003e\u003cth\u003e\u003c/th\u003e\u003cth scope=col\u003e\u0026lt;chr\u0026gt;\u003c/th\u003e\u003cth scope=col\u003e\u0026lt;dbl\u0026gt;\u003c/th\u003e\u003cth scope=col\u003e\u0026lt;dbl\u0026gt;\u003c/th\u003e\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\t\u003ctr\u003e\u003cth scope=row\u003e1\u003c/th\u003e\u003ctd\u003eConiferous woodland \u003c/td\u003e\u003ctd\u003e13\u003c/td\u003e\u003ctd\u003e0.3871913\u003c/td\u003e\u003c/tr\u003e\n\t\u003ctr\u003e\u003cth scope=row\u003e2\u003c/th\u003e\u003ctd\u003eHeather and shrub   \u003c/td\u003e\u003ctd\u003e13\u003c/td\u003e\u003ctd\u003e0.5173610\u003c/td\u003e\u003c/tr\u003e\n\t\u003ctr\u003e\u003cth scope=row\u003e3\u003c/th\u003e\u003ctd\u003eImproved grassland  \u003c/td\u003e\u003ctd\u003e14\u003c/td\u003e\u003ctd\u003e0.3233749\u003c/td\u003e\u003c/tr\u003e\n\t\u003ctr\u003e\u003cth scope=row\u003e4\u003c/th\u003e\u003ctd\u003eHeather and shrub   \u003c/td\u003e\u003ctd\u003e14\u003c/td\u003e\u003ctd\u003e0.5542493\u003c/td\u003e\u003c/tr\u003e\n\t\u003ctr\u003e\u003cth scope=row\u003e5\u003c/th\u003e\u003ctd\u003eBroadleaved woodland\u003c/td\u003e\u003ctd\u003e15\u003c/td\u003e\u003ctd\u003e0.2784485\u003c/td\u003e\u003c/tr\u003e\n\t\u003ctr\u003e\u003cth scope=row\u003e6\u003c/th\u003e\u003ctd\u003eConiferous woodland \u003c/td\u003e\u003ctd\u003e15\u003c/td\u003e\u003ctd\u003e0.2257099\u003c/td\u003e\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n","content_type":"text/html"},"text/markdown":{"content":"\nA data.frame: 6 × 3\n\n| \u003c!--/--\u003e | LandCover \u0026lt;chr\u0026gt; | Certainty \u0026lt;dbl\u0026gt; | EVI \u0026lt;dbl\u0026gt; |\n|---|---|---|---|\n| 1 | Coniferous woodland  | 13 | 0.3871913 |\n| 2 | Heather and shrub    | 13 | 0.5173610 |\n| 3 | Improved grassland   | 14 | 0.3233749 |\n| 4 | Heather and shrub    | 14 | 0.5542493 |\n| 5 | Broadleaved woodland | 15 | 0.2784485 |\n| 6 | Coniferous woodland  | 15 | 0.2257099 |\n\n","content_type":"text/markdown"},"text/latex":{"content":"A data.frame: 6 × 3\n\\begin{tabular}{r|lll}\n  \u0026 LandCover \u0026 Certainty \u0026 EVI\\\\\n  \u0026 \u003cchr\u003e \u0026 \u003cdbl\u003e \u0026 \u003cdbl\u003e\\\\\n\\hline\n\t1 \u0026 Coniferous woodland  \u0026 13 \u0026 0.3871913\\\\\n\t2 \u0026 Heather and shrub    \u0026 13 \u0026 0.5173610\\\\\n\t3 \u0026 Improved grassland   \u0026 14 \u0026 0.3233749\\\\\n\t4 \u0026 Heather and shrub    \u0026 14 \u0026 0.5542493\\\\\n\t5 \u0026 Broadleaved woodland \u0026 15 \u0026 0.2784485\\\\\n\t6 \u0026 Coniferous woodland  \u0026 15 \u0026 0.2257099\\\\\n\\end{tabular}\n","content_type":"text/latex"},"text/plain":{"content":"  LandCover            Certainty EVI      \n1 Coniferous woodland  13        0.3871913\n2 Heather and shrub    13        0.5173610\n3 Improved grassland   14        0.3233749\n4 Heather and shrub    14        0.5542493\n5 Broadleaved woodland 15        0.2784485\n6 Coniferous woodland  15        0.2257099","content_type":"text/plain"}}}],"key":"WdA8BP1Uyd"}],"key":"rWU3Zc4NFj"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":1414,"column":1},"end":{"line":1414,"column":1}},"children":[{"type":"text","value":"We can then visualise the range of EVI values by land cover class:","position":{"start":{"line":1414,"column":1},"end":{"line":1414,"column":1}},"key":"hQ06QtAHEc"}],"key":"sjSOcjAcOg"}],"key":"QmAjlevmQX"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"par(mar = c(4,12,1,1))\nplot(EVI ~ as.factor(LandCover), data=evi_by_LCM, horizontal=TRUE, las=1, xlab=\"\")","key":"wyQ8My3UWE"},{"type":"output","id":"YSZQsIUY9zIAIjNbrWe2W","data":[{"output_type":"display_data","metadata":{"image/png":{"width":420,"height":240}},"data":{"text/plain":{"content":"plot without title","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"421499d09bfdfb32dbf3ac20721a528d","path":"https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/421499d09bfdfb32dbf3ac20721a528d.png"}}}],"key":"vZLeZiL3q4"}],"key":"URNah3Y3FC"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":1421,"column":1},"end":{"line":1421,"column":1}},"children":[{"type":"text","value":"Image classification","position":{"start":{"line":1421,"column":1},"end":{"line":1421,"column":1}},"key":"JATeZbx6Ja"}],"identifier":"image-classification","label":"Image classification","html_id":"image-classification","implicit":true,"key":"CQvC7Nre7M"},{"type":"paragraph","position":{"start":{"line":1423,"column":1},"end":{"line":1429,"column":1}},"children":[{"type":"text","value":"We already have the CEH Land Cover map, but we may be able to get a better local model\nof land cover by classifying the Sentinel 2 data. Image classification is the process of\ntaking spectral data from an image and identifying particular spectral signatures\n(combinations of values in the different bands) with a land cover category. You ","position":{"start":{"line":1423,"column":1},"end":{"line":1423,"column":1}},"key":"RLcw9PPd7C"},{"type":"emphasis","position":{"start":{"line":1423,"column":1},"end":{"line":1423,"column":1}},"children":[{"type":"text","value":"can","position":{"start":{"line":1423,"column":1},"end":{"line":1423,"column":1}},"key":"Oyt0nXqigJ"}],"key":"pTv9IeoeBk"},{"type":"text","value":"\nclassify simple RGB images, but it is often better to use data with more spectral bands:\nas we saw with the false colour infrared image, some bands are great at picking out\nparticular features.","position":{"start":{"line":1423,"column":1},"end":{"line":1423,"column":1}},"key":"jzGiHUJzvG"}],"key":"pUZJj9ozcQ"},{"type":"heading","depth":3,"position":{"start":{"line":1431,"column":1},"end":{"line":1431,"column":1}},"children":[{"type":"text","value":"Unsupervised classification","position":{"start":{"line":1431,"column":1},"end":{"line":1431,"column":1}},"key":"vU5gXbq0FK"}],"identifier":"unsupervised-classification","label":"Unsupervised classification","html_id":"unsupervised-classification","implicit":true,"key":"rzxMy6xkfc"},{"type":"paragraph","position":{"start":{"line":1433,"column":1},"end":{"line":1435,"column":1}},"children":[{"type":"text","value":"Unsupervised classification tries to extract clusters of spectral signatures from the\ndata. There are many approaches, but the basic aim of the algorithms is to try and find\nsets of points in the image that have similar spectral signatures.","position":{"start":{"line":1433,"column":1},"end":{"line":1433,"column":1}},"key":"Gt88i5Iq9q"}],"key":"ctLpobrrvY"},{"type":"paragraph","position":{"start":{"line":1437,"column":1},"end":{"line":1441,"column":1}},"children":[{"type":"text","value":"Here we will use the base R ","position":{"start":{"line":1437,"column":1},"end":{"line":1437,"column":1}},"key":"DXIdMPM6RC"},{"type":"inlineCode","value":"stats::kmeans","position":{"start":{"line":1437,"column":1},"end":{"line":1437,"column":1}},"key":"hbTAYGLmxZ"},{"type":"text","value":" function to carry out k-means clustering on\nthe data. The ","position":{"start":{"line":1437,"column":1},"end":{"line":1437,"column":1}},"key":"t6Awze77sh"},{"type":"inlineCode","value":"k","position":{"start":{"line":1437,"column":1},"end":{"line":1437,"column":1}},"key":"gQw2KYU6EI"},{"type":"text","value":" of the k-means is the number of clusters we want to identify, and here\nwe are letting the algorithm pick 10 random starting points from with the image spectra\nand then iterating to try and find stable sets of clusters. It then repeats that process\nwith different starting choices and returns a classification across all of the runs.","position":{"start":{"line":1437,"column":1},"end":{"line":1437,"column":1}},"key":"UkNwFgfuXe"}],"key":"uvzdtqgXtg"}],"key":"Ay9P8ifkJI"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# We need to convert the raster data into a data frame giving the \n# spectral signature of each cell\nvalues \u003c- as.data.frame(s2_silwood_10m)\nhead(values)","key":"AD7UNcOUHE"},{"type":"output","id":"To1fXwrb_Kl8Ywb8p0t0a","data":[{"output_type":"display_data","metadata":{},"data":{"text/html":{"content":"\u003ctable class=\"dataframe\"\u003e\n\u003ccaption\u003eA data.frame: 6 × 10\u003c/caption\u003e\n\u003cthead\u003e\n\t\u003ctr\u003e\u003cth\u003e\u003c/th\u003e\u003cth scope=col\u003eB\u003c/th\u003e\u003cth scope=col\u003eG\u003c/th\u003e\u003cth scope=col\u003eR\u003c/th\u003e\u003cth scope=col\u003eNIR\u003c/th\u003e\u003cth scope=col\u003eRE5\u003c/th\u003e\u003cth scope=col\u003eRE6\u003c/th\u003e\u003cth scope=col\u003eRE7\u003c/th\u003e\u003cth scope=col\u003eNNIR\u003c/th\u003e\u003cth scope=col\u003eSWIR1\u003c/th\u003e\u003cth scope=col\u003eSWIR2\u003c/th\u003e\u003c/tr\u003e\n\t\u003ctr\u003e\u003cth\u003e\u003c/th\u003e\u003cth scope=col\u003e\u0026lt;dbl\u0026gt;\u003c/th\u003e\u003cth scope=col\u003e\u0026lt;dbl\u0026gt;\u003c/th\u003e\u003cth scope=col\u003e\u0026lt;dbl\u0026gt;\u003c/th\u003e\u003cth scope=col\u003e\u0026lt;dbl\u0026gt;\u003c/th\u003e\u003cth scope=col\u003e\u0026lt;dbl\u0026gt;\u003c/th\u003e\u003cth scope=col\u003e\u0026lt;dbl\u0026gt;\u003c/th\u003e\u003cth scope=col\u003e\u0026lt;dbl\u0026gt;\u003c/th\u003e\u003cth scope=col\u003e\u0026lt;dbl\u0026gt;\u003c/th\u003e\u003cth scope=col\u003e\u0026lt;dbl\u0026gt;\u003c/th\u003e\u003cth scope=col\u003e\u0026lt;dbl\u0026gt;\u003c/th\u003e\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\t\u003ctr\u003e\u003cth scope=row\u003e1\u003c/th\u003e\u003ctd\u003e0.1126540\u003c/td\u003e\u003ctd\u003e0.1346360\u003c/td\u003e\u003ctd\u003e0.1176198\u003c/td\u003e\u003ctd\u003e0.5312377\u003c/td\u003e\u003ctd\u003e0.1616589\u003c/td\u003e\u003ctd\u003e0.3894638\u003c/td\u003e\u003ctd\u003e0.4897377\u003c/td\u003e\u003ctd\u003e0.5389172\u003c/td\u003e\u003ctd\u003e0.2604423\u003c/td\u003e\u003ctd\u003e0.1682324\u003c/td\u003e\u003c/tr\u003e\n\t\u003ctr\u003e\u003cth scope=row\u003e2\u003c/th\u003e\u003ctd\u003e0.1125039\u003c/td\u003e\u003ctd\u003e0.1317386\u003c/td\u003e\u003ctd\u003e0.1162934\u003c/td\u003e\u003ctd\u003e0.5213764\u003c/td\u003e\u003ctd\u003e0.1621940\u003c/td\u003e\u003ctd\u003e0.3903101\u003c/td\u003e\u003ctd\u003e0.4925578\u003c/td\u003e\u003ctd\u003e0.5394651\u003c/td\u003e\u003ctd\u003e0.2606421\u003c/td\u003e\u003ctd\u003e0.1676645\u003c/td\u003e\u003c/tr\u003e\n\t\u003ctr\u003e\u003cth scope=row\u003e3\u003c/th\u003e\u003ctd\u003e0.1137242\u003c/td\u003e\u003ctd\u003e0.1307431\u003c/td\u003e\u003ctd\u003e0.1163586\u003c/td\u003e\u003ctd\u003e0.4971099\u003c/td\u003e\u003ctd\u003e0.1632642\u003c/td\u003e\u003ctd\u003e0.3920027\u003c/td\u003e\u003ctd\u003e0.4981979\u003c/td\u003e\u003ctd\u003e0.5405609\u003c/td\u003e\u003ctd\u003e0.2610416\u003c/td\u003e\u003ctd\u003e0.1665289\u003c/td\u003e\u003c/tr\u003e\n\t\u003ctr\u003e\u003cth scope=row\u003e4\u003c/th\u003e\u003ctd\u003e0.1138673\u003c/td\u003e\u003ctd\u003e0.1347918\u003c/td\u003e\u003ctd\u003e0.1176043\u003c/td\u003e\u003ctd\u003e0.5016983\u003c/td\u003e\u003ctd\u003e0.1637144\u003c/td\u003e\u003ctd\u003e0.3945694\u003c/td\u003e\u003ctd\u003e0.5009160\u003c/td\u003e\u003ctd\u003e0.5416230\u003c/td\u003e\u003ctd\u003e0.2610287\u003c/td\u003e\u003ctd\u003e0.1660050\u003c/td\u003e\u003c/tr\u003e\n\t\u003ctr\u003e\u003cth scope=row\u003e5\u003c/th\u003e\u003ctd\u003e0.1127050\u003c/td\u003e\u003ctd\u003e0.1365101\u003c/td\u003e\u003ctd\u003e0.1175242\u003c/td\u003e\u003ctd\u003e0.5214314\u003c/td\u003e\u003ctd\u003e0.1635447\u003c/td\u003e\u003ctd\u003e0.3980100\u003c/td\u003e\u003ctd\u003e0.5007122\u003c/td\u003e\u003ctd\u003e0.5426514\u003c/td\u003e\u003ctd\u003e0.2606036\u003c/td\u003e\u003ctd\u003e0.1660928\u003c/td\u003e\u003c/tr\u003e\n\t\u003ctr\u003e\u003cth scope=row\u003e6\u003c/th\u003e\u003ctd\u003e0.1131771\u003c/td\u003e\u003ctd\u003e0.1339148\u003c/td\u003e\u003ctd\u003e0.1181829\u003c/td\u003e\u003ctd\u003e0.5241254\u003c/td\u003e\u003ctd\u003e0.1637062\u003c/td\u003e\u003ctd\u003e0.3980521\u003c/td\u003e\u003ctd\u003e0.4925694\u003c/td\u003e\u003ctd\u003e0.5329403\u003c/td\u003e\u003ctd\u003e0.2602010\u003c/td\u003e\u003ctd\u003e0.1675292\u003c/td\u003e\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n","content_type":"text/html"},"text/markdown":{"content":"\nA data.frame: 6 × 10\n\n| \u003c!--/--\u003e | B \u0026lt;dbl\u0026gt; | G \u0026lt;dbl\u0026gt; | R \u0026lt;dbl\u0026gt; | NIR \u0026lt;dbl\u0026gt; | RE5 \u0026lt;dbl\u0026gt; | RE6 \u0026lt;dbl\u0026gt; | RE7 \u0026lt;dbl\u0026gt; | NNIR \u0026lt;dbl\u0026gt; | SWIR1 \u0026lt;dbl\u0026gt; | SWIR2 \u0026lt;dbl\u0026gt; |\n|---|---|---|---|---|---|---|---|---|---|---|\n| 1 | 0.1126540 | 0.1346360 | 0.1176198 | 0.5312377 | 0.1616589 | 0.3894638 | 0.4897377 | 0.5389172 | 0.2604423 | 0.1682324 |\n| 2 | 0.1125039 | 0.1317386 | 0.1162934 | 0.5213764 | 0.1621940 | 0.3903101 | 0.4925578 | 0.5394651 | 0.2606421 | 0.1676645 |\n| 3 | 0.1137242 | 0.1307431 | 0.1163586 | 0.4971099 | 0.1632642 | 0.3920027 | 0.4981979 | 0.5405609 | 0.2610416 | 0.1665289 |\n| 4 | 0.1138673 | 0.1347918 | 0.1176043 | 0.5016983 | 0.1637144 | 0.3945694 | 0.5009160 | 0.5416230 | 0.2610287 | 0.1660050 |\n| 5 | 0.1127050 | 0.1365101 | 0.1175242 | 0.5214314 | 0.1635447 | 0.3980100 | 0.5007122 | 0.5426514 | 0.2606036 | 0.1660928 |\n| 6 | 0.1131771 | 0.1339148 | 0.1181829 | 0.5241254 | 0.1637062 | 0.3980521 | 0.4925694 | 0.5329403 | 0.2602010 | 0.1675292 |\n\n","content_type":"text/markdown"},"text/latex":{"content":"A data.frame: 6 × 10\n\\begin{tabular}{r|llllllllll}\n  \u0026 B \u0026 G \u0026 R \u0026 NIR \u0026 RE5 \u0026 RE6 \u0026 RE7 \u0026 NNIR \u0026 SWIR1 \u0026 SWIR2\\\\\n  \u0026 \u003cdbl\u003e \u0026 \u003cdbl\u003e \u0026 \u003cdbl\u003e \u0026 \u003cdbl\u003e \u0026 \u003cdbl\u003e \u0026 \u003cdbl\u003e \u0026 \u003cdbl\u003e \u0026 \u003cdbl\u003e \u0026 \u003cdbl\u003e \u0026 \u003cdbl\u003e\\\\\n\\hline\n\t1 \u0026 0.1126540 \u0026 0.1346360 \u0026 0.1176198 \u0026 0.5312377 \u0026 0.1616589 \u0026 0.3894638 \u0026 0.4897377 \u0026 0.5389172 \u0026 0.2604423 \u0026 0.1682324\\\\\n\t2 \u0026 0.1125039 \u0026 0.1317386 \u0026 0.1162934 \u0026 0.5213764 \u0026 0.1621940 \u0026 0.3903101 \u0026 0.4925578 \u0026 0.5394651 \u0026 0.2606421 \u0026 0.1676645\\\\\n\t3 \u0026 0.1137242 \u0026 0.1307431 \u0026 0.1163586 \u0026 0.4971099 \u0026 0.1632642 \u0026 0.3920027 \u0026 0.4981979 \u0026 0.5405609 \u0026 0.2610416 \u0026 0.1665289\\\\\n\t4 \u0026 0.1138673 \u0026 0.1347918 \u0026 0.1176043 \u0026 0.5016983 \u0026 0.1637144 \u0026 0.3945694 \u0026 0.5009160 \u0026 0.5416230 \u0026 0.2610287 \u0026 0.1660050\\\\\n\t5 \u0026 0.1127050 \u0026 0.1365101 \u0026 0.1175242 \u0026 0.5214314 \u0026 0.1635447 \u0026 0.3980100 \u0026 0.5007122 \u0026 0.5426514 \u0026 0.2606036 \u0026 0.1660928\\\\\n\t6 \u0026 0.1131771 \u0026 0.1339148 \u0026 0.1181829 \u0026 0.5241254 \u0026 0.1637062 \u0026 0.3980521 \u0026 0.4925694 \u0026 0.5329403 \u0026 0.2602010 \u0026 0.1675292\\\\\n\\end{tabular}\n","content_type":"text/latex"},"text/plain":{"content":"  B         G         R         NIR       RE5       RE6       RE7      \n1 0.1126540 0.1346360 0.1176198 0.5312377 0.1616589 0.3894638 0.4897377\n2 0.1125039 0.1317386 0.1162934 0.5213764 0.1621940 0.3903101 0.4925578\n3 0.1137242 0.1307431 0.1163586 0.4971099 0.1632642 0.3920027 0.4981979\n4 0.1138673 0.1347918 0.1176043 0.5016983 0.1637144 0.3945694 0.5009160\n5 0.1127050 0.1365101 0.1175242 0.5214314 0.1635447 0.3980100 0.5007122\n6 0.1131771 0.1339148 0.1181829 0.5241254 0.1637062 0.3980521 0.4925694\n  NNIR      SWIR1     SWIR2    \n1 0.5389172 0.2604423 0.1682324\n2 0.5394651 0.2606421 0.1676645\n3 0.5405609 0.2610416 0.1665289\n4 0.5416230 0.2610287 0.1660050\n5 0.5426514 0.2606036 0.1660928\n6 0.5329403 0.2602010 0.1675292","content_type":"text/plain"}}}],"key":"yA2wRqqrRm"}],"key":"hi4aLewbk0"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Now we can run the clustering\nn_cats \u003c- 6\ns2_kmeans \u003c- kmeans(\n  values, centers=n_cats, iter.max = 500, nstart = 5, algorithm=\"Lloyd\"\n)\n\n# We can now take the cluster attribute from the output and put those values\n# back into a 10m resolution raster\ns2_kmeans_map \u003c- rast(s2_silwood_10m, nlyr=1)\nvalues(s2_kmeans_map) \u003c- s2_kmeans$cluster","key":"jfFJQDid1U"},{"type":"output","id":"3iX0lrKCKpBXme0PcQf5P","data":[],"key":"WJuLk4zcmL"}],"key":"piS1G7Cb8F"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":1463,"column":1},"end":{"line":1464,"column":1}},"children":[{"type":"text","value":"Now that we have the map, we can add labels and category names, as we did above for the\nCEH dataset.","position":{"start":{"line":1463,"column":1},"end":{"line":1463,"column":1}},"key":"ohpiD5HMjM"}],"key":"Prekm5qWab"}],"key":"TEYOp98AFM"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"labels \u003c- data.frame(ID=1:n_cats, category=paste0(\"Category_\", 1:n_cats))\n#colours \u003c- data.frame(ID=1:n_cats, colours=hcl.colors(n_cats, \"Dark 2\"))\n\ncolours \u003c- data.frame(ID=1:n_cats, colours=carto_pal(n_cats, \"Safe\"))\n\nlevels(s2_kmeans_map) \u003c- labels\ncoltab(s2_kmeans_map) \u003c- colours\n\nplot(s2_kmeans_map)","key":"gUJ4knh5Q4"},{"type":"output","id":"fkOcXT2u06Tdc-G43rEPk","data":[{"output_type":"display_data","metadata":{"image/png":{"width":420,"height":240}},"data":{"text/plain":{"content":"plot without title","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"a0a9c7811c51585a79fbbc76d3a3df46","path":"https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/a0a9c7811c51585a79fbbc76d3a3df46.png"}}}],"key":"XXEoGOR7Ph"}],"key":"nkIH9ZnEIA"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":1480,"column":1},"end":{"line":1480,"column":1}},"children":[{"type":"text","value":"Supervised classification","position":{"start":{"line":1480,"column":1},"end":{"line":1480,"column":1}},"key":"y3Sy49lieM"}],"identifier":"supervised-classification","label":"Supervised classification","html_id":"supervised-classification","implicit":true,"key":"maK0nfWbqn"},{"type":"paragraph","position":{"start":{"line":1482,"column":1},"end":{"line":1485,"column":1}},"children":[{"type":"text","value":"The classes from an unsupervised classification are a purely statistical construction:\nthey often do identify meaningful land cover types, but they need to be interpreted and\nit is common to re-run the process with different numbers of classes, or to merge\nclasses that identify very similar regions.","position":{"start":{"line":1482,"column":1},"end":{"line":1482,"column":1}},"key":"iO5lx7PPZQ"}],"key":"jheqEHG9YS"},{"type":"paragraph","position":{"start":{"line":1487,"column":1},"end":{"line":1490,"column":1}},"children":[{"type":"text","value":"The alternative of supervised classification avoids that by starting with a training\ndataset of sites with known categories. The spectral signatures of those sites can then\nbe used to assign other sites to classes based on their similarity to the training data.\nThis does mean that you need to put together a training dataset in one of two ways:","position":{"start":{"line":1487,"column":1},"end":{"line":1487,"column":1}},"key":"eSNbiDV0Ej"}],"key":"liwMHBnYGP"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":1492,"column":1},"end":{"line":1496,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":1492,"column":1},"end":{"line":1493,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"physically exploring the location with a GPS and assigning classes based on field data\n(“ground truthing”), or","position":{"start":{"line":1492,"column":1},"end":{"line":1492,"column":1}},"key":"hjY8OcAkSm"}],"key":"Mg80AXiFvy"}],"key":"C8CSt3wxJ8"},{"type":"listItem","spread":true,"position":{"start":{"line":1494,"column":1},"end":{"line":1496,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"selecting points from the imagery that visually belong to a particular class\n(“digitization”).","position":{"start":{"line":1494,"column":1},"end":{"line":1494,"column":1}},"key":"Wx1UAiie0U"}],"key":"gjzliSbKRx"}],"key":"U2pzdrhK91"}],"key":"QJ5UH9zcOZ"},{"type":"paragraph","position":{"start":{"line":1497,"column":1},"end":{"line":1499,"column":1}},"children":[{"type":"text","value":"Here we use a training set drawn from inspecting the imagery, saved as a set of X and Y\npoint coordinates and the land cover category at that point. There are multiple sites\nfor each class, giving a distribution of signatures associated with each class.","position":{"start":{"line":1497,"column":1},"end":{"line":1497,"column":1}},"key":"UvH0K5r5Fg"}],"key":"C5IZBoJaMB"}],"key":"EmoKe4Onpt"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Load the classification data and convert it to an SF point dataset\ntraining_sites \u003c- read.csv(\"../data/SpatialMethods/S2_classification_data.csv\")\ntraining_sites \u003c- st_as_sf(training_sites, coords=c(\"x\",\"y\"), crs=\"EPSG:27700\")\n\n# Plot the data over the top of an aerial image. This is a bit of a hack\n# as it plots the vector data first to get the legend, then plots the aerial\n# photo over the top and then the training sites _again_.\nplot(training_sites, reset=FALSE)\nplotRGB(silwood_aerial, add=TRUE)\nplot(training_sites, add=TRUE)\n\n# Show a table of the number of training sites for each category.\ntable(training_sites$category)","key":"uK9MUTfBHX"},{"type":"output","id":"3PiGwKYXf0JE4PKmrzjh0","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"\n Bare Ground    Grassland         Road Silwood Lake        Urban        Water \n           9           36           10            4           24            9 \n    Woodland \n          37 ","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{"image/png":{"width":420,"height":240}},"data":{"text/plain":{"content":"Plot with title “category”","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"ff18bad7336bc32d46fb818f435a9bc8","path":"https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/ff18bad7336bc32d46fb818f435a9bc8.png"}}}],"key":"fBQA4gJeB7"}],"key":"yFvJUTqVMt"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":1517,"column":1},"end":{"line":1518,"column":1}},"children":[{"type":"text","value":"We can then extract the spectral signatures at each of those sites to give a spectral\ntraining dataset to use in classification.","position":{"start":{"line":1517,"column":1},"end":{"line":1517,"column":1}},"key":"Wik87tlLAk"}],"key":"alBgwLcgmN"}],"key":"QLJe22LWub"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Extract a data frame of band values at each training site and add the\n# category field to the dataset.\ntraining_spectra \u003c- extract(s2_silwood_10m, training_sites, ID=FALSE)\ntraining_spectra$category \u003c- training_sites$category","key":"AdymphAIJC"},{"type":"output","id":"l5F2vzia1Wg3mkTGbOiCG","data":[],"key":"EVoMWMzXxo"}],"key":"aIQCmKUKOB"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":1527,"column":1},"end":{"line":1530,"column":1}},"children":[{"type":"text","value":"We will use a regression tree model using the ","position":{"start":{"line":1527,"column":1},"end":{"line":1527,"column":1}},"key":"NK2SSwWjwK"},{"type":"inlineCode","value":"rpart::rpart","position":{"start":{"line":1527,"column":1},"end":{"line":1527,"column":1}},"key":"Ah9cLg1GRt"},{"type":"text","value":" function to assign spectral\nsignatures to classes. A regression tree finds critical values in the different bands\nthat separate different classes and provides a simple decision tree based on the\ntraining data that can then be used to classify the whole image.","position":{"start":{"line":1527,"column":1},"end":{"line":1527,"column":1}},"key":"Rn7cHfKyo3"}],"key":"qjuQeZXK7K"}],"key":"iPciAO24Lm"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Fit a regression tree of the land cover category as a function of the bands\ns2_class_model \u003c- rpart(\n  category ~  B + G + R + NIR + RE5 + RE6 + RE7 + NNIR + SWIR1 + SWIR2,\n  data = training_spectra, method = 'class', minsplit = 5\n)\n\n# Show the regression tree.\nprint(s2_class_model)","key":"gSiKFfcXZR"},{"type":"output","id":"VlrpIASIA4qWgeEIWykyk","data":[{"output_type":"stream","name":"stdout","text":"n= 129 \n\nnode), split, n, loss, yval, (yprob)\n      * denotes terminal node\n\n 1) root 129 92 Woodland (0.07 0.28 0.078 0.031 0.19 0.07 0.29)  \n   2) R\u003e=0.1304218 81 45 Grassland (0.11 0.44 0.099 0.049 0.3 0 0)  \n     4) SWIR1\u003e=0.356181 43  7 Grassland (0.12 0.84 0 0 0.047 0 0)  \n       8) B\u003e=0.2016674 3  0 Bare Ground (1 0 0 0 0 0 0) *\n       9) B\u003c 0.2016674 40  4 Grassland (0.05 0.9 0 0 0.05 0 0)  \n        18) NIR\u003e=0.3257478 38  2 Grassland (0.053 0.95 0 0 0 0 0) *\n        19) NIR\u003c 0.3257478 2  0 Urban (0 0 0 0 1 0 0) *\n     5) SWIR1\u003c 0.356181 38 16 Urban (0.11 0 0.21 0.11 0.58 0 0)  \n      10) RE5\u003c 0.2091596 12  5 Road (0 0 0.58 0.33 0.083 0 0)  \n        20) RE6\u003e=0.2886455 7  0 Road (0 0 1 0 0 0 0) *\n        21) RE6\u003c 0.2886455 5  1 Silwood Lake (0 0 0 0.8 0.2 0 0) *\n      11) RE5\u003e=0.2091596 26  5 Urban (0.15 0 0.038 0 0.81 0 0) *\n   3) R\u003c 0.1304218 48 11 Woodland (0 0 0.042 0 0 0.19 0.77)  \n     6) NIR\u003c 0.30421 10  1 Water (0 0 0.1 0 0 0.9 0) *\n     7) NIR\u003e=0.30421 38  1 Woodland (0 0 0.026 0 0 0 0.97) *\n"}],"key":"lXuAIxYauF"}],"key":"uLhOn81Bjx"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":1543,"column":1},"end":{"line":1545,"column":1}},"children":[{"type":"text","value":"The model can then be used to predict values for all of the pixels. The resulting\nraster has one layer for each land cover type that gives the probability that the pixel\nis in that class.","position":{"start":{"line":1543,"column":1},"end":{"line":1543,"column":1}},"key":"PQ8mu9pw7x"}],"key":"C6E6Lh3LoJ"}],"key":"mHPXU2G95O"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Generate the predictions for the whole map\ns2_class_probability \u003c- predict(s2_silwood_10m, s2_class_model)\n\n# Plot 3 of the probability layers\nplot(s2_class_probability[[1:3]], nc=3)","key":"cnOU3NoSLL"},{"type":"output","id":"HEwDyVVuTQjdyIFNkK9YT","data":[{"output_type":"display_data","metadata":{"image/png":{"width":420,"height":240}},"data":{"text/plain":{"content":"plot without title","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"dc466da9142a3731297483fbdd05a185","path":"https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/dc466da9142a3731297483fbdd05a185.png"}}}],"key":"TEzYBTTS92"}],"key":"NfrYr9FASF"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":1555,"column":1},"end":{"line":1556,"column":1}},"children":[{"type":"text","value":"We can convert it into a land cover map by assigning each pixel to the class where it\nhas the highest probability.","position":{"start":{"line":1555,"column":1},"end":{"line":1555,"column":1}},"key":"fPnXddu07y"}],"key":"Ic8thmEN3Z"}],"key":"EPhFg34tTK"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Find the layer with the highest probability. The index of that code gives the \n# associated land  cover type\ns2_class_map \u003c- which.max(s2_class_probability)\n\n# Assign level labels to the index codes.\nlevels(s2_class_map) \u003c- data.frame(id=1:7, class=names(s2_class_probability))\nplot(s2_class_map, col=carto_pal(7, \"Safe\"))","key":"gpB1UfYRkR"},{"type":"output","id":"eM1sS3rqz8e5KKI-k0Qci","data":[{"output_type":"display_data","metadata":{"image/png":{"width":420,"height":240}},"data":{"text/plain":{"content":"plot without title","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"c9fa9f1e5d862136edc9aec3dde72e1b","path":"https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/c9fa9f1e5d862136edc9aec3dde72e1b.png"}}}],"key":"zee2l0iU4D"}],"key":"Y3ontkeUXy"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":1568,"column":1},"end":{"line":1571,"column":1}},"children":[{"type":"text","value":"It is good practice to partition your training dataset to then test the accuracy of the\nclassification - can your model successfully predict the classes of the data retained in\nthe test partition. There are a lot of approaches to this (k-fold cross validation is a\ncommon one) but these are outside the scope of this practical.","position":{"start":{"line":1568,"column":1},"end":{"line":1568,"column":1}},"key":"EW00U05xVH"}],"key":"S2o9TN6FS2"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Generating training data","position":{"start":{"line":1573,"column":1},"end":{"line":1573,"column":1}},"key":"y9P87hRv15"}],"key":"A70WpkIM5H"},{"type":"paragraph","position":{"start":{"line":1576,"column":1},"end":{"line":1578,"column":1}},"children":[{"type":"text","value":"Digitizing training data is one of those tasks where it may be easier to use a dedicated\nGIS program like GIS. This is mostly because it is easier to zoom in on an image to\nprecisely place the training locations.","position":{"start":{"line":1576,"column":1},"end":{"line":1576,"column":1}},"key":"zYN32ZTa5p"}],"key":"e2F5V3HAcv"},{"type":"paragraph","position":{"start":{"line":1580,"column":1},"end":{"line":1582,"column":1}},"children":[{"type":"text","value":"However, you can use R to create training datasets. The code below defines a function\nthat can be used to generate a training data frame and then extend it with training data\nfor different classes.","position":{"start":{"line":1580,"column":1},"end":{"line":1580,"column":1}},"key":"Xwm2LwkkmT"}],"key":"TYdc00845z"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"pick_training_sites \u003c- function(category, df = NULL) {\n    #' Function to add training data locations by clicking on a displayed map.\n    #' \n    #' The function returns a data frame with the X and Y coordinates of the clicked\n    #' points and a category field giving the `category` label for with the points.\n    #' Press 'Escape' to finish collecting points and return a dataframe of coordinates.\n    #' The returned dataframe for one category can be passed back into the `df`\n    #' argument to append sites for a new category to the existing data. \n\n    # Pick the points from a plotted GIS map\n    xy \u003c- draw(\"points\", pch=4)\n    # Convert the selected coordinates to a dataframe and add the category label\n    new_data \u003c- as.data.frame(crds(xy))\n    new_data$category \u003c- category\n\n    # Return the new_data appended to any existing data\n    return(rbind(df, new_data))\n}\n\n# Plot the image\nplotRGB(silwood_aerial)\n\n# Build up the training set by clicking on the image and then pressing\n# \"escape\" to finish defining one class and to move onto the next category\ndf \u003c- pick_training_sites(\"Urban\")\ndf \u003c- pick_training_sites(\"Grassland\", df=df)\ndf \u003c- pick_training_sites(\"Water\", df=df)\ndf \u003c- pick_training_sites(\"Silwood Lake\", df=df)\ndf \u003c- pick_training_sites(\"Bare Ground\", df=df)\ndf \u003c- pick_training_sites(\"Woodland\", df=df)\ndf \u003c- pick_training_sites(\"Road\", df=df)\n\n# Export the data\nwrite.csv(df, \"../data/SpatialMethods/S2_classification_data.csv\", row.names=FALSE)","visibility":"show","key":"CtE3qWioBa"},{"type":"output","id":"R4LEYRQ4o7WppsfWVQut_","data":[],"visibility":"show","key":"LslpfrApIP"}],"data":{"tags":["skip-execution"]},"visibility":"show","key":"HQguvDIpYB"}],"class":"dropdown","key":"DcvPNp0vSv"},{"type":"heading","depth":2,"position":{"start":{"line":1625,"column":1},"end":{"line":1625,"column":1}},"children":[{"type":"text","value":"Saving GIS files","position":{"start":{"line":1625,"column":1},"end":{"line":1625,"column":1}},"key":"UGoSxSkICd"}],"identifier":"saving-gis-files","label":"Saving GIS files","html_id":"saving-gis-files","implicit":true,"key":"MUJpGFN0yq"}],"key":"lIaCyrAVVD"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Remove any existing data output folder rather than have to stick a load of \n# overwrite=TRUE arguments in the student facing text.\nif (dir.exists(\"spatial_method_practical_outputs\")) {\n  unlink(\"spatial_method_practical_outputs\", recursive=TRUE)\n}","visibility":"show","key":"nTOOIQW7XP"},{"type":"output","id":"7wL37-3TM1ZymAtyt1eIr","data":[],"visibility":"show","key":"pgOwUJE5HN"}],"data":{"tags":[]},"visibility":"remove","key":"x9yPWFWbNl"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":1637,"column":1},"end":{"line":1638,"column":1}},"children":[{"type":"text","value":"We have created a lot of new dataset during this practical, which we should save for\nfuture use. The first thing to do is create a new directory to save the data files in:","position":{"start":{"line":1637,"column":1},"end":{"line":1637,"column":1}},"key":"Lc7estivY1"}],"key":"JlHD6Gu3jq"}],"key":"iB6yViIPWC"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Create an output directory\ndir.create(\"spatial_method_practical_outputs\")\nsetwd(\"spatial_method_practical_outputs\")","key":"iiE2pfAhp1"},{"type":"output","id":"4NHFXSrPEGSiG8KtlXKHD","data":[],"key":"BcEEDKeJhG"}],"key":"WfMq5snVzy"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":1646,"column":1},"end":{"line":1646,"column":1}},"children":[{"type":"text","value":"Saving raster data","position":{"start":{"line":1646,"column":1},"end":{"line":1646,"column":1}},"key":"dREYwgd7TS"}],"identifier":"saving-raster-data","label":"Saving raster data","html_id":"saving-raster-data","implicit":true,"key":"pjQygi20J6"},{"type":"paragraph","position":{"start":{"line":1648,"column":1},"end":{"line":1651,"column":1}},"children":[{"type":"text","value":"We can write raster data out using the ","position":{"start":{"line":1648,"column":1},"end":{"line":1648,"column":1}},"key":"K5Y59HzTd3"},{"type":"inlineCode","value":"terra::writeRaster","position":{"start":{"line":1648,"column":1},"end":{"line":1648,"column":1}},"key":"eHOD6cC4Dd"},{"type":"text","value":" function. This\nfunction writes all the bands in the dataset out to a single file. The function uses the\nfile suffix of the file name you provide to set the output format: there are lots of\nformats, but GeoTIFF is widely used and a good general choice.","position":{"start":{"line":1648,"column":1},"end":{"line":1648,"column":1}},"key":"GjWsTMATXI"}],"key":"ZqemOSrTCm"}],"key":"iol4PlPUei"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Create an output directory\ndir.create(\"spatial_method_practical_outputs\")\nsetwd(\"spatial_method_practical_outputs\")\n\n# Save the NDVI and EVI data\nwriteRaster(ndvi_silwood, \"NDVI_Silwood.tiff\")\nwriteRaster(ndvi_nhm, \"NDVI_NHM.tiff\")\n\nwriteRaster(evi_silwood, \"EVI_Silwood.tiff\")\nwriteRaster(evi_nhm, \"EVI_NHM.tiff\")\n\n# Save the multiband Sentinel 2 data\nwriteRaster(s2_silwood_10m, \"Sentinel2_Silwood.tiff\")\nwriteRaster(s2_nhm_10m, \"Sentinel2_NHM.tiff\")","key":"aA2COu07Qo"},{"type":"output","id":"eClnD7iVaX7ACIgeHYbOt","data":[],"key":"rLBRCNSnKo"}],"key":"dAnzBokGtr"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":1670,"column":1},"end":{"line":1670,"column":1}},"children":[{"type":"text","value":"Saving vector data","position":{"start":{"line":1670,"column":1},"end":{"line":1670,"column":1}},"key":"p1EhRi80cR"}],"identifier":"saving-vector-data","label":"Saving vector data","html_id":"saving-vector-data","implicit":true,"key":"uo6UQuqfGc"},{"type":"paragraph","position":{"start":{"line":1672,"column":1},"end":{"line":1675,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":1672,"column":1},"end":{"line":1672,"column":1}},"key":"cO4sEfzFnj"},{"type":"inlineCode","value":"sf_st::write","position":{"start":{"line":1672,"column":1},"end":{"line":1672,"column":1}},"key":"Ngqi9Sz2MR"},{"type":"text","value":" function is used to write vector data to file. Again, the file format\nis inferred from the output file name. This ","position":{"start":{"line":1672,"column":1},"end":{"line":1672,"column":1}},"key":"zsOLBmsIoA"},{"type":"inlineCode","value":"sf_st::write","position":{"start":{"line":1672,"column":1},"end":{"line":1672,"column":1}},"key":"V95jv4PftH"},{"type":"text","value":" function is slightly more\ncomplex because file formats work in slightly different ways. The function has three\nmain arguments:","position":{"start":{"line":1672,"column":1},"end":{"line":1672,"column":1}},"key":"nu9XHjRbIH"}],"key":"klMwzzvWaY"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":1677,"column":1},"end":{"line":1683,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":1677,"column":1},"end":{"line":1677,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"obj","position":{"start":{"line":1677,"column":1},"end":{"line":1677,"column":1}},"key":"HucVKjZYa4"},{"type":"text","value":": The ","position":{"start":{"line":1677,"column":1},"end":{"line":1677,"column":1}},"key":"PAWgy0bh5F"},{"type":"inlineCode","value":"sf","position":{"start":{"line":1677,"column":1},"end":{"line":1677,"column":1}},"key":"ajDfbutB5c"},{"type":"text","value":" object you want to write to a file.","position":{"start":{"line":1677,"column":1},"end":{"line":1677,"column":1}},"key":"cKnml6Ydts"}],"key":"tW8yRo50dE"}],"key":"eKXIV6ok1y"},{"type":"listItem","spread":true,"position":{"start":{"line":1678,"column":1},"end":{"line":1679,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"dsn","position":{"start":{"line":1678,"column":1},"end":{"line":1678,"column":1}},"key":"an1Xc56tew"},{"type":"text","value":": The ","position":{"start":{"line":1678,"column":1},"end":{"line":1678,"column":1}},"key":"LLEOdO1yAA"},{"type":"emphasis","position":{"start":{"line":1678,"column":1},"end":{"line":1678,"column":1}},"children":[{"type":"text","value":"data source name","position":{"start":{"line":1678,"column":1},"end":{"line":1678,"column":1}},"key":"keGrg5ZQic"}],"key":"s9seaIBf96"},{"type":"text","value":" that usually gives a filename that the data will be\nwritten to.","position":{"start":{"line":1678,"column":1},"end":{"line":1678,"column":1}},"key":"vS06PmqY5F"}],"key":"cOyZWcZFyH"}],"key":"Re2BI78YFc"},{"type":"listItem","spread":true,"position":{"start":{"line":1680,"column":1},"end":{"line":1683,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"layer","position":{"start":{"line":1680,"column":1},"end":{"line":1680,"column":1}},"key":"QD71GWtz2o"},{"type":"text","value":": A ","position":{"start":{"line":1680,"column":1},"end":{"line":1680,"column":1}},"key":"DBEa3rBhds"},{"type":"emphasis","position":{"start":{"line":1680,"column":1},"end":{"line":1680,"column":1}},"children":[{"type":"text","value":"layer name","position":{"start":{"line":1680,"column":1},"end":{"line":1680,"column":1}},"key":"SlIjkEvdyX"}],"key":"E9d8TzxRGv"},{"type":"text","value":" within the data source that the data will be saved under. Not\nall formats support multiple layers (e.g. shapefiles), so you do not always need to\nprovide a layer name.","position":{"start":{"line":1680,"column":1},"end":{"line":1680,"column":1}},"key":"mpkTvYLa1n"}],"key":"X7GPXgTO9u"}],"key":"MT2NBm21Sj"}],"key":"bQ1IhQE5Cu"},{"type":"paragraph","position":{"start":{"line":1684,"column":1},"end":{"line":1685,"column":1}},"children":[{"type":"text","value":"There are many, ","position":{"start":{"line":1684,"column":1},"end":{"line":1684,"column":1}},"key":"veDWihMWFh"},{"type":"emphasis","position":{"start":{"line":1684,"column":1},"end":{"line":1684,"column":1}},"children":[{"type":"text","value":"many","position":{"start":{"line":1684,"column":1},"end":{"line":1684,"column":1}},"key":"Iowew6mDLF"}],"key":"ozlaqjqAMl"},{"type":"text","value":" vector file formats - see the help file on ","position":{"start":{"line":1684,"column":1},"end":{"line":1684,"column":1}},"key":"p3cokLuCpD"},{"type":"inlineCode","value":"sf::st_drivers()","position":{"start":{"line":1684,"column":1},"end":{"line":1684,"column":1}},"key":"VGNhYzW2Fo"},{"type":"text","value":" and\nthe output","position":{"start":{"line":1684,"column":1},"end":{"line":1684,"column":1}},"key":"l1QT2durIl"}],"key":"z6d6hdfrIH"}],"key":"LVhqMBPrVH"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"st_drivers()$name","key":"VLh9wycwGv"},{"type":"output","id":"Udc8MllkVsKOvWKh1PVyt","data":[{"output_type":"display_data","metadata":{},"data":{"text/html":{"content":"\u003cstyle\u003e\n.list-inline {list-style: none; margin:0; padding: 0}\n.list-inline\u003eli {display: inline-block}\n.list-inline\u003eli:not(:last-child)::after {content: \"\\00b7\"; padding: 0 .5ex}\n\u003c/style\u003e\n\u003col class=list-inline\u003e\u003cli\u003e'FITS'\u003c/li\u003e\u003cli\u003e'PCIDSK'\u003c/li\u003e\u003cli\u003e'netCDF'\u003c/li\u003e\u003cli\u003e'PDS4'\u003c/li\u003e\u003cli\u003e'VICAR'\u003c/li\u003e\u003cli\u003e'JP2OpenJPEG'\u003c/li\u003e\u003cli\u003e'PDF'\u003c/li\u003e\u003cli\u003e'MBTiles'\u003c/li\u003e\u003cli\u003e'BAG'\u003c/li\u003e\u003cli\u003e'EEDA'\u003c/li\u003e\u003cli\u003e'OGCAPI'\u003c/li\u003e\u003cli\u003e'ESRI Shapefile'\u003c/li\u003e\u003cli\u003e'MapInfo File'\u003c/li\u003e\u003cli\u003e'UK .NTF'\u003c/li\u003e\u003cli\u003e'LVBAG'\u003c/li\u003e\u003cli\u003e'OGR_SDTS'\u003c/li\u003e\u003cli\u003e'S57'\u003c/li\u003e\u003cli\u003e'DGN'\u003c/li\u003e\u003cli\u003e'OGR_VRT'\u003c/li\u003e\u003cli\u003e'Memory'\u003c/li\u003e\u003cli\u003e'CSV'\u003c/li\u003e\u003cli\u003e'NAS'\u003c/li\u003e\u003cli\u003e'GML'\u003c/li\u003e\u003cli\u003e'GPX'\u003c/li\u003e\u003cli\u003e'LIBKML'\u003c/li\u003e\u003cli\u003e'KML'\u003c/li\u003e\u003cli\u003e'GeoJSON'\u003c/li\u003e\u003cli\u003e'GeoJSONSeq'\u003c/li\u003e\u003cli\u003e'ESRIJSON'\u003c/li\u003e\u003cli\u003e'TopoJSON'\u003c/li\u003e\u003cli\u003e'Interlis 1'\u003c/li\u003e\u003cli\u003e'Interlis 2'\u003c/li\u003e\u003cli\u003e'OGR_GMT'\u003c/li\u003e\u003cli\u003e'GPKG'\u003c/li\u003e\u003cli\u003e'SQLite'\u003c/li\u003e\u003cli\u003e'ODBC'\u003c/li\u003e\u003cli\u003e'WAsP'\u003c/li\u003e\u003cli\u003e'PGeo'\u003c/li\u003e\u003cli\u003e'MSSQLSpatial'\u003c/li\u003e\u003cli\u003e'PostgreSQL'\u003c/li\u003e\u003cli\u003e'OpenFileGDB'\u003c/li\u003e\u003cli\u003e'DXF'\u003c/li\u003e\u003cli\u003e'CAD'\u003c/li\u003e\u003cli\u003e'FlatGeobuf'\u003c/li\u003e\u003cli\u003e'Geoconcept'\u003c/li\u003e\u003cli\u003e'GeoRSS'\u003c/li\u003e\u003cli\u003e'VFK'\u003c/li\u003e\u003cli\u003e'PGDUMP'\u003c/li\u003e\u003cli\u003e'OSM'\u003c/li\u003e\u003cli\u003e'GPSBabel'\u003c/li\u003e\u003cli\u003e'OGR_PDS'\u003c/li\u003e\u003cli\u003e'WFS'\u003c/li\u003e\u003cli\u003e'OAPIF'\u003c/li\u003e\u003cli\u003e'EDIGEO'\u003c/li\u003e\u003cli\u003e'SVG'\u003c/li\u003e\u003cli\u003e'Idrisi'\u003c/li\u003e\u003cli\u003e'XLS'\u003c/li\u003e\u003cli\u003e'ODS'\u003c/li\u003e\u003cli\u003e'XLSX'\u003c/li\u003e\u003cli\u003e'Elasticsearch'\u003c/li\u003e\u003cli\u003e'Carto'\u003c/li\u003e\u003cli\u003e'AmigoCloud'\u003c/li\u003e\u003cli\u003e'SXF'\u003c/li\u003e\u003cli\u003e'Selafin'\u003c/li\u003e\u003cli\u003e'JML'\u003c/li\u003e\u003cli\u003e'PLSCENES'\u003c/li\u003e\u003cli\u003e'CSW'\u003c/li\u003e\u003cli\u003e'VDV'\u003c/li\u003e\u003cli\u003e'GMLAS'\u003c/li\u003e\u003cli\u003e'MVT'\u003c/li\u003e\u003cli\u003e'NGW'\u003c/li\u003e\u003cli\u003e'MapML'\u003c/li\u003e\u003cli\u003e'Parquet'\u003c/li\u003e\u003cli\u003e'Arrow'\u003c/li\u003e\u003cli\u003e'GTFS'\u003c/li\u003e\u003cli\u003e'PMTiles'\u003c/li\u003e\u003cli\u003e'JSONFG'\u003c/li\u003e\u003cli\u003e'MiraMonVector'\u003c/li\u003e\u003cli\u003e'TIGER'\u003c/li\u003e\u003cli\u003e'AVCBin'\u003c/li\u003e\u003cli\u003e'AVCE00'\u003c/li\u003e\u003cli\u003e'HTTP'\u003c/li\u003e\u003c/ol\u003e\n","content_type":"text/html"},"text/markdown":{"content":"1. 'FITS'\n2. 'PCIDSK'\n3. 'netCDF'\n4. 'PDS4'\n5. 'VICAR'\n6. 'JP2OpenJPEG'\n7. 'PDF'\n8. 'MBTiles'\n9. 'BAG'\n10. 'EEDA'\n11. 'OGCAPI'\n12. 'ESRI Shapefile'\n13. 'MapInfo File'\n14. 'UK .NTF'\n15. 'LVBAG'\n16. 'OGR_SDTS'\n17. 'S57'\n18. 'DGN'\n19. 'OGR_VRT'\n20. 'Memory'\n21. 'CSV'\n22. 'NAS'\n23. 'GML'\n24. 'GPX'\n25. 'LIBKML'\n26. 'KML'\n27. 'GeoJSON'\n28. 'GeoJSONSeq'\n29. 'ESRIJSON'\n30. 'TopoJSON'\n31. 'Interlis 1'\n32. 'Interlis 2'\n33. 'OGR_GMT'\n34. 'GPKG'\n35. 'SQLite'\n36. 'ODBC'\n37. 'WAsP'\n38. 'PGeo'\n39. 'MSSQLSpatial'\n40. 'PostgreSQL'\n41. 'OpenFileGDB'\n42. 'DXF'\n43. 'CAD'\n44. 'FlatGeobuf'\n45. 'Geoconcept'\n46. 'GeoRSS'\n47. 'VFK'\n48. 'PGDUMP'\n49. 'OSM'\n50. 'GPSBabel'\n51. 'OGR_PDS'\n52. 'WFS'\n53. 'OAPIF'\n54. 'EDIGEO'\n55. 'SVG'\n56. 'Idrisi'\n57. 'XLS'\n58. 'ODS'\n59. 'XLSX'\n60. 'Elasticsearch'\n61. 'Carto'\n62. 'AmigoCloud'\n63. 'SXF'\n64. 'Selafin'\n65. 'JML'\n66. 'PLSCENES'\n67. 'CSW'\n68. 'VDV'\n69. 'GMLAS'\n70. 'MVT'\n71. 'NGW'\n72. 'MapML'\n73. 'Parquet'\n74. 'Arrow'\n75. 'GTFS'\n76. 'PMTiles'\n77. 'JSONFG'\n78. 'MiraMonVector'\n79. 'TIGER'\n80. 'AVCBin'\n81. 'AVCE00'\n82. 'HTTP'\n\n\n","content_type":"text/markdown"},"text/latex":{"content":"\\begin{enumerate*}\n\\item 'FITS'\n\\item 'PCIDSK'\n\\item 'netCDF'\n\\item 'PDS4'\n\\item 'VICAR'\n\\item 'JP2OpenJPEG'\n\\item 'PDF'\n\\item 'MBTiles'\n\\item 'BAG'\n\\item 'EEDA'\n\\item 'OGCAPI'\n\\item 'ESRI Shapefile'\n\\item 'MapInfo File'\n\\item 'UK .NTF'\n\\item 'LVBAG'\n\\item 'OGR\\_SDTS'\n\\item 'S57'\n\\item 'DGN'\n\\item 'OGR\\_VRT'\n\\item 'Memory'\n\\item 'CSV'\n\\item 'NAS'\n\\item 'GML'\n\\item 'GPX'\n\\item 'LIBKML'\n\\item 'KML'\n\\item 'GeoJSON'\n\\item 'GeoJSONSeq'\n\\item 'ESRIJSON'\n\\item 'TopoJSON'\n\\item 'Interlis 1'\n\\item 'Interlis 2'\n\\item 'OGR\\_GMT'\n\\item 'GPKG'\n\\item 'SQLite'\n\\item 'ODBC'\n\\item 'WAsP'\n\\item 'PGeo'\n\\item 'MSSQLSpatial'\n\\item 'PostgreSQL'\n\\item 'OpenFileGDB'\n\\item 'DXF'\n\\item 'CAD'\n\\item 'FlatGeobuf'\n\\item 'Geoconcept'\n\\item 'GeoRSS'\n\\item 'VFK'\n\\item 'PGDUMP'\n\\item 'OSM'\n\\item 'GPSBabel'\n\\item 'OGR\\_PDS'\n\\item 'WFS'\n\\item 'OAPIF'\n\\item 'EDIGEO'\n\\item 'SVG'\n\\item 'Idrisi'\n\\item 'XLS'\n\\item 'ODS'\n\\item 'XLSX'\n\\item 'Elasticsearch'\n\\item 'Carto'\n\\item 'AmigoCloud'\n\\item 'SXF'\n\\item 'Selafin'\n\\item 'JML'\n\\item 'PLSCENES'\n\\item 'CSW'\n\\item 'VDV'\n\\item 'GMLAS'\n\\item 'MVT'\n\\item 'NGW'\n\\item 'MapML'\n\\item 'Parquet'\n\\item 'Arrow'\n\\item 'GTFS'\n\\item 'PMTiles'\n\\item 'JSONFG'\n\\item 'MiraMonVector'\n\\item 'TIGER'\n\\item 'AVCBin'\n\\item 'AVCE00'\n\\item 'HTTP'\n\\end{enumerate*}\n","content_type":"text/latex"},"text/plain":{"content":" [1] \"FITS\"           \"PCIDSK\"         \"netCDF\"         \"PDS4\"          \n [5] \"VICAR\"          \"JP2OpenJPEG\"    \"PDF\"            \"MBTiles\"       \n [9] \"BAG\"            \"EEDA\"           \"OGCAPI\"         \"ESRI Shapefile\"\n[13] \"MapInfo File\"   \"UK .NTF\"        \"LVBAG\"          \"OGR_SDTS\"      \n[17] \"S57\"            \"DGN\"            \"OGR_VRT\"        \"Memory\"        \n[21] \"CSV\"            \"NAS\"            \"GML\"            \"GPX\"           \n[25] \"LIBKML\"         \"KML\"            \"GeoJSON\"        \"GeoJSONSeq\"    \n[29] \"ESRIJSON\"       \"TopoJSON\"       \"Interlis 1\"     \"Interlis 2\"    \n[33] \"OGR_GMT\"        \"GPKG\"           \"SQLite\"         \"ODBC\"          \n[37] \"WAsP\"           \"PGeo\"           \"MSSQLSpatial\"   \"PostgreSQL\"    \n[41] \"OpenFileGDB\"    \"DXF\"            \"CAD\"            \"FlatGeobuf\"    \n[45] \"Geoconcept\"     \"GeoRSS\"         \"VFK\"            \"PGDUMP\"        \n[49] \"OSM\"            \"GPSBabel\"       \"OGR_PDS\"        \"WFS\"           \n[53] \"OAPIF\"          \"EDIGEO\"         \"SVG\"            \"Idrisi\"        \n[57] \"XLS\"            \"ODS\"            \"XLSX\"           \"Elasticsearch\" \n[61] \"Carto\"          \"AmigoCloud\"     \"SXF\"            \"Selafin\"       \n[65] \"JML\"            \"PLSCENES\"       \"CSW\"            \"VDV\"           \n[69] \"GMLAS\"          \"MVT\"            \"NGW\"            \"MapML\"         \n[73] \"Parquet\"        \"Arrow\"          \"GTFS\"           \"PMTiles\"       \n[77] \"JSONFG\"         \"MiraMonVector\"  \"TIGER\"          \"AVCBin\"        \n[81] \"AVCE00\"         \"HTTP\"          ","content_type":"text/plain"}}}],"key":"d31Z8cBHVR"}],"key":"anSmDiuzpD"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":1691,"column":1},"end":{"line":1693,"column":1}},"children":[{"type":"text","value":"The GeoPackage format is generally more convenient because it is a single file and can\nhold multiple layers.  The code below saves the four processed VML subsets to a single\nGeoPackage file.","position":{"start":{"line":1691,"column":1},"end":{"line":1691,"column":1}},"key":"fGRMXcHJY1"}],"key":"DaClrG6qcd"}],"key":"XZgzvA20rO"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Save the VML to GPKG\nst_write(silwood_VML_roads, dsn=\"OS_VML_Silwood_NHM.gpkg\", layer=\"silwood_VML_roads\")\nst_write(nhm_VML_roads, dsn=\"OS_VML_Silwood_NHM.gpkg\", layer=\"nhm_VML_roads\")\nst_write(silwood_VML_water, dsn=\"OS_VML_Silwood_NHM.gpkg\", layer=\"silwood_VML_water\")\nst_write(nhm_VML_water, dsn=\"OS_VML_Silwood_NHM.gpkg\", layer=\"nhm_VML_water\")","key":"scvHA59jMD"},{"type":"output","id":"wg1TQR1q4qvRousoXa3he","data":[{"output_type":"stream","name":"stdout","text":"Writing layer `silwood_VML_roads' to data source \n  `OS_VML_Silwood_NHM.gpkg' using driver `GPKG'\nWriting 780 features with 5 fields and geometry type Unknown (any).\n"},{"output_type":"stream","name":"stdout","text":"Writing layer `nhm_VML_roads' to data source \n  `OS_VML_Silwood_NHM.gpkg' using driver `GPKG'\nWriting 3154 features with 5 fields and geometry type Unknown (any).\n"},{"output_type":"stream","name":"stdout","text":"Writing layer `silwood_VML_water' to data source \n  `OS_VML_Silwood_NHM.gpkg' using driver `GPKG'\nWriting 113 features with 3 fields and geometry type Polygon.\n"},{"output_type":"stream","name":"stdout","text":"Writing layer `nhm_VML_water' to data source \n  `OS_VML_Silwood_NHM.gpkg' using driver `GPKG'\nWriting 37 features with 3 fields and geometry type Polygon.\n"}],"key":"neAmDqEwVy"}],"key":"t2evrkGszf"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":1704,"column":1},"end":{"line":1707,"column":1}},"children":[{"type":"text","value":"Although the Shapefile format is more widely known, the inconvience of having multiple\nfiles is high and often leads to problems with incomplete datasets. It also has some odd\nconstraints - as you can see in the output below, there is a limit to the length of\nattribute table field names in shapefiles.","position":{"start":{"line":1704,"column":1},"end":{"line":1704,"column":1}},"key":"zZi2AFshxh"}],"key":"bmOdGv42N1"}],"key":"nQXkLLzzn1"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"r","executable":true,"value":"# Save the sensors as shapefile\nst_write(sensor_locations, dsn=\"sensor_locations.shp\")","key":"R9u7Y5UJp7"},{"type":"output","id":"86zNwO6Dep7YyVRf2rBUj","data":[{"output_type":"stream","name":"stderr","text":"Warning message in abbreviate_shapefile_names(obj):\n“Field names abbreviated for ESRI Shapefile driver”\n"},{"output_type":"stream","name":"stdout","text":"Writing layer `sensor_locations' to data source \n  `sensor_locations.shp' using driver `ESRI Shapefile'\nWriting 18 features with 24 fields and geometry type Point.\n"}],"key":"KNrYRg91QI"}],"key":"mBxC5OBnGM"}],"key":"l4e1gHxvAD"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Required packages and data","short_title":"Requirements","url":"/practical-requirements","group":"Ecological and Evolutionary Data Science"},"next":{"title":"Microclimate sensor data analysis in R","short_title":"Microclimate","url":"/microclimate-sensor-analysis-easylog","group":"Ecological and Evolutionary Data Science"}}},"domain":"http://localhost:3001"},"project":{"title":"Ecological and Evolutionary Data Science","toc":[{"file":"intro.md"},{"file":"practical_requirements.md"},{"file":"gis_practical/gis_practical.md"},{"file":"microclimate/microclimate_sensor_analysis_EasyLog.md"}],"exports":[],"bibliography":[],"index":"index","pages":[{"slug":"practical-requirements","title":"Required packages and data","short_title":"Requirements","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"gis-practical","title":"Spatial methods in Ecological and Evolutionary Data Science","short_title":"Spatial Methods","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"microclimate-sensor-analysis-easylog","title":"Microclimate sensor data analysis in R","short_title":"Microclimate","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1}]}}},"actionData":null,"errors":null},"future":{"unstable_dev":false,"unstable_postcss":false,"unstable_tailwind":false,"v2_errorBoundary":true,"v2_headers":true,"v2_meta":true,"v2_normalizeFormMethod":true,"v2_routeConvention":true}};</script><script type="module" async="">import "https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/manifest-51D9907C.js";
import * as route0 from "https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/root-TRTRBUUN.js";
import * as route1 from "https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/routes/$-VLPGWU3Z.js";
window.__remixRouteModules = {"root":route0,"routes/$":route1};

import("https://imperialcollegelondon.github.io/living_planet_eco_evo_data/build/entry.client-PCJPW7TK.js");</script></body></html>